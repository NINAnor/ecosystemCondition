[{"path":"index.html","id":"about","chapter":"About ","heading":"About ","text":"site may view details certain indicators ecosystem condition Norway calculated.web page made document work related R&D project develop indicators ecosystem condition three main ecosystems Norway: wetlands, open areas forest line, semi-natural land. indicators yet used real assessments, may represent unfinished work pending future data availability. addition, may chose also present analyses documenting indicators used existing assessments ecosystem condition.","code":""},{"path":"index.html","id":"eatools","chapter":"About ","heading":"eaTools ","text":"eaTools R package aimed solving common tasks GIS oriented ecosystem accounting, especially ecosystem condition accounting. use functions package, function normalise condition variables seen Figure 0.1.\nFigure 0.1: normalised condition variable called indicator. indicator transformed sigmoid function.\nSee package documentation, especially Articles information examples use.","code":"\n#devtools::install_github(\"NINAnor/eaTools\")\nlibrary(eaTools)\n\n# Import example data\ndata(\"ex_polygons\")\n\n# Use the questionmark to readabout the example data sets or to view the  function documentation \n#?ex_polygons\n\neaTools::ea_normalise(data = ex_polygons,\n             vector = \"condition_variable_2\",\n             upper_reference_level = 7,\n             scaling_function = \"sigmoid\",\n             plot = T)"},{"path":"index.html","id":"community-review","chapter":"About ","heading":"Community review","text":"want work transparent credible. Therefor encourage types feedback analyses indicators ecological condition can read web site. submit comments, please github repository open new issue answer .","code":""},{"path":"index.html","id":"author-guidelines","chapter":"About ","heading":"Author guidelines","text":"project uses type standardised reporting reproducible workflows (typically code) calculating indicator presented separate webpages within shared website. website built GitHub repo using seperate RMarkdown files chapter. files must English. process authoring sharing/distributing Rmarkdown-files explained .highly encouraged indicators delivered georeferenced maps, hereafter called indicator maps, simple tables. common structure indicator maps follow. indicator maps can vector formats raster formats. vector data, .Rdata .rds files can used, example shape files allow field names (.e. column names) long ones use. georeferenced data use EPSG:25833 - ETRS89 / UTM zone 33N.Indicator maps highest possible spatial resolution possible weighing need spatial representativity. example, may need aggregate x number data points get average stable representative given region. need spatially aggregate indicator maps , example produce national estimate.indicator values, reference values ect mapped following columns (vector data) bands (raster data):v_YYYY variable value (.e. un-scaled raw indicator values) year YYYY.sd_YYYY standard deviation associated v_YYYY. measures uncertainty currently supported.referance_high reference value, .e. value variable v reference conditions. value vary years.referance_low lower limit reference value, .e. worst possible value variable v. value vary years. missing, value assumed zero.thr threshold value defining good condition variable v. missing, value default 0.6.i_YYYY indicator value year YYYY. value depends values, also scaling function (.e. linear, exponential, two-sided, ect.). scaling function needs presented documentation.rest workflow follows.Obtain go ahead signal coordination group make sure free start workRead template.Rmd file. Make copy store , (root) folder DRAFT_myIndicator.Rmd. (example, see DRAFT_breareal.Rmd). Finish documentation analyses .\ncan load data internal NINA servers, web hosts, store smaller data set data. data folder also contains supporting data sets may want use, delineation five regions used ecosystem assessment (data/regions.shp), outline Norway (outlineOfNorway_EPSG25833.shp).\npreview rmarkdown file html R, type rmarkdown::render('DRAFT_myIndicator.Rmd', output_format = \"html_document\", output_dir = \"temp\") console (knitr shortcuts don’t work expected inside bookdown projects).\nfilling template.Rmd file work, try change headers much.\nFinal result analyses written indicators folder. preferred output georeferenced data (rasters shape files), placed indators/indicatorMaps. Non-georeferenced data, like data tables, can stored indicators.\ncan load data internal NINA servers, web hosts, store smaller data set data. data folder also contains supporting data sets may want use, delineation five regions used ecosystem assessment (data/regions.shp), outline Norway (outlineOfNorway_EPSG25833.shp).preview rmarkdown file html R, type rmarkdown::render('DRAFT_myIndicator.Rmd', output_format = \"html_document\", output_dir = \"temp\") console (knitr shortcuts don’t work expected inside bookdown projects).filling template.Rmd file work, try change headers much.Final result analyses written indicators folder. preferred output georeferenced data (rasters shape files), placed indators/indicatorMaps. Non-georeferenced data, like data tables, can stored indicators.Make pull request main GitHub repository submit file. comfortable using GitHub, contac Anders rrange sending files via email.Anders someone else project wil conduct rapid code review, making sure code reproducible, interpretable renders locally R Studio server.approved, reviewer make copy DRAFT_ file, removing DRAFT_ part name, well YML header, well updating rmd_files part _bookdown.yml. (example file, see breareal.Rmd.)update web site (web site), admin user needs pull repo R Studio server, compile book (Ctr+Shift+B), commit push main. html version book docs folder.","code":""},{"path":"index.html","id":"citation","chapter":"About ","heading":"Citation","text":"cite book please use following citation:Kolstad, .L., Topper, J. Grainger, M.J., Sandvik, H. Indicators Ecosystem Condition Norway. https://ninanor.github.io/ecosystemCondition/index.html.doi [TBA]","code":""},{"path":"index.html","id":"license","chapter":"About ","heading":"0.1 License","text":"book licensed CC 4.0 licence means can share adapt material\npurpose. However, must give appropriate credit, provide link license, indicate changes made. can add additional restrictions material even adapted.","code":""},{"path":"overview-of-indicators.html","id":"overview-of-indicators","chapter":"Overview of indicators","heading":"Overview of indicators","text":"Lacking content\nidea page give quick overview available indicators, possibly present Norwegian fact sheets . now page just example look like.","code":""},{"path":"overview-of-indicators.html","id":"areal-av-isbreer-glacier-area","chapter":"Overview of indicators","heading":"Areal av isbreer / Glacier area","text":"indicator reflects relative loss glacial area tha last climatic normal persion today.\nTable 0.1: Fakatark tilstandindikatoren Areal av isbreer\n","code":""},{"path":"overview-of-indicators.html","id":"indicator-x","chapter":"Overview of indicators","heading":"Indicator X","text":"indicator …","code":""},{"path":"slitasje-og-kjørespor.html","id":"slitasje-og-kjørespor","chapter":"1 Slitasje og kjørespor","heading":"1 Slitasje og kjørespor","text":"Author date:Anders L. KolstadMarch 2023","code":""},{"path":"slitasje-og-kjørespor.html","id":"introduction","chapter":"1 Slitasje og kjørespor","heading":"1.1 Introduction","text":"indicator represent human caused damage disturbance soils vegetation, typically things like recreational activities -road vehicle traffic. data come combination non-random field surveys area-representative surveys. Disturbance soils vegetation recorded various data sets NiN variables 7SE 7TK, similar, fine-scaled variable, PRSL PRTK. Effects domestic animal included definition variables, upper reference value therefore set 0% disturbance.Since data sampled systematic random way, must take extra care -extrapolate space. delineate homogeneous impact areas (HIA) based four classes increasing infrastructure, say field data representative inside HIA region (five regions Norway) recorded. calculate area weighted mean (error) indicator value HIA region combination, long 150 data points give combination HIA region.general workflow calculation indicator.Import Nature type data data set (incl. GRUK) ANO data\nsetImport Nature type data data set (incl. GRUK) ANO data\nsetIdentify relevant nature types subset\ndataIdentify relevant nature types subset\ndataConvert ANO points polygonsConvert ANO points polygonsFor polygon, extract NiN-variable lowest value\n(one--principle), e.g. Fig. 1.7.polygon, extract NiN-variable lowest value\n(one--principle), e.g. Fig. 1.7.Combine data setsCombine data setsScale slitasje variable based \nreference values.Scale slitasje variable based \nreference values.Define homogeneous impact areas (HIA)Define homogeneous impact areas (HIA)Aggregate spread indicator value across HIAs\nassessment regionsAggregate spread indicator value across HIAs\nassessment regionsConfirm relationship infrastructure index indicator\nvalues justify extrapolationConfirm relationship infrastructure index indicator\nvalues justify extrapolationTO : Prepare ecosystem delineation maps us ethese mask extrapolated indicator mapsTO : Prepare ecosystem delineation maps us ethese mask extrapolated indicator mapsSpatial aggregation indicator values uncertainties accounting areasSpatial aggregation indicator values uncertainties accounting areasExport indicator maps regional extrapolated mapsExport indicator maps regional extrapolated maps","code":""},{"path":"slitasje-og-kjørespor.html","id":"about-the-underlying-data","chapter":"1 Slitasje og kjørespor","heading":"1.2 About the underlying data","text":"indicator uses data set standardised field survey nature\ntypes. can read preliminary analyses\n. See also official\nsite\nEnvironment Agency. also import data set called\nANO, can read \n","code":""},{"path":"slitasje-og-kjørespor.html","id":"representativity-in-time-and-space","chapter":"1 Slitasje og kjørespor","heading":"1.2.1 Representativity in time and space","text":"nature type mapping random said area\nrepresentative. ANO data set however, area representative. \ndata 2018 present. data one field season usually\nbecomes available early following year.","code":""},{"path":"slitasje-og-kjørespor.html","id":"original-units","chapter":"1 Slitasje og kjørespor","heading":"1.2.2 Original units","text":"variables recorded coarse four-step ordinal scale (Fig.\n1.4) eigth-step scale.","code":""},{"path":"slitasje-og-kjørespor.html","id":"temporal-coverage","chapter":"1 Slitasje og kjørespor","heading":"1.2.3 Temporal coverage","text":"data goes back 2018. therefore bulk data 2018 2022 one time step. use mean date raw data,\ndefine variable belonging year 2020 (read \n).","code":""},{"path":"slitasje-og-kjørespor.html","id":"aditional-comments-about-the-dataset","chapter":"1 Slitasje og kjørespor","heading":"1.2.4 Aditional comments about the dataset","text":"run nature type data set, see .","code":""},{"path":"slitasje-og-kjørespor.html","id":"ecosystem-characteristic","chapter":"1 Slitasje og kjørespor","heading":"1.3 Ecosystem characteristic","text":"","code":""},{"path":"slitasje-og-kjørespor.html","id":"norwegain-standard","chapter":"1 Slitasje og kjørespor","heading":"1.3.1 Norwegain standard","text":"indicator tagged Økologisk egenskap called\nPrimærproduksjon (Primary productivity). tentative, \nperhaps abiotiske forhold suited. thought behind \nchoice slitasje affect potential primary productivity.","code":""},{"path":"slitasje-og-kjørespor.html","id":"un-standard","chapter":"1 Slitasje og kjørespor","heading":"1.3.2 UN standard","text":"indicator tagged Physical state characteristics\nindicator. quite clear. ’s type abiotic characteristic \nphysical structure rather chemical\ncomposition.","code":""},{"path":"slitasje-og-kjørespor.html","id":"collinearities-with-other-indicators","chapter":"1 Slitasje og kjørespor","heading":"1.4 Collinearities with other indicators","text":"Slitasje thought exhibit collinearity indicator \npresent.","code":""},{"path":"slitasje-og-kjørespor.html","id":"reference-condition-and-values","chapter":"1 Slitasje og kjørespor","heading":"1.5 Reference condition and values","text":"","code":""},{"path":"slitasje-og-kjørespor.html","id":"reference-condition","chapter":"1 Slitasje og kjørespor","heading":"1.5.1 Reference condition","text":"reference condition one minimal negative human impact. \nalso true semi-natural ecosystems. example, reference\ncondition, slitasje semi-natural ecosystems defined zero,\neven though point time condition realized.","code":""},{"path":"slitasje-og-kjørespor.html","id":"reference-values-thresholds-for-defining-good-ecological-condition-minimum-andor-maximum-values","chapter":"1 Slitasje og kjørespor","heading":"1.5.2 Reference values, thresholds for defining good ecological condition, minimum and/or maximum values","text":"Upper = 0%Upper = 0%Threshold = 10%Threshold = 10%Lower = 100%Lower = 100%upper reference value 0 (slitasje), lower reference\nvalue 100%. Note 100% slitasje mean area\nmust scarred damaged, hypothetical quadrats around \npoint affected (variable frequency-driven, \namount-driven). threshold good ecosystem condition 10%\ndamage. Perhaps set somewhat higher, like 20 30%.\nindicator value interpretted differently polygon\nvs landscape scale. polygon scale, 10% damage may seem\nlike much, whilst landscape scale, 10% seems serious.\nfinal threshold value debated illustrated examples.Read normalisation .","code":""},{"path":"slitasje-og-kjørespor.html","id":"uncertainties","chapter":"1 Slitasje og kjørespor","heading":"1.6 Uncertainties","text":"Uncertainties/errors estimated aggregated indicator values \nbootstrapping individual indicator values 1000 times calculating \ndistribution area weighted means. See documentation eaTools::ea_spread .\nuncertainty different \nspatial variation get straight forward without\nbootstrapping. aggregating second time,\nhomogeneous impact areas accounting areas, assume normal\ndistribution around indicator values, already mentioned\nerrors, sample n times combine resamples \nnew, area weighted, distribution. errors accounting areas\nthus represents spatial variation, precision, \nindicator values within accounting areas.","code":""},{"path":"slitasje-og-kjørespor.html","id":"references","chapter":"1 Slitasje og kjørespor","heading":"1.7 References","text":"additional references.","code":""},{"path":"slitasje-og-kjørespor.html","id":"analyses","chapter":"1 Slitasje og kjørespor","heading":"1.8 Analyses","text":"","code":""},{"path":"slitasje-og-kjørespor.html","id":"data-sets","chapter":"1 Slitasje og kjørespor","heading":"1.8.1 Data sets","text":"","code":""},{"path":"slitasje-og-kjørespor.html","id":"NTM","chapter":"1 Slitasje og kjørespor","heading":"1.8.1.1 Nature type mapping","text":"indicator uses data set\nNaturtyper etter Miljødirektoratets Instruks, can found\n.\nSee also detailed description data set.also separate summary file \nnature types manually mapped NiN variables correct NiN-main types. can use find nature types associated NiN main types\ninterested .interested mapping units include target variables.deleted 17 nature types left us :Importing sub-setting main data file, fix duplicate hovedøkosystem, calculate area, split one column two, make numeric, select target variables:\nFigure 1.1: overview naturetypes calculate indicator. Colours refer main ecosystem affiliation.\nColumn names starting number problematic, adding prefix\nFigure 1.2: Distribution data points time.\nNow need create single row per locality new variable \nproduct/function four variables “7SE”, “7TK”, “PRTK” \n“PRSL”. want base indicator whichever variables highest value (worst condition). Therefore first convert ordinal scale continuous scale, using median value ordinal step.variables use slightly different scales. PRSL PRTK use 8\nstep scale:\nFigure 1.3: Eight step condition scale\n7TK 7SE use 4 step scale\nFigure 1.4: Four step condition scale\ntransfer ordinal variables continuous scale.create new data table calculate new\nvariable paste back sf object.First combine 7TK PRTK, also 7SE PRSLSE 10064\nNA’s, TK \n7007.\nFigure 1.5: 7SE scores naturetype dataset\nNA fraction quite big. localities 7TK PRTK recorded,\n7SE PRSL.\nFigure 1.6: 7TK scores nature type dataset\ncan combine two variables composite variable called\nslitasjeWhen variables NA, get -Inf. 13 cases . Removing now.\nFigure 1.7: Slitasje scores.\nappears localities good condition.also like know, tk SE recordedm\noften TK defining slitasje-indicator, \noften SE. can taking difference.\nFigure 1.8: Counting number cases TK SE defining slitasje indicator score.\nLooks like SE (= 7SE PRSL) likely detrimental state.Now copy slitasje-values sf object.","code":"\nnaturetypes_summary_import <- readRDS(\"data/naturetypes/natureType_summary.rds\")\nmyVars <- c('7TK', '7SE', 'PRTK', 'PRSL')\nnaturetypes_summary <- naturetypes_summary_import %>%\n  rowwise() %>%\n  mutate(keepers = sum(c_across(\n    all_of(myVars))>0, na.rm=T)) %>%\n  filter(keepers > 0) %>%\n  select(Nature_type, NiN_mainType, Year)\nDT::datatable(naturetypes_summary)\nnaturetypes <- sf::st_read(dsn = path) %>%\n  filter(naturtype %in% naturetypes_summary$Nature_type) %>%\n  mutate(hovedøkosystem = recode(hovedøkosystem,\n                                 \"naturligÅpneOmråderUnderSkoggrensa\" = \"naturligÅpneOmråderILavlandet\"),\n         area = st_area(.)) %>%\n  separate_rows(ninBeskrivelsesvariable, sep=\",\") %>%\n  separate(col = ninBeskrivelsesvariable,\n           into = c(\"NiN_variable_code\", \"NiN_variable_value\"),\n           sep = \"_\",\n           remove=F) %>%\n  mutate(NiN_variable_value = as.numeric(NiN_variable_value)) %>%\n  filter(NiN_variable_code %in% myVars)\n#> Reading layer `Naturtyper_nin_0000_norge' from data source \n#>   `/data/R/GeoSpatialData/Habitats_biotopes/Norway_Miljodirektoratet_Naturtyper_nin/Original/Naturtyper_nin_0000_norge_25833_FILEGDB/Naturtyper_nin_0000_norge_25833_FILEGDB.gdb' \n#>   using driver `OpenFileGDB'\n#> Simple feature collection with 117427 features and 36 fields\n#> Geometry type: MULTIPOLYGON\n#> Dimension:     XY\n#> Bounding box:  xmin: -74953.52 ymin: 6448986 xmax: 1075081 ymax: 7921284\n#> Projected CRS: ETRS89 / UTM zone 33N\n#> Warning: There was 1 warning in `stopifnot()`.\n#> ℹ In argument: `NiN_variable_value =\n#>   as.numeric(NiN_variable_value)`.\n#> Caused by warning:\n#> ! NAs introduced by coercion\nggplot(data = naturetypes, aes(x = naturtype, fill = hovedøkosystem))+\n  geom_bar()+\n  coord_flip()+\n  theme_bw(base_size = 12)+\n  theme(legend.position = \"top\",\n        legend.title = element_blank(),\n        legend.direction = \"vertical\")+\n  #guides(fill = \"none\")+\n  xlab(\"\")+\n  ylab(\"Number of localities\")\nnaturetypes$NiN_variable_code <- paste0(\"var_\", naturetypes$NiN_variable_code)\nbarplot(table(naturetypes$kartleggingsår))\nknitr::include_graphics(\"images/mdirPRscale.PNG\")\nknitr::include_graphics(\"images/ninAR4b.PNG\")\nnaturetypes <- naturetypes %>%\n  mutate(NiN_variable_value = case_when(\n    NiN_variable_code %in% c(\"var_7TK\", \"var_7SE\") ~ \n      case_match(NiN_variable_value,\n             0 ~ 0,\n             1 ~ mean(c(0, 1/16))*100,\n             2 ~ mean(c(1/16, 1/2))*100,\n             3 ~ 75),\n    NiN_variable_code %in% c('var_PRTK', 'var_PRSL') ~ \n      case_match(NiN_variable_value,\n             0 ~ 0,\n             1 ~ 1.5,\n             2 ~ mean(c(3, 6.25)),\n             3 ~ mean(c(6.25, 12.5)),\n             4 ~ mean(c(12.5, 25)),\n             5 ~ mean(c(25, 50)),\n             6 ~ mean(c(50, 75)),\n             7 ~ mean(c(75, 100)))\n    )\n  )\nnaturetypes_wide <- pivot_wider(naturetypes,\n                                names_from = \"NiN_variable_code\",\n                                values_from = \"NiN_variable_value\",\n                                id_cols = \"identifikasjon_lokalId\")\nnaturetypes_wide <- as.data.frame(naturetypes_wide)\nhead(naturetypes_wide, 10)\n#>    identifikasjon_lokalId var_PRSL var_7TK var_7SE var_PRTK\n#> 1         NINFP2210087853      0.0       0      NA       NA\n#> 2         NINFP2210087857      0.0       0      NA       NA\n#> 3         NINFP1910012022       NA      NA   0.000       NA\n#> 4         NINFP1910005432      1.5      NA      NA       NA\n#> 5         NINFP2210089748       NA       0   0.000       NA\n#> 6         NINFP2210096062       NA      NA   0.000      0.0\n#> 7         NINFP1910029434       NA      NA   3.125      1.5\n#> 8         NINFP2010029112       NA       0   0.000       NA\n#> 9         NINFP2010029325       NA       0   0.000       NA\n#> 10        NINFP1910057556       NA      NA   0.000       NA\nnaturetypes_wide <- naturetypes_wide %>%\n  mutate(TK = if_else(\n    is.na(var_PRTK), var_7TK, var_PRTK),\n    SE = if_else(\n      is.na(var_PRSL), var_7SE, var_PRSL)\n    )\ntemp <- naturetypes_wide %>%\n  group_by(SE) %>%\n  summarise(sum = n())\n\nggplot(temp, aes(x = factor(SE),\n                 y = sum))+\n  geom_bar(stat=\"identity\",\n           fill=\"grey\",\n           colour = \"black\")+\n  theme_bw(base_size = 12)+\n  labs(x = \"7SE or PRSL score\",\n       y = \"Number of localities\")\ntemp <- naturetypes_wide %>%\n  group_by(TK) %>%\n  summarise(sum = n())\n\nggplot(temp, aes(x = factor(TK),\n                 y = sum))+\n  geom_bar(stat=\"identity\",\n           fill=\"grey\",\n           colour = \"black\")+\n  theme_bw(base_size = 12)+\n  labs(x = \"7TK og PRTK score\",\n       y = \"Number of localities\")\nnaturetypes_wide$slitasje <- apply(naturetypes_wide[,c(\"TK\", \"SE\")], 1, max, na.rm=T)\nnaturetypes_wide <- naturetypes_wide[naturetypes_wide$slitasje>=0,]\ntemp <- naturetypes_wide %>%\n  group_by(slitasje) %>%\n  summarise(sum = n())\n\nggplot(temp, aes(x = factor(slitasje),\n                 y = sum))+\n  geom_bar(stat=\"identity\",\n           fill=\"grey\",\n           colour = \"black\")+\n  theme_bw(base_size = 12)+\n  labs(x = \"Slitasje score converted to percentage\",\n       y = \"Number of localities\") + \n  theme(axis.text.x = element_text(angle=90, vjust=0.5))\n\n\ndiff <- naturetypes_wide$SE - naturetypes_wide$TK\n\ndiff <- ifelse(diff == 0, \"TK and SE\",\n               ifelse(diff <0, \"TK\", \"SE\"))\n\ndiff_tbl <- as.data.frame(table(diff))\n\nggplot(diff_tbl, aes(x = diff, y = Freq))+\n  geom_bar(stat = \"identity\",\n           colour = \"black\",\n           fill = \"grey\")+\n  theme_bw(base_size = 12)+\n  labs(x = \"Defining variable\",\n       y = \"Number of localities\")\nnaturetypes$slitasje <- naturetypes_wide$slitasje[match(naturetypes$identifikasjon_lokalId, naturetypes_wide$identifikasjon_lokalId)]\n#nrow(naturetypes[is.na(naturetypes$slitasje),])  # 13 cases\nnaturetypes <- naturetypes[!is.na(naturetypes$slitasje),]"},{"path":"slitasje-og-kjørespor.html","id":"gruk","chapter":"1 Slitasje og kjørespor","heading":"1.8.1.2 GRUK","text":"variable also recorded \nGRUK.\nnature type data set ’m working includes data already\n(presently 2021 included). GRUK also records related variable:\n% cover 5m radii circles, much detailed. data \npublished. case better use harmonized data set\ncase.","code":""},{"path":"slitasje-og-kjørespor.html","id":"ANO-import","chapter":"1 Slitasje og kjørespor","heading":"1.8.1.3 ANO","text":"Arealrepresentativ Naturovervåking (ANO) consist 1000 systematically\nplaced locations 18 sample points. sample point \ncircle 250 m2 visualised, main ecosystem recorded.\nDepending main ecosystem, certain NiN variables also\nrecorded. 7SE recorded våtmark, semi-natural areas \nnaturally open areas. 7TK recorded våtmark naturally open\nareas .Table showing main ecosystems two NiN variables 7SE 7TK\nrecorded withing ANO data set.nice 7SE recorded naturally open areas.\nvariable relevant .think use våtmark since approach \n‘worst value’ variable 7SE 7TK (see ). think \n7SE naturally open areas underestimate degree \ndegredation areas.ANO harmonise better Naturetype data set included\n7SE 7TK Naturally open Semi natural ecosystem.data set contains data year 2019 2021. need \nupdate data set later. clear data \n2020.point/row 250 square meters. data also contains\ninformation big proportion area made \ndominant main ecosystem. However, \n130\nNA’s , 19% data.appears proportion circle made dominant\necosystem recorded year 2019. fact, main ecosystem\nrecorded 2019:can remove NA’s, thus 2019 data.2019 ANO data excluded missing informationLet’s look variation recorded proportion ecosystem\ncover\nFigure 1.9: Distribution ANO variable andel_hovedoekosystem_punkt wetland localities.\nzero obvious mistake.’s another plot distribution variable:\nFigure 1.10: Percentage cover Våtmark main ecosystem 250m2 circle\ncan see people tend record variable steps 5%, \nsample points 100% belonging main ecosystem.want use area weighting indicator, can use \npercentage cover data calculate area. Note data sets\nuse m2 area units.Let’s now look distribution variables. First need \nseparate variable name values . Now data\nlooks like :create new variable prefixed var_:NA’s case blank cells. field app allow\nusers leaving field blank. need remove rows. \nfourteen cases:variable 7TKNo NA’s time.ANO field app allow user leave blank cells. \nresulted exclusion data.\nFigure 1.11: Distribution 7TK 7SE scores ANO data\nANO sites seem even better condition localities naturtype data set.Combining two variables 7TJ 7SE one, nature\ntype data.extract mid values ordinal range step, like previously nature type data set.\nFigure 1.12: Distribution slitasje scores ANO data\n","code":"\nano <- sf::st_read(paste0(pData, \"Naturovervaking_eksport.gdb\"),\n                   layer = \"ANO_SurveyPoint\") %>%\n  dplyr::filter(hovedoekosystem_punkt == \"vaatmark\")\n#> Reading layer `ANO_SurveyPoint' from data source \n#>   `/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/Naturovervaking_eksport.gdb' \n#>   using driver `OpenFileGDB'\n#> Simple feature collection with 8974 features and 71 fields\n#> Geometry type: POINT\n#> Dimension:     XY\n#> Bounding box:  xmin: -51950 ymin: 6467050 xmax: 1094950 ymax: 7923950\n#> Projected CRS: ETRS89 / UTM zone 33N\ntable(ano$aar)\n#> \n#> 2019 2021 \n#>  130  558\n# Hard coding name change\n#unique(ano$hovedtype_250m2)[3]\n#ano$hovedtype_250m2[ano$hovedtype_250m2==unique(ano$hovedtype_250m2)[3]] <- \"Aapen jordvassmyr\"\ntable(ano$hovedtype_250m2, ano$aar)\n#>                             \n#>                              2019 2021\n#>   Åpen jordvannsmyr             0  416\n#>   Boreal hei                    0    1\n#>   Fjellhei leside og tundra     0    3\n#>   Grøftet torvmark              0    5\n#>   Helofytt-ferskvannssump       0    3\n#>   Kaldkilde                     0    2\n#>   Myr- og sumpskogsmark         0   51\n#>   Nedbørsmyr                    0   53\n#>   Rasmark                       0    1\n#>   Semi-naturlig myr             0    7\n#>   Semi-naturlig våteng          0    2\n#>   Skogsmark                     0    2\n#>   Strandsumpskogsmark           0    2\n#>   Våtsnøleie og snøleiekilde    0    6\nano <- ano[!is.na(ano$andel_hovedoekosystem_punkt),]\npar(mar=c(5,6,4,2))\nplot(ano$andel_hovedoekosystem_punkt[order(ano$andel_hovedoekosystem_punkt)],\n     ylab=\"Percentage of the 250 m2 area\\ncovered by the main ecosystem\")\nano <- ano[ano$andel_hovedoekosystem_punkt>20,]\nggplot(ano, aes(x = andel_hovedoekosystem_punkt))+\n         geom_histogram(fill = \"grey\",\n                        colour=\"black\",\n                        binwidth = 1)+\n  theme_bw(base_size = 12)+\n  xlab(\"Percentage cover of the Våtmark main ecosystem\\n in the 250m2 circle\")+\n  scale_x_continuous(limits = c(0,101),\n                     breaks = seq(0,100,10))\nano$area <- (ano$andel_hovedoekosystem_punkt/100)*250\nano$bv_7se[1:6]\n#> [1] \"7SE_0\" \"7SE_0\" \"7SE_0\" \"7SE_0\" \"7SE_0\" \"7SE_0\"\nano$var_7SE <- as.numeric(sub(pattern = \"7SE_\",\n                 replacement = \"\",\n                 x = ano$bv_7se))\n#> Warning: NAs introduced by coercion\nnrow(ano[is.na(ano$var_7SE),])\n#> [1] 14\nano <- ano[!is.na(ano$var_7SE),]\nano$var_7TK <- as.numeric(sub(pattern = \"7TK_\",\n                 replacement = \"\",\n                 x = ano$bv_7tk))\npar(mfrow=c(1,2))\nbarplot(table(ano$var_7TK), xlab=\"7TK scores\")\nbarplot(table(ano$var_7SE), xlab=\"7SE scores\")\ntemp <- as.data.frame(ano)\ntemp$slitasje <- apply(temp[,c(\"var_7TK\", \"var_7SE\")], 1, max, na.rm=T)\nano$slitasje <- temp$slitasje\nano <- ano %>%\n  mutate(slitasje = case_match(slitasje,\n             0 ~ 0,\n             1 ~ mean(c(0, 1/16))*100,\n             2 ~ mean(c(1/16, 1/2))*100,\n             3 ~ 75))\nbarplot(table(ano$slitasje), xlab=\"% Slitasje\", ylab = \"Number of localities\")"},{"path":"slitasje-og-kjørespor.html","id":"combine-nt-ano","chapter":"1 Slitasje og kjørespor","heading":"1.8.1.3.1 Combine Naturtype data and ANO","text":"need combine nature type data set ANO data set. \nadd column origin show data comes . \nalso add column main ecosystem.Fix classI use dplyr::select reduce number columns keep things \nbit tidy.","code":"\nano$origin <- \"ANO\"\nnaturetypes$origin <- \"Nature type mapping\"\nano$hovedøkosystem <- \"Våtmark\"\nano$kartleggingsår <- ano$aar\nnaturetypes$kartleggingsår <- as.numeric(naturetypes$kartleggingsår)\nnaturetypes$area <- units::drop_units(naturetypes$area)\nslitasje_data <- dplyr::bind_rows(select(ano,\n                                  GlobalID,\n                                  origin,\n                                  kartleggingsår,\n                                  hovedøkosystem,\n                                  area,\n                                  slitasje,\n                                  SHAPE), \n                           select(naturetypes,\n                                  identifikasjon_lokalId,\n                                  origin,\n                                  hovedøkosystem,\n                                  kartleggingsår,\n                                  area,\n                                  slitasje,\n                                  SHAPE))\n\nunique(st_geometry_type(slitasje_data))\n#> [1] POINT        MULTIPOLYGON\n#> 18 Levels: GEOMETRY POINT LINESTRING POLYGON ... TRIANGLE"},{},{"path":"slitasje-og-kjørespor.html","id":"distribution-of-slitasje-scores","chapter":"1 Slitasje og kjørespor","heading":"1.8.1.4 Distribution of Slitasje scores","text":"\nFigure 1.14: Slitasje scores (ANO Naturetype (GRUK) data combined). score locality equals highest (worst) score related variables 7TK, 7SE, PRSL PRTK.\nLet’s see proportion data points (area) origination \ndata set\nFigure 1.15: Barplot show contribution (number localities) different data sets slitasje indicator.\nANO data important , can become \nimportant future good included workflow.","code":"\ntemp <- as.data.frame(table(slitasje_data$slitasje))\nggplot(temp, aes(x = Var1,\n                 y = Freq))+\n  geom_bar(stat=\"identity\",\n           fill=\"grey\",\n           colour = \"black\")+\n  theme_bw(base_size = 12)+\n  labs(x = \"slitasje score\",\n       y = \"Number of localities\")\ntemp <- as.data.frame(table(slitasje_data$origin))\n\nggplot(temp, aes(x = Var1,\n                 y = Freq))+\n  geom_bar(stat=\"identity\",\n           fill=\"grey\",\n           colour = \"black\")+\n  theme_bw(base_size = 12)+\n  labs(x = \"Data origin\",\n       y = \"Number of localities\")"},{"path":"slitasje-og-kjørespor.html","id":"outline-of-norway-and-regions","chapter":"1 Slitasje og kjørespor","heading":"1.8.1.5 Outline of Norway and regions","text":"GIS layers used crop marine areas, define\naccounting areas, respectively.","code":"\noutline <- sf::read_sf(\"data/outlineOfNorway_EPSG25833.shp\")\nregions <- sf::read_sf(\"data/regions.shp\", options = \"ENCODING=UTF8\")\nunique(regions$region)\n#> [1] \"Nord-Norge\" \"Midt-Norge\" \"Østlandet\"  \"Vestlandet\"\n#> [5] \"Sørlandet\""},{"path":"slitasje-og-kjørespor.html","id":"scale-slitasje-ind","chapter":"1 Slitasje og kjørespor","heading":"1.8.2 Scaled indicator values","text":"can scale indicator polygon, can chose aggregate\nfirst. scaled value representative precise \npolygon level, scale level. think .However, combined surveyed area small fraction \ntotal area Norway, producing indicator values \nmapped areas leaves indicator without much value regional\nassessments. regional assessments calculate regional\nindicator values, simply area weighting polygons\nregion. don’t want assume \npolygons representative far outside mapped area. perhaps\ncan assume representative inside homogeneous ecological\nareas, Homoegeneous Impact Areas (HIAs). ’s \ninfrastructure index comes . ’s plan:normalise indicators polygon level.normalise indicators polygon level.take simplified infrastructure index (vector data set HIAs)\nextract corresponding indicator values intersect \ngiven HIA, extrapolate area weighted mean values \nentire HIA withing given geographical region. Errors \ncalculated bootstrapping.take simplified infrastructure index (vector data set HIAs)\nextract corresponding indicator values intersect \ngiven HIA, extrapolate area weighted mean values \nentire HIA withing given geographical region. Errors \ncalculated bootstrapping.Take new area weighted indicator values HIAs match\necosystem occurrences HIA (possibly using\nrandomly sampled points available ecosystem occurrences).\nerrors HIAs.Take new area weighted indicator values HIAs match\necosystem occurrences HIA (possibly using\nrandomly sampled points available ecosystem occurrences).\nerrors HIAs.calculate indicator value region (accounting area) \nweighted average based relative area ecosystem\noccurrences. Errors carried somehow, perhaps via weighted\nresampling.calculate indicator value region (accounting area) \nweighted average based relative area ecosystem\noccurrences. Errors carried somehow, perhaps via weighted\nresampling.","code":""},{"path":"slitasje-og-kjørespor.html","id":"scaled-slitasje-variable","chapter":"1 Slitasje og kjørespor","heading":"1.8.2.1 Scaled variable","text":"use reference levels/values Norway:implies impossible detect measure state \ndegraded form (100% disturbed). problem \noriginal data resolution. compensate somewhat \nusing non-linear transformation.Also, threshold value set quite conservatively (think), \ndiscussed.need little trick reverse upper lower reference\nvalues normalisation work. bug can fixed\ninside eaTools.\nFigure 1.16: Performing linear break-point type normalisation slitasje variable.\nnormalisation seems reasonable . can save indicator\nvalues. point yet making time series, \nassign indicator value average year data.Assigning indicator year 2020.","code":"\nupper <- 0\nlower <- 100\nthreshold <- 5\neaTools::ea_normalise(data = slitasje_data,\n                      vector = \"slitasje\",\n                      upper_reference_level = lower,\n                      lower_reference_level = upper,\n                      break_point = threshold,\n                      plot=T,\n                      reverse = T\n                      )\nmean(slitasje_data$kartleggingsår)\n#> [1] 2020.254\nslitasje_data$i_2020 <- eaTools::ea_normalise(data = slitasje_data,\n                      vector = \"slitasje\",\n                      upper_reference_level = lower,\n                      lower_reference_level = upper,\n                      break_point = threshold,\n                      reverse = T\n                      )"},{"path":"slitasje-og-kjørespor.html","id":"HIA","chapter":"1 Slitasje og kjørespor","heading":"1.8.3 Homogeneous impact areas","text":"want use Homogeneous Impact Areas (HIA) define\nsmaller regions can extrapolate indicator values. \ndata generated discretizing Norwegian Infrastructure Index. \nrefer ordinal values four HIA classes Human\nImpact Factor (HIF). just keep approach separate \nNorwegian Infrastructure Index.want check HIF fact good predictor slitasje.also want split four HIA classes based region. \nneed two layers CRS.Since HIA map region map completely overlapping (HIA masked using region map), can get \nintersectionsCreate new column crossing region HIF","code":"\nHIA <- readRDS(paste0(pData, \"infrastrukturindeks/homogeneous_impact_areas.rds\"))\nst_crs(HIA) == st_crs(regions)\n#> [1] TRUE\nHIA_regions <- eaTools::ea_homogeneous_area(HIA,\n                             regions,\n                             keep1 = \"infrastructureIndex\",\n                             keep2 = \"region\")\nsaveRDS(HIA_regions, \"P:/41201785_okologisk_tilstand_2022_2023/data/cache/HIA_regions.rds\")\nHIA_regions <- HIA_regions %>%\n  mutate(region_HIF = paste(region, infrastructureIndex))"},{"path":"slitasje-og-kjørespor.html","id":"validate","chapter":"1 Slitasje og kjørespor","heading":"1.8.3.1 Validate","text":"now 20 unique areas (main ecosystem) , given\ndata, extrapolate indicator values .","code":""},{},{"path":"slitasje-og-kjørespor.html","id":"looking-at-the-hia","chapter":"1 Slitasje og kjørespor","heading":"1.8.3.2 Looking at the HIA","text":"view data zooming TrondheimCropping raster bboxGet map major roads, context\nFigure 1.22: closer look HIA designation Trondheim\nLet’s calculate areas polygons compare HIF \nfive regions.\nFigure 1.23: Stacked barplot showing distribution human impact factor across five regions Norway.\nfigure shows Nord-Norge example, lot \nrelatively untouched areas, Østlandet highest\nproportion impacted areas. expected.","code":"\nmyBB <- st_bbox(c(xmin=260520.12, xmax = 278587.56,\n                ymin = 7032142.5, ymax = 7045245.27),\n                crs = st_crs(HIA_regions))\nHIA_trd <- sf::st_crop(HIA_regions, myBB)\n#> Warning: attribute variables are assumed to be spatially\n#> constant throughout all geometries\nhw_utm <- readRDS(\"data/cache/highways_trondheim.rds\")\n(HIA_trd <- tm_shape(HIA_trd)+\n  tm_polygons(col = \"infrastructureIndex\",\n    title=\"Infrastructure index\\n(modified 4-step scale)\",\n    palette = \"-viridis\",\n    style=\"cat\")+\n  tm_layout(legend.outside = T)+\n  tm_shape(hw_utm)+\n  tm_lines(col=\"red\")+\n  tm_shape(outline)+\n  tm_borders(col = \"black\", lwd=2))\nHIA_regions$area <- sf::st_area(HIA_regions)\ntemp <- as.data.frame(HIA_regions) %>%\n  group_by(region, infrastructureIndex) %>%\n  summarise(area = mean(area))\n#> `summarise()` has grouped output by 'region'. You can\n#> override using the `.groups` argument.\n\nggplot(temp, aes(x = region, y = area, fill = factor(infrastructureIndex)))+\n  geom_bar(position = \"stack\", stat = \"identity\")+\n  guides(fill = guide_legend(\"HIF\"))"},{"path":"slitasje-og-kjørespor.html","id":"spread-slitasje","chapter":"1 Slitasje og kjørespor","heading":"1.8.4 Aggregate and spread (extrapolate)","text":"now want find mean indicator value HIA (.e. \naggregate) spread spatially entire HIA within\nregion (.e. extrapolate).want add threshold don’t end extrapolating\nbased data points. previousl used 150 data pionts, think right.’s easier see ’s happening zoom bit. Lets get \nboundary box around Trondheim.Cropping data bbox\nFigure 1.24: Slitasje indicator extrapolated Trondheim\nNote wetland semi-natural areas \nextrapolate values urban areas, naturally open\nareas extrapolate least affected areas.\nregions generally excluded HIFs.maps easy misunderstand, therefor \ncommunicated caution. considered temporary\nfiles -products.next step now toPrepare ecosystem delineation maps EPSG25833 perfectly aligned master gridPrepare ecosystem delineation maps EPSG25833 perfectly aligned master gridRasterize extrapolated indicator map, using ET map template (see Fig. @ref(fig:#masking-example))Rasterize extrapolated indicator map, using ET map template (see Fig. @ref(fig:#masking-example))mask using perfectly aligned ET map.mask using perfectly aligned ET map.faster way :Draw n random point samples ET map, andDraw n random point samples ET map, andextract indicator values points (extrapolated\nindicator map (stars object)).extract indicator values points (extrapolated\nindicator map (stars object)).… provide spatially explicit indicator values \nentire ecosystem delineation.","code":"\nwetlands_slitasje_extr <- ea_spread(indicator_data = wetlands,\n                         indicator = i_2020,\n                         regions = HIA_regions,\n                         groups = region_HIF,\n                         threshold = 150)\n\nseminat_slitasje_extr <- ea_spread(indicator_data = seminat,\n                         indicator = i_2020,\n                         regions = HIA_regions,\n                         groups = region_HIF,\n                         threshold = 150)\n\nnatOpen_slitasje_extr <- ea_spread(indicator_data = natOpen,\n                         indicator = i_2020,\n                         regions = HIA_regions,\n                         groups = region_HIF,\n                         threshold = 150)\n#saveRDS(wetlands_slitasje_extr, \"/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/cache/wetlands_slitasje_extr.rds\")\n#saveRDS(seminat_slitasje_extr,  \"/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/cache/seminat_slitasje_extr.rds\")\n#saveRDS(natOpen_slitasje_extr,  \"/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/cache/natOpen_slitasje_extr.rds\")\nmyBB <- st_bbox(c(xmin=260520.12, xmax = 278587.56,\n                ymin = 7032142.5, ymax = 7045245.27),\n                crs = st_crs(wetlands_slitasje_extr))\nwetlands_slitasje_extr_trd <- sf::st_crop(wetlands_slitasje_extr, myBB)\nseminat_slitasje_extr_trd <- sf::st_crop(seminat_slitasje_extr, myBB)\nnatOpen_slitasje_extr_trd <- sf::st_crop(natOpen_slitasje_extr, myBB)\nmyCol <- \"RdYlGn\"\ntmap_arrange(\ntm_shape(wetlands_slitasje_extr_trd)+\n  tm_polygons(col = \"w_mean\",\n    title=\"Slitasje indicator\",\n    palette = myCol,\n    style=\"cont\",\n    breaks = c(0,1))+\n  tm_layout(legend.outside = T)+\n  tm_shape(hw_utm)+\n  tm_lines(col=\"blue\")+\n  tm_layout(title = \"Wetland\"),\n\ntm_shape(seminat_slitasje_extr_trd)+\n  tm_polygons(col = \"w_mean\",\n    title=\"Slitasje indicator\",\n    palette = myCol,\n    style=\"cont\",\n    breaks = c(0,1))+\n  tm_layout(legend.outside = T)+\n  tm_shape(hw_utm)+\n  tm_lines(col=\"blue\")+\n  tm_layout(title = \"Semi-natural areas\"),\n\ntm_shape(natOpen_slitasje_extr_trd)+\n  tm_polygons(col = \"w_mean\",\n    title=\"Slitasje indicator\",\n    palette = myCol,\n    style=\"cont\",\n    breaks = c(0,1))+\n  tm_layout(legend.outside = T)+\n  tm_shape(hw_utm)+\n  tm_lines(col=\"blue\")+\n  tm_layout(title = \"Naturally open areas\"),\nHIA_trd)"},{"path":"slitasje-og-kjørespor.html","id":"ecosystem-map","chapter":"1 Slitasje og kjørespor","heading":"1.8.5 Ecosystem map","text":"See .","code":""},{"path":"slitasje-og-kjørespor.html","id":"aggregate-to-region","chapter":"1 Slitasje og kjørespor","heading":"1.8.6 Aggregate to region","text":"need aggreate ET occurence indicator values, \nregional delineation. functionality can developed eaTools,\ncase build around exactextratr::exact_extract().carry errors, can example\nproduce distributions indicator values ET\noccurrence (groups ) resample distributions \narea weighting.","code":""},{"path":"slitasje-og-kjørespor.html","id":"uncertainty","chapter":"1 Slitasje og kjørespor","heading":"1.8.7 Uncertainty","text":"calculations indicator uncertainty done bootstrapping, \ndescribed eaTools.","code":""},{"path":"slitasje-og-kjørespor.html","id":"eksport-files-final-product","chapter":"1 Slitasje og kjørespor","heading":"1.9 Eksport files (final product)","text":"According workflow specifications, export indicator\nmap highest resolution, use various web interfaces etc.\nfinest resolution indicator map include columns \nuncertainty (estimated aggregated\nlevel), reference levels (spatial variation).can also export map indicator extrapolate \nindicator values homogeneous areas (e.g. Fig. 1.24 . map \ninterpreted caution, since appear providing explicit indicator\nvalues areas data. map mainly \naggregation purposes. mark map prefix\nhomogeneous-areas. also export map masking \nET map, output must come disclaimers.Finally export map five accounting areas \nwall--wall indicator value errors (e.g. Fig 2.5). map can also contain data\ncovering ETs. Otherwise maps visually\ninterpretative.","code":""},{"path":"slitasje-og-kjørespor.html","id":"slitasje-in-wetlands","chapter":"1 Slitasje og kjørespor","heading":"1.9.1 Slitasje in wetlands","text":"plan export final product.Write file","code":"\n# keep col names short and standardized\nexp_wetland <- ...exp_wetland_HIAextrapolated <- …exp_wetland_AAextrapolated <- …\nst_write(exp_wetland, \"indicators/indicatorMaps/slitasje/wetland_slitasje.shp\",\n         append = F)\n\nst_write(exp_wetlandHIAextrapolated, \n         \"indicators/indicatorMaps/extrapolated_to_homogeneous_areas/slitasje/homogeneous_areas_wetland_slitasje.shp\",\n         append = F)\n\nst_write(exp_wetland, \"indicators/indicatorMaps/extrapolated_to_accounting_areas/slitasje/accounting_areas_wetland_slitasje.shp\",\n         append = F)"},{"path":"median-summer-temp.html","id":"median-summer-temp","chapter":"2 Median Summer Temperature","heading":"2 Median Summer Temperature","text":"Author date:Anders L. KolstadMarch 2023","code":""},{"path":"median-summer-temp.html","id":"introduction-1","chapter":"2 Median Summer Temperature","heading":"2.1 Introduction","text":"chapters describes workflow indicator describing median summer temperature. comprehensive documentation development workflow , see . data comes interpolated climate surfaces SeNorge contain one 1x1km raster day since 1957 present. reference levels extracted time period 1961-1990 (temporal reference condition).WorkflowCollate variable data series, ending one raster per year aggregating across days within yearCollate variable data series, ending one raster per year aggregating across days within yearCalculate spatially explicit reference values aggregating across years 1961-1990. upper reference value equal median value period, lower reference values (two-sided) equal 5 SD units. indicator value mean five year period.Calculate spatially explicit reference values aggregating across years 1961-1990. upper reference value equal median value period, lower reference values (two-sided) equal 5 SD units. indicator value mean five year period.Calculate indicator values spatially explicit rescaling based reference valuesCalculate indicator values spatially explicit rescaling based reference valuesMask ecosystem type (step yet done ready available ecosystem maps)Mask ecosystem type (step yet done ready available ecosystem maps)Aggregate space (accounting areas) take mean five year period get final indicator valuesAggregate space (accounting areas) take mean five year period get final indicator valuesMake trend figure spatially aggregated mapsMake trend figure spatially aggregated maps","code":""},{"path":"median-summer-temp.html","id":"about-the-underlying-data-1","chapter":"2 Median Summer Temperature","heading":"2.2 About the underlying data","text":"data raster format extends back 1957 form multiple interpolated climate variables. spatial resolution 1 x 1 km.","code":""},{"path":"median-summer-temp.html","id":"representativity-in-time-and-space-1","chapter":"2 Median Summer Temperature","heading":"2.2.1 Representativity in time and space","text":"data includes last normal period (1961-1990) defines reference condition climate variables. Therefore temporal resolution good. Also considering daily resolution data.Spatially, 1x1 km resolution sufficient climate variables, esp. homogeneous terrain, needs evaluation variable scenario specifically.","code":""},{"path":"median-summer-temp.html","id":"original-units-1","chapter":"2 Median Summer Temperature","heading":"2.2.2 Original units","text":"Varied. Specified parameter.","code":""},{"path":"median-summer-temp.html","id":"temporal-coverage-1","chapter":"2 Median Summer Temperature","heading":"2.2.3 Temporal coverage","text":"1957 - present","code":""},{"path":"median-summer-temp.html","id":"additional-comments-about-the-data-set","chapter":"2 Median Summer Temperature","heading":"2.2.4 Additional comments about the data set","text":"data format recently changed .BIL .nc (netcdf) now single file contains rasters one year (365 days), sometimes multiple variables also.","code":""},{"path":"median-summer-temp.html","id":"ecosystem-characteristic-1","chapter":"2 Median Summer Temperature","heading":"2.3 Ecosystem characteristic","text":"","code":""},{"path":"median-summer-temp.html","id":"norwegian-standard","chapter":"2 Median Summer Temperature","heading":"2.3.1 Norwegian standard","text":"variables typically fall abiotiske egenskaper class.","code":""},{"path":"median-summer-temp.html","id":"seea-ea","chapter":"2 Median Summer Temperature","heading":"2.3.2 SEEA EA","text":"SEEA EA, variables typically fall A1 - Physical state characteristics.","code":""},{"path":"median-summer-temp.html","id":"collinearities-with-other-indicators-1","chapter":"2 Median Summer Temperature","heading":"2.4 Collinearities with other indicators","text":"Climate variables likely correlated (e.g. temperature snow). Also, climate variables better classed pressure indicators, might causal association several condition indicators.","code":""},{"path":"median-summer-temp.html","id":"reference-condition-and-values-1","chapter":"2 Median Summer Temperature","heading":"2.5 Reference condition and values","text":"","code":""},{"path":"median-summer-temp.html","id":"reference-condition-1","chapter":"2 Median Summer Temperature","heading":"2.5.1 Reference condition","text":"reference condition climate variables defined normal period 1961-1990.","code":""},{"path":"median-summer-temp.html","id":"reference-values-thresholds-for-defining-good-ecological-condition-minimum-andor-maximum-values-1","chapter":"2 Median Summer Temperature","heading":"2.5.2 Reference values, thresholds for defining good ecological condition, minimum and/or maximum values","text":"Un-scaled indicator value = median value 5 year periods (5 years pragmatic choice. long enough smooth lot inter-annual variation, ’s long enough enable estimating errors)Un-scaled indicator value = median value 5 year periods (5 years pragmatic choice. long enough smooth lot inter-annual variation, ’s long enough enable estimating errors)Upper reference level (best possible condition) = median value reference periodUpper reference level (best possible condition) = median value reference periodThresholds good ecosystem condition = 2 standard deviation units away upper reference level climate variable reference period.Thresholds good ecosystem condition = 2 standard deviation units away upper reference level climate variable reference period.Lower reference values (two-directional) = 5 standard deviation units climate variable reference period (implies linear scaling).Lower reference values (two-directional) = 5 standard deviation units climate variable reference period (implies linear scaling).choice use 2 SD units threshold values subjective choice many ways, founded empirical known relationship indicators ecosystem integrity. value comes common practice calling something extreme weather outside 2 SD units current running average. , indicator value today <0.6 implies mean variable last year referred extreme occurred 1961 1990. think conservative threshold, since one /call extreme one year outside 2SD range, mean 5 years outside range really extreme.","code":""},{"path":"median-summer-temp.html","id":"uncertainties-1","chapter":"2 Median Summer Temperature","heading":"2.6 Uncertainties","text":"indicator map (1 x 1 km raster) uncertainty associated indicator values. aggregated indicator values (e.g. regions), uncertainty indicator value calculated spatial variation indicator values via bootstrapping. might, however, changed later temporal variation five years period.","code":""},{"path":"median-summer-temp.html","id":"references-1","chapter":"2 Median Summer Temperature","heading":"2.7 References","text":"https://senorge./rr tm download : https://thredds.met./thredds/catalog/senorge/seNorge_2018/Archive/catalog.html","code":""},{"path":"median-summer-temp.html","id":"additional-resources","chapter":"2 Median Summer Temperature","heading":"2.7.1 Additional resources","text":"Stars packageR GIS economists chapter 7","code":""},{"path":"median-summer-temp.html","id":"analyses-1","chapter":"2 Median Summer Temperature","heading":"2.8 Analyses","text":"","code":""},{"path":"median-summer-temp.html","id":"data-set","chapter":"2 Median Summer Temperature","heading":"2.8.1 Data set","text":"data downloaded local NINA server, updated regularly.folder contains folder different parametersWe interested tm, temperatur celcius. reason variable called tg data .","code":"\npath <- ifelse(dir == \"C:\", \n      \"R:/GeoSpatialData/Meteorology/Norway_SeNorge2018_v22.09/Original\",\n      \"/data/R/GeoSpatialData/Meteorology/Norway_SeNorge2018_v22.09/Original\")\n(files <- list.files(path))\n#>  [1] \"age\"        \"fsw\"        \"gwb_eva\"    \"gwb_gwtcl\" \n#>  [5] \"gwb_q\"      \"gwb_sssdev\" \"gwb_sssrel\" \"lwc\"       \n#>  [9] \"qsw\"        \"rr_tm\"      \"sd\"         \"sdfsw\"     \n#> [13] \"swe\""},{"path":"median-summer-temp.html","id":"regions","chapter":"2 Median Summer Temperature","heading":"2.8.1.1 Regions","text":"Importing shape file regional delineation.Outline NorwayRemove marine areas regions\nFigure 1.1: Five accounting areas (regions) Norway.\n","code":"\nreg <- sf::st_read(\"data/regions.shp\", options = \"ENCODING=UTF8\")\n#> options:        ENCODING=UTF8 \n#> Reading layer `regions' from data source \n#>   `/data/scratch/Matt_bookdown__debug/ecosystemCondition/data/regions.shp' \n#>   using driver `ESRI Shapefile'\n#> Simple feature collection with 5 features and 2 fields\n#> Geometry type: POLYGON\n#> Dimension:     XY\n#> Bounding box:  xmin: -99551.21 ymin: 6426048 xmax: 1121941 ymax: 7962744\n#> Projected CRS: ETRS89 / UTM zone 33N\n#st_crs(reg)\nnor <- sf::st_read(\"data/outlineOfNorway_EPSG25833.shp\")\n#> Reading layer `outlineOfNorway_EPSG25833' from data source \n#>   `/data/scratch/Matt_bookdown__debug/ecosystemCondition/data/outlineOfNorway_EPSG25833.shp' \n#>   using driver `ESRI Shapefile'\n#> Simple feature collection with 1 feature and 2 fields\n#> Geometry type: MULTIPOLYGON\n#> Dimension:     XY\n#> Bounding box:  xmin: -113472.7 ymin: 6448359 xmax: 1114618 ymax: 7939917\n#> Projected CRS: ETRS89 / UTM zone 33N\nreg <- st_intersection(reg, nor)\ntm_shape(reg) +\n  tm_polygons(col=\"region\")"},{"path":"median-summer-temp.html","id":"ecosystem-map-1","chapter":"2 Median Summer Temperature","heading":"2.8.1.2 Ecosystem map","text":"Coming soon ….climate indicators need masked ecosystem type maps. step part chapter.","code":""},{"path":"median-summer-temp.html","id":"conceptual-workflow","chapter":"2 Median Summer Temperature","heading":"2.8.2 Conceptual workflow","text":"general, conceptual workflow like :Collate variable data series\nImport .nc files (loop though year 1961-1990) subset correct attribute\nFilter data dates (optional) (dplyr::filter). means reading 365 rasters memory, much quicker filter correct rasters importing step (see examples later chapter)\nAggregate across time within year (stars::st_apply). time consuming operation workflow.\nJoin data one data cube (stars:c)\nCollate variable data seriesImport .nc files (loop though year 1961-1990) subset correct attributeImport .nc files (loop though year 1961-1990) subset correct attributeFilter data dates (optional) (dplyr::filter). means reading 365 rasters memory, much quicker filter correct rasters importing step (see examples later chapter)Filter data dates (optional) (dplyr::filter). means reading 365 rasters memory, much quicker filter correct rasters importing step (see examples later chapter)Aggregate across time within year (stars::st_apply). time consuming operation workflow.Aggregate across time within year (stars::st_apply). time consuming operation workflow.Join data one data cube (stars:c)Join data one data cube (stars:c)Calculate reference values\nAggregate (st_apply) across reference years (dplyr::filter) get median sd values\nJoin existing data cube (stars:c)\nCalculate reference valuesAggregate (st_apply) across reference years (dplyr::filter) get median sd valuesAggregate (st_apply) across reference years (dplyr::filter) get median sd valuesJoin existing data cube (stars:c)Join existing data cube (stars:c)Calculate indicator values\nNormalize climate variable individual grid cell level using three reference values (mutate(across()))\nCalculate indicator valuesNormalize climate variable individual grid cell level using three reference values (mutate(across()))Mask ecosystem type (also done step one, doesn’t speed things set cells NA)Mask ecosystem type (also done step one, doesn’t speed things set cells NA)Aggregate space (accounting areas) (zonal statistics)\nAggregate across 5 year time steps smooth random inter-annual variation leave climate signal\nIntersect accounting area polygons exactextrar::exact_extract get mean/median (spatial) sd. (Alternatively, get temporal sd grid cell level step .)\nAggregate space (accounting areas) (zonal statistics)Aggregate across 5 year time steps smooth random inter-annual variation leave climate signalAggregate across 5 year time steps smooth random inter-annual variation leave climate signalIntersect accounting area polygons exactextrar::exact_extract get mean/median (spatial) sd. (Alternatively, get temporal sd grid cell level step .)Intersect accounting area polygons exactextrar::exact_extract get mean/median (spatial) sd. (Alternatively, get temporal sd grid cell level step .)Make trend figure spatially aggregated mapsMake trend figure spatially aggregated maps","code":""},{"path":"median-summer-temp.html","id":"step-1---temporal-aggregation-within-a-year","chapter":"2 Median Summer Temperature","heading":"2.8.3 Step 1 - temporal aggregation within a year","text":"takes 20 sec per file/year, 22 min total. bad. 6000 rasters read memory. ’s test effect splitting cores.Note GTiff automatically renames third dimension band also renames attribute. can rename .\nFigure 2.1: Showing three random slices year dimension.\n","code":"\npath <- path <- ifelse(dir == \"C:\", \n      \"R:/\",\n      \"/data/R/\")\n  \npath2 <- paste0(path, \"GeoSpatialData/Meteorology/Norway_SeNorge2018_v22.09/Original/rr_tm/\")\n\nmyFiles <- list.files(path2, pattern=\".nc$\",full.names = T)\n# The last file (the last year) is incomplete and don't include all julian dates that we select below, so I will not include it:\nmyFiles <- myFiles[-length(myFiles)]\n\nreal_temp_summer <- NULL\n\n# set up parallel cluster using 10 cores\ncl <- makeCluster(10L)\n\n# Get julian days after defining months\ntemp <- stars::read_ncdf(paste(myFiles[1]), var=\"tg\")\nstart_month_num <-  6\nend_month_num <- 8\n\njulian_start <- yday(st_get_dimension_values(temp, \"time\")[1] %m+%\n                       months(+start_month_num))\njulian_end <- yday(st_get_dimension_values(temp, \"time\")[1] %m+%\n                     months(+end_month_num))\nstep <- julian_end-julian_start\n\n\n\nfor(i in 1:length(myFiles)){\n  \n  tic(\"init\")\n  temp <- stars::read_ncdf(paste(myFiles[i]), var=\"tg\", proxy=F,\n                           ncsub = cbind(start = c(1, 1, julian_start), \n                              count = c(NA, NA, step)))\n  year_temp <- year(st_get_dimension_values(temp, \"time\")[1])\n  print(year_temp)\n  lookup <- setNames(\"mean\", paste0(\"v_\", year_temp)) \n    # Perhaps leave out the v_ to get a numeric vector instead, \n    # which is easier to subset\n  st_crs(temp) <- 25833\n  toc()\n\n  tic(\"filter and st_apply\")\n  temp <- temp %>%\n    #filter(time %within% myInterval) %>%\n    st_apply(1:2, mean, CLUSTER = cl) %>%\n    rename(all_of(lookup)) \n  toc()\n  \n  tic(\"c()\")\n  real_temp_summer <- c(temp, real_temp_summer)\n  #rm(temp)\n  toc()\n}\n\ntic(\"Merge\")\nreal_temp_summer <- real_temp_summer %>%\n  merge(name = \"Year\") %>%\n  setNames(\"climate_variable\")\ntoc()\n\nstopCluster(cl)\nwrite_stars(real_temp_summer, \"/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/aggregated_climate_time_series/real_temp_summer.tiff\")\nsummer_median_temp <- real_temp_summer %>% \n  st_set_dimensions(names = c(\"x\", \"y\", \"v_YEAR\")) %>%\n  setNames(\"temperature\")\nggplot()+\n  geom_stars(data = summer_median_temp[,,,c(1,11,66)], downsample = c(10, 10, 0)) +\n  coord_equal() +\n  theme_void() +\n  scale_fill_viridis_c(option = \"D\") +  \n  scale_x_discrete(expand = c(0, 0)) +\n  scale_y_discrete(expand = c(0, 0))+\n  facet_wrap(~v_YEAR)"},{"path":"median-summer-temp.html","id":"step-2---calculate-reference-values","chapter":"2 Median Summer Temperature","heading":"2.8.4 Step 2 - calculate reference values","text":"need first define reference period subset data summer_median_temp.First need rename dimension values turn back dates.can filter leave reference period.calculate median sd like abovePivot turn dimension attributes, rename attributes:\nFigure 2.2: Showing upper reference levels standard deviation actual data median summer temperatures.\nneed combine variables ref values one data cube","code":"\nnew_dims <- as.Date(paste0(\n  substr(st_get_dimension_values(summer_median_temp, \"v_YEAR\"), 3, 6), \"-01-01\"))\nsummer_median_temp_ref <- summer_median_temp %>%\n  st_set_dimensions(\"v_YEAR\", values = new_dims)\nsummer_median_temp_ref <- summer_median_temp_ref %>%\n  filter(v_YEAR %within% interval(\"1961-01-01\", \"1990-12-31\"))\nst_get_dimension_values(summer_median_temp_ref, \"v_YEAR\")\n#>  [1] \"1990-01-01\" \"1989-01-01\" \"1988-01-01\" \"1987-01-01\"\n#>  [5] \"1986-01-01\" \"1985-01-01\" \"1984-01-01\" \"1983-01-01\"\n#>  [9] \"1982-01-01\" \"1981-01-01\" \"1980-01-01\" \"1979-01-01\"\n#> [13] \"1978-01-01\" \"1977-01-01\" \"1976-01-01\" \"1975-01-01\"\n#> [17] \"1974-01-01\" \"1973-01-01\" \"1972-01-01\" \"1971-01-01\"\n#> [21] \"1970-01-01\" \"1969-01-01\" \"1968-01-01\" \"1967-01-01\"\n#> [25] \"1966-01-01\" \"1965-01-01\" \"1964-01-01\" \"1963-01-01\"\n#> [29] \"1962-01-01\" \"1961-01-01\"\nmedian_sd <- function(x) { c(median = median(x), sd = sd(x))}\nsystem.time({\ncl <- makeCluster(10L)\nsummer_median_temp_ref <- summer_median_temp_ref %>%\n  st_apply(c(\"x\", \"y\"), \n           FUN =  median_sd,\n           CLUSTER = cl)\nstopCluster(cl)\n})\nwrite_stars(summer_median_temp_ref, \"/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/aggregated_climate_time_series/summer_median_temp_ref.tiff\")\nsummer_median_temp_ref_long <- summer_median_temp_ref %>% \n  split(\"band\") %>%\n  setNames(c(\"reference_upper\", \"sd\"))\ntmap_arrange(\ntm_shape(st_downsample(summer_median_temp_ref_long, 10))+\n  tm_raster(\"reference_upper\")\n,\ntm_shape(st_downsample(summer_median_temp_ref_long, 10))+\n  tm_raster(\"sd\",\n            palette = \"-viridis\")\n)\ny_var <- summer_median_temp %>%\n  split(\"v_YEAR\") %>%\n  c(summer_median_temp_ref_long)"},{"path":"median-summer-temp.html","id":"step-3---normalise-variable","chapter":"2 Median Summer Temperature","heading":"2.8.5 Step 3 - normalise variable","text":"\nFigure 1.10: Example showing median summer tempretur 1970, upper lwoer reference temperture, .e. median 5 SD units temperature 1961-1990, finally, scaled indicator values.\nreal indicator values means 5 year periods. Calculating running mean time steps time consuming. Therefore, scaled, regional indicator values calculated distinct time steps. time series can perhaps still presented yearly resolution.","code":"\n# select the columns to normalise\ncols <- names(y_var)[!names(y_var) %in% c(\"reference_upper\", \"sd\") ]\ncols_new <- cols\nnames(cols_new) <- gsub(\"v_\", \"i_\", cols)\n# The break point scaling is actually not needed here, since \n# having the lower ref value to be 5 sd implies that the threshold is\n# 2 sd in a linear scaling.\n\nsystem.time(\ny_var_norm <- y_var %>%\n  mutate(reference_low = reference_upper - 5*sd ) %>%\n  mutate(reference_low2 = reference_upper + 5*sd ) %>%\n  mutate(threshold_low = reference_upper -2*sd ) %>%\n  mutate(threshold_high = reference_upper +2*sd ) %>%\n  mutate(across(all_of(cols), ~ \n                  if_else(.x < reference_upper,\n                  if_else(.x < threshold_low, \n                                        (.x - reference_low) / (threshold_low - reference_low),\n                                        (.x - threshold_low) / (reference_upper - threshold_low),\n                                        ),\n                  if_else(.x > threshold_high, \n                                        (reference_low2 - .x) / (reference_low2 - threshold_high),\n                                        (threshold_high - .x) / (threshold_high - reference_upper),\n                                        )\n                ))) %>%\n  mutate(across(all_of(cols), ~ if_else(.x > 1, 1, .x))) %>%\n  mutate(across(all_of(cols), ~ if_else(.x < 0, 0, .x))) %>%\n  rename(all_of(cols_new)) %>%\n  c(select(y_var, all_of(cols)))\n)\ngc()\nsaveRDS(y_var_norm, \"/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/aggregated_climate_time_series/summer_median_temp_normalised.RData\")\n\n# Tiff dont allow for multiple attributes:\n#write_stars(y_var_norm, \"/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/aggregated_climate_time_series/summer_median_temp_normalised.tiff\")\n\nlims <- c(-5, 22)\n\nggarrange(\nggplot() + \n  geom_stars(data = st_downsample(y_var_norm[\"v_1970\"],10)) +\n  coord_equal() +\n  theme_void() +\n  scale_fill_viridis_c(option = \"D\",\n                       limits = lims) +  \n  scale_x_discrete(expand = c(0, 0)) +\n  scale_y_discrete(expand = c(0, 0))\n,\nggplot() + \n  geom_stars(data = st_downsample(y_var_norm[\"reference_upper\"], 10)) +\n  coord_equal() +\n  theme_void() +\n  scale_fill_viridis_c(option = \"D\",\n                       limits = lims) +  \n  scale_x_discrete(expand = c(0, 0)) +\n  scale_y_discrete(expand = c(0, 0))\n,\nggplot() + \n  geom_stars(data = st_downsample(y_var_norm[\"reference_low\"], 10)) +\n  coord_equal() +\n  theme_void() +\n  scale_fill_viridis_c(option = \"D\",\n                       limits = lims) +  \n  scale_x_discrete(expand = c(0, 0)) +\n  scale_y_discrete(expand = c(0, 0))\n,\n\nggplot() + \n  geom_stars(data = st_downsample(y_var_norm[\"reference_low2\"], 10)) +\n  coord_equal() +\n  theme_void() +\n  scale_fill_viridis_c(option = \"D\",\n                       limits = lims) +  \n  scale_x_discrete(expand = c(0, 0)) +\n  scale_y_discrete(expand = c(0, 0))\n,\n\nggplot() + \n  geom_stars(data = st_downsample(y_var_norm[\"i_1970\"],10)) +\n  coord_equal() +\n  theme_void() +\n  scale_fill_viridis_c(option = \"A\",\n                       limits = c(0, 1)) +  \n  scale_x_discrete(expand = c(0, 0)) +\n  scale_y_discrete(expand = c(0, 0))\n, ncol=2, nrow=3, align = \"hv\"\n)"},{"path":"median-summer-temp.html","id":"step-4---mask-with-ecosystem-delineation-map","chapter":"2 Median Summer Temperature","heading":"2.8.6 Step 4 - Mask with ecosystem delineation map","text":"step simply ignore now. relatively easy , maps.","code":""},{"path":"median-summer-temp.html","id":"step-5---make-figures","chapter":"2 Median Summer Temperature","heading":"2.8.7 Step 5 - Make figures","text":"plot time series first need spatial aggregation.user; system; elapsed: 7.603; 3.071; 10.697I also get sd like , wanted base indicator uncertainty measure spatial variation:user; system; elapsed: 7.420; 2.921; 10.355Reshape plot\nFigure 2.3: Times series median summer temperature centered median value reference period. reference period indicated thick horizontal line. Dottet horisontal lines 2 sd units reference period.\ncan take mean sd last 5 years add spatial representation.\nFigure 2.4: Scaled indicator values, aggregated 5 year intervals. Errors represent temporal variation (standard errors) within regions across 5 years.\nFinally, can add values sp object accounting areas.\nFigure 2.5: Summer tempreature indicator values five accounting areas Norway. SD spatial variation.\n","code":"\nsystem.time(\nregional_means <- rast(y_var_norm) %>%\n  exact_extract(reg, fun = 'mean', append_cols = \"region\", progress=T) %>%\n  setNames(c(\"region\", names(y_var_norm)))\n  )\nsystem.time(\nregional_sd <- rast(y_var_norm) %>%\n  exact_extract(reg, fun = 'stdev', append_cols = \"region\", progress=T) %>%\n  setNames(c(\"region\", names(y_var_norm)))\n  )\nsaveRDS(regional_means, \"temp/regional_means.rds\")\nsaveRDS(regional_sd, \"temp/regional_sd.rds\")\ndiv <- c(\"reference_upper\",\n         \"reference_low\",\n         \"reference_low2\",\n         \"threshold_low\",\n         \"threshold_high\",\n         \"sd\")\n\ntemp <- regional_means %>%\n  as.data.frame() %>%\n  select(region, div)\n  \nregional_means_long <- regional_means %>%\n  as.data.frame() %>%\n  select(!all_of(div)) %>%\n  pivot_longer(!region) %>%\n  separate(name, into=c(\"type\", \"year\")) %>%\n  pivot_wider(#id_cols = region,\n              names_from = type)  %>%\n  left_join(temp, by=join_by(region)) %>% \n  mutate(diff = v-reference_upper) %>%\n  mutate(threshold_low_centered = threshold_low-reference_upper) %>%\n  mutate(threshold_high_centered = threshold_high-reference_upper)\n\n#Adding the spatial sd\n#(\n#regional_means_long <- regional_sd %>%\n#  select(!all_of(div)) %>%\n#  pivot_longer(!region) %>%\n#  separate(name, into=c(\"type\", \"year\")) %>%\n#  pivot_wider(names_from = type) %>%\n#  rename(i_sd = i,\n#         v_sd = v) %>%\n#  left_join(regional_means_long, by=join_by(region, year))\n#)\nregOrder = c(\"Østlandet\",\"Sørlandet\",\"Vestlandet\",\"Midt-Norge\",\"Nord-Norge\")\n\nregional_means_long %>%\n  mutate(col = if_else(diff>0, \"1\", \"2\")) %>%\n  ggplot(aes(x = as.numeric(year), \n           y = diff, fill = col))+\n  geom_bar(stat=\"identity\")+\n  geom_hline(aes(yintercept = threshold_low_centered),\n        linetype=2)+\n  geom_hline(aes(yintercept = threshold_high_centered),\n        linetype=2)+\n  geom_segment(x = 1961, xend=1990,\n               y = 0, yend = 0,\n               linewidth=2)+\n  scale_fill_hue(l=70, c=60)+\n  theme_bw(base_size = 12)+\n  ylab(\"Sommertemperatur\\navvik fra 1961-1990\")+\n  xlab(\"\")+\n  guides(fill=\"none\")+\n  facet_wrap( .~ factor(region, levels = regOrder),\n              ncol=3,\n              scales = \"free_y\")\n(\ni_aggregatedToPeriods <- regional_means_long %>%\n  mutate(year = as.numeric(year)) %>%\n  mutate(period = case_when(\n    year %between% c(2018, 2022) ~ \"2018-2022\",\n    year %between% c(2013, 2017) ~ \"2013-2017\",\n    year %between% c(2008, 2012) ~ \"2008-2012\",\n    year %between% c(2003, 2007) ~ \"2003-2007\",\n    .default = \"pre 2003\"\n  )) %>%\n  mutate(period_rank = case_when(\n   period == \"2018-2022\" ~ 5,\n   period == \"2013-2017\" ~ 4,\n   period == \"2008-2012\" ~ 3,\n   period == \"2003-2007\" ~ 2,\n    .default = 1\n  )) %>%\n  group_by(region, period, period_rank) %>%\n  summarise(indicator = mean(i),\n            sd = sd(i)\n            # If I inluded a spatial measure for the uncertainty, here is how I would carry the errors:\n            #spatial_sd = sqrt(sum(i_sd^2))/length(i_sd)\n            )\n)\n#> `summarise()` has grouped output by 'region', 'period'. You\n#> can override using the `.groups` argument.\n#> # A tibble: 25 × 5\n#> # Groups:   region, period [25]\n#>    region     period    period_rank indicator     sd\n#>    <chr>      <chr>           <dbl>     <dbl>  <dbl>\n#>  1 Midt-Norge 2003-2007           2     0.427 0.139 \n#>  2 Midt-Norge 2008-2012           3     0.573 0.0992\n#>  3 Midt-Norge 2013-2017           4     0.536 0.212 \n#>  4 Midt-Norge 2018-2022           5     0.607 0.179 \n#>  5 Midt-Norge pre 2003            1     0.642 0.182 \n#>  6 Nord-Norge 2003-2007           2     0.460 0.149 \n#>  7 Nord-Norge 2008-2012           3     0.675 0.0602\n#>  8 Nord-Norge 2013-2017           4     0.641 0.127 \n#>  9 Nord-Norge 2018-2022           5     0.625 0.110 \n#> 10 Nord-Norge pre 2003            1     0.625 0.194 \n#> # ℹ 15 more rows\nlabs <- unique(i_aggregatedToPeriods$period[order(i_aggregatedToPeriods$period_rank)])\n\ni_aggregatedToPeriods %>%\n  ggplot(aes(x = period_rank, \n             y = indicator,\n             colour=region))+\n  geom_line() +\n  geom_point() +\n  geom_errorbar(aes(ymin=indicator-sd, \n                    ymax=indicator+sd), \n                    width=.2,\n                 position=position_dodge(0.2)) +\n  theme_bw(base_size = 12)+\n  scale_x_continuous(breaks = 1:5,\n                     labels = labs)+\n  labs(x = \"\", y = \"indikatorverdi\")\nreg2 <- reg %>%\n  left_join(i_aggregatedToPeriods[i_aggregatedToPeriods$period_rank==5,], by=join_by(region))\nmyCol <- \"RdYlGn\"\nmyCol2 <- \"-RdYlGn\"\n\ntm_main <- tm_shape(reg2)+\n  tm_polygons(col=\"indicator\",\n              title=\"Indikator:\\nsommertemperatur\",\n    palette = myCol,\n    style=\"fixed\",\n    breaks = seq(0,1,.2)) \n  \ntm_inset <- tm_shape(reg2)+\n  tm_polygons(col=\"sd\",\n              title=\"SD\",\n              palette = myCol2,\n              style=\"cont\")+\n  tm_layout(legend.format = list(digits=2))\n\ntmap_arrange(tm_main, \n             tm_inset)"},{"path":"alien-species.html","id":"alien-species","chapter":"3 Alien species","heading":"3 Alien species","text":"Author date:Anders L. KolstadMarch 2023","code":""},{"path":"alien-species.html","id":"introduction-2","chapter":"3 Alien species","heading":"3.1 Introduction","text":"indicator represent ecological -site effect alien species. Whilst introduction alien species best considered pressure variable, relative abundance alien species given location seen manifestation negative anthropogenic impact, therefore valid condition indicator.related variable used previously alpine forest ecosystems Norway. indicators based ANO, national monitoring program, alien species cover estimated closest whole %. upper lower reference levels used back 0 100% species composition made alien species, respectively. threshold value good reduced condition defined 5%. approach, indicator represented relative area absence alien species. way flip-side alien species abundance. latter said pressure variable, whilst former reacts direct linear consequence changes variable, therefore accepted condition indicator. make distinction .time using nature type mapping dataset records assumed effect alien species, rather direct measure abundance % cover. recording scale called R7 (Fig. 3.1) ordinal scale non-linear relationship %cover recorded ANO (Fig. 3.2). order combine two data sets, must convert one scales match .base indicator R7 scale, since , presumably, bigger data set. therefore convert %cover R7 classes based can interpret Fig. 3.2.Upper reference value 1, lower reference value 7, R7 scale.\nthreshold value set value 4 R7 scale.\nbased interpretation author based definition value Fig. 3.1.\nStep 4 R7 scale step , concordantly, best matches 5% threshold old approach, seen Fig. 3.2.\nFigure 3.1: R7 scale used recording effect alien species nature type monitoring program\n\nFigure 3.2: Comparing R7 scale (x axis) used nature type monitoring program %cover (y-axis), alien species recorded ANO. assuming x axis shifted downwards compared original R7 scale range 1 7, value 0 equals R7 value 1. Cropped Evju et al (2022).\nSince nature type data sampled systematic random way, must take extra care -extrapolate space. delineate homogeneous impact areas (HIA) based four classes increasing infrastructure intersected municipality borders, say n data points field data representative inside entire HIA. related indicator used accounting areas define HIA (5 accounting areas Norway), addition infrastructure classes. indicator, expect gradients also inside accounting areas, therefore define HIAs based municipalities. means missing data final indicator maps, since municipalities sufficient data points estimate indicator values.calculate area weighted mean (error) indicator value HIA, long n data points given combination HIA municipality.general workflow calculation indicator.Import Nature type data data set (incl. GRUK) ANO data\nsetImport Nature type data data set (incl. GRUK) ANO data\nsetIdentify relevant nature types subset\ndataIdentify relevant nature types subset\ndataConvert ANO points polygonsConvert ANO points polygonsCombine data setsCombine data setsScale alien species variable based \nreference values.Scale alien species variable based \nreference values.Define homogeneous impact areas (HIA) based infrastructure index municipalitiesDefine homogeneous impact areas (HIA) based infrastructure index municipalitiesAggregate spread indicator value across HIAs\n(municipalities)Aggregate spread indicator value across HIAs\n(municipalities)Confirm relationship infrastructure index indicator\nvalues justify extrapolationConfirm relationship infrastructure index indicator\nvalues justify extrapolationTO : Prepare ecosystem delineation maps us ethese mask extrapolated indicator mapsTO : Prepare ecosystem delineation maps us ethese mask extrapolated indicator mapsSpatial aggregation indicator values uncertainties accounting areasSpatial aggregation indicator values uncertainties accounting areasExport indicator maps regional extrapolated mapsExport indicator maps regional extrapolated maps","code":"\nknitr::include_graphics(\"images/R7 scale.PNG\")\nknitr::include_graphics(\"images/fremmedart_prosentVSinnslag.PNG\")"},{"path":"alien-species.html","id":"about-the-underlying-data-2","chapter":"3 Alien species","heading":"3.2 About the underlying data","text":"indicator uses data set standardised field survey nature\ntypes. can read data set preliminary analyses\n. See also official\nsite\nEnvironment Agency. also import data set called\nANO, can read \n.","code":""},{"path":"alien-species.html","id":"representativity-in-time-and-space-2","chapter":"3 Alien species","heading":"3.2.1 Representativity in time and space","text":"nature type mapping random said area\nrepresentative. ANO data set however, area representative. \ndata 2018 present. data one field season usually\nbecomes available early following year.","code":""},{"path":"alien-species.html","id":"original-units-2","chapter":"3 Alien species","heading":"3.2.2 Original units","text":"variables recorded unitless seven-step ordinal scale (Fig.\n3.1) % cover alien species.","code":""},{"path":"alien-species.html","id":"temporal-coverage-2","chapter":"3 Alien species","heading":"3.2.3 Temporal coverage","text":"data goes back 2018. therefore bulk data 2018 2022 one time step. use mean date raw data,\ndefine variable belonging year 2020 (read \n).","code":""},{"path":"alien-species.html","id":"aditional-comments-about-the-dataset-1","chapter":"3 Alien species","heading":"3.2.4 Aditional comments about the dataset","text":"run nature type data set, see .","code":""},{"path":"alien-species.html","id":"ecosystem-characteristic-2","chapter":"3 Alien species","heading":"3.3 Ecosystem characteristic","text":"","code":""},{"path":"alien-species.html","id":"norwegain-standard-1","chapter":"3 Alien species","heading":"3.3.1 Norwegain standard","text":"indicator tagged Økologisk egenskap called\nFunksjonelt viktige arter og strukturer (Functionally important species structures). emphasises negaivte effect alien species example supressing excluding native species. cases, alien species can also affect nutrient cycling recruitment.","code":""},{"path":"alien-species.html","id":"un-standard-1","chapter":"3 Alien species","heading":"3.3.2 UN standard","text":"indicator tagged B1 Compositional state characteristics\nindicator.","code":""},{"path":"alien-species.html","id":"collinearities-with-other-indicators-2","chapter":"3 Alien species","heading":"3.4 Collinearities with other indicators","text":"Alien species thought exhibit collinearity indicator \npresent.","code":""},{"path":"alien-species.html","id":"reference-condition-and-values-2","chapter":"3 Alien species","heading":"3.5 Reference condition and values","text":"","code":""},{"path":"alien-species.html","id":"reference-condition-2","chapter":"3 Alien species","heading":"3.5.1 Reference condition","text":"reference condition one minimal negative human impact. \nalso true semi-natural ecosystems. sense, reference condition pre 1800s,\nsince alien species defined species established post 1800.","code":""},{"path":"alien-species.html","id":"reference-values-thresholds-for-defining-good-ecological-condition-minimum-andor-maximum-values-2","chapter":"3 Alien species","heading":"3.5.2 Reference values, thresholds for defining good ecological condition, minimum and/or maximum values","text":"Upper = 1 (R7 scale), corresponding 0% alien speciesUpper = 1 (R7 scale), corresponding 0% alien speciesThreshold = 4 (R7 scale), corresponding 5-30% alien species cover.Threshold = 4 (R7 scale), corresponding 5-30% alien species cover.Lower = 7 (R7 scale), corresponding 100% alien species cover.Lower = 7 (R7 scale), corresponding 100% alien species cover.Read normalisation .","code":""},{"path":"alien-species.html","id":"uncertainties-2","chapter":"3 Alien species","heading":"3.6 Uncertainties","text":"Uncertainties/errors estimated aggregated indicator values \nbootstrapping individual indicator values 1000 times calculating \ndistribution area weighted means. uncertainty different \nspatial variation get straight forward without\nbootstrapping. aggregating second time,\nhomogeneous impact areas accounting areas, assume normal\ndistribution around indicator values, already mentioned\nerrors, sample n times combine resamples \nnew, area weighted, distribution. errors accounting areas\nthus represents spatial variation, precision, \nindicator values within accounting areas.","code":""},{"path":"alien-species.html","id":"references-2","chapter":"3 Alien species","heading":"3.7 References","text":"Nature type dataANOEvju, M., Skrindo, .B. & Solstad, H. (red.) 2022. Overvåking av åpen grunnlendt kalkmark 2021‒2024. Årsrapport 2022. NINA Rapport 2195. Norsk institutt naturforskning.","code":""},{"path":"alien-species.html","id":"analyses-2","chapter":"3 Alien species","heading":"3.8 Analyses","text":"","code":""},{"path":"alien-species.html","id":"data-sets-1","chapter":"3 Alien species","heading":"3.8.1 Data sets","text":"","code":""},{"path":"alien-species.html","id":"NTM2","chapter":"3 Alien species","heading":"3.8.1.1 Nature type mapping","text":"indicator uses data set\nNaturtyper etter Miljødirektoratets Instruks, can found\n.\nSee also detailed description data set.also separate summary file \nnature types manually mapped NiN variables correct NiN-main types.\ncan use find nature types interest.interested mapping units include target variables. variable fremmedartsinnslag coded 7FA.deleted 30 nature types left us 24 nature types 7FA recorded:Importing sub-setting main data file, fix duplicate hovedøkosystem, calculate area, split one column two, make numeric, select target variables:\nFigure 1.1: overview naturetypes calculate indicator.\nNote lot data semi-natural ecosystem compared two.Column names starting number problematic, adding prefixRemoving NA’sShift variable start 1 rather 0.\nFigure 3.3: Alien species variable scores nature type data set.\nappears localities good condition, localities alien species .","code":"\nnaturetypes_summary_import <- readRDS(\"data/naturetypes/natureType_summary.rds\")\nmyVars <- '7FA'\nnaturetypes_summary <- naturetypes_summary_import %>%\n  rowwise() %>%\n  mutate(keepers = sum(c_across(\n    all_of(myVars))>0, na.rm=T)) %>%\n  filter(keepers >0) %>%\n  select(Nature_type, NiN_mainType, Year)\nDT::datatable(naturetypes_summary)\nnaturetypes <- sf::st_read(dsn = path) %>%\n  filter(naturtype %in% naturetypes_summary$Nature_type) %>%\n  mutate(hovedøkosystem = case_match(hovedøkosystem,\n                                  \"naturligÅpneOmråderILavlandet\" ~ \"naturligÅpneOmråderUnderSkoggrensa\",\n                                  .default = hovedøkosystem),\n         area = st_area(.)) %>%\n  separate_rows(ninBeskrivelsesvariable, sep=\",\") %>%\n  separate(col = ninBeskrivelsesvariable,\n           into = c(\"NiN_variable_code\", \"NiN_variable_value\"),\n           sep = \"_\",\n           remove=F) %>%\n  mutate(NiN_variable_value = as.numeric(NiN_variable_value)) %>%\n  filter(NiN_variable_code %in% myVars)\n#> Reading layer `Naturtyper_nin_0000_norge' from data source \n#>   `/data/R/GeoSpatialData/Habitats_biotopes/Norway_Miljodirektoratet_Naturtyper_nin/Original/Naturtyper_nin_0000_norge_25833_FILEGDB/Naturtyper_nin_0000_norge_25833_FILEGDB.gdb' \n#>   using driver `OpenFileGDB'\n#> Simple feature collection with 117427 features and 36 fields\n#> Geometry type: MULTIPOLYGON\n#> Dimension:     XY\n#> Bounding box:  xmin: -74953.52 ymin: 6448986 xmax: 1075081 ymax: 7921284\n#> Projected CRS: ETRS89 / UTM zone 33N\nggplot(data = naturetypes, aes(x = naturtype, fill = hovedøkosystem))+\n  geom_bar()+\n  coord_flip()+\n  theme_bw(base_size = 10)+\n  theme(legend.position = \"top\",\n        legend.title = element_blank(),\n        legend.direction = \"vertical\")+\n  guides(fill = \"none\")+\n  xlab(\"\")+\n  ylab(\"Number of localities\")+\n  facet_wrap(.~hovedøkosystem, ncol=1, scale=\"free\")\nnaturetypes$NiN_variable_code <- paste0(\"var_\", naturetypes$NiN_variable_code)\nnaturetypes <- naturetypes[!is.na(naturetypes$NiN_variable_value),]\nnaturetypes$NiN_variable_value <- naturetypes$NiN_variable_value+1\nggplot(naturetypes, aes(x = NiN_variable_value))+\n  geom_histogram(fill=\"grey\",\n           colour = \"black\",\n           binwidth = 1)+\n  theme_bw(base_size = 12)+\n  labs(x = \"Alien species variable score\") +\n  facet_wrap(.~hovedøkosystem, scales=\"free_y\")"},{"path":"alien-species.html","id":"gruk-1","chapter":"3 Alien species","heading":"3.8.1.2 GRUK","text":"variable also recorded \nGRUK.\nnature type data set ’m working includes data already\n(presently 2021 included). GRUK also records related variable:\n% cover 5m radii circles, much detailed. data \npublished. case better use harmonized data set\ncase.NOTE: ’m sure, wonder 2021 GRUK data pilot project GRUK data, future GRUK data, included data set.","code":""},{"path":"alien-species.html","id":"ANO-import2","chapter":"3 Alien species","heading":"3.8.1.3 ANO","text":"Arealrepresentativ Naturovervåking (ANO) consist 1000 systematically\nplaced locations Norway, 18 sample points. sample point \ncircle 250 m2 visualised, main ecosystem recorded.%cover alien vascular plant estimated, independent main ecosystem type.\ncontrast nature type data set, ANO looks vascular plants, also three strictest categories\nalien plant list (SE, HI, PH). therefore completely unproblematic combine data sets,\nanyway. expect plants far common species group influence 7FA variable well.\nsimilarly, expect three strictest alien plant categories contain aggressive species \ndrive 7FA variable categories.data set contains data year 2019 2021. need \nupdate data set later. clear data \n2020.point/row 250 square meters. data also contains\ninformation big proportion area made \ndominant main ecosystem. However, \n215\nNA’s , 20% data.appears proportion circle made dominant\necosystem recorded year 2019. fact, main ecosystem\nrecorded 2019:can remove NA’s, thus 2019 data.2019 ANO data excluded missing informationLet’s look variation recorded proportion ecosystem\ncover\nFigure 3.4: Distribution ANO variable andel_hovedoekosystem_punkt.\nzero obvious mistake. Removing :’s another plot distribution variable:\nFigure 1.8: Percentage cover main ecosystem 250m2 circle\ncan see people tend record variable steps 5%, \nsample points 100% belonging main ecosystem.want use area weighting indicator, can use \npercentage cover data calculate area. Note data sets\nuse m2 area units.Let’s now look distribution variable. coded fa_total_dekning.\nFirst, 73 NA’s column can remove.Let us plot distribution values.\nFigure 3.5: Distribution %cover alien plants variable ANO data set\nANO localities seemingly less alien plants nature type localities. can du sampling biases latter.Now convert %cover values 7FA classes. critical step, since one--one mapping ,\nrather considerable overlap, can seen Fig. 3.2.\nFigure 3.6: Distribution R7 values ANO data set\n","code":"\nano_eco <- c(\"vaatmark\", \"naturlig_apne\", \"semi_naturlig_mark\")\nano <- sf::st_read(paste0(pData, \"Naturovervaking_eksport.gdb\"),\n                   layer = \"ANO_SurveyPoint\") %>%\n  dplyr::filter(hovedoekosystem_punkt %in% ano_eco) %>%\n   mutate(hovedoekosystem_punkt = case_match(hovedoekosystem_punkt,\n                                       \"vaatmark\" ~ \"våtmark\",\n                                       \"naturlig_apne\" ~ \"naturligÅpneOmråderUnderSkoggrensa\",\n                                       \"semi_naturlig_mark\" ~ \"semi-naturligMark\",\n                                       .default = hovedoekosystem_punkt))\n#> Reading layer `ANO_SurveyPoint' from data source \n#>   `/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/Naturovervaking_eksport.gdb' \n#>   using driver `OpenFileGDB'\n#> Simple feature collection with 8974 features and 71 fields\n#> Geometry type: POINT\n#> Dimension:     XY\n#> Bounding box:  xmin: -51950 ymin: 6467050 xmax: 1094950 ymax: 7923950\n#> Projected CRS: ETRS89 / UTM zone 33N\ntable(ano$aar)\n#> \n#> 2019 2021 \n#>  215  887\ntable(ano$hovedtype_250m2, ano$aar)\n#>                             \n#>                              2019 2021\n#>   Åpen flomfastmark             0    1\n#>   Åpen grunnlendt mark          0   90\n#>   Åpen jordvannsmyr             0  417\n#>   Boreal hei                    0   81\n#>   Fjellhei leside og tundra     0    5\n#>   Grøftet torvmark              0    5\n#>   Helofytt-ferskvannssump       0    3\n#>   Historisk skredmark           0    3\n#>   Isinnfrysingsmark             0    1\n#>   Kaldkilde                     0    3\n#>   Kystlynghei                   0   26\n#>   Løs sterkt endret fastmark    0    1\n#>   Myr- og sumpskogsmark         0   51\n#>   Nakent berg                   0   35\n#>   Nedbørsmyr                    0   53\n#>   Rasmark                       0   23\n#>   Rasmarkhei og -eng            0    3\n#>   Semi-naturlig eng             0   44\n#>   Semi-naturlig myr             0   14\n#>   Semi-naturlig våteng          0    2\n#>   Skogsmark                     0    3\n#>   Strandberg                    0    5\n#>   Strandeng                     0    2\n#>   Strandsumpskogsmark           0    2\n#>   Våtsnøleie og snøleiekilde    0    6\nano <- ano[!is.na(ano$andel_hovedoekosystem_punkt),]\npar(mar=c(5,6,4,2))\nplot(ano$andel_hovedoekosystem_punkt[order(ano$andel_hovedoekosystem_punkt)],\n     ylab=\"Percentage of the 250 m2 area\\ncovered by the main ecosystem\")\nano <- ano[ano$andel_hovedoekosystem_punkt>20,]\nggplot(ano, aes(x = andel_hovedoekosystem_punkt))+\n         geom_histogram(fill = \"grey\",\n                        colour=\"black\",\n                        binwidth = 1)+\n  theme_bw(base_size = 12)+\n  xlab(\"Percentage cover of the main ecosystem\\n in the 250m2 circle\")+\n  scale_x_continuous(limits = c(0,101),\n                     breaks = seq(0,100,10))\nano$area <- (ano$andel_hovedoekosystem_punkt/100)*250\nano <- ano[!is.na(ano$fa_total_dekning),]\nggplot(ano, aes(x = fa_total_dekning))+\n  geom_histogram(fill=\"grey\",\n           colour = \"black\",\n           binwidth = 1)+\n  theme_bw(base_size = 12)+\n  labs(x = \"% cover alien vascular plants\") +\n  facet_wrap(.~hovedoekosystem_punkt, scales=\"free_y\")\nano <- ano %>%\n  mutate(var_7FA = case_when(\n             fa_total_dekning>90 ~ 7,\n             fa_total_dekning>25 ~ 6,\n             fa_total_dekning>10 ~ 5,\n             fa_total_dekning>5 ~ 4,\n             fa_total_dekning>2 ~ 3,\n             fa_total_dekning>1 ~ 2,\n             fa_total_dekning<1 ~ 1))\nggplot(ano, aes(x = var_7FA))+\n  geom_histogram(fill=\"grey\",\n           colour = \"black\",\n           binwidth = 1)+\n  theme_bw(base_size = 12)+\n  labs(x = \"% cover alien vascular plants\\n converted to the R7 scale\") +\n  facet_wrap(.~hovedoekosystem_punkt, scales=\"free_y\")\n#> Warning: Removed 6 rows containing non-finite values\n#> (`stat_bin()`)."},{"path":"alien-species.html","id":"combine-nt-ano2","chapter":"3 Alien species","heading":"3.8.1.3.1 Combine Naturtype data and ANO","text":"need combine nature type data set ANO data set. \nadd column origin show data comes . \nalso add column main ecosystem.Fix classI use dplyr::select reduce number columns keep things \nbit tidy.","code":"\nano$origin <- \"ANO\"\nnaturetypes$origin <- \"Nature type mapping\"\nano$hovedøkosystem <- ano$hovedoekosystem_punkt\nano$kartleggingsår <- ano$aar\nnaturetypes$kartleggingsår <- as.numeric(naturetypes$kartleggingsår)\nnaturetypes$area <- units::drop_units(naturetypes$area)\nalien_data <- dplyr::bind_rows(select(ano,\n                                  GlobalID,\n                                  origin,\n                                  kartleggingsår,\n                                  hovedøkosystem,\n                                  area,\n                                  var_7FA,\n                                  SHAPE), \n                           select(naturetypes,\n                                  identifikasjon_lokalId,\n                                  origin,\n                                  hovedøkosystem,\n                                  kartleggingsår,\n                                  area,\n                                  var_7FA = NiN_variable_value,\n                                  SHAPE))"},{},{"path":"alien-species.html","id":"distribution-of-7fa-scores","chapter":"3 Alien species","heading":"3.8.1.4 Distribution of 7FA scores","text":"\nFigure 3.8: 7FA (alien species) scores (ANO Naturetype (GRUK) data combined).\nLet’s see proportion data points (area) originating \ndata set\nFigure 3.9: Barplot showing contribution (number localities) different data sets alien species indicator.\nANO data important , can become \nimportant future good included workflow.","code":"\ntemp <- as.data.frame(table(alien_data$var_7FA))\nggplot(temp, aes(x = Var1,\n                 y = Freq))+\n  geom_bar(stat=\"identity\",\n           fill=\"grey\",\n           colour = \"black\")+\n  theme_bw(base_size = 12)+\n  labs(x = \"7FA score\",\n       y = \"Number of localities\")\ntemp <- as.data.frame(table(alien_data$origin))\n\nggplot(temp, aes(x = Var1,\n                 y = Freq))+\n  geom_bar(stat=\"identity\",\n           fill=\"grey\",\n           colour = \"black\")+\n  theme_bw(base_size = 12)+\n  labs(x = \"Data origin\",\n       y = \"Number of localities\")"},{"path":"alien-species.html","id":"outline-of-norway-and-regions-1","chapter":"3 Alien species","heading":"3.8.1.5 Outline of Norway and regions","text":"layers used crop marine areas, define\naccounting areas, respectively.MunicipalitiesThere multi-surfaces convert multi-polygons plotting.\nFigure 3.10: Municipalities Norway.\n","code":"\noutline <- sf::read_sf(\"data/outlineOfNorway_EPSG25833.shp\")\nregions <- sf::read_sf(\"data/regions.shp\", options = \"ENCODING=UTF8\")\nunique(regions$region)\n#> [1] \"Nord-Norge\" \"Midt-Norge\" \"Østlandet\"  \"Vestlandet\"\n#> [5] \"Sørlandet\"\npath1 <- ifelse(dir == \"C:\", \n               \"R:/\",\n               \"/data/R/\")\n\npath <- paste0(path1, \"GeoSpatialData/AdministrativeUnits/Norway_AdministrativeUnits/Original/Norway_Municipalities/Basisdata_0000_Norge_25833_Kommuner_FGDB.gdb\")\n\n# find the correct layer\n#st_layers(path)\nmuni <- sf::read_sf(path, options = \"ENCODING=UTF8\", layer = \"kommune\")\nmuni <- st_cast(muni, \"MULTIPOLYGON\")\ntm_shape(muni)+\n  tm_polygons(col=\"kommunenummer\")+\n  tm_layout(legend.outside = T)"},{"path":"alien-species.html","id":"scale-alien-ind","chapter":"3 Alien species","heading":"3.8.2 Scaled indicator values","text":"can scale indicator polygon, can chose aggregate\nfirst. scaled value representative precise \npolygon level, scale level. think .However, combined surveyed area small fraction \ntotal area Norway, producing indicator values \nmapped areas leaves indicator without much value regional\nassessments. simply area weighting polygons\nregion. expect considerable sampling bias\ncan’t assume \npolygons representative far outside mapped area. perhaps\ncan assume representative inside homogeneous ecological\nareas, Homoegeneous Impact Areas (HIAs). ’s \ninfrastructure index comes . ’s plan:normalise indicators polygon level.normalise indicators polygon level.take simplified infrastructure index (vector data) intersect municipality borders produce map homogeneous impact areas (HIAs).take simplified infrastructure index (vector data) intersect municipality borders produce map homogeneous impact areas (HIAs).extract corresponding indicator values intersect \ngiven HIA, extrapolate area weighted mean values \nentire HIA. Errors \ncalculated bootstrapping.extract corresponding indicator values intersect \ngiven HIA, extrapolate area weighted mean values \nentire HIA. Errors \ncalculated bootstrapping.Take new area weighted indicator values HIAs, rasterize , mask \necosystem occurrences. errors HIAs.Take new area weighted indicator values HIAs, rasterize , mask \necosystem occurrences. errors HIAs.calculate indicator value region (accounting area) \nweighted average based relative area ecosystem\noccurrences. Errors carried somehow, perhaps via weighted\nresampling.calculate indicator value region (accounting area) \nweighted average based relative area ecosystem\noccurrences. Errors carried somehow, perhaps via weighted\nresampling.","code":""},{"path":"alien-species.html","id":"scaled-alien-variable","chapter":"3 Alien species","heading":"3.8.2.1 Scaled variable","text":"use reference levels/values Norway:\nFigure 3.11: Performing linear break-point type normalisation alien species variable.\npoint yet making time series, \nassign indicator value average year data.Assigning indicator year 2020.","code":"\nlow <- 1\nhigh <- 7\nthreshold <- 4\neaTools::ea_normalise(data = alien_data,\n                      vector = \"var_7FA\",\n                      upper_reference_level = high,\n                      lower_reference_level = low,\n                      break_point = threshold,\n                      plot=T,\n                      reverse = T\n                      )\n#> Warning: Removed 6 rows containing missing values\n#> (`geom_point()`).\nmean(alien_data$kartleggingsår)\n#> [1] 2020.12\nalien_data$i_2020 <- eaTools::ea_normalise(data = alien_data,\n                      vector = \"var_7FA\",\n                      upper_reference_level = high,\n                      lower_reference_level = low,\n                      break_point = threshold,\n                      reverse = T\n                      )"},{"path":"alien-species.html","id":"HIA-alien","chapter":"3 Alien species","heading":"3.8.3 Homogeneous impact areas","text":"want use Homogeneous Impact Areas (HIA) define\nsmaller regions can extrapolate indicator values. \ndata generated discretizing Norwegian Infrastructure Index. \nrefer ordinal values four HIA classes Human\nImpact Factor (HIF). just keep approach separate \nNorwegian Infrastructure Index.want check HIF fact good predictor alien species.also want split four HIA classes based municipality. \nneed two layers CRS.get intersections (unique combinations)Create new column crossing municipality number HIFHere view data zooming TrondheimCropping raster bboxGet map major roads, context\nFigure 3.12: closer look HIA designation Trondheim\nSee Fig. 1.23 closer look distribution HIA classes across Norway.","code":"\nHIA <- readRDS(paste0(pData, \"infrastrukturindeks/homogeneous_impact_areas.rds\"))\nst_crs(HIA) == st_crs(muni)\n#> [1] TRUE\nHIA_muni <- eaTools::ea_homogeneous_area(HIA,\n                             muni,\n                             keep1 = \"infrastructureIndex\",\n                             keep2 = \"kommunenummer\")\nsaveRDS(HIA_muni, \"P:/41201785_okologisk_tilstand_2022_2023/data/cache/HIA_muni.rds\")\nHIA_muni <- HIA_muni %>%\n  mutate(muni_HIF = paste(\"ID\", kommunenummer, infrastructureIndex, sep=\"_\"))\nmyBB <- st_bbox(c(xmin=260520.12, xmax = 278587.56,\n                ymin = 7032142.5, ymax = 7045245.27),\n                crs = st_crs(HIA_muni))\nHIA_trd <- sf::st_crop(HIA_muni, myBB)\n#> Warning: attribute variables are assumed to be spatially\n#> constant throughout all geometries\nhw_utm <- readRDS(\"data/cache/highways_trondheim.rds\")\n(HIA_trd <- tm_shape(HIA_trd)+\n  tm_polygons(col = \"infrastructureIndex\",\n    title=\"Infrastructure index\\n(modified 4-step scale)\",\n    palette = \"-viridis\",\n    style=\"cat\")+\n  tm_layout(legend.outside = T)+\n  tm_shape(hw_utm)+\n  tm_lines(col=\"red\")+\n  tm_shape(outline)+\n  tm_borders(col = \"black\", lwd=2))"},{"path":"alien-species.html","id":"validate-1","chapter":"3 Alien species","heading":"3.8.3.1 Validate","text":"now 1350 HIAs (main ecosystem) , given\ndata, extrapolate indicator values . first want validate assumption HIF\nexplains considerable portion variation indicator values.subset alien_data three ecosystems.Creating summary statistics.data 277 363 municipalities. figure shows many municipalities least one data point , specific human impact factor level:\nFigure 3.13: Number municipalities least one data point , specific human impact factor level.\nsay need 20 data points HIA municipality combination order extrapolate entire HIA municipality, get much less work :\nFigure 3.14: Number municipalities least 20 data points , specific human impact factor level.\n\nFigure 3.15: Indicator-pressure relationship across ecosystems.\ntrend , strong perhaps.similar figure, looking relative frequency indicator level polygons within HIA.\nFigure 3.16: Relative frequency plot showing distribution polygons different indicator values.\nfigure think supports indicator-pressure relationship\njustifies using HIA x municipality intersections local reference\nareas.Let us look effect sample size indicator uncertainty.\nFigure 3.17: Sample size indicator uncertainty.\nshows uncertainty really inflated sample sizes less 50-100.\nFigure 3.18: Summary statistics alien species indicator.\n","code":"\n#make geometries valid \nalien_data <- st_make_valid(alien_data)\n\n#subset\nwetlands <- alien_data[alien_data$hovedøkosystem == \"våtmark\",]\nseminat <- alien_data[alien_data$hovedøkosystem == \"semi-naturligMark\",]\nnatOpen <- alien_data[alien_data$hovedøkosystem == \"naturligÅpneOmråderUnderSkoggrensa\",]\nwetland_stats <- ea_spread(indicator_data = wetlands,\n          indicator = i_2020,\n          regions = HIA_muni,\n          groups = muni_HIF,\n          summarise = TRUE)\n\nseminat_stats <- ea_spread(indicator_data = seminat,\n          indicator = i_2020,\n          regions = HIA_muni,\n          groups = muni_HIF,\n          summarise = TRUE)\n\nnatOpen_stats <- ea_spread(indicator_data = natOpen,\n          indicator = i_2020,\n          regions = HIA_muni,\n          groups = muni_HIF,\n          summarise = TRUE)\n\nwetland_stats <- wetland_stats %>%\n  add_column(eco = \"wetland\")\n\nseminat_stats <- seminat_stats %>%\n  add_column(eco = \"semi-natural\")\n\nnatOpen_stats <- natOpen_stats %>%\n  add_column(eco = \"Naturally-open\")\n\nall_stats <- rbind(wetland_stats,\n                   seminat_stats,\n                   natOpen_stats)\nall_stats <- all_stats %>%\n  separate(muni_HIF,\n           into = c(\"tempLink\", \"municipalityNumber\", \"HIF\"),\n           sep = \"_\")\n\n#saveRDS(all_stats, \"/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/cache/all_stats_alienSpecies.rds\")\nsaveRDS(all_stats, \"P:/41201785_okologisk_tilstand_2022_2023/data/cache/all_stats_alienSpecies.rds\")\nall_stats %>%\n  group_by(HIF, eco) %>%\n  summarise(n = n()) %>%\n  ggplot()+\n  geom_bar(aes(x = HIF, y = n), stat =\"identity\")+\n  theme_bw()+\n  ylab(\"Number of municipalities\")+\n  facet_wrap(.~eco)\n#> `summarise()` has grouped output by 'HIF'. You can override\n#> using the `.groups` argument.\nall_stats %>%\n  filter(n>20) %>%\n  group_by(HIF, eco) %>%\n  summarise(n = n()) %>%\n  ggplot()+\n  geom_bar(aes(x = HIF, y = n), stat =\"identity\")+\n  theme_bw()+\n  ylab(\"Number of municipalities\")+\n  facet_wrap(.~eco)\n#> `summarise()` has grouped output by 'HIF'. You can override\n#> using the `.groups` argument.\nall_stats %>%\n  filter(n > 20) %>%\n  ggplot(aes(x = HIF, y = w_mean))+\n  geom_point(size=2, position = position_dodge2(.1))+\n  geom_violin(alpha=0)+\n  theme_bw()+\n  labs(x = \"Human impact factor\",\n       y = \"Indicator value (area weighted means)\")corrCheck <- st_intersection(alien_data, HIA)\nsaveRDS(corrCheck, paste0(pData, \"cache/corrCheck_alienSpecies.rds\")\nggplot(corrCheck, aes(x = factor(infrastructureIndex), fill = factor(round(i_2020,2))))+\n  geom_bar(position=\"fill\")+\n  theme_bw(base_size = 12)+\n  guides(fill = guide_legend(\"Alien species indicator\"))+\n  ylab(\"Fraction of data points\")+\n  xlab(\"HIF\")+\n  scale_fill_brewer(palette = \"RdYlGn\")+\n  facet_wrap(.~hovedøkosystem)\nall_stats %>%\n  filter(n > 5) %>%\n  ggplot(aes(x = n, y = sd))+\n  geom_point(size=2, position = position_dodge2(.1))+\n  theme_bw()+\n    facet_wrap(.~eco, scales=\"free\")\nDT::datatable(all_stats) %>%\n  formatRound(columns=3:8, digits=2)"},{"path":"alien-species.html","id":"spread-alien","chapter":"3 Alien species","heading":"3.8.4 Aggregate and spread (extrapolate)","text":"now want find mean indicator value HIA (.e. \naggregate) spread spatially entire HIA (.e. extrapolate).want add threshold don’t end extrapolating\nbased data points. use 20 data points minimum.’s easier see ’s happening zoom bit. look closely three example municipalities:Trondheim (municipality nr 5001), Nordre Follo (3020) Målselv (5418).\nFigure 3.19: Alien species indicator extrapolated Nordre Follo (3020), Trondheim (5001) Målselv (5418). Note maps masked ecosystem type, three ecosystem specific indicators overlaping. bottom row shows location four human impact sones.\nFigure 3.19 indicates indicator lot missing data (see also ). Nordre Follo Trondheim example, indicator values tied naturally open wetland ecosystems, semi natural ecosystems data HIF class 2. , however, still lot better discarding entire data set due issues related area representativity. amount missing data indicator maps closely tied chosen threshold value many data points must order calculate (area weighted) mean indicator value. used 20 threshold . Målselv (far right column), ended enough data wetlands HIF class 0, since municipality HIF class get lot indicator coverage.following table contains data values underlying Figure 3.19, including HIAs <20 data points.\nFigure 3.20: Summary statistics three example municipalities.\nNote can also show uncertainties maps:\nFigure 3.21: Map showing uncertainties (spatial variation) around indicator values alien species three example municipalities Semi-natural ecosystems.\n","code":"\nwetland_alien_extr <- ea_spread(indicator_data = wetlands,\n                         indicator = i_2020,\n                         regions = HIA_muni,\n                         groups = muni_HIF,\n                         threshold = 20)\n\nseminat_alien_extr <- ea_spread(indicator_data = seminat,\n                         indicator = i_2020,\n                         regions = HIA_muni,\n                         groups = muni_HIF,\n                         threshold = 20)\n\nnatOpen_alien_extr <- ea_spread(indicator_data = natOpen,\n                         indicator = i_2020,\n                         regions = HIA_muni,\n                         groups = muni_HIF,\n                         threshold = 20)\nwetland_alien_extr <- wetland_alien_extr %>%\n  separate(ID,\n           into = c(\"ID\", \"municipalityNumber\", \"HIF\"),\n           sep = \"_\") %>%\n  add_column(eco = \"wetlands\")\n\nseminat_alien_extr <- seminat_alien_extr %>%\n  separate(ID,\n           into = c(\"ID\", \"municipalityNumber\", \"HIF\"),\n           sep = \"_\") %>%\n  add_column(eco = \"semi_natural\")\n\nnatOpen_alien_extr <- natOpen_alien_extr %>%\n  separate(ID,\n           into = c(\"ID\", \"municipalityNumber\", \"HIF\"),\n           sep = \"_\") %>%\n  add_column(eco = \"naturally_open\")\n\nalien_extr <- rbind(\n  wetland_alien_extr,\n  seminat_alien_extr,\n  natOpen_alien_extr\n)\nalien_extr_trd_nf <- alien_extr %>%\n  filter(municipalityNumber %in% c(\"5001\", \"3020\", \"5418\"))\nmyCol <- \"RdYlGn\"\n\ntmap_arrange(\ntm_shape(alien_extr_trd_nf)+\n  tm_polygons(col = \"w_mean\",\n    title=\"Alien species indicator\",\n    palette = myCol,\n     style=\"fixed\",\n    breaks = seq(0,1,.1))+\n  tm_layout(legend.outside = T)+\n  tm_facets(by=c(\"eco\", \"municipalityNumber\"))\n,\ntm_shape(alien_extr_trd_nf)+\n  tm_polygons(col = \"HIF\",\n    title=\"Human impact factor\",\n    palette = \"-viridis\",\n    style=\"cont\",\n    breaks = c(0,1))+\n  tm_layout(legend.outside = T)+\n  tm_facets(by=c(\"municipalityNumber\"))\n,\nncol=1,\nheights = c(1,0.3))\nall_stats %>%\n  filter(municipalityNumber %in% c(\"5001\", \"3020\", \"5418\")) %>%\n  arrange(municipalityNumber, eco, HIF) %>%\n  DT::datatable()%>%\n  formatRound(columns=3:8, digits=2)\ntm_shape(alien_extr_trd_nf[alien_extr_trd_nf$eco==\"semi_natural\",])+\n  tm_polygons(col = \"sd\",\n    title=\"SD(alien\\nspecies indicator)\",\n    palette = \"-viridis\"\n     )+\n  tm_layout(legend.outside = T)+\n  tm_facets(by=\"municipalityNumber\")"},{"path":"alien-species.html","id":"exploring-the-indicator-values","chapter":"3 Alien species","heading":"3.8.5 Exploring the indicator values","text":"HIAs good condition:\nFigure 3.22: Number HIAs >20 data points (sum three ecosystems)\n","code":"\nalien_extr %>%\n  filter(!is.na(w_mean)) %>%\n  ggplot()+\n  geom_histogram(aes(x = w_mean))+\n  theme_bw()+\n  labs(x = \"Area weighted indicator value\",\n       y = \"Number of HIAs with >20 data points\")\n#> `stat_bin()` using `bins = 30`. Pick better value with\n#> `binwidth`."},{"path":"alien-species.html","id":"alien-data-coverage","chapter":"3 Alien species","heading":"3.8.5.1 Data coverage","text":"Let’s see big proportion Norway ended data . Ideally masking indicator maps ecosystem delineations,\ncan also get good feel data coverage like well.area Norway isAnd total relative area indicator maps\nFigure 3.23: Relative area cover indicator maps alien species indicator (.e. value 1 means HIAs > 20 data points, 0.2 means 20% ). assuming ecosystems equally common mapped , measure data coverage representative real indicator coverage masking maps ecosystem delineations.\nFigure 3.23 shows us indicator provide indicator values 20% semi-natural ecosystem, considerably less two ecosystems. data coverage sensitive threshold minimum data points, set >20 case. Also, nature type data accumulating time, data coverage increase. Therefore think indicator worth , considerably better alternative discard entire data set.","code":"\n(total_area <- st_area(outline))\n#> 325694265348 [m^2]\nalien_extr %>%\n  filter(!is.na(w_mean)) %>%\n  mutate(m2 = st_area(.)) %>%\n  group_by(eco) %>%\n  summarise(sum_area = sum(m2)) %>%\n  add_column(total_area = total_area) %>%\n  mutate(relative_area = units::drop_units(sum_area/total_area)) %>%\n  ggplot()+\n  geom_bar(aes(x = eco, y = relative_area),\n           stat = \"identity\")+\n  labs(x = \"Ecosystem\", y = \"Relative indicator data coverage\")+\n  theme_bw()"},{"path":"alien-species.html","id":"effect-of-latitude","chapter":"3 Alien species","heading":"3.8.5.2 Effect of latitude","text":"Alien species tend invade south. Let us see effect latitude.Extracting x y coordinates\nFigure 3.24: Effect latitude alien species indicator values. blue line loess smoother (span=0.75).\nquite clear association latitude -site effect alien species.","code":"\ntemp <- alien_extr %>%\n  filter(!is.na(w_mean)) %>%\n  st_centroid() %>%\n  st_coordinates()\n\ntemp2 <- alien_extr %>%\n  filter(!is.na(w_mean))  %>%\n  cbind(temp)\ntemp2 %>%\n  ggplot(aes(x = X, y = w_mean))+\n  geom_point()+\n  theme_bw()+\n  geom_smooth(linewidth=2,\n              method=\"loess\",\n              span=0.75)+\n  labs(x = \"Latitude (UTM with offset)\",\n       y = \"Alien species indicator value\\n(area weighted)\")+\n  facet_wrap(~eco)"},{"path":"alien-species.html","id":"next-steps","chapter":"3 Alien species","heading":"3.9 Next steps","text":"next steps now toPrepare ecosystem delineation maps EPSG:25833 perfectly aligned master gridPrepare ecosystem delineation maps EPSG:25833 perfectly aligned master gridRasterize extrapolated indicator map, using ET map templateRasterize extrapolated indicator map, using ET map templateand mask using perfectly aligned ET map.mask using perfectly aligned ET map., look Median Summer Temperature aggregate spatially accounting areas (regions), look Median Summer Temperature aggregate spatially accounting areas (regions)workflow synchronized slitasje indicator. attempt little proof concept .","code":""},{"path":"alien-species.html","id":"masking-example","chapter":"3 Alien species","heading":"3.10 Masking with an ecosystem delineation - example","text":"Let’s try steps 2 3 reduced data set. ’ll work wetlands Gran municipality.\nFigure 3.25: Alien species indicator wetlands Gran municipality.\ncan import crop ecosystem delineation map.EDM UTM32 actually want UTM33. transforming takes long, transform indicator map instead.\nFigure 3.26: Wetlands Gran municipality\nrasterize indicator map match EDM. takes , even just one municipality. ’m sure work entire country.\nFigure 3.27: Indictor values (alien species, extrapolated area weighted values) Gran municipality. Note pixelation small (10 x 10 m), larger squares remnants HIA map 1 x 1 km resolution.\nmask remove areas actually watlands.\nFigure 3.28: Stratified, area weighted indictor values (alien species) Gran municipality masked wetland ecosystem delimination map.\neasy get zonal statistics using exactextratr. kind map Norway can get mean value regions (defined via polygon set) course area weighted (weight given ecosystem occurences don’t indicator values).","code":"\ngran <- wetland_alien_extr %>%\n  filter(municipalityNumber == \"3446\")\ntm_shape(gran)+\n  tm_polygons(col = \"w_mean\",\n    title=\"Alien species indicator - wetlands\",\n    palette = myCol,\n     style=\"fixed\",\n    breaks = seq(0,1,.1))+\n  tm_layout(legend.outside = T,\n            title = \"Gran municipality\")\nfile <- \"P:/41201785_okologisk_tilstand_2022_2023/data/Myrmodell/myrmodell90pros.tif\"\nEDM <- stars::read_stars(file, proxy=F)\ngran <- st_transform(gran, st_crs(EDM))\nmire_gran <- st_crop(EDM, gran)\nsaveRDS(mire_gran, paste0(pData, \"cache/mire_gran.rds\"))\nggplot()+\n  geom_stars(data = st_downsample(mire_gran, 10))\ngran_rast <- st_rasterize(gran, template = mire_gran)  \nsaveRDS(gran_rast, paste0(pData, \"cache/gran_rast.rds\"))\ngran_outline <- muni %>%\n  filter(kommunenummer == \"3446\")\ntm_shape(st_downsample(gran_rast, 10))+\n  tm_raster(col=\"w_mean\")+\n  tm_shape(gran_outline)+\n  tm_borders(col=\"red\")\ngran_rast_masked <- gran_rast\ngran_rast_masked[mire_gran == 0] <- NA\ntm_shape(st_downsample(gran_rast_masked, 10))+\n  tm_raster(col=\"w_mean\",\n            palette = \"red\")+\n  tm_shape(gran_outline)+\n  tm_borders(col=\"red\")"},{"path":"areal-av-isbreer.html","id":"areal-av-isbreer","chapter":"4 Areal av isbreer","heading":"4 Areal av isbreer","text":"Author date:\nAnders Kolstad","code":"#> [1] \"2023-04-14\""},{"path":"areal-av-isbreer.html","id":"introduction-3","chapter":"4 Areal av isbreer","heading":"4.1 Introduction","text":"indicator describes relative change glacial extent fire regions Norway. slightly different indicator used alpine assessment.","code":""},{"path":"areal-av-isbreer.html","id":"about-the-underlying-data-3","chapter":"4 Areal av isbreer","heading":"4.2 About the underlying data","text":"indicator uses maps glacier extent ( breatlas ) 2018-2019 compares similar map 1947-1985. maps owned NVE (Norsk vassdrags og energidirektorat). new map based Sentinel images, old map digitised version N50 maps, additional areal photo interpretation top.","code":""},{"path":"areal-av-isbreer.html","id":"representativity-in-time-and-space-3","chapter":"4 Areal av isbreer","heading":"4.2.1 Representativity in time and space","text":"data set (map) covers entire Norwegian mainland. two time steps, expect changes glacial extent relatively linear consistent time.\nolder map may underestimated glacial extent due better chance smaller snow ice patches captured Sentinel contra aerial photo interpretations.","code":""},{"path":"areal-av-isbreer.html","id":"original-units-3","chapter":"4 Areal av isbreer","heading":"4.2.2 Original units","text":"Area units (e.g. km2)","code":""},{"path":"areal-av-isbreer.html","id":"temporal-coverage-3","chapter":"4 Areal av isbreer","heading":"4.2.3 Temporal coverage","text":"1947-2019","code":""},{"path":"areal-av-isbreer.html","id":"aditional-comments-about-the-dataset-2","chapter":"4 Areal av isbreer","heading":"4.2.4 Aditional comments about the dataset","text":"None","code":""},{"path":"areal-av-isbreer.html","id":"ecosystem-characteristic-3","chapter":"4 Areal av isbreer","heading":"4.3 Ecosystem characteristic","text":"","code":""},{"path":"areal-av-isbreer.html","id":"norwegian-standard-1","chapter":"4 Areal av isbreer","heading":"4.3.1 Norwegian standard","text":"indicator initially assigned Abiotiske forhold characteristic, now considered Landskapsøkologiske mønstre. initial justificaton glacial melting influence water availability downstream. Now put weight glaciers just resevoirs ice water, habitat, presence abundance specific habitat can though aspect landscape state.","code":""},{"path":"areal-av-isbreer.html","id":"seea-ect","chapter":"4 Areal av isbreer","heading":"4.3.2 SEEA ECT","text":"indicator similarly assiged SEEA ECT class C1 Landscape characteristics.","code":""},{"path":"areal-av-isbreer.html","id":"collinearities-with-other-indicators-3","chapter":"4 Areal av isbreer","heading":"4.4 Collinearities with other indicators","text":"None known.","code":""},{"path":"areal-av-isbreer.html","id":"reference-state-and-values","chapter":"4 Areal av isbreer","heading":"4.5 Reference state and values","text":"","code":""},{"path":"areal-av-isbreer.html","id":"reference-state","chapter":"4 Areal av isbreer","heading":"4.5.1 Reference state","text":"indicator uses reference state indicators developed similar projects, defined Nybø et al (2017): Fagsystem fastsetting av god økologisk tilstand. glacial extent primarily, solely, dependent climate, case actual data climatic reference period previous normal period 1961-1990.","code":""},{"path":"areal-av-isbreer.html","id":"reference-values-thresholds-for-defining-good-ecological-condition-minimum-andor-maximum-values-3","chapter":"4 Areal av isbreer","heading":"4.5.2 Reference values, thresholds for defining good ecological condition, minimum and/or maximum values","text":"reference value zero change glacial extent time. threshold defining good ecological condition set 40% reduction glacial extent, default solution. normalization follows linear model, although sigmoidal weibull function might appropriate.minimum value set zero.","code":""},{"path":"areal-av-isbreer.html","id":"uncertainties-3","chapter":"4 Areal av isbreer","heading":"4.6 Uncertainties","text":"add 3% error side estimates, reported glacier maps NVE.","code":""},{"path":"areal-av-isbreer.html","id":"references-3","chapter":"4 Areal av isbreer","heading":"4.7 References","text":"Andreassen, L.M., & Winsvold, S.H. (eds.). 2012. Inventory Norwegian glaciers. NVE Rapport 38, Norges Vassdrags- og energidirektorat, 236 sAndreassen, L.M., & Winsvold, S.H. (eds.). 2012. Inventory Norwegian glaciers. NVE Rapport 38, Norges Vassdrags- og energidirektorat, 236 sAndreassen, L.M., Elvehøy, H., Kjøllmoen, B. & Belart, J.M.C. 2020. Glacier change Norway since 1960s – overview mass balance, area, length surface elevation changes. Journal Glaciology 66: 313–328Andreassen, L.M., Elvehøy, H., Kjøllmoen, B. & Belart, J.M.C. 2020. Glacier change Norway since 1960s – overview mass balance, area, length surface elevation changes. Journal Glaciology 66: 313–328Andreassen, L.M., Nagy, T., Kjøllmoen, B. & Leigh, J.R. 2022. Sentinel-2 based inventory Norway’s glaciers ice-marginal lakes 2018/2019. Journal Glaciology (review)Andreassen, L.M., Nagy, T., Kjøllmoen, B. & Leigh, J.R. 2022. Sentinel-2 based inventory Norway’s glaciers ice-marginal lakes 2018/2019. Journal Glaciology (review)Winsvold, S.H., Andreassen, L.M. & Kienholz, C.. 2014. Glacier area length changes Norway repeat inventories. Cryosphere 8: 1885-1903Winsvold, S.H., Andreassen, L.M. & Kienholz, C.. 2014. Glacier area length changes Norway repeat inventories. Cryosphere 8: 1885-1903","code":""},{"path":"areal-av-isbreer.html","id":"analyses-3","chapter":"4 Areal av isbreer","heading":"4.8 Analyses","text":"","code":""},{"path":"areal-av-isbreer.html","id":"importing-the-data-sets","chapter":"4 Areal av isbreer","heading":"4.8.1 Importing the data sets","text":"four data sets:glacial atlasn50 (old glacial atlas)regional delineation Norway (fire regions)outline mainland NorwayWe assuming glaciers found mountins, se need mask glacial atlas data using ecosystem delineation map.","code":""},{"path":"areal-av-isbreer.html","id":"glacial-atlas","chapter":"4 Areal av isbreer","heading":"4.8.1.1 Glacial atlas","text":"new glacial atlas 2018 2019 based Sentinell (ref. Liss Marie Andreassen, NVE)maps made project need CRS: EPSG:25833 - ETRS89 / UTM zone 33N.\none UTM 33N ETRS89, even defined old Proj.4 way.6915 polygons. Let’s calculate area polygons study distribution size classes.polygons small, couple big ones. largest polygon 50 km2, note polygons somewhat arbitrarily split.","code":"\n\n# server path\nbreatlas_path <- '/data/P-Prosjekter/41201042_okologisk_tilstand_fastlandsnorge_2020_dataanaly/fjell2021/data/breatlas/breatlas_2018_2019/Breatlas_20182019_temp20210922_lma.shp'\n\n# local path \n#breatlas_path <- 'P:/41201042_okologisk_tilstand_fastlandsnorge_2020_dataanaly/fjell2021/data/breatlas/breatlas_2018_2019/Breatlas_20182019_temp20210922_lma.shp'\n\n\nbreatlas <- sf::st_read(breatlas_path)\n#> Reading layer `Breatlas_20182019_temp20210922_lma' from data source `/data/P-Prosjekter/41201042_okologisk_tilstand_fastlandsnorge_2020_dataanaly/fjell2021/data/breatlas/breatlas_2018_2019/Breatlas_20182019_temp20210922_lma.shp' \n#>   using driver `ESRI Shapefile'\n#> Simple feature collection with 6915 features and 27 fields (with 4 geometries empty)\n#> Geometry type: MULTIPOLYGON\n#> Dimension:     XY\n#> Bounding box:  xmin: -9874.591 ymin: 6624398 xmax: 810132 ymax: 7836994\n#> Projected CRS: ETRS89 / UTM zone 33N\nbreatlas$area <- st_area(breatlas)\npar(mfrow=c(1,2))\nhist(breatlas$area)\nplot(breatlas$area)"},{"path":"areal-av-isbreer.html","id":"map-of-norway","chapter":"4 Areal av isbreer","heading":"4.8.1.2 Map of Norway","text":"map stored GitHub repository indicators/data/.","code":"\nnor <- sf::read_sf(\"data/outlineOfNorway_EPSG25833.shp\")\n\nplot(nor$geometry, axes=T, main = \"Breatlas 2018-2019\")\n  plot(breatlas$geometry, add=T, border = \"blue\")"},{"path":"areal-av-isbreer.html","id":"n50","chapter":"4 Areal av isbreer","heading":"4.8.1.3 N50","text":"old glacial extent map. Import transform , .Let’s now plot top .red areas map far right ice retreated selected glacier west coast.\nNow need devide map regions compare area n50 new glacial extent map breatlas.","code":"\n\n# server path\nn50_path <- '/data/P-Prosjekter/41201042_okologisk_tilstand_fastlandsnorge_2020_dataanaly/fjell2021/data/breatlas/n50/cryoclim_GAO_NO_1952_1985_UTM_33N.shp'\n\n# local path\n#n50_path <- 'P:/41201042_okologisk_tilstand_fastlandsnorge_2020_dataanaly/fjell2021/data/breatlas/n50/cryoclim_GAO_NO_1952_1985_UTM_33N.shp'\n\nn50 <- sf::st_read(n50_path)%>%\n  st_transform(crs = crs(breatlas))\n#> Reading layer `cryoclim_GAO_NO_1952_1985_UTM_33N' from data source `/data/P-Prosjekter/41201042_okologisk_tilstand_fastlandsnorge_2020_dataanaly/fjell2021/data/breatlas/n50/cryoclim_GAO_NO_1952_1985_UTM_33N.shp' \n#>   using driver `ESRI Shapefile'\n#> Simple feature collection with 7141 features and 30 fields\n#> Geometry type: POLYGON\n#> Dimension:     XY\n#> Bounding box:  xmin: -7278.562 ymin: 6623024 xmax: 812207.8 ymax: 7841654\n#> Projected CRS: WGS 84 / UTM zone 33N\nplot(nor$geometry, axes=T, main = \"n50 - 1952-1985\")\n  plot(n50$geometry, add=T, border = \"red\")\n\n# define some boundary boxes for zooming in on specific regions\nmyExt <- raster::extent(c(0, 100000, 6840000, 6900000))\nmyExt2 <- raster::extent(c(5000, 10000, 6880000, 6885000))\n\n# Prepare plotting device with one row, three columns\npar(mfrow=c(1,3))\n\n# Create three maps, each zooming in a bit further.\nplot(nor$geometry, axes=T)\n    plot(n50$geometry,  border = \"orange\", col = scales::alpha(\"orange\", 1), add=T)\n    plot(myExt, add=T, lwd=2)\n\nplot(nor$geometry, xlim=c(0, 100000),\n          ylim=c(6840000, 6900000),\n          axes=T)\n    plot(n50$geometry, add=T, col = \"grey\")\n    plot(myExt2, add=T, lwd=3, col=\"orange\")\n\n# for this last map I plot the old extent in red and the new as grey on top. The red areas still visible will be areas where the glaciers have retreated.        \nplot(nor$geometry, xlim=c(5000, 10000),\n          ylim=c(6880000, 6885000),\n     axes=T)\n    plot(n50$geometry, add=T, col = \"red\")\n    plot(breatlas$geometry, add=T, col = \"grey\")"},{"path":"areal-av-isbreer.html","id":"regions-1","chapter":"4 Areal av isbreer","heading":"4.8.1.4 Regions","text":"Importing shape file regional delineation.Let’s plot make sure correct.Get region namesThese odd. Let fix Norwegian letters manually.going need fix problem glacier polygons crossing .68 polygons valid.\nLet’s look first four reasons .convinient function fix .Let plot new, fixed map top old see match. give new valid map blue transparent colour, old map yellow transparent colour.seems worked.\nNotice also larger polygons somewhat arbitrarely divided several adjoining polygons. new map, old n50 map.Delete invalid data set.","code":"\nreg <- st_read(\"data/regions.shp\")\n#> Reading layer `regions' from data source \n#>   `/data/scratch/Matt_bookdown__debug/ecosystemCondition/data/regions.shp' \n#>   using driver `ESRI Shapefile'\n#> Simple feature collection with 5 features and 2 fields\n#> Geometry type: POLYGON\n#> Dimension:     XY\n#> Bounding box:  xmin: -99551.21 ymin: 6426048 xmax: 1121941 ymax: 7962744\n#> Projected CRS: ETRS89 / UTM zone 33N\nst_crs(reg)\n#> Coordinate Reference System:\n#>   User input: ETRS89 / UTM zone 33N \n#>   wkt:\n#> PROJCRS[\"ETRS89 / UTM zone 33N\",\n#>     BASEGEOGCRS[\"ETRS89\",\n#>         ENSEMBLE[\"European Terrestrial Reference System 1989 ensemble\",\n#>             MEMBER[\"European Terrestrial Reference Frame 1989\"],\n#>             MEMBER[\"European Terrestrial Reference Frame 1990\"],\n#>             MEMBER[\"European Terrestrial Reference Frame 1991\"],\n#>             MEMBER[\"European Terrestrial Reference Frame 1992\"],\n#>             MEMBER[\"European Terrestrial Reference Frame 1993\"],\n#>             MEMBER[\"European Terrestrial Reference Frame 1994\"],\n#>             MEMBER[\"European Terrestrial Reference Frame 1996\"],\n#>             MEMBER[\"European Terrestrial Reference Frame 1997\"],\n#>             MEMBER[\"European Terrestrial Reference Frame 2000\"],\n#>             MEMBER[\"European Terrestrial Reference Frame 2005\"],\n#>             MEMBER[\"European Terrestrial Reference Frame 2014\"],\n#>             ELLIPSOID[\"GRS 1980\",6378137,298.257222101,\n#>                 LENGTHUNIT[\"metre\",1]],\n#>             ENSEMBLEACCURACY[0.1]],\n#>         PRIMEM[\"Greenwich\",0,\n#>             ANGLEUNIT[\"degree\",0.0174532925199433]],\n#>         ID[\"EPSG\",4258]],\n#>     CONVERSION[\"UTM zone 33N\",\n#>         METHOD[\"Transverse Mercator\",\n#>             ID[\"EPSG\",9807]],\n#>         PARAMETER[\"Latitude of natural origin\",0,\n#>             ANGLEUNIT[\"degree\",0.0174532925199433],\n#>             ID[\"EPSG\",8801]],\n#>         PARAMETER[\"Longitude of natural origin\",15,\n#>             ANGLEUNIT[\"degree\",0.0174532925199433],\n#>             ID[\"EPSG\",8802]],\n#>         PARAMETER[\"Scale factor at natural origin\",0.9996,\n#>             SCALEUNIT[\"unity\",1],\n#>             ID[\"EPSG\",8805]],\n#>         PARAMETER[\"False easting\",500000,\n#>             LENGTHUNIT[\"metre\",1],\n#>             ID[\"EPSG\",8806]],\n#>         PARAMETER[\"False northing\",0,\n#>             LENGTHUNIT[\"metre\",1],\n#>             ID[\"EPSG\",8807]]],\n#>     CS[Cartesian,2],\n#>         AXIS[\"(E)\",east,\n#>             ORDER[1],\n#>             LENGTHUNIT[\"metre\",1]],\n#>         AXIS[\"(N)\",north,\n#>             ORDER[2],\n#>             LENGTHUNIT[\"metre\",1]],\n#>     USAGE[\n#>         SCOPE[\"Engineering survey, topographic mapping.\"],\n#>         AREA[\"Europe between 12°E and 18°E: Austria; Denmark - offshore and offshore; Germany - onshore and offshore; Norway including Svalbard - onshore and offshore.\"],\n#>         BBOX[46.4,12,84.42,18]],\n#>     ID[\"EPSG\",25833]]\nplot(nor$geometry, axes=T)\n  plot(reg$geometry, add=T, border = \"black\", \n       col = scales::alpha(c(\"blue\", \n                             \"red\", \n                             \"green\",\n                             \"yellow\",\n                             \"brown\"), .2))\nunique(reg$region)\n#> [1] \"Nord-Norge\"      \"Midt-Norge\"      \"Ã\\u0098stlandet\"\n#> [4] \"Vestlandet\"      \"SÃ¸rlandet\"\nreg$region[reg$region==\"Ã\\u0098stlandet\"] <- \"Østlandet\"\nreg$region[reg$region==\"SÃ¸rlandet\"] <- \"Sørlandet\"\ntable(st_is_valid(breatlas))\n#> \n#> FALSE  TRUE \n#>    68  6847\nunique(st_is_valid(breatlas, reason=T))[1:5]\n#> [1] \"Valid Geometry\"                                       \n#> [2] \"Ring Self-intersection[100236.4931 6912507.5864]\"     \n#> [3] \"Ring Self-intersection[92500.2095999997 6900940.8003]\"\n#> [4] \"Ring Self-intersection[91965.6612 6883260.4912]\"      \n#> [5] \"Ring Self-intersection[120595.9254 6853573.4955]\"\n# requires lwgeom\nbreatlas2 <- st_make_valid(breatlas)\ntable(st_is_valid(breatlas2))\n#> \n#> TRUE \n#> 6915\n\n# same result:\n#breatlas2 <- st_buffer(breatlas, 0.0)\n#table(st_is_valid(breatlas2))\nplot(nor$geometry, xlim=c(5000, 10000),\n          ylim=c(6880000, 6885000),\n     axes=T)\n    plot(breatlas2$geometry, add=T, col = scales::alpha(\"blue\",0.5))\n    plot(breatlas$geometry, add=T, col = scales::alpha(\"yellow\",0.5))\nbreatlas <- breatlas2\nrm(breatlas2)"},{"path":"areal-av-isbreer.html","id":"glacial-area-per-region","chapter":"4 Areal av isbreer","heading":"4.8.2 Glacial area per region","text":"","code":""},{"path":"areal-av-isbreer.html","id":"contemporary-area","chapter":"4 Areal av isbreer","heading":"4.8.2.1 Contemporary area","text":"one method getting glacial area region.Checking happens polygons span regions. Central Norway red western Norway green. 50% transparency means get third colour overlap.worked fine.Calculating area polygonsSouthern Norway <1km2 glaciers 2018-2019.","code":"\n# This intersection operation is a bit heavy, so I do it once and store it locally so that I can import it again quickly. \n#brealtas_reg <- st_intersection(breatlas, reg)\n#saveRDS(brealtas_reg, \"indicators/data/brealtas_reg_helperfile.rds\")\n\n# Importing what I create above\nbrealtas_reg <- readRDS(\"data/brealtas_reg_helperfile.rds\")\nplot(brealtas_reg$geometry[brealtas_reg$region==\"Midt-Norge\"], \n    col = scales::alpha(\"red\",0.5), border=NA, axes=T, \n     ylim=c(6900000, 6905000),\n     xlim=c(85000, 100000))\nplot(brealtas_reg$geometry[brealtas_reg$region==\"Vestlandet\"], \n     col = scales::alpha(\"green\",0.5), border=NA, add=T)\n  plot(nor$geometry, add=T)\n#Calculating the area of the polygons\nbrealtas_reg$area_crop <- st_area(brealtas_reg)\n\n# summing the area for each region\nbretabell <- tapply(\n       brealtas_reg$area_crop,\n       brealtas_reg$region,\n       FUN = sum)\n\n# converting from m2 to km2\nbretabell <- bretabell/1000000\n\n# plotting\nbarplot(\n  bretabell,\n  ylab=\"Breareal (km2)\"\n)"},{"path":"areal-av-isbreer.html","id":"same-for-n50","chapter":"4 Areal av isbreer","heading":"4.8.2.2 Same for N50","text":"Thats good.\nNow plot reference values (n50) contemporary data together.figure , glacial area reference periond light grey todays area dark grey. height light grey bar depicts reduction glacial area.little glaicers southern Norway reference period, 4 km2. condition poor! ’m entirely sure representative. alternative set NA, think - one argue glaciers important central alpine ecosystems south.","code":"\nn50x <- st_make_valid(n50)\n#n50_reg <- st_intersection(n50x, reg)\n#saveRDS(n50_reg, \"indicators/data/n50_helperfile.rds\")\nn50_reg <- readRDS(\"data/n50_helperfile.rds\")\nplot(n50_reg$geometry[n50_reg$region==\"Midt-Norge\"], \n    col = scales::alpha(\"red\",0.5), border=NA, axes=T, \n     ylim=c(6900000, 6905000),\n     xlim=c(85000, 100000))\nplot(n50_reg$geometry[n50_reg$region==\"Vestlandet\"], \n     col = scales::alpha(\"green\",0.5), border=NA, add=T)\n  plot(nor$geometry, add=T)\nn50_reg$area_crop <- st_area(n50_reg)\n\nn50tabell <- tapply(\n       n50_reg$area_crop,\n       n50_reg$region,\n       FUN = sum)\nn50tabell <- n50tabell/1000000 \n\n\nbarplot(\n  n50tabell,\n  ylab=\"Breareal (km2)\",\n  col=\"grey\"\n)\nbarplot(\n  bretabell,\n  ylab=\"Breareal (km2)\",\n  add=T,\n  col=\"grey30\"\n)"},{"path":"areal-av-isbreer.html","id":"scaled-indicator-values","chapter":"4 Areal av isbreer","heading":"4.8.3 Scaled indicator values","text":"Making table indicator values.Scaling clipping regions outline NorwayPlotting static map scaled indicator valuesCalculating total change glacier extentWe’ve lost 30% glacial area time.","code":"\nmyTbl <- tibble(region           = names(bretabell),\n                indikator        = bretabell,\n                referanseverdi   = n50tabell)\nmyTbl$skalert_indikator <- myTbl$indikator/myTbl$referanseverdi\n\nknitr::kable(myTbl)\n# paste the scaled indicato values into the shape file with the regions, using the match function to make sure the align correctly\nreg$skalert_indikator <- myTbl$skalert_indikator[match(reg$region, myTbl$region)]\n\n# cutting away the marine areas\nreg_clipped <- st_intersection(reg, nor)\n#> Warning: attribute variables are assumed to be spatially\n#> constant throughout all geometries\n# round of to 2 decimals\nreg_clipped$skalert_indikator_r <- round(reg_clipped$skalert_indikator, 2)\ntmap_mode(\"plot\") # mode 'view' takes a lot longer to render, but looks better\n#> tmap mode set to plotting\ntm_shape(reg_clipped) + \n  tm_polygons(col=\"skalert_indikator\", \n              border.col = \"white\")+\n  tm_text(\"skalert_indikator_r\", size=1.5)+\n  tm_shape(nor)+\n  tm_polygons(alpha = 0,border.col = \"black\")\n# removing the value for souther norway\nreg_clipped$skalert_indikator[reg_clipped$region==\"Sørlandet\"] <- NA\nsum(bretabell)/sum(n50tabell)\n#> [1] 0.7003536"},{"path":"areal-av-isbreer.html","id":"uncertainty-1","chapter":"4 Areal av isbreer","heading":"4.8.4 Uncertainty","text":"NVE reports 3% uncertainty method. interpret +- 3% represent 99.9%CI estimate (ca 2 SD).\noriginal indicator re-sampled indicator value 10000 times , 0.015sd, get distribution indicator values. time settle reporting sd single value .","code":""},{"path":"areal-av-isbreer.html","id":"prepare-export","chapter":"4 Areal av isbreer","heading":"4.9 Prepare export","text":"Now can prepare final exported data file. shape file raw scaled indicator values, reference reference values, uncertainties.names columns standardised (region, v_YYYY, sd_YYYY, i_YYYY, reference).","code":"\nnames(reg_clipped)\n#> [1] \"id\"                  \"region\"             \n#> [3] \"skalert_indikator\"   \"GID_0\"              \n#> [5] \"NAME_0\"              \"geometry\"           \n#> [7] \"skalert_indikator_r\"\n# paste the raw variable estimates\nreg_clipped$v_2019 <- myTbl$indikator[match(reg_clipped$region, myTbl$region)]              \n\n# paste the reference values\nreg_clipped$reference <- myTbl$referanseverdi[match(reg_clipped$region, myTbl$region)]      \n\n# add 3% (one-sided) errors (SD=1.5% so that 1.95SD equals about 3%). \nreg_clipped$sd_2019 <- reg_clipped$v_2019*0.015\n        \n# subset the shape file to include only the columns of interest, and rename the column with the scaled indicator values, assigning the value to year 2019.\nexp <- dplyr::select(reg_clipped,\n                     region,\n                     v_2019,\n                     sd_2019,\n                     reference,\n                     i_2019 = skalert_indikator,\n                     geometry)"},{"path":"areal-av-isbreer.html","id":"eksport-shape-file-final-product","chapter":"4 Areal av isbreer","heading":"4.9.1 Eksport shape file (final product)","text":"","code":"\nsf::st_write(exp, \"indicators/indicatorMaps/breareal.shp\")\nknitr::kable(exp[,1:5])"},{"path":"areal-uten-død-eller-skadet-røsslyng-i-kystlynghei.html","id":"areal-uten-død-eller-skadet-røsslyng-i-kystlynghei","chapter":"5 Areal uten død eller skadet røsslyng i kystlynghei","heading":"5 Areal uten død eller skadet røsslyng i kystlynghei","text":"Author date:\nAnders L. Kolstad","code":"#> [1] \"2023-04-14\""},{"path":"areal-uten-død-eller-skadet-røsslyng-i-kystlynghei.html","id":"introduction-4","chapter":"5 Areal uten død eller skadet røsslyng i kystlynghei","heading":"5.1 Introduction","text":"quickly go ANO data set years 2019-2021 investigate frequeny poins fall within coastal heathlands (kystlynghei). decide whether can use data inform indicator proportion dead Calluna vulgaris (røsslyng).","code":""},{"path":"areal-uten-død-eller-skadet-røsslyng-i-kystlynghei.html","id":"analyses-4","chapter":"5 Areal uten død eller skadet røsslyng i kystlynghei","heading":"5.2 Analyses","text":"","code":""},{"path":"areal-uten-død-eller-skadet-røsslyng-i-kystlynghei.html","id":"ano-data","chapter":"5 Areal uten død eller skadet røsslyng i kystlynghei","heading":"5.2.0.1 ANO data","text":"Data downloaded .Import list terms:Table number sampling points per year:\nFigure 5.1: distribution ANO points fall within different main ecosystems.\nSub-setting data consider seni natural areas.230 points semi-natural.49 1m2 samples kystlynghei.26 250m2 circles kystlynghei. variable interest called Dekning av død/skadet røsslyng recorded 26 circles.","code":"\nano <- sf::st_read(\"/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/Naturovervaking_eksport.gdb\",\n                   layer = \"ANO_SurveyPoint\")\n#> Reading layer `ANO_SurveyPoint' from data source \n#>   `/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/Naturovervaking_eksport.gdb' \n#>   using driver `OpenFileGDB'\n#> Simple feature collection with 8974 features and 71 fields\n#> Geometry type: POINT\n#> Dimension:     XY\n#> Bounding box:  xmin: -51950 ymin: 6467050 xmax: 1094950 ymax: 7923950\n#> Projected CRS: ETRS89 / UTM zone 33N\n#st_crs(ano)\nnames(ano)\n#>  [1] \"GlobalID\"                      \n#>  [2] \"registeringsdato\"              \n#>  [3] \"klokkeslett_start\"             \n#>  [4] \"ano_flate_id\"                  \n#>  [5] \"ano_punkt_id\"                  \n#>  [6] \"ssb_id\"                        \n#>  [7] \"program\"                       \n#>  [8] \"instruks\"                      \n#>  [9] \"aar\"                           \n#> [10] \"dataansvarlig_mdir\"            \n#> [11] \"dataeier\"                      \n#> [12] \"vaer\"                          \n#> [13] \"hovedoekosystem_punkt\"         \n#> [14] \"andel_hovedoekosystem_punkt\"   \n#> [15] \"utilgjengelig_punkt\"           \n#> [16] \"utilgjengelig_begrunnelse\"     \n#> [17] \"gps\"                           \n#> [18] \"noeyaktighet\"                  \n#> [19] \"kommentar_posisjon\"            \n#> [20] \"klokkeslett_karplanter_start\"  \n#> [21] \"art_alle_registrert\"           \n#> [22] \"karplanter_dekning\"            \n#> [23] \"klokkeslett_karplanter_slutt\"  \n#> [24] \"karplanter_feltsjikt\"          \n#> [25] \"moser_dekning\"                 \n#> [26] \"torvmoser_dekning\"             \n#> [27] \"lav_dekning\"                   \n#> [28] \"stroe_dekning\"                 \n#> [29] \"jord_grus_stein_berg_dekning\"  \n#> [30] \"stubber_kvister_dekning\"       \n#> [31] \"alger_fjell_dekning\"           \n#> [32] \"kommentar_ruteanalyse\"         \n#> [33] \"fastmerker\"                    \n#> [34] \"kommentar_fastmerker\"          \n#> [35] \"kartleggingsenhet_1m2\"         \n#> [36] \"hovedtype_1m2\"                 \n#> [37] \"ke_beskrivelse_1m2\"            \n#> [38] \"kartleggingsenhet_250m2\"       \n#> [39] \"hovedtype_250m2\"               \n#> [40] \"ke_beskrivelse_250m2\"          \n#> [41] \"andel_kartleggingsenhet_250m2\" \n#> [42] \"bv_7gr_gi\"                     \n#> [43] \"bv_7jb_ba\"                     \n#> [44] \"bv_7jb_bt\"                     \n#> [45] \"bv_7jb_si\"                     \n#> [46] \"bv_7tk\"                        \n#> [47] \"bv_7se\"                        \n#> [48] \"forekomst_ntyp\"                \n#> [49] \"ntyp\"                          \n#> [50] \"kommentar_naturtyperegistering\"\n#> [51] \"side_5_note\"                   \n#> [52] \"krypende_vier_dekning\"         \n#> [53] \"ikke_krypende_vier_dekning\"    \n#> [54] \"vedplanter_total_dekning\"      \n#> [55] \"busker_dekning\"                \n#> [56] \"tresjikt_dekning\"              \n#> [57] \"treslag_registrert\"            \n#> [58] \"roesslyng_dekning\"             \n#> [59] \"roesslyngblad\"                 \n#> [60] \"pa_dekning\"                    \n#> [61] \"pa_note\"                       \n#> [62] \"pa_registrert\"                 \n#> [63] \"fa_total_dekning\"              \n#> [64] \"fa_registrert\"                 \n#> [65] \"kommentar_250m2_flate\"         \n#> [66] \"klokkeslett_slutt\"             \n#> [67] \"vedlegg_url\"                   \n#> [68] \"creator\"                       \n#> [69] \"creationdate\"                  \n#> [70] \"editor\"                        \n#> [71] \"editdate\"                      \n#> [72] \"SHAPE\"\ntable(ano$aar)\n#> \n#> 2019 2020 2021 \n#> 1111 3411 4452\npar(mar=c(15,5,0,0))\nbarplot(table(ano$hovedoekosystem_punkt), las=2)\nsnat <- ano[ano$hovedoekosystem_punkt == \"semi_naturlig_mark\",]\nsnat2 <- snat[!is.na(snat$GlobalID),]\ntable(snat$hovedtype_1m2)\n#> \n#>       Åpen jordvannsmyr              Boreal hei \n#>                       4                     107 \n#>               Kaldkilde             Kystlynghei \n#>                       1                      49 \n#>             Nakent berg              Nedbørsmyr \n#>                       2                       1 \n#>       Semi-naturlig eng       Semi-naturlig myr \n#>                      51                       6 \n#> Semi-naturlig strandeng    Semi-naturlig våteng \n#>                       1                       1 \n#>               Skogsmark \n#>                       4\ntable(ano$hovedtype_250m2)\n#> \n#>                                      Åker \n#>                                        62 \n#>                         Åpen flomfastmark \n#>                                         1 \n#>                      Åpen grunnlendt mark \n#>                                        92 \n#>                         Åpen jordvannsmyr \n#>                                       427 \n#>                                 Blokkmark \n#>                                       204 \n#>                                Boreal hei \n#>                                        94 \n#>        Breforland og snøavsmeltingsområde \n#>                                        33 \n#>               Eng-liknende oppdyrket mark \n#>                                        19 \n#>       Eng-liknende sterkt endret fastmark \n#>                                         2 \n#>                Fjellgrashei og grastundra \n#>                                        32 \n#>                 Fjellhei leside og tundra \n#>                                       853 \n#>                             Flomskogsmark \n#>                                         1 \n#>                          Grøftet torvmark \n#>                                         6 \n#>                        Grotte og overheng \n#>                                         1 \n#>               Hard sterkt endret fastmark \n#>                                         2 \n#>                   Helofytt-ferskvannssump \n#>                                         4 \n#>                       Historisk skredmark \n#>                                         3 \n#>                         Isinnfrysingsmark \n#>                                         2 \n#>                                 Kaldkilde \n#>                                         3 \n#>                               Kystlynghei \n#>                                        26 \n#>                Løs sterkt endret fastmark \n#>                                        43 \n#>                     Myr- og sumpskogsmark \n#>                                        53 \n#>                               Nakent berg \n#>                                       193 \n#>                                Nedbørsmyr \n#>                                        53 \n#>                       Oppdyrket varig eng \n#>                                        45 \n#>                           Oppfrysingsmark \n#>                                         3 \n#>                 Plener parker og liknende \n#>                                        19 \n#>                                     Rabbe \n#>                                        83 \n#>                                   Rasmark \n#>                                        58 \n#>                        Rasmarkhei og -eng \n#>                                         8 \n#>                         Semi-naturlig eng \n#>                                        45 \n#>                         Semi-naturlig myr \n#>                                        14 \n#>                      Semi-naturlig våteng \n#>                                         2 \n#>                                 Skogsmark \n#>                                      1288 \n#>                   Snø- og isdekt fastmark \n#>                                       105 \n#>                                   Snøleie \n#>                                       160 \n#>                                Strandberg \n#>                                         5 \n#>                                 Strandeng \n#>                                         2 \n#>                       Strandsumpskogsmark \n#>                                         2 \n#> Tørrlagte våtmarks- og ferskvannssystemer \n#>                                         7 \n#>                                   Torvtak \n#>                                         1 \n#>                              Treplantasje \n#>                                        13 \n#>                Våtsnøleie og snøleiekilde \n#>                                        13"},{"path":"areal-uten-død-eller-skadet-røsslyng-i-kystlynghei.html","id":"conclusion","chapter":"5 Areal uten død eller skadet røsslyng i kystlynghei","heading":"5.3 Conclusion","text":"random allocation sampling points, enough points fall coastal heathlands allow us create trustworthy indicator nature type. years data might end 100 points, borderline need order calculate condition values regional level level precision.","code":""},{"path":"naturtype.html","id":"naturtype","chapter":"6 Nature types","heading":"6 Nature types","text":"application nature type data setData exploration analyses thematic coverageAuthor:Anders L. KolstadMarch 2023Here investigate specific data set, Naturtyper - Miljødirektoratets instruks try evaluate usability designing indicators ecosystem condition. involves assessing spatial temporal representation, well conceptual alignment Norwegian system ecosystem condition assessments.precision field mapping assess . assume , even considerable, sampling error, inherent field data.first part analysis simply get overview data, making ready part 2 look thematic coverage nature types NiN variables used.","code":""},{"path":"naturtype.html","id":"import-data-and-general-summary-statistics","chapter":"6 Nature types","heading":"6.1 Import data and general summary statistics","text":"Fix non-valid polygons:data set 117k polygons, 37 variables:therefore takes little minute render plot, code :","code":"\ndir <- substr(getwd(), 1,2)\n\n# local path\n#path <- \"data/R:/GeoSpatialData/Habitats_biotopes/Norway_Miljodirektoratet_Naturtyper_nin/Original/Natur_Naturtyper_NiN_norge_med_svalbard_25833.gdb\"\n# temporary path \n#path <- \"/data/Egenutvikling/41001581_egenutvikling_anders_kolstad/data/Natur_Naturtyper_NiN_norge_med_svalbard_25833.g#db\"\n\n# server path pre 2022 data\n#path <- \"/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/Natur_Naturtyper_NiN_norge_med_svalbard_25833.gdb\"\npath <- ifelse(dir == \"C:\", \n               \"R:/GeoSpatialData/Habitats_biotopes/Norway_Miljodirektoratet_Naturtyper_nin/Original/Naturtyper_nin_0000_norge_25833_FILEGDB/Naturtyper_nin_0000_norge_25833_FILEGDB.gdb\",\n               \"/data/R/GeoSpatialData/Habitats_biotopes/Norway_Miljodirektoratet_Naturtyper_nin/Original/Naturtyper_nin_0000_norge_25833_FILEGDB/Naturtyper_nin_0000_norge_25833_FILEGDB.gdb\")\n\ndat <- sf::st_read(dsn = path)\ndat <- sf::st_make_valid(dat)\ndim(dat)\n#> [1] 117427     37\nnor <- sf::read_sf(\"data/outlineOfNorway_EPSG25833.shp\")\ntmap_mode(\"view\")\ntm_shape(dat) + \n  tm_polygons(col=\"tilstand\")+\n  tm_shape(nor)+\n  tm_polygons(alpha = 0,border.col = \"black\")"},{"path":"naturtype.html","id":"area","chapter":"6 Nature types","heading":"6.2 Area","text":"Calculating area polygon/localityThe smallest polygons 20 m2, biggest 15.8 km2.largest polygon Kalkfattig og intermediær fjellhei, leside og tundra , smallest polygon Sørlig kaldkilde.Sum mapped area divided Norwegian mainland area:0.6% Norway mapped (note bigger area surveyed, small fraction delineated). therefore essential 0.5% representative.","code":"\ndat$area <- sf::st_area(dat)\nsummary(dat$area)\n#>     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. \n#>       20      700     2810    17153     8674 15794178\n#Import outline of mainland Norway\nnor <- sf::read_sf(\"data/outlineOfNorway_EPSG25833.shp\")\nsum(dat$area)/sf::st_area(nor)\n#> 0.006184274 [1]"},{"path":"naturtype.html","id":"temporal-trend","chapter":"6 Nature types","heading":"6.3 Temporal trend","text":"\nFigure 6.1: Temproal trend nature type mapping using Miljødirektoratets Instruks\ndifferences field mapping instructions years. need decide whether include years, perhaps exclude first year.","code":"\ndat$kartleggingsår <- as.numeric(dat$kartleggingsår)\narea_year <- as.data.frame(tapply(dat$area, dat$kartleggingsår, sum))\nnames(area_year) <- \"area\"\narea_year$year <- row.names(area_year)\narea_year$area_km2 <- area_year$area/10^6\nggplot(area_year)+\n  geom_bar(aes(x = year, y = area_km2),\n           stat = \"identity\",\n           fill = \"grey\",\n           colour=\"black\",\n           size = 1.2)+\n  theme_bw(base_size = 12)+\n  labs(x = \"Year\", y = \"Total mapped area (km/2)\")\n#> Warning: Using `size` aesthetic for lines was deprecated in ggplot2\n#> 3.4.0.\n#> ℹ Please use `linewidth` instead.\n#> This warning is displayed once every 8 hours.\n#> Call `lifecycle::last_lifecycle_warnings()` to see where\n#> this warning was generated."},{"path":"naturtype.html","id":"condition","chapter":"6 Nature types","heading":"6.4 Condition","text":"quick overview condition scores\nFigure 1.2: overal distribution condition scores\nsites/polygons either good moderately good condition. ’m sure first class represents. seems like polygons don’t condition score. Looking just data set, also online faktaark localities, give answer:figure show cases restricted just one field season.\nFigure 6.2: Temporal trend localities without condition scores.\n\nFigure 2.1: Main ecosystems localities missing condition scores.\ncases restricted two main ecosystems, one class main ecosystem recorded. Looking cases clear relevant work , don’t know data set begin .\nFigure 1.5: Nature types localities missing condition scores.\nseven nature types (exclude mapped) don’t condition score.Snøleieblokkmark rabbeblokkmark protocol assessing condition status. Leirskredgrop, leirravine grotte nature types 2018 (mapped 2021), similarly assessed condition scores. Isinnfrysingsmark assessed condition now, 2018. Snøleieberg new 2022 mapped area. can therefore exclude localities data set:resulted deletion 370 rows, 0.32 % data.","code":"\ndat <- dat %>%\n  mutate(tilstand =  recode(tilstand, \n                            \"sværtRedusert\" = \"1 - Svært redusert\",\n                            \"dårlig\" = \"2 - Dårlig\",\n                            \"moderat\" = \"3 - Moderat\",\n                            \"god\" = \"4 - God\"))\n\nbarplot(tapply(dat$area/10^6, factor(dat$tilstand), sum))\nView(dat[dat$tilstand==\"\",])\nbarplot(table(dat$kartleggingsår[dat$tilstand==\"\"]), \n        ylab=\"Number of localities without condition scores\",\n        xlab=\"Year\")\npar(mar=c(5,20,1,1))\nbarplot(table(dat$hovedøkosystem[dat$tilstand==\"\"]),\n        horiz = T, las=2,\n        xlab=\"Number of localities without condition scores\")\npar(mar=c(5,20,1,1))\nbarplot(table(dat$naturtype[dat$tilstand==\"\"]),\n        horiz = T, las=2,\n        xlab=\"Number of localities without condition scores\")\ndat_rm <- dat\ndat <- dat_rm[dat_rm$tilstand!=\"\",]"},{"path":"naturtype.html","id":"mosaic-types","chapter":"6 Nature types","heading":"6.5 Mosaic types","text":"field mapping instruction include option delineating mosaic types. Let’s investigate cases.area displays repeating pattern mixed nature types smaller minimum mapping unit MMU, grouped many overlapping polygons unique nature types. Within nature type polygons, distribution NiN-grunntyper (online can see percentage distribution, data set presence/absence data) assigned different nature types (nature types Environmental agencies classification). condition scoring can unique overlapping nature type mosaic. don’t know precise location NiN-grunntyper part mosaic nature types.\nFigure 6.3: number mosaic localities relatively small.\nMosaic localities occur many main ecosystems (many nature types therein).\nFigure 6.4: Distribution mosaic nature types across hovedøkosystem\nconclusion thatMosaic localities used pin-point NiN grunntyper (e.g. remote sensing purposes).Mosaic localities CAN used extract condition scores nature types, tied NiN grunntype listed polygon, include belong part(s) mosaic.","code":"\nbarplot(table(dat$mosaikk),\n        xlab = \"Mosaic\", ylab=\"Number of localities\")\n# Fix duplicated `hovedøkosystem`\n#unique(dat$hovedøkosystem)\ndat$hovedøkosystem[dat$hovedøkosystem==\"naturligÅpneOmråderILavlandet\"] <- \"naturligÅpneOmråderUnderSkoggrensa\"\npar(mar=c(5,20,1,1))\nbarplot(table(dat$hovedøkosystem[dat$mosaikk==\"ja\"]),\n        horiz = T, las=2,\n        xlab=\"Number of mosaic localities\")"},{"path":"naturtype.html","id":"nin-types-across-main-ecosystems","chapter":"6 Nature types","heading":"6.6 NiN types across main ecosystems","text":"NiN main types can extracted column ninKartleggingsenheter. NiN mapping units recorded field. NiN main type makes first part mapping unit code. variable oddly concatenated. Let’s tease apart.\nFigure 6.5: number NiN main types within one locality normally one, except mosaic localities.\nMosaic localities (right pane) much higher likelihood including multiple NiN main types, also occurs non-mosaic localities (10 000 cases). , , nature types defined within single NiN main type, need see whats going .First need melt data frame order tally number NiN min types within hovedøkosystem.\nFigure 6.6: Figure showing number localities NiN main type. One locality can one NiN main type. Mosaic localities excluded figure.\nmessy figure, point , lot miss-match NiN main types hovedøkosystem. Taking one example: T2 (åpen grunnledt mark) found mountains, one case occurs. view case.. find online fact sheet locality, see actually mosaic. nature type called Kalkfattig og intermediær fjellhei, leside og tundra defined strictly T3, field surveyor recorded lots NiN mapping units (hence, main NiN types) addition. mistake. Online can see locality 50% T3, information data set available. Miljødirektoratet consider adding information downloadable dataset. order NiN types ninKartleggingsenheter column reflecting commonness types ether.way extract defining NiN type naturtype column, nice. Miljødirektoratet may consider adding well. exclude localities mosaics, multiple NiN main types (, ’re going , least), first need know naturtype allow multiple NiN main types.next figure show, cases restricted mapping year, hence changes field protocol.\nFigure 6.7: Temporal trend recording non-mosaic localities recorded consisting multiple NiN mapping units different NiN main types.\nLets look common nature types recorded way.\nFigure 6.8: ten common nature types number localities multiple NiN main types\n‘Hule eiker’ special case recorded points polygons, can found NiN main type hovedøkosystem.Kystlynghei often occurs mosaic, figure 6.8 excluded mosaic localities, kystlynghei strictly defined T34.\ntrue naturbeitemark restricted T32.\nMaybe localities recorded mosaic localities. case, automatically extract main NiN type rows now.remaining option manually assign defining NiN main type nature type. data included data set, need sourced mapping protocols different field seasons.deeper analyses causes localities mapped NiN main types outside definition nature type, see Appendix 1.","code":"\n#dat$ninKartleggingsenheter  [1:10]\n# remove NA prefix:\ndat$ninKartleggingsenheter2 <- gsub(\"NA_\", dat$ninKartleggingsenheter, replacement = \"\")\n#dat$ninKartleggingsenheter2[1:30]\n\ndat$ninKartleggingsenheter2 <- str_replace_all(dat$ninKartleggingsenheter2, \".[CE].[\\\\d]{1,}\", replacement = \"\")\n#dat$ninKartleggingsenheter2[1:30]\ndat$ninKartleggingsenheter2 <- str_replace_all(dat$ninKartleggingsenheter2, \"-.\", replacement = \"\")\nuni <- function(x){paste(unique(unlist(strsplit(x, \",\"))), collapse = \",\")}\ndat$ninKartleggingsenheter3 <- lapply(dat$ninKartleggingsenheter2, uni)\nn_uni <- function(x){length(unique(unlist(strsplit(x, \",\"))))}\ndat$n_ninKartleggingsenheter <- lapply(dat$ninKartleggingsenheter2, n_uni)\ndat$n_ninKartleggingsenheter <- as.numeric(dat$n_ninKartleggingsenheter) \n\npar(mfrow=c(1,3))\nbarplot(table(dat$n_ninKartleggingsenheter),\n        xlab = \"Number of NiN main types\",\n        ylab = \"Number of localities\")\nbarplot(table(dat$n_ninKartleggingsenheter[dat$mosaikk==\"nei\"]),\n        xlab = \"Number of NiN main types\\n(Mosaic localities excluded)\")\nbarplot(table(dat$n_ninKartleggingsenheter[dat$mosaikk==\"ja\"]),\n        xlab = \"Number of NiN main types\\n(Mosaic localities only)\")\ndat_melt <- tidyr::separate_rows(dat, ninKartleggingsenheter3)\nggplot(dat_melt[dat_melt$mosaikk!=\"ja\",])+\n  geom_bar(aes(x = ninKartleggingsenheter3))+\n  coord_flip()+\n  theme_bw(base_size = 12)+\n  facet_wrap(\"hovedøkosystem\",\n             scales = \"free\")\nView(dat_melt[dat_melt$mosaikk!=\"Ja\" & dat_melt$hovedøkosystem==\"Fjell\" & dat_melt$ninKartleggingsenheter3==\"T2\",])\npar(mar=c(2,6,2,2))\ntemp <- dat[dat$n_ninKartleggingsenheter>1 & dat$mosaikk!=\"ja\",]\nbarplot(table(temp$kartleggingsår), ylab=\"Number of localities with more than one NiN main type\\n(mosaic localitie excluded) \")\ntemp2 <- as.data.frame(table(temp$naturtype, temp$n_ninKartleggingsenheter))\ntemp2 <- temp2[base::order(temp2$Freq, decreasing = T),][1:10,]\npar(mar=c(8,20,1,1))\nbarplot(temp2$Freq, names.arg = temp2$Var1, las=2,\n        horiz = T, xlab = \"Number of localities with >1 NiN main type\")\nDT::datatable(\n  dat[dat$naturtype==\"Hule eiker\",][1:5,c(\"naturtype\", \"hovedøkosystem\", \"ninKartleggingsenheter\")])"},{"path":"naturtype.html","id":"assigning-nin-main-types-to-nature-types","chapter":"6 Nature types","heading":"6.7 Assigning NiN main types to Nature types","text":"NiN main types need added manually nature types, field recorded data error prone, defining NiN units nature type included data set.start excluding three target ecosystems.also exclude Hule eiker, nature type easy tie single main ecosystem. scenarios, one might wish keep hule eiker depending main ecosystem recorded field.Get unique nature typesExtract year mappedExtract associated ecosystemCombine one data frameWe 69 nature types consider.wetland types can actually excluded way limited ecosystem mean open wetland:\nFigure 6.9: List nature types showing years nature type mapped.\nalso now exclude nature types mapped 2018 /2019 . nature types get data future, also mapped time methodology quite unstable.removed 12 nature types.Next want add NiN main types. need look definition nature type get NiN code . also extract NiN sub types (grunntyper), become messy. Therefor create second column textual/categorical description degree thematic coverage.look definitions nature type first last year type mapped, years .","code":"\ntarget <- c(\"semi-naturligMark\",\n            \"våtmark\",\n            \"naturligÅpneOmråderUnderSkoggrensa\")\ndat <- dat[dat$hovedøkosystem %in% target,]\ndat <- dat[dat$naturtype != \"Hule eiker\",]\nntyp <- unique(dat$naturtype)\nyears <- NULL\nfor(i in 1:length(ntyp)){\nyears[i] <- paste(sort(unique(dat$kartleggingsår[dat$naturtype == ntyp[i]])), collapse = \", \")\n}\neco <- NULL\nfor(i in 1:length(ntyp)){\neco[i] <- paste(unique(dat$hovedøkosystem[dat$naturtype == ntyp[i]]), collapse = \", \")\n}\nntypDF <- data.frame(\n  \"Nature_type\" = ntyp,\n  \"Year\"        = years,\n  \"Ecosystem\"   = eco\n)\nexcl_nt <- c(\"Kalkrik myr- og sumpskogsmark\",\n             #\"Flommyr, myrkant og myrskogsmark\",  # Only V9 is relevant. This type also includes V2 and V8\n             \"Gammel fattig sumpskog\",\n             \"Rik gransumpskog\",\n             \"Grankildeskog\",\n             \"Rik svartorsumpskog\",\n             \"Rik gråorsumpskog\",\n             \"Rik svartorstrandskog\",\n             \"Saltpåvirket svartorstrandskog\",\n             \"Kilde-edellauvskog\",\n             \"Saltpåvirket strand- og sumpskogsmark\",\n             \"Svak kilde og kildeskogsmark\",\n             \"Rik vierstrandskog\",\n             \"Varmekjær kildelauvskog\"\n             )\nntypDF$Nature_type <- trimws(ntypDF$Nature_type)\nntypDF <- ntypDF[!ntypDF$Nature_type %in% excl_nt,]\nDT::datatable(ntypDF)\nntypDF2 <- ntypDF[ntypDF$Year != \"2018\" &\n                  ntypDF$Year != \"2019\" & \n                  ntypDF$Year != \"2018, 2019\"# no types were mappend in 2018 & 2019 only\n                  ,]"},{"path":"naturtype.html","id":"add-nin-main-type-and-degree-of-representativity","chapter":"6 Nature types","heading":"6.7.1 Add NiN main type and degree of representativity","text":"Split new column two.","code":"\n#remove trailing white spaces\nntypDF2$Nature_type <- trimws(ntypDF2$Nature_type)\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Aktiv skredmark\"                                    ] <- \"T17 | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Åpen flomfastmark\"                                  ] <- \"T18 | all\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Åpen grunnlendt kalkrik mark i boreonemoral sone\"   ] <- \"T2  | calcareous\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Åpen grunnlendt kalkrik mark i sørboreal sone\"      ] <- \"T2  | calcareous\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Atlantisk høymyr\"                                   ] <- \"V3  | all (if including sub-types)\" # can also include smaller areas of V1\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Boreal hei\"                                         ] <- \"T31 | all\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Eksentrisk høymyr\"                                  ] <- \"V3  | all (if including sub-types)\" # can also include smaller areas of V1\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Eng-aktig sterkt endret fastmark\"                   ] <- \"T41 | all\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Fosse-eng\"                                          ] <- \"T15 | all\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Fosseberg\"                                          ] <- \"T1  | extra wet\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Fossepåvirket berg\"                                 ] <- \"T1  | extra wet\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Fuglefjell-eng og fugletopp\"                        ] <- \"T8  | all\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Hagemark\"                                           ] <- \"T32 | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Høgereligende og nordlig nedbørsmyr\"                ] <- \"V3  | all (if including sub-types)\" # torvmarksformene are excluded\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Isinnfrysingsmark\"                                  ] <- \"T20 | all\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Kalkrik helofyttsump\"                               ] <- \"L4 | calcareous\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Kanthøymyr\"                                         ] <- \"V3  | all (if including sub-types)\" # can also include smaller areas of V1\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Konsentrisk høymyr\"                                 ] <- \"V3  | all (if including sub-types)\" # can also include smaller areas of V1\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Kystlynghei\"                                        ] <- \"T34 | all\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Lauveng\"                                            ] <- \"T32 | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Nakent tørkeutsatt kalkberg\"                        ] <- \"T1  | calcareous and dry\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Naturbeitemark\"                                     ] <- \"T32 | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Øvre sandstrand uten pionervegetasjon\"              ] <- \"T29 | sandy and vegetated\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Øyblandingsmyr\"                                     ] <- \"V1  | partial\" # also includes V3\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Palsmyr\"                                            ] <- \"V3  | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Platåhøymyr\"                                        ] <- \"V3  | all (if including sub-types)\" # can also include smaller areas of V1\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Rik åpen jordvannsmyr i mellomboreal sone\"          ] <- \"V1  | calcareous\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Rik åpen jordvannsmyr i nordboreal og lavalpin sone\"] <- \"V1  | calcareous\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Rik åpen sørlig jordvannsmyr\"                       ] <- \"V1  | calcareous\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Sanddynemark\"                                       ] <- \"T21 | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Semi-naturlig eng\"                                  ] <- \"T32 | all (if including sub-types)\"\n# This might be called Kulturmarkseng in the 2018 protocol, but Semi-naturlig eng in the data set. \n# Kulturmarkseng also includes V10\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Semi-naturlig myr\"                                  ] <- \"V9  | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Semi-naturlig strandeng\"                            ] <- \"T33 | all (-2018)\" # could perhaps be used in 2018, but it's defined awkwardly\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Semi-naturlig våteng\"                               ] <- \"V10 | all (-2018)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Silt og leirskred\"                                  ] <- \"T17 | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Slåttemark\"                                         ] <- \"T32 | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Slåttemyr\"                                          ] <- \"V9  | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Sørlig etablert sanddynemark\"                       ] <- \"T21 | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Sørlig kaldkilde\"                                   ] <- \"V4  | southern\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Sørlig nedbørsmyr\"                                  ] <- \"V3  | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Sørlig slåttemyr\"                                   ] <- \"V9  | all (if including sub-types)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Strandeng\"                                          ] <- \"T12 | all (-2018)\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Svært tørkeutsatt sørlig kalkberg\"                  ] <- \"T1  | calcareous and dry\"\nntypDF2$hovedgruppe[ntypDF2$Nature_type == \"Terrengdekkende myr\"                                ] <- \"V3  | all (if including sub-types)\"\nntypDF2 <- ntypDF2 %>%\n  tidyr::separate(col = hovedgruppe,\n                  into = c(\"NiN_mainType\", \"NiN_mainTypeCoverage\"),\n                  #sep = \"|\",\n                  remove=T,\n                  extra = \"merge\"\n              )"},{"path":"naturtype.html","id":"add-nin-variables","chapter":"6 Nature types","heading":"6.8 Add NiN variables","text":"Preparing data:NiN variable codes:Converting NiN_variable_value numeric also introduced NA’s categories:now go variable codes separately also judge NA’s real, example coded zeros something. exclude variables part biodiversity assessment localities, since assessed localities poor condition (bias possible correct).","code":"\n#Exclude non-relevant forest wetland types\ndat2 <- dat[!dat$naturtype %in% excl_nt,]\n\n# Melt data\ndat2L <- tidyr::separate_rows(dat2, ninBeskrivelsesvariable, sep=\",\")\n\n# Split the code and the value into separate columns\ndat2L <- tidyr::separate(dat2L, \n                              col = ninBeskrivelsesvariable,\n                              into = c(\"NiN_variable_code\", \"NiN_variable_value\"),\n                              sep = \"_\",\n                              remove=F\n                              )\n#> Warning: Expected 2 pieces. Missing pieces filled with `NA` in 1\n#> rows [189800].\n# One NA produced here, but I check it, and it's fine.\n\n# Convert values to numeric. This causes some NA's which I will go through below\ndat2L$NiN_variable_value <- as.numeric(dat2L$NiN_variable_value)\n#> Warning: NAs introduced by coercion\nunique(sort(dat2L$NiN_variable_code))\n#>  [1] \"1AG-A-0\"   \"1AG-A-E\"   \"1AG-A-G\"   \"1AG-B\"    \n#>  [5] \"1AG-C\"     \"1AR-A-E\"   \"1AR-C-L\"   \"3TO-BØ\"   \n#>  [9] \"3TO-HA\"    \"3TO-HE\"    \"3TO-HK\"    \"3TO-HN\"   \n#> [13] \"3TO-HP\"    \"3TO-PA\"    \"3TO-TE\"    \"4DL-S-0\"  \n#> [17] \"4DL-SS-0\"  \"4TG-BL\"    \"4TG-EL\"    \"4TG-GF\"   \n#> [21] \"4TL-BS\"    \"4TL-HE\"    \"4TL-HL\"    \"4TL-RB\"   \n#> [25] \"4TL-SB\"    \"4TS-TS\"    \"5AB-0\"     \"5AB-DO-TT\"\n#> [29] \"5BY-0\"     \"6SE\"       \"6SO\"       \"7FA\"      \n#> [33] \"7GR-GI\"    \"7JB-BA\"    \"7JB-BT\"    \"7JB-GJ\"   \n#> [37] \"7JB-HT-SL\" \"7JB-HT-ST\" \"7JB-KU-BY\" \"7JB-KU-DE\"\n#> [41] \"7JB-KU-MO\" \"7JB-KU-PI\" \"7RA-BH\"    \"7RA-SJ\"   \n#> [45] \"7SD-0\"     \"7SD-NS\"    \"7SE\"       \"7SN-BE\"   \n#> [49] \"7TK\"       \"7VR-RE\"    \"7VR-RI\"    \"LKMKI\"    \n#> [53] \"LKMSP\"     \"PRAK\"      \"PRAM\"      \"PRH\"      \n#> [57] \"PRHA\"      \"PRHT\"      \"PRKA\"      \"PRKU\"     \n#> [61] \"PRMY\"      \"PRRL-CR\"   \"PRRL-DD\"   \"PRRL-EN\"  \n#> [65] \"PRRL-NT\"   \"PRRL-VU\"   \"PRSE-KA\"   \"PRSE-PA\"  \n#> [69] \"PRSE-SH\"   \"PRSL\"      \"PRTK\"      \"PRTO\"     \n#> [73] \"PRVS\"\nsort(unique(dat2L$NiN_variable_code[is.na(dat2L$NiN_variable_value)]))\n#>  [1] \"4DL-S-0\"   \"4DL-SS-0\"  \"4TL-HL\"    \"5AB-0\"    \n#>  [5] \"5BY-0\"     \"7FA\"       \"7GR-GI\"    \"7JB-BA\"   \n#>  [9] \"7JB-BT\"    \"7JB-GJ\"    \"7JB-KU-BY\" \"7JB-KU-DE\"\n#> [13] \"7JB-KU-MO\" \"7JB-KU-PI\" \"7RA-SJ\"    \"7SD-0\"    \n#> [17] \"7SD-NS\"    \"7SE\"       \"7SN-BE\"    \"7TK\"      \n#> [21] \"7VR-RE\"    \"7VR-RI\"    \"LKMKI\"     \"LKMSP\"    \n#> [25] \"PRH\"       \"PRVS\""},{"path":"naturtype.html","id":"ag-a-sjiktdekningsvariabler","chapter":"6 Nature types","heading":"6.8.1 1AG-A (sjiktdekningsvariabler)","text":"different variables describing cover different vegetation strata /species1AG--0 = Total tre canopy cover1AG-B = Total shrub cover1AG-C = Total field layer cover1AG--E = ‘Overstandere’1AG--G = ‘gjenveksttrær’","code":""},{"path":"naturtype.html","id":"ar-c-l-andel-vedvekster-i-fletsjiktet","chapter":"6 Nature types","heading":"6.8.2 1AR-C-L (Andel vedvekster i fletsjiktet)","text":"condition variable mire nature types","code":""},{"path":"naturtype.html","id":"to-torvmarksformer","chapter":"6 Nature types","heading":"6.8.3 3TO (Torvmarksformer)","text":"defining variables, part condition assessment.","code":"\nexclude <- c(\"3TO-BØ\",\n             \"3TO-HA\",\n             \"3TO-HE\",\n             \"3TO-HK\",\n             \"3TO-HN\",\n             \"3TO-HP\",\n             \"3TO-PA\",\n             \"3TO-TE\")"},{"path":"naturtype.html","id":"dl-coarse-dead-wood","chapter":"6 Nature types","heading":"6.8.4 4DL (Coarse dead wood)","text":"4DL-SS-0 4DL-S-0 total amount coarse woody debris/logs. recorded one nature type 2018, biodiversity variable, state variable.","code":"\nexclude <- c(exclude,\n             \"4DL-SS-0\",\n             \"4DL-S-0\")"},{"path":"naturtype.html","id":"tg-old-trees","chapter":"6 Nature types","heading":"6.8.5 4TG (old trees)","text":"three variables used biodiversity variables 2018.","code":"\nexclude <- c(exclude,\n             \"4TG-BL\",\n             \"4TG-EL\",\n             \"4TG-GF\")"},{"path":"naturtype.html","id":"tl-trees-with-fire-scars","chapter":"6 Nature types","heading":"6.8.6 4TL (trees with fire scars)","text":"five variables used together 4TG biodiversity variables 2018.","code":"\nexclude <- c(exclude,\n             \"4TL-BS\",\n             \"4TL-HE\",\n             \"4TL-HL\",\n             \"4TL-RB\",\n             \"4TL-SB\")"},{"path":"naturtype.html","id":"ab-and-5by-arealbruksklasser-og-byggningstyper","chapter":"6 Nature types","heading":"6.8.7 5AB and 5BY (arealbruksklasser og byggningstyper)","text":"area land use types building types, respectively, values numeric, categorical, represents presence absence land uses objects. suited automatically determining ecosystem condition done subjectively field.","code":"\nexclude <- c(exclude,\n             \"5AB-0\",\n             \"5AB-DO-TT\",\n             \"5BY-0\"\n             )"},{"path":"naturtype.html","id":"se-and-6so-bioclimatical-sections-and-sones","chapter":"6 Nature types","heading":"6.8.8 6SE and 6SO (Bioclimatical sections and sones)","text":"relevant condition variables.","code":"\nexclude <- c(exclude,\n             \"6SE\",\n             \"6SO\")"},{"path":"naturtype.html","id":"fa-fremmedartsinnslag","chapter":"6 Nature types","heading":"6.8.9 7FA (fremmedartsinnslag)","text":"allowed value X, Ok keep NA.","code":""},{"path":"naturtype.html","id":"gr-gi","chapter":"6 Nature types","heading":"6.8.10 7GR-GI","text":"7GR-GI (grøftingsintensitet) value X either, OK exclude NA’s. keep variable, even though clearly pressure indicator, might want use surrogate mire hydrology.","code":""},{"path":"naturtype.html","id":"jb-ba-aktuell-bruksintensitet","chapter":"6 Nature types","heading":"6.8.11 7JB-BA (Aktuell bruksintensitet)","text":"common condition/pressure variable semi-natural nature types.Overview cases value set X.just cases, mostly 2018. OK treat NA.","code":"\ntemp <- dat2L[dat2L$ninBeskrivelsesvariable == \"7JB-BA_X\",]\ntable(temp$kartleggingsår, temp$naturtype)\n#>       \n#>        Eng-aktig sterkt endret fastmark Hagemark\n#>   2018                                0        0\n#>   2020                                1        0\n#>   2021                                0        1\n#>       \n#>        Semi-naturlig eng Semi-naturlig strandeng Slåttemark\n#>   2018                 0                       0          0\n#>   2020                 0                       0          0\n#>   2021                 1                       1          1\n#>       \n#>        Strandeng\n#>   2018        27\n#>   2020         0\n#>   2021         0"},{"path":"naturtype.html","id":"jb-bt-beitetrykk","chapter":"6 Nature types","heading":"6.8.12 7JB-BT (Beitetrykk)","text":"Similar variable .OK treat X’s NA’s.","code":"\ntemp <- dat2L[dat2L$ninBeskrivelsesvariable == \"7JB-BT_X\",]\ntable(temp$kartleggingsår, temp$naturtype)\n#>       \n#>        Åpen flomfastmark Kystlynghei Sanddynemark\n#>   2019                 3           0            0\n#>   2020                 1           1            2\n#>   2021                 3           0            0"},{"path":"naturtype.html","id":"jb-gj-gjødsling","chapter":"6 Nature types","heading":"6.8.13 7JB-GJ (Gjødsling)","text":"Similar variable two .OK treat X’s NA’s.variable used condition indicator, perhaps strictly speaking pressure indicator. Secondly, many semi-natural areas fertilized, also reference condition. people made meadows probably agree productive field/meadow poor condition. condition variable therefor directly tuned towards maintenance biodiversity.","code":"\ntemp <- dat2L[dat2L$ninBeskrivelsesvariable == \"7JB-BT_X\",]\ntable(temp$kartleggingsår, temp$naturtype)\n#>       \n#>        Åpen flomfastmark Kystlynghei Sanddynemark\n#>   2019                 3           0            0\n#>   2020                 1           1            2\n#>   2021                 3           0            0"},{"path":"naturtype.html","id":"jb-ht-høsting-av-tresjiktet","chapter":"6 Nature types","heading":"6.8.14 7JB-HT (Høsting av tresjiktet)","text":"Used Lauveng 2019 2020.marginal exclude already now.","code":"\ntemp <- dat2L[dat2L$NiN_variable_code == \"7JB-HT-ST\" | \n               dat2L$NiN_variable_code == \"7JB-HT-SL\" ,]\ntable(temp$kartleggingsår, temp$naturtype)\n#>       \n#>        Lauveng\n#>   2019      14\n#>   2020       8\n#>   2022       2\nexclude <- c(exclude,\n             \"7JB-HT-SL\",\n             \"7JB-HT-ST\")"},{"path":"naturtype.html","id":"jb-ku-kystlyngheias-utviklingsfaser","chapter":"6 Nature types","heading":"6.8.15 7JB-KU (Kystlyngheias utviklingsfaser)","text":"= byggefaseDE = degenereringsfaseMO = moden fasePI = pionerfaseThis variable used biodiversity assessment, can therefore used condition assessment localities poor conditions mapped/assessed.nonetheless explore variable bit since variable suggested previously condition variable.\nNiN defines possible values numeric 0 4 (shifted become 1-5 data set), 998 cases given value X.reason variable used biodiversity assessment, performed condition poor, following table shows localities variable given value X spread across condition scores:can also make note big proportion total number localities Kystlynghei poor (svært redusert) condition, therefore variable 7JB-KU recorded large proportion localities.\nFigure 3.17: distribution condition scores Kystlynghei.\npercentage localities poor condition 0%.kystlynghei locality values four parameters (7BA-/DE/MO/PI), look cases detail, understand values set X (probably means left blank), example like :… can see sometimes <4 >0 variables/phases given score, sometimes none . makes problematic set NA’s zeros.variable used indicator Ecological Condition future, variable needs assessed localities, field protocol /field app needs revised possible record blank NA values.","code":"\nexclude <- c(exclude, \n             \"7JB-KU-BY\", \n             \"7JB-KU-DE\", \n             \"7JB-KU-MO\", \n             \"7JB-KU-PI\")\ntemp <- dat2L[dat2L$ninBeskrivelsesvariable == \"7JB-KU-BY_X\" |\n                     dat2L$ninBeskrivelsesvariable == \"7JB-KU-DE_X\" |\n                dat2L$ninBeskrivelsesvariable == \"7JB-KU-MO_X\" |\n                     dat2L$ninBeskrivelsesvariable == \"7JB-KU-PI_X\",]\ntable(temp$kartleggingsår, temp$naturtype)\n#>       \n#>        Kystlynghei\n#>   2018         510\n#>   2019         132\n#>   2020          21\n#>   2021         326\n#>   2022           7\ntable(temp$tilstand)\n#> \n#> 1 - Svært redusert         2 - Dårlig        3 - Moderat \n#>                  9                181                733 \n#>            4 - God \n#>                 73\nKU <- dat2[dat2$naturtype==\"Kystlynghei\",]\nbarplot(table(KU$tilstand))\n#View(dat2L[dat2L$NiN_variable_code == \"7JB-KU-BY\" & is.na(dat2L$NiN_variable_value),])\n#View(dat2L[dat2L$identifikasjon_lokalid ==\"NINFP1810002975\",]) # None of the 7JB-KU variables have values\n#View(dat2L[dat2L$identifikasjon_lokalid ==\"NINFP2110057689\",]) # Two of the 7JB-KU variables have values"},{"path":"naturtype.html","id":"ra-bh-and-7ra-sj-rask-suksesjon-i-boreal-hei-og-i-i-semi-naturlig-og-sterkt-endret-jordbruksmark-inkludert-våteng","chapter":"6 Nature types","heading":"6.8.16 7RA-BH and 7RA-SJ (rask suksesjon i boreal hei og i i semi-naturlig og sterkt endret jordbruksmark inkludert våteng)","text":"Condition variables.\ncases 7RA-SJ value X. numeric 1-4, value X mistake think. can exclude (.e. allow NA’s).","code":""},{"path":"naturtype.html","id":"sd-0-and-7sd--ns-natur--og-normalskogsdynamikk","chapter":"6 Nature types","heading":"6.8.17 7SD-0 and 7SD- NS (Natur- og normalskogsdynamikk)","text":"7SD-NS 7SD-0 also used one nature type (forest), wooded localities Flommyr, myrkant og myrskogsmark. X therefore means relevant, can also exclude parameters dataset together.","code":"\nexclude <- c(exclude, \n             \"7SD-0\",     \n             \"7SD-NS\")"},{"path":"naturtype.html","id":"tk-and-7se-kjørespor-slitasje","chapter":"6 Nature types","heading":"6.8.18 7TK and 7SE (kjørespor & slitasje)","text":"7TK (kjørespor) 7SE (slitasje) allowed value X, happened rare occasions (24) anyhow. ’s fine treat NA’s.","code":""},{"path":"naturtype.html","id":"vr-ri-reguleringsintensitet","chapter":"6 Nature types","heading":"6.8.19 7VR-RI (Reguleringsintensitet)","text":"variable defined numeric 1-5. , however, quite cases X.explain , case, variable good indicator condition rather represents pressure/driver. OK treat NA’s.LKMs\nLKM’s (lokal kompleks miljøvariabel) relevant us .","code":"\ntemp <- dat2L[dat2L$ninBeskrivelsesvariable == \"7VR-RI_X\",]\ntable(temp$kartleggingsår, temp$naturtype)\n#>       \n#>        Åpen flomfastmark\n#>   2019                96\n#>   2020                 1\n#>   2021                11\n#>   2022                 1"},{"path":"naturtype.html","id":"lkmki","chapter":"6 Nature types","heading":"6.8.20 LKMKI","text":"","code":"+ Kalk (lime)\n+ Exclude"},{"path":"naturtype.html","id":"lkmsp","chapter":"6 Nature types","heading":"6.8.21 LKMSP","text":"MdirPR-variables\nMiljødirektoratets variables (usually variations existing NiN-variables)","code":"+ Slåttemarkspreg\n+ Exclude"},{"path":"naturtype.html","id":"prak","chapter":"6 Nature types","heading":"6.8.22 PRAK","text":"","code":"+ Antall NiN-kartleggingsenheter\n+ Used in the biodiversity assessment\n+ Exclude"},{"path":"naturtype.html","id":"pram","chapter":"6 Nature types","heading":"6.8.23 PRAM","text":"","code":"+ Menneskeskapte objekter\n+ Related to 5BY and 5AB\n+ Exclude (see 5BY and 5AB)"},{"path":"naturtype.html","id":"prh","chapter":"6 Nature types","heading":"6.8.24 PRH","text":"","code":"+ This is perhaps a mistake and should be PRHA or PRHT\n+ Exclude"},{"path":"naturtype.html","id":"prha","chapter":"6 Nature types","heading":"6.8.25 PRHA","text":"","code":"+ Habitat spesifikke arter\n+ Used in the biodiversity assessment\n+ Exclude"},{"path":"naturtype.html","id":"prht","chapter":"6 Nature types","heading":"6.8.26 PRHT","text":"","code":"+ Høsting av tresjiktet"},{"path":"naturtype.html","id":"prka","chapter":"6 Nature types","heading":"6.8.27 PRKA","text":"","code":"+ Kalkindikatorer\n+ Used in the biodiversity assessment\n+ Exclude"},{"path":"naturtype.html","id":"prku","chapter":"6 Nature types","heading":"6.8.28 PRKU","text":"","code":"+ Kystlyngheias utviklingsfaser\n+ Related to 7JB-KU\n+ Used in the biodiversity assessment\n+ Exclude"},{"path":"naturtype.html","id":"prmy","chapter":"6 Nature types","heading":"6.8.29 PRMY","text":"","code":"+ Myrstruktur\n+ Used in the biodiversity assessment\n+ Exclude"},{"path":"naturtype.html","id":"prrl-crddenntvu","chapter":"6 Nature types","heading":"6.8.30 PRRL-CR/DD/EN/NT/VU","text":"","code":"+ Red list categories\n+ Used in the biodiversity assessment\n+ Exclude"},{"path":"naturtype.html","id":"prse-ka","chapter":"6 Nature types","heading":"6.8.31 PRSE-KA","text":"","code":"+ Strukturer, elementer og torvmarksformer (in 2018)\n+ See PRSE-PA"},{"path":"naturtype.html","id":"prse-pa","chapter":"6 Nature types","heading":"6.8.32 PRSE-PA","text":"","code":"+ Strukturer, elementer og torvmarksformer\n+ Used in the biodiversity assessment\n+ Exclude"},{"path":"naturtype.html","id":"prse-sh","chapter":"6 Nature types","heading":"6.8.33 PRSE-SH","text":"","code":"+ Strukturer, elementer og torvmarksformer (in 2018)\n+ See PRSE-PA"},{"path":"naturtype.html","id":"prsl","chapter":"6 Nature types","heading":"6.8.34 PRSL","text":"","code":"+ Slitasje\n+ Related to 7SE"},{"path":"naturtype.html","id":"prtk","chapter":"6 Nature types","heading":"6.8.35 PRTK","text":"","code":"+ Spor av tunge kjøretøyer\n+ Related to 7TK"},{"path":"naturtype.html","id":"prto","chapter":"6 Nature types","heading":"6.8.36 PRTO","text":"","code":"+ Torvuttak\n+ Strictly speaking a pressure variable"},{"path":"naturtype.html","id":"prvs","chapter":"6 Nature types","heading":"6.8.37 PRVS","text":"","code":"+ Variasjon i vannsprutintensitet\n+ Used in the biodiversity assessment\n+ Exclude\nexclude <- c(exclude,\n             \"LKMKI\",     \n          \"LKMSP\",\n          \"PRAK\",\n          \"PRAM\",\n          \"PRH\",\n          \"PRHA\",\n          \"PRKA\",\n          \"PRKU\",\n          \"PRMY\",\n          \"PRRL-DD\",   \"PRRL-VU\",   \"PRRL-NT\",   \"PRRL-EN\",   \"PRRL-CR\",  \n          \"PRSE-KA\",\n          \"PRSE-PA\",\n          \"PRSE-SH\",\n          \"PRVS\"\n          )"},{"path":"naturtype.html","id":"subset","chapter":"6 Nature types","heading":"6.9 Subset","text":"Now now 24 possible condition variables.dat2L2 includes three target ecosystems. Hule eiker excluded. Mosaics included. Several non-relevant NiN variables excluded (forested wetlands). localities duplicated many rows NiN variables locality.","code":"\n# Exclude NAs\ndat2L2 <- dat2L[!is.na(dat2L$NiN_variable_value),]\n\n# Exclude selected NiN variables \ndat2L2 <- dat2L2[!dat2L2$NiN_variable_code %in% exclude,]"},{"path":"naturtype.html","id":"combine-naturetypes-nin-variables-and-nin-main-types","chapter":"6 Nature types","heading":"6.10 Combine Naturetypes, NiN variables and NiN main types","text":"Add column total number localities nature type get percentage localities NiN main type recorded.Cast get NiN codes columnsThis data set contains nature types mapped 2018 2019, removed ntypDF2. Let’s exclude nature types nowCombine data sets","code":"\nntyp_vars <- as.data.frame(table(dat2L2$naturtype, dat2L2$NiN_variable_code))\nnames(ntyp_vars) <- c(\"Nature_type\", \"NiN_variable_code\", \"NiN_variable_count\")\nntyp_vars <- ntyp_vars[ntyp_vars$NiN_variable_count >0,]\nhead(ntyp_vars)\n#>                                          Nature_type\n#> 3   Åpen grunnlendt kalkrik mark i boreonemoral sone\n#> 16                                          Hagemark\n#> 29                                    Naturbeitemark\n#> 73                                          Hagemark\n#> 83                                           Lauveng\n#> 156                                Semi-naturlig myr\n#>     NiN_variable_code NiN_variable_count\n#> 3             1AG-A-0                 41\n#> 16            1AG-A-0                348\n#> 29            1AG-A-0                  1\n#> 73            1AG-A-E               1706\n#> 83            1AG-A-E                 12\n#> 156           1AG-A-G                792\n#options(scipen=999) # suppress exp notation\ncount <- as.data.frame(table(dat2$naturtype))\nnames(count) <- c(\"Nature_type\", \"totalLocations\")\nntyp_vars$totalLocations <- count$totalLocations[match(ntyp_vars$Nature_type, count$Nature_type)]\nntyp_vars$percentageUse <- round((ntyp_vars$NiN_variable_count/ntyp_vars$totalLocations)*100, 1)\n# should switch to pivot_wider\nntyp_vars_wide <- data.table::dcast(setDT(ntyp_vars),\n                                    Nature_type~NiN_variable_code,\n                                    value.var = \"percentageUse\")\nntyp_vars_wide <- ntyp_vars_wide[ntyp_vars_wide$Nature_type %in% ntypDF2$Nature_type]\nntyp_fill <- cbind(ntypDF2, ntyp_vars_wide[,-1][match(ntypDF2$Nature_type, ntyp_vars_wide$Nature_type)])"},{"path":"naturtype.html","id":"add-number-of-location-and-total-area-mapped","chapter":"6 Nature types","heading":"6.10.1 Add number of location and total area mapped","text":"","code":"\ndat2$km2 <- units::drop_units(dat2$area/10^6)\n\nnum <- as.data.frame(dat2) %>%\n  group_by(naturtype)%>%\n  summarise(km2 = sum(km2),\n            numberOfLocalities = n())\n\nntyp_fill <- cbind(ntyp_fill, num[,-1][match(ntyp_fill$Nature_type, num$naturtype),])"},{"path":"naturtype.html","id":"plots","chapter":"6 Nature types","heading":"6.11 Plots","text":"","code":""},{"path":"naturtype.html","id":"the-total-mapped-area","chapter":"6 Nature types","heading":"6.11.1 The total mapped area","text":"\nFigure 1.22: total mapped area nature types associated three selected main ecosystems\n","code":"\n\nmySize <- 8\ngg_area <- ntyp_fill %>%\n  arrange(km2) %>%\n  mutate(Nature_type=factor(Nature_type, levels=Nature_type)) %>%   # This trick update the factor levels\n  ggplot( aes(x = Nature_type,\n                   y = km2)) +\n        geom_segment( aes(xend=Nature_type, yend=0)) +\n        geom_point( size=4, aes(group = Ecosystem,\n                                colour= Ecosystem)) +\n        coord_flip() +\n        theme_bw(base_size = mySize) +\n        xlab(\"\")+\n        ylab(expression(km^2))+\n      theme(legend.position = \"top\",\n        legend.key.size =  unit(.05, 'cm'),\n            legend.background = element_rect(fill = \"white\", color = \"black\")\n            )\n\ngg_locs <- ntyp_fill %>%\n  arrange(km2) %>%\n  mutate(Nature_type=factor(Nature_type, levels=Nature_type)) %>%    # also sorted after km2\n  ggplot( aes(x = Nature_type,\n                   y = numberOfLocalities)) +\n        geom_segment( aes(xend=Nature_type, yend=0)) +\n        geom_point( size=4, aes(group = Ecosystem,\n                                colour= Ecosystem)) +\n        coord_flip() +\n        theme_bw(base_size = mySize) +\n        xlab(\"\")+\n        ylab(\"Number of localities\")+\n  theme(legend.position = \"none\",\n        axis.text.y = element_blank())\n\n\negg::ggarrange(gg_area, gg_locs, \n                        ncol = 2)"},{"path":"naturtype.html","id":"area-of-localities-per-nin-main-type","chapter":"6 Nature types","heading":"6.11.2 Area of localities per NiN main type","text":"First add NiN main types covered nature types.Adding non-mapped open typesAdding non-mapped semi-natural typesAdding non-mapped wetland typesV6 Våtsnøleie, guess mapped, grouped alpine ecosystem. ’ll therefore add , mention figure caption .\nFigure 6.10: areas mapped NiN main type, degree spatial representativity (coverage) mapping units (nature types). V6 Våtsnøleie og snøleiekilde included.\n","code":"\nopen <- c(\n  \"T1\",\n  \"T2\",\n  \"T6\",\n  \"T8\",\n  \"T11\",\n  \"T12\",\n  \"T13\",\n  \"T15\",\n  \"T16\",\n  \"T17\",\n  \"T18\",\n  \"T20\",\n  \"T21\",\n  \"T23\",\n  \"T24\",\n  \"T25\",\n  \"T26\",\n  \"T27\",\n  \"T29\"\n)\n\nsemi <- c(\n  \"T31\",\n  \"T32\",\n  \"T33\",\n  \"T34\",\n  \"T40\",  # are these included\n  \"T41\"   # are these included\n)\n\nwetland <- c(\n  \"V1\",\n  \"V3\",\n  \"V4\",\n  \"V6\",\n  \"V9\",\n  \"V10\",\n  \"L4\"    # this will probably not be part of the assessments\n  \n)\nopen[!open %in% ntyp_fill$NiN_mainType]\n#> [1] \"T6\"  \"T11\" \"T13\" \"T16\" \"T23\" \"T24\" \"T25\" \"T26\" \"T27\"\nntyp_fill2 <- ntyp_fill %>%\n  add_row(NiN_mainType = \"T6\",  Ecosystem = \"naturligÅpneOmråderUnderSkoggrensa\", NiN_mainTypeCoverage = \"Not mapped\", km2 = 0) %>%\n  add_row(NiN_mainType = \"T11\", Ecosystem = \"naturligÅpneOmråderUnderSkoggrensa\", NiN_mainTypeCoverage = \"Not mapped\", km2 = 0) %>%\n  add_row(NiN_mainType = \"T13\", Ecosystem = \"naturligÅpneOmråderUnderSkoggrensa\", NiN_mainTypeCoverage = \"Not mapped\", km2 = 0) %>%\n  add_row(NiN_mainType = \"T16\", Ecosystem = \"naturligÅpneOmråderUnderSkoggrensa\", NiN_mainTypeCoverage = \"Not mapped\", km2 = 0) %>%\n  add_row(NiN_mainType = \"T23\", Ecosystem = \"naturligÅpneOmråderUnderSkoggrensa\", NiN_mainTypeCoverage = \"Not mapped\", km2 = 0) %>%\n  add_row(NiN_mainType = \"T24\", Ecosystem = \"naturligÅpneOmråderUnderSkoggrensa\", NiN_mainTypeCoverage = \"Not mapped\", km2 = 0) %>%\n  add_row(NiN_mainType = \"T25\", Ecosystem = \"naturligÅpneOmråderUnderSkoggrensa\", NiN_mainTypeCoverage = \"Not mapped\", km2 = 0) %>%\n  add_row(NiN_mainType = \"T26\", Ecosystem = \"naturligÅpneOmråderUnderSkoggrensa\", NiN_mainTypeCoverage = \"Not mapped\", km2 = 0) %>%\n  add_row(NiN_mainType = \"T27\", Ecosystem = \"naturligÅpneOmråderUnderSkoggrensa\", NiN_mainTypeCoverage = \"Not mapped\", km2 = 0) \nsemi[!semi %in% ntyp_fill$NiN_mainType]\n#> [1] \"T40\"\nntyp_fill2 <- ntyp_fill2 %>%\n  add_row(NiN_mainType = \"T40\", Ecosystem = \"semi-naturligMark\", NiN_mainTypeCoverage = \"Not mapped\", km2 = 0)\nwetland[!wetland %in% ntyp_fill$NiN_mainType]\n#> [1] \"V6\"\nmySize <- 10\nntyp_fill2 %>%\n  # combining two classes to get a better colour palette\n  mutate(NiN_mainTypeCoverage = \n           replace(NiN_mainTypeCoverage, NiN_mainTypeCoverage == \"southern\", \"partial\"),\n         NiN_mainTypeCoverage = \n           replace(NiN_mainTypeCoverage, NiN_mainTypeCoverage == \"calcareous and dry\", \"calcareous\")) %>%\n  \n  group_by(NiN_mainType, NiN_mainTypeCoverage) %>%\n  mutate(km2 = sum(km2)) %>%\n  slice_head()%>%\n  select(Ecosystem,\n         NiN_mainType,\n         NiN_mainTypeCoverage,\n         km2)%>%\n  ungroup() %>%\n  mutate(NiN_mainType = forcats::fct_reorder(NiN_mainType, km2)) %>%\n  ggplot(aes(x = NiN_mainType,\n             y = km2,\n             fill = NiN_mainTypeCoverage))+\n    geom_bar(stat = \"identity\",\n             colour = \"grey40\",\n             position = \"stack\")+\n    theme_bw(base_size = mySize)+\n    coord_flip()+\n  labs(x = \"NiN main type\",\n       y = expression(km^2),\n       fill = \"Spatial coverage\")+\n  scale_fill_brewer(palette = \"Set1\")+\n  facet_wrap(vars(Ecosystem),\n             scales = \"free\",\n             labeller = label_wrap_gen(width=25))"},{"path":"naturtype.html","id":"number-of-localities-per-nin-main-type","chapter":"6 Nature types","heading":"6.11.3 Number of localities per NiN main type","text":"\nFigure 6.11: number localities mapped NiN main type, degree spatial representativity (coverage) mapping units (nature types). V6 Våtsnøleie og snøleiekilde included. NiN main types arranged rougly decreasing order, except types mapped , arranged top.\nfigure take Naturlig åpne områder poorly represented general many NiN main types completely missing data set. three common types area, however, complete thematic coverage (excluding year 2018 including sub-types). need investigate especially NiN variables nature types mapping T18 Åpen flomfastmark, T12 Strandeng T21 Sanddynemark can use.Semi-naturlig mark quite good thematic coverage three main types (area). three types probably makes considerably smaller area, note T33 coverage, classes (-2018). three main ecosystems, semi-naturlig mark dominates clearly terms area terms number localities.Våtmark good thematic coverage V3 nedbørsmyr V9 semi-naturlig myr, V1 åpen jordvassmyr calcareous localities mapped assessed. question whether, given NiN variable, calcareous localities can representative mires (poor rich) introduce much bias one way another. Another important bias main ecosystem related lower size limit mapping units (MMU), quite big V3. need think whether small bogs less prone different pressures compared big bogs.","code":"\nmySize <- 10\nntyp_fill2 %>%\n  # combining two classes to get a better colour palette\n  mutate(NiN_mainTypeCoverage = \n           replace(NiN_mainTypeCoverage, NiN_mainTypeCoverage == \"southern\", \"partial\"),\n         NiN_mainTypeCoverage = \n           replace(NiN_mainTypeCoverage, NiN_mainTypeCoverage == \"calcareous and dry\", \"calcareous\")) %>%\n  \n  group_by(NiN_mainType, NiN_mainTypeCoverage) %>%\n  mutate(count = sum(numberOfLocalities)) %>%\n  slice_head()%>%\n  select(Ecosystem,\n         NiN_mainType,\n         NiN_mainTypeCoverage,\n         count)%>%\n  ungroup() %>%\n  mutate(count = replace_na(count, 0)) %>%\n  mutate(NiN_mainType = fct_reorder(NiN_mainType, count)) %>%\n  ggplot(aes(x = NiN_mainType,\n             y = count,\n             fill = NiN_mainTypeCoverage))+\n    geom_bar(stat = \"identity\",\n             colour = \"grey40\",\n             position = \"stack\")+\n    theme_bw(base_size = mySize)+\n    coord_flip()+\n  labs(x = \"NiN main type\",\n       y = \"Number of localities\",\n       fill = \"Spatial coverage\")+\n  scale_fill_brewer(palette = \"Set1\")+\n  facet_wrap(vars(Ecosystem),\n             scales = \"free\",\n             labeller = label_wrap_gen(width=25))"},{"path":"naturtype.html","id":"commonness-of-nin-variables","chapter":"6 Nature types","heading":"6.11.4 Commonness of NiN variables","text":"want see common different NiN variables , can use select core variables \\(_kjernevariabler_\\).First get total area mapped per main ecosystem\nFigure 3.27: Barplot showing proportion area NiN variable recorded. total mapped area main ecosystem (facets) shown dashed red line. three dominant NiN main types ecosystem given uniqe colour, remaining grouped ‘’.\nfigure, combination , points obvious NiN variable candidates.7SE 7TK good candidates Naturlig åpne områder. 7JA-BT probably appropriately classed pressure indicator. 7VR-RI recorded T18 localities.two variables (7SE 7TK) best candidates also Semi-natural areas. 7JB-BT pressure variable (beitetrykk). 7RA-SJ/BH related gjengoing covered another indicator informed remote sensing (LiDAR), therefor don’t need describe field-based indicator well.Våtmark, 7GR-Gi common variables, pressure variable (grøfting). , perhaps used surrogate indicator. think justifiable, especially since relationship pressure (grøfting) condition (hydrology) well known. 7SE+PRSL 7TK+PRTK good candidates. PRTO relevant V3, covers relatively large area. , however,, like pressure indicator.","code":"\nareaSum <- ntyp_fill2 %>%\n  group_by(Ecosystem) %>%\n  summarise(km2 = sum(km2)) %>%\n  tibble::add_column(.before=1,\n                     NiN_code = rep(\"Combined\", 3))\nntyp_fill2 %>%\n  pivot_longer(cols = unique(ntyp_vars$NiN_variable_code)) %>%\n  drop_na(value) %>%\n  rename(NiN_code = name,\n         useFrequency = value) %>%\n  filter(useFrequency > 0) %>%\n  group_by(NiN_code, Ecosystem, NiN_mainType) %>%  # NiN main type could be replaced with Nature_type\n  summarise(km2 = sum(km2)) %>%\n  \n  # create a truncated fill variable \n  group_by(Ecosystem) %>%\n  mutate(myFill = fct_lump(NiN_mainType, 3, w = km2)) %>%\n  \n  # qick fix to sort variable across facets (dont work after adding 'Nature_type' in the first group_by)\n  #mutate(lab = paste(NiN_code, substr(Ecosystem, start = 1, stop = 1), sep = \" \")) %>%\n  #ungroup()%>%\n  #mutate(lab = forcats::fct_reorder(lab, km2)) %>%\n  \n  \n  # plot\n  ggplot(aes(x = NiN_code,\n              y = km2,\n             fill = myFill\n                ))+\n  geom_bar(stat = \"identity\",\n           colour = \"grey40\",\n           #fill = \"grey80\",\n           position = \"stack\")+\n  geom_hline(data = areaSum,\n             aes(yintercept = km2),\n             colour = \"red\",\n             linetype = \"dashed\")+\n  facet_wrap(vars(Ecosystem),\n             scales = \"free\",\n             labeller = label_wrap_gen(width=25))+\n  labs(x = \"\",\n       y = expression(km^2),\n       fill = \"\")+\n  coord_flip()+\n  scale_fill_brewer(palette = \"Set1\")+\n  theme_bw(base_size = mySize)\n#> `summarise()` has grouped output by 'NiN_code',\n#> 'Ecosystem'. You can override using the `.groups` argument.\n#> Warning in RColorBrewer::brewer.pal(n, pal): n too large, allowed maximum for palette Set1 is 9\n#> Returning the palette you asked for with that many colors"},{"path":"naturtype.html","id":"tables","chapter":"6 Nature types","heading":"6.12 Tables","text":"output tables numbers underlying figures.\nFigure 6.12: List 45 nature types additionam data, including proportion localities data NiN variables.\n\nFigure 3.28: List unique combinatios NiN variable codes naturetypes summed area data.\n","code":"\nDT::datatable(ntyp_fill2,\n              #extensions = \"FixedColumns\",\n  options = list(\n    scrollX = T,\n    scrollY=T,\n    pageLength = 10))\nDT::datatable(\n  ntyp_fill2 %>%\n  pivot_longer(cols = unique(ntyp_vars$NiN_variable_code)) %>%\n  drop_na(value) %>%\n  rename(NiN_code = name,\n         useFrequency = value) %>%\n  filter(useFrequency > 0) %>%\n  group_by(NiN_code, Ecosystem, NiN_mainType) %>%  # NiN main type could be replaced with Nature_type\n  summarise(km2 = sum(km2)),\n  options = list(\n    scrollX = T,\n    scrollY=T,\n    pageLength = 10))\n#> `summarise()` has grouped output by 'NiN_code',\n#> 'Ecosystem'. You can override using the `.groups` argument."},{"path":"naturtype.html","id":"exp-natureType-summary","chapter":"6 Nature types","heading":"6.13 Export data","text":"Exporting table summary statistics information compiled nature type three main ecosystems. can merged main data set order subset according specific research question.Note also main data set still contains localities mis-match nature type definition NiN mapping uits recorded field. researcher decide include exclude .main data set also includes mosaic localities, less suitable use ground truth data remote sensing methods.","code":"\nsaveRDS(ntyp_fill2, \"data/naturetypes/natureType_summary.rds\")"},{"path":"naturtype.html","id":"appendix-1","chapter":"6 Nature types","heading":"6.14 Appendix 1","text":"deeper look causes localities recorded seemingly erroneous NiN mapping units (hence NiN main types)Lets look NiN main types (recorded field) cover different hovedøkosystem exclude Hule eiker localities one NiN main type.Let’s focus three targeted ecosystems.\nFigure 6.13: Number localities combination main ecosystem NiN main type\nStill weird cases look turn , trying understand came recorded way.","code":"\ndat_red <- dat_melt[dat_melt$n_ninKartleggingsenheter==1 & \n                      dat_melt$naturtype != \"Hule eiker\" &\n                      dat_melt$mosaikk == \"nei\",]\ndat_red_tally <- stats::aggregate(data = dat_red,\n                                  area~hovedøkosystem+ninKartleggingsenheter3, FUN = length)\nnames(dat_red_tally)[3] <- \"count\"\nggplot(dat_red_tally[dat_red_tally$hovedøkosystem %in% target,],\n       aes(x = ninKartleggingsenheter3,\n               y = count))+\n  geom_bar(\n           fill=\"grey\",\n           colour=\"black\",\n           stat=\"identity\")+\n  coord_flip()+\n  theme_bw(base_size = 12)+\n  labs(y = \"Number of localities\",\n       x = \"NiN main types\")+\n  scale_y_continuous(position = \"left\",\n                   expand = expansion(mult=c(.0,.3)))+\n  geom_text(aes(label=count), hjust=-0.25)+\n    facet_wrap(\"hovedøkosystem\",\n             scales = \"free\",\n             ncol = 3)"},{"path":"naturtype.html","id":"naturligåpneområderunderskoggrensa","chapter":"6 Nature types","heading":"6.14.0.1 naturligÅpneOmråderUnderSkoggrensa","text":"Listing NiN main types recorded nature types belonging naturligÅpneOmråderUnderSkoggrensa, clearly don’t belong :V10 (semi-naturlig våteng)\nOne case Åpen flomfastmark wrongly associated V10 whan T18.\nOne case Åpen flomfastmark wrongly associated V10 whan T18.T33 (Semi naturlig strandeng)\ncases either naturtype semi-naturlig strandeng (hence hovedøkosystem Semi-nat), naturtype correctly recorded Strandeng NiN type T12.\ncases either naturtype semi-naturlig strandeng (hence hovedøkosystem Semi-nat), naturtype correctly recorded Strandeng NiN type T12.T32 (Semi-naturlig eng)\nObvious error\nObvious errorT30 (Flomskogsmark)\nObvious error\nObvious errorListing remaining NiN main types:\n* T8 (fulglefjelleng og fugltopp)\n* T6 (Standberg)\n* T29 (Grus og steindominert strand og strandlinje)\n* T21 (Sanddynemark)\n* T20 (Isinnfrysingsmark)\n* T2 (Åpen grunlendt mark)\n* T18 (Åpne flomfastmark)\n* T17 (Aktiv skredmark)\n* T15 (Fosse-eng)\n* T13 (Rasmark)\n* T12 (Strandeng)\n* T1 (Nakent berg)resulted deleting 20m localities.","code":"\n`%!in%` <- Negate(`%in%`)\ndat_red2 <- dat_red[\n  dat_red$hovedøkosystem!=\"naturligÅpneOmråderUnderSkoggrensa\" |\n  dat_red$hovedøkosystem==\"naturligÅpneOmråderUnderSkoggrensa\" & \n    dat_red$ninKartleggingsenheter3 %!in% c(\"T30\", \"T32\", \"T33\", \"V10\"),]"},{"path":"naturtype.html","id":"semi-naturlig-mark","chapter":"6 Nature types","heading":"6.14.0.2 Semi-naturlig mark","text":"Listing NiN main types recorded nature types belonging Semi-naturlig mark, clearly don’t belong :V9 (Semi-naturlig myr)\nKystlynghei recorded mire\nKystlynghei recorded mireT4 (Fastmarksskogsmark)\nT32 (naturbeitemark, lauveng, hagemark, +++)\nT32 (naturbeitemark, lauveng, hagemark, +++)T35 (Sterkt endret fastmark med løsmassedekke)\nWrong NiN type given eng-aktig sterkt endret fastmark (T40)\nWrong NiN type given eng-aktig sterkt endret fastmark (T40)T3 (Fjellhei, leside og tundra)\nBoreal hei (’ve T31)\nBoreal hei (’ve T31)T12 (Strandeng)\nprobably T33\nprobably T33T1 (Nakent berg)\nObvious mistake\nObvious mistakeListing remaining NiN-main types:\n* V10 (semi-nat våteng)\n* T41 (Oppdyrket mark med preg av semi-naturlig eng)\n* T40 (Sterkt endret fastmark med preg av semi-naturlig eng)\n* T31-34This resulted deletion 87 localities.","code":"\ndat_red3 <- dat_red2[\n  dat_red2$hovedøkosystem!=\"semi-naturligMark\" |\n  dat_red2$hovedøkosystem==\"semi-naturligMark\" & dat_red2$ninKartleggingsenheter3 %!in% c(\"V9\", \"T4\", \"T35\", \"T3\", \"T12\", \"T1\"),]"},{"path":"naturtype.html","id":"våtmark","chapter":"6 Nature types","heading":"6.14.0.3 Våtmark","text":"Listing NiN main types recorded nature types belonging Våtmark, clearly don’t belong .Våtmark doesn’t distinguish semi-natural natural, V-types correct, except strongly modified V11-V13.V11 (Torvtak)\nObvious mistake\nObvious mistakeV12 (Grøftet åpne torvmark)\nObvious mistake\nObvious mistakeV13 (Ny våtmark)\nObvious mistake\nObvious mistakeT4 (skog)\n’ve T2 strange things\n’ve T2 strange thingsT30-T32\nSomeone switching semi-natural natural equivalents\nSomeone switching semi-natural natural equivalentsThis resulted deletion 33 localities.total 140 localities, 0.2% localities, field-recorded NiN main don’t match definition nature type. see symptom bigger problem data validation.","code":"\ndat_red4 <- dat_red3[\n  dat_red3$hovedøkosystem!=\"våtmark\" |\n  dat_red3$hovedøkosystem==\"våtmark\" & dat_red3$ninKartleggingsenheter3 %!in% c(\"T4\", \"T30\", \"T31\", \"T32\", \"V11\", \"V12\", \"V13\"),]"},{"path":"scaling-functions.html","id":"scaling-functions","chapter":"7 Scaling functions","heading":"7 Scaling functions","text":"Author. Anders L. KolstadDate: 2023-04-14Superseeded : functionality explained moved eaTools package. Please see documentation updated examples.Indicator ecological condition may scaled reference value become normalised hence comparable. SEEA EA, un-scaled raw indicators called indicators , simply referred variables, use distinction . Scaling variables reference conditions can done many ways. examples, inspiration.Define plotting aestheticsCreate random raw data two variablesLets say reference condition variable1 equal 16, variable 2 35","code":"\nset.seed(123)\nlow <- \"red\"\nhigh <- \"green\"\nridge <- geom_density_ridges_gradient(scale = 3, size = .3)\nmyColour <- \"black\"\nmySize <- 10\nmyAlpha <- .7\nmyShape <- 21\ndat <- data.frame(variable1 = rnorm(50, 10, 4), \n                  variable2 = rnorm(50, 30, 3))\n\ntemp <- data.table::melt(setDT(dat))\n#> Warning in melt.data.table(setDT(dat)): id.vars and\n#> measure.vars are internally guessed when both are 'NULL'.\n#> All non-numeric/integer/logical type columns are considered\n#> id.vars, which in this case are columns []. Consider\n#> providing at least one of 'id' or 'measure' vars in future.\n\nggplot(temp,\n       aes(x = value,\n           y = variable,\n           fill = stat(x)))+\n  ridge+\n  scale_fill_gradient(low = low, high = high)\n#> Warning: `stat(x)` was deprecated in ggplot2 3.4.0.\n#> ℹ Please use `after_stat(x)` instead.\n#> This warning is displayed once every 8 hours.\n#> Call `lifecycle::last_lifecycle_warnings()` to see where\n#> this warning was generated.\n#> Picking joint bandwidth of 1.22\ndat$referenceHigh1 <- 16\ndat$referenceHigh2 <- 35"},{"path":"scaling-functions.html","id":"linear-with-a-natural-zero","chapter":"7 Scaling functions","heading":"7.1 Linear, with a natural zero","text":"can scale variable linearly, saying values 12 represents ‘perfect’ condition. also assume value zero worst possible condition variable. divide reference value, truncate values .reverse good bad condition: change sign add one.two indicators become comparable now normalised. least true around reference value. perhaps variable value around 25 variable2 actually quite bad. example assumed value zero worst possible value, may always case.","code":"\ndat$indicator1 <- dat$variable1/dat$referenceHigh1\ndat$indicator1[dat$indicator1>1] <- 1\n\ndat$indicator2 <- dat$variable2/dat$referenceHigh2\ndat$indicator2[dat$indicator2>1] <- 1\ntemp <- melt(setDT(dat),\n             measure.vars = c(\"indicator1\", \"indicator2\"))\nggplot(dat)+\n  geom_point(\n    aes(x = variable1, y = indicator1, fill = indicator1),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  geom_vline(xintercept = dat$referenceHigh1[1],\n             linetype = \"dashed\",\n             size =2)+\n  \n  geom_point(aes(x = variable2, y = indicator2, fill = indicator2),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  geom_vline(xintercept = dat$referenceHigh2,\n             linetype = \"dashed\",\n             size =2)+\n  ylab(\"Indicator values\")+\n  xlab(\"Variable values\")+\n  \n  scale_fill_gradient(\"Indicator values\", low = low, high = high)\n#> Warning: Using `size` aesthetic for lines was deprecated in ggplot2\n#> 3.4.0.\n#> ℹ Please use `linewidth` instead.\n#> This warning is displayed once every 8 hours.\n#> Call `lifecycle::last_lifecycle_warnings()` to see where\n#> this warning was generated.\nggplot(dat)+\n  geom_point(\n    aes(x = variable1, y = indicator1*(-1)+1, fill = indicator1*(-1)+1),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  geom_vline(xintercept = dat$referenceHigh1[1],\n             linetype = \"dashed\",\n             size =2)+\n  \n  ylab(\"Indicator values\")+\n  xlab(\"Variable values\")+\n  \n  scale_fill_gradient(\"Indicator values\", low = low, high = high)"},{"path":"scaling-functions.html","id":"linear-with-defined-lower-limit","chapter":"7 Scaling functions","heading":"7.2 Linear, with defined lower limit","text":"can also say worst possible condition variables zero, example say 5 variable1 28 variable2.can normalise data two reference values.","code":"\ndat$referenceLow1 <- 5\ndat$referenceLow2 <- 28\ndat$indicator1_LowHigh <- (dat$variable1-dat$referenceLow1)/(dat$referenceHigh1 - dat$referenceLow1)\ndat$indicator1_LowHigh[dat$indicator1_LowHigh <0] <- 0\ndat$indicator1_LowHigh[dat$indicator1_LowHigh >1] <- 1\n\ndat$indicator2_LowHigh <- (dat$variable2-dat$referenceLow2)/(dat$referenceHigh2 - dat$referenceLow2)\ndat$indicator2_LowHigh[dat$indicator2_LowHigh <0] <- 0\ndat$indicator2_LowHigh[dat$indicator2_LowHigh >1] <- 1\nggplot(dat)+\n  geom_point(\n    aes(x = variable1, y = indicator1_LowHigh, fill = indicator1_LowHigh),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  geom_vline(xintercept = 16,\n             linetype = \"dashed\",\n             size =2)+\n  geom_vline(xintercept = 5,\n             linetype = \"dashed\",\n             size =2)+\n  \n  geom_point(aes(x = variable2, y = indicator2_LowHigh, fill = indicator2_LowHigh),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  geom_vline(xintercept = 35,\n             linetype = \"dashed\",\n             size =2)+\n  geom_vline(xintercept = 28,\n             linetype = \"dashed\",\n             size =2)+\n  ylab(\"Indicator values\")+\n  xlab(\"Variable values\")+\n  \n  scale_fill_gradient(\"Indicator values\", low = low, high = high)"},{"path":"scaling-functions.html","id":"break-point-scaling","chapter":"7 Scaling functions","heading":"7.3 Break point scaling","text":"can also define threshold good ecological condition. Lets example say variable1, ecosystem function really declines variable shows values 9.can normalise , using refer break point normalisation. maths, see .solid lines point indicator value variable equals threshold value.","code":"\ndat$thr1 <- 9\ndat$indicator1_breakPoint <- ifelse(\n  dat$variable1 < dat$thr1,\n    ((dat$variable1-dat$referenceLow1)/(dat$thr1 - dat$referenceLow1))*(0.6-0)+0,\n    ((dat$variable1-dat$thr1)/(dat$referenceHigh1 - dat$thr1))*(1-0.6)+0.6\n  )\n\ndat$indicator1_breakPoint[dat$indicator1_breakPoint<0] <- 0\ndat$indicator1_breakPoint[dat$indicator1_breakPoint>1] <- 1\nggplot(dat)+\n  geom_point(\n    aes(x = variable1, y = indicator1_breakPoint, fill = indicator1_breakPoint),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  geom_vline(xintercept = dat$referenceHigh1[1],\n             linetype = \"dashed\",\n             size =2)+\n  geom_vline(xintercept = dat$referenceLow1,\n             linetype = \"dashed\",\n             size =2)+\n  geom_segment(aes(x = thr1, y = 0, xend = thr1, yend = 0.6),\n               linetype=\"solid\",\n               size=1.5)+\n  geom_segment(aes(x = 0, y = 0.6, xend = thr1, yend = 0.6),\n               linetype=\"solid\",\n               size=1.5)+\n  \n  ylab(\"Indicator values\")+\n  xlab(\"Variable values\")+\n  \n  scale_fill_gradient(\"Indicator values\", low = low, high = high)"},{"path":"scaling-functions.html","id":"two-sided-indicator","chapter":"7 Scaling functions","heading":"7.4 Two-sided indicator","text":"indicator may optimum value somewhere middle range, rather max min value. can define two-sided indicator. Lets say variable2 optimal level 30, values either lower high bad.","code":"\ndat$referenceMid2 <- 30\ndat$indicator2_twoSided <- ifelse(\n  dat$variable2<dat$referenceMid2,\n    (dat$variable2-dat$referenceLow2)/(dat$referenceMid2-dat$referenceLow2),\n    ((dat$variable2-dat$referenceMid2)/(dat$referenceHigh2-dat$referenceMid2))*(-1)+1\n  )\n\n# truncating\ndat$indicator2_twoSided[dat$indicator2_twoSided<0] <- 0\ndat$indicator2_twoSided[dat$indicator2_twoSided>1] <- 1\nggplot(dat)+\n  geom_point(\n    aes(x = variable2, y = indicator2_twoSided, fill = indicator2_twoSided),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  geom_vline(xintercept = dat$referenceMid2[1],\n             linetype = \"dashed\",\n             size =2)+\n  geom_vline(xintercept = dat$referenceLow2[1],\n             linetype = \"dashed\",\n             size =2)+\n  geom_vline(xintercept = dat$referenceHigh2[1],\n             linetype = \"dashed\",\n             size =2)+\n \n  ylab(\"Indicator values\")+\n  xlab(\"Variable values\")+\n  \n  scale_fill_gradient(\"Indicator values\", low = low, high = high)"},{"path":"scaling-functions.html","id":"sigmoid-transformation","chapter":"7 Scaling functions","heading":"7.5 Sigmoid transformation","text":"many , non-linear ways normalise indicator. correct choice scaling function varies indicators depends nature indicator represents, also uncertainty around reference values. Personally, think sigmoid function often makes lot sense. less sensitive changes around min max reference values. slight deviation reference condition perhaps often described true reduction condition. true example reference communities (ecosystems defined , representing, good condition) show variation variable values, yet reference value fixed. linear scaling cases lead referred underestimation biaz (making thing look worse really ).equation sigmoid transformation use comes Oliver al. (2021); Eq. 1, Supplemetary Information S2.Finding transformed indicator value variable equals thresholdThe solid helperlines point indicator value variable value equals threshold. Later shift values indicator value becomes 0.6 point.Also plotted linearly normalised indicator values:dotted helper lines selve visual guides judge different scaled indicator value 0.6 two approaches.","code":"\ndat$indicator1_sigmoid <- 100.68*(1-exp(-5*(dat$indicator1_LowHigh)^2.5))/100\nsigmoid_thr <- 100.68*(1-exp(-5*((dat$thr1[1]-dat$referenceLow1[1])/(dat$referenceHigh1[1]-dat$referenceLow1[1]))^2.5))/100\nggplot(dat)+\n  geom_point(\n    aes(x = variable1, y = indicator1_sigmoid, fill = indicator1_sigmoid),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  \n  geom_vline(xintercept = dat$referenceLow1[1],\n             linetype = \"dashed\",\n             size =2)+\n  geom_vline(xintercept = dat$referenceHigh1[1],\n             linetype = \"dashed\",\n             size =2)+\n  \n  geom_segment(aes(x = thr1, y = 0, xend = thr1, yend = sigmoid_thr),\n               linetype=\"solid\",\n               size=1)+\n  geom_segment(aes(x = 0, y = sigmoid_thr, xend = thr1, yend = sigmoid_thr),\n               linetype=\"solid\",\n               size=1)+\n  \n  \n  ylab(\"Indicator values\")+\n  xlab(\"Variable values\")+\n  \n  scale_fill_gradient(\"Indicator values\", low = low, high = high)\nggplot(dat)+\n  geom_point(\n    aes(x = indicator1_LowHigh, y = indicator1_sigmoid, fill = indicator1_sigmoid),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  \n  geom_vline(xintercept = 0.6,\n             linetype = \"dashed\",\n             size =2)+\n   geom_hline(yintercept = 0.6,\n             linetype = \"dashed\",\n             size =2)+\n  \n  ylab(\"Sigmoid-transformed\\nIndicator values\")+\n  xlab(\"Linear indicatior values\")+\n  \n  scale_fill_gradient(\"Indicator values\", low = low, high = high)"},{"path":"scaling-functions.html","id":"accounting-for-the-threshold-value","chapter":"7 Scaling functions","heading":"7.5.1 Accounting for the threshold value","text":"can account threshold good ecological condition applying sigmoid transformation like thisThe grey circles horizonal line correspons sigmoid transformation without adjustment threshold value.","code":"\ndat$indicator1_sigmoid_thr <- ifelse(\n  dat$variable1<dat$thr1,\n    ((dat$indicator1_sigmoid-0)/(sigmoid_thr-0))*(0.6-0)+0,\n    ((dat$indicator1_sigmoid-sigmoid_thr)/(1-sigmoid_thr))*(1-0.6)+0.6\n  )\nggplot(dat)+\n  geom_point(\n    aes(x = variable1, y = indicator1_sigmoid),\n             fill   = \"grey\", \n             colour = myColour,\n             size   = 5,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  \n  geom_point(\n    aes(x = variable1, y = indicator1_sigmoid_thr, fill = indicator1_sigmoid_thr),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  \n  geom_vline(xintercept = dat$referenceLow1[1],\n             linetype = \"dashed\",\n             size =1)+\n  geom_vline(xintercept = dat$referenceHigh1[1],\n             linetype = \"dashed\",\n             size =1)+\n  \n  geom_segment(aes(x = 0, y = sigmoid_thr, xend = thr1, yend = sigmoid_thr),\n               linetype=\"solid\",\n               colour = \"grey\",\n               size=1)+\n  \n  geom_segment(aes(x = thr1, y = 0, xend = thr1, yend = 0.6),\n               linetype=\"solid\",\n               size=1)+\n  geom_segment(aes(x = 0, y = 0.6, xend = thr1, yend = 0.6),\n               linetype=\"solid\",\n               size=1)+\n  \n  \n  ylab(\"Indicator values\")+\n  xlab(\"Variable values\")+\n  \n  scale_fill_gradient(\"Indicator values\", low = low, high = high)"},{"path":"scaling-functions.html","id":"exponential-functoins","chapter":"7 Scaling functions","heading":"7.6 Exponential functoins","text":"two examples exponential transformation can also used:","code":"\ndat$indicator1_expConvex <- dat$indicator1_LowHigh^0.5\ndat$indicator1_expConcave <- dat$indicator1_LowHigh^2\n\nggplot(dat)+\n  geom_point(\n    aes(x = variable1, y = indicator1_expConvex, fill = indicator1_expConvex),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  geom_point(\n    aes(x = variable1, y = indicator1_expConcave, fill = indicator1_expConcave),\n             colour = myColour,\n             size   = mySize,\n             alpha  = myAlpha,\n             shape  = myShape)+\n  \n  geom_vline(xintercept = dat$referenceLow1[1],\n             linetype = \"dashed\",\n             size =1)+\n  geom_vline(xintercept = dat$referenceHigh1[1],\n             linetype = \"dashed\",\n             size =1)+\n  ylab(\"Indicator values\")+\n  xlab(\"Variable values\")+\n  \n  scale_fill_gradient(\"Indicator values\", low = low, high = high)"},{"path":"homogeneous-impact-areas.html","id":"homogeneous-impact-areas","chapter":"8 Homogeneous Impact Areas","heading":"8 Homogeneous Impact Areas","text":"Author date:Anders Kolstad","code":""},{"path":"homogeneous-impact-areas.html","id":"introduction-5","chapter":"8 Homogeneous Impact Areas","heading":"8.1 Introduction","text":"chapter documents creation wall--wall map homogeneous impact areas Norway.\nmap produced binning values infrastructure index four discrete categories.\nlikely good predictor indicators, slitasje presence alien species.","code":""},{"path":"homogeneous-impact-areas.html","id":"about-the-underlying-data-4","chapter":"8 Homogeneous Impact Areas","heading":"8.2 About the underlying data","text":"infrastructure index explained .\nwall--wall raster Norway 100 m resolution.\npixel given value along continuous gradient 0 around 15.4, representing frequency surrounding cells within 500 m human infrastructure (houses, roads, ect).","code":""},{"path":"homogeneous-impact-areas.html","id":"representativity-in-time-and-space-4","chapter":"8 Homogeneous Impact Areas","heading":"8.2.1 Representativity in time and space","text":"infrastructure index calculated data slightly different dates, can said represent year 2015.\ndata covers mainland Norway.","code":""},{"path":"homogeneous-impact-areas.html","id":"references-4","chapter":"8 Homogeneous Impact Areas","heading":"8.2.2 References","text":"Bakkestuen, V., Dervo, B.K., Bærum, K.M. og Erikstad, L. 2022.\nPrediksjonsmodellering av naturtyper ferskvann.\nNINA Rapport 2079.\nNorsk institutt naturforskning.","code":""},{"path":"homogeneous-impact-areas.html","id":"analyses-5","chapter":"8 Homogeneous Impact Areas","heading":"8.3 Analyses","text":"","code":""},{"path":"homogeneous-impact-areas.html","id":"import-data","chapter":"8 Homogeneous Impact Areas","heading":"8.3.1 Import data","text":"path must conditional:Import stars proxy (data imported yet)Print coordinate reference system:","code":"\ndir <- substr(getwd(), 1,2)\npath <- ifelse(dir == \"C:\", \n        \"R:/GeoSpatialData/Utility_governmentalServices/Norway_Infrastructure_Index/Original/Infrastrukturindeks_UTM33/infra_tiff.tif\",\n        \"/data/R/GeoSpatialData/Utility_governmentalServices/Norway_Infrastructure_Index/Original/Infrastrukturindeks_UTM33/infra_tiff.tif\")\ninfra <- stars::read_stars(path)\nst_crs(infra)$input\n#> [1] \"WGS_1984_UTM_Zone_33N\""},{"path":"homogeneous-impact-areas.html","id":"trondheim-example","chapter":"8 Homogeneous Impact Areas","heading":"8.3.2 Trondheim example","text":"’s easier see ’s happening zoom bit.\nLets get boundary box around Trondheim.Cropping raster bbox","code":"\nmyBB <- st_bbox(c(xmin=260520.12, xmax = 278587.56,\n                ymin = 7032142.5, ymax = 7045245.27),\n                crs = st_crs(infra))\ninfra_trd <- sf::st_crop(infra, myBB)"},{"path":"homogeneous-impact-areas.html","id":"get-osm-highways","chapter":"8 Homogeneous Impact Areas","heading":"8.3.2.1 Get OSM highways","text":"Lets download base maps help validate contextualize infrastructure index.Transform lat long due osm requirementsGet boundary box cropped rasterDownload highways using bbox.Transforming highway data back utm, although strictly necessary.object contains many roads (30k).\n’ll take unnamed roads.","code":"\ninfra_trd_ll <- sf::st_transform(infra_trd, 4326)\nmyBB_ll <- sf::st_bbox(infra_trd_ll)\nhw <- \n  osmplotr::extract_osm_objects(\n    bbox = myBB_ll,\n    key = \"highway\",\n    sf = T)\nhw_utm <- sf::st_transform(hw, sf::st_crs(infra_trd)) \nhw_utm <- hw_utm[!is.na(hw_utm$name),]"},{"path":"homogeneous-impact-areas.html","id":"discretize","chapter":"8 Homogeneous Impact Areas","heading":"8.3.2.2 Discretize","text":"define simplified categorical typology infrastructure index using four classes.Lets plot two maps side side\nFigure 6.3: Infrastructure index Trondheim, comparing continous scale ordinal four-step scale. Major roads white.\ntweaked thresholds bins categories match knowledge land use intensity Trondheim, example forest next Trondheim (left map) second lowest class.\nlooks pretty good .\ndepicts gradient human presence high within built zone, low forests mountains west.\nNote still considerable human activity also form outdoor recreation even forestry.","code":"\nnames(infra_trd) <- \"infrastructureIndex\"\ninfra_trd_reclassed <-  infra_trd %>%\n  mutate(infrastructureIndex = case_when(\n    infrastructureIndex < 1 ~ 0,\n    infrastructureIndex < 6 ~ 1,\n    infrastructureIndex < 12 ~ 2,\n    infrastructureIndex >= 12 ~ 3\n  ))\nmap_trd_reclassed <- tm_shape(infra_trd_reclassed)+\n  tm_raster(title=\"Infrastructure Index\",\n            #palette = \"viridis\",\n            style=\"cat\")+\n  tm_layout(legend.outside = T)+\n  tm_shape(hw_utm)+\n  tm_lines(col=\"white\")\nmap_trd <- tm_shape(infra_trd)+\n  tm_raster(title=\"Infrastructure Index\",\n            style=\"cont\",\n            palette = \"viridis\")+\n  tm_layout(legend.outside = T)+\n  tm_shape(hw_utm)+\n  tm_lines(col=\"white\")\ntmap_arrange(map_trd,\n             map_trd_reclassed,\n             ncol=1)\n#> stars_proxy object shown at 181 by 132 cells.\n#> stars_proxy object shown at 181 by 132 cells."},{"path":"homogeneous-impact-areas.html","id":"aggregate","chapter":"8 Homogeneous Impact Areas","heading":"8.3.2.3 Aggregate","text":"resolution map need, size data implies next step, vectorization, take long.\ntherefore aggregate, reduce resolution.cell now average aggregated cells, hence value continuous .\nLet’s make discrete.\nFigure 6.6: Infrastrcture index Trondheim four-step discrete scale, aggregated 1x1 km resolution using mean function.\nresolution good enough purpose .\nsee map extends bit fjord. want cut away areas. can use map outline Norway .CRS needs identical\nFigure 8.1: Infrastrcture index Trondheim four-step discrete scale, aggregated 1x1 km resolution using mean function.\ntreated raster cells points cropping, cells center cell outside terrestrial delineation removed. think makes sense unbiased area statistics, coastal indicator data also excluded . errors smaller finer resolution raster, computation time problem.","code":"\ndim <- st_dimensions(infra)\npaste(\"Resolution is\", dim$x$delta, \"by\", dim$x$delta, \"meters\")\n#> [1] \"Resolution is 100 by 100 meters\"\ninfra_trd_reclassed_agg <- st_warp(infra_trd_reclassed, cellsize = c(1000, 1000), \n                                   crs = st_crs(infra_trd_reclassed), \n                                   use_gdal = TRUE,\n                                   method = \"average\")\ndim <- st_dimensions(infra_trd_reclassed_agg)\npaste(\"Resolution is\", dim$x$delta, \"by\", dim$x$delta, \"meters\")\n#> [1] \"Resolution is 1000 by 1000 meters\"\nnames(infra_trd_reclassed_agg) <- \"infrastructureIndex\"\ninfra_trd_reclassed_agg <-  infra_trd_reclassed_agg %>%\n  mutate(infrastructureIndex = case_when(\n    infrastructureIndex < 1 ~ 0,\n    infrastructureIndex < 6 ~ 1,\n    infrastructureIndex < 12 ~ 2,\n    infrastructureIndex >= 12 ~ 3\n  ))\ntm_shape(infra_trd_reclassed_agg)+\n  tm_raster(title=\"Infrastructure Index\",\n            style=\"cat\")+\n  tm_layout(legend.outside = T)+\n  tm_shape(hw_utm)+\n  tm_lines(col=\"white\")\noutline <- st_read(\"data/outlineOfNorway_EPSG25833.shp\")\n#> Reading layer `outlineOfNorway_EPSG25833' from data source \n#>   `/data/scratch/Matt_bookdown__debug/ecosystemCondition/data/outlineOfNorway_EPSG25833.shp' \n#>   using driver `ESRI Shapefile'\n#> Simple feature collection with 1 feature and 2 fields\n#> Geometry type: MULTIPOLYGON\n#> Dimension:     XY\n#> Bounding box:  xmin: -113472.7 ymin: 6448359 xmax: 1114618 ymax: 7939917\n#> Projected CRS: ETRS89 / UTM zone 33N\ninfra_trd_reclassed_agg <- st_transform(infra_trd_reclassed_agg, 25833)\ninfra_trd_reclassed_agg_terrestrial <- st_crop(infra_trd_reclassed_agg, outline)\n#> Warning in st_crop.stars(infra_trd_reclassed_agg, outline):\n#> crop only crops regular grids\ntm_shape(infra_trd_reclassed_agg_terrestrial)+\n  tm_raster(title=\"Infrastructure Index\",\n            style=\"cat\")+\n  tm_layout(legend.outside = T)+\n  tm_shape(hw_utm)+\n  tm_lines(col=\"white\")+\n  tm_shape(outline)+\n  tm_borders(lwd =2,\n             col = \"black\")"},{"path":"homogeneous-impact-areas.html","id":"aggregate-the-entire-map-to-1x1-km","chapter":"8 Homogeneous Impact Areas","heading":"8.3.3 Aggregate the entire map to 1x1 km","text":"","code":"\n# runtime about 30 sec\ninfra_agg <- st_warp(infra, cellsize = c(1000, 1000), \n                                   crs = st_crs(infra), \n                                   use_gdal = TRUE,\n                                   method = \"average\")\n# The CRS needs to be identical for st_crop\ninfra_agg <- st_transform(infra_agg, 25833)"},{"path":"homogeneous-impact-areas.html","id":"cut-out-marine-areas","chapter":"8 Homogeneous Impact Areas","heading":"8.3.4 Cut out marine areas","text":"see map extends bit fjord. want cut away areas. can use map outline Norway .","code":"\ninfra_agg_terrestrial <- st_crop(infra_agg, outline)\nsaveRDS(infra_agg_terrestrial, \"P:/41201785_okologisk_tilstand_2022_2023/data/cache/infra_agg_terrestrial.rds\")"},{"path":"homogeneous-impact-areas.html","id":"discretize-the-entire-map","chapter":"8 Homogeneous Impact Areas","heading":"8.3.5 Discretize the entire map","text":"","code":"\nnames(infra_agg_terrestrial) <- \"infrastructureIndex\"\n\ninfra_agg_discrete <- infra_agg_terrestrial %>%\n  mutate(infrastructureIndex = case_when(\n    infrastructureIndex < 1 ~ 0,\n    infrastructureIndex < 6 ~ 1,\n    infrastructureIndex < 12 ~ 2,\n    infrastructureIndex >= 12 ~ 3\n  ))"},{"path":"homogeneous-impact-areas.html","id":"vectorize","chapter":"8 Homogeneous Impact Areas","heading":"8.3.6 Vectorize","text":"step might seem rather stupid.\nwant vectorize rather large raster.\nmakes quite big data object.\nreason really good way burn polygon data raster grid cells disuse raster package.\nstraight forward either.\ncalculating intersections polygons fast easy.Let’s plot now.\nFirst, lets crop reduce computation time.\nFigure 8.2: vectorized version Infrastructure index Trondheim four-step discrete scale.\ncan seen figure , st_warp merges grid cells value, vectorized raster doesn’t end big end.","code":"\ninfra_agg_discrete_vect <- \n  eaTools::ea_homogeneous_area(infra_agg_discrete, \n                                groups = infrastructureIndex)\npath <- ifelse(dir == \"C:\", \n        \"P:/41201785_okologisk_tilstand_2022_2023/data/cache/\",\n        \"/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/cache/\")\n\nsaveRDS(infra_agg_discrete_vect, paste0(path, \"infra_agg_discrete_vect.rds\"))\nmyBB <- st_bbox(c(xmin=260520.12, xmax = 278587.56,\n                ymin = 7032142.5, ymax = 7045245.27),\n                crs = st_crs(infra_agg_discrete_vect))\n\ninfra_agg_discrete_vect_trd <- st_crop(infra_agg_discrete_vect, myBB)\n#> Warning: attribute variables are assumed to be spatially\n#> constant throughout all geometries\ntm_shape(infra_agg_discrete_vect_trd)+\n  tm_polygons(col=\"infrastructureIndex\",\n              style = \"cat\")+\n  tm_layout(legend.outside = T)+\n  tm_shape(hw_utm)+\n  tm_lines(col=\"white\")"},{"path":"homogeneous-impact-areas.html","id":"check-national-distribution","chapter":"8 Homogeneous Impact Areas","heading":"8.4 Check national distribution","text":"Since two layers completely overlapping, can get intersectionsLet’s calculate areas polygons compare HIF five regions.\nFigure 1.23: Stacked barplot showing distribution human impact factor across five regions Norway.\ndistribution looks reasonable. relative proportions similar five regions, Østlandet Sørlandet infrastructure general.numbers behind figure .","code":"\nregions <- sf::read_sf(\"data/regions.shp\", options = \"ENCODING=UTF8\")\nunique(regions$region)\n#> [1] \"Nord-Norge\" \"Midt-Norge\" \"Østlandet\"  \"Vestlandet\"\n#> [5] \"Sørlandet\"\nst_crs(infra_agg_discrete_vect) == st_crs(regions)\n#> [1] TRUE\ninfra_stats <- eaTools::ea_homogeneous_area(infra_agg_discrete_vect,\n                             regions,\n                             keep1 = \"infrastructureIndex\",\n                             keep2 = \"region\")\nsaveRDS(infra_stats, \"P:/41201785_okologisk_tilstand_2022_2023/data/cache/infra_stats.rds\")\ninfra_stats$area_km2 <- units::drop_units(sf::st_area(infra_stats))\ninfra_stats$area_km2 <- infra_stats$area_km2/1000\n\ntemp <- as.data.frame(infra_stats) %>%\n  group_by(region, infrastructureIndex) %>%\n  summarise(area_km2 = mean(area_km2))\n#> `summarise()` has grouped output by 'region'. You can\n#> override using the `.groups` argument.\n\nggarrange(\n  ggplot(temp, aes(x = region, y = area_km2, fill = factor(infrastructureIndex)))+\n    geom_bar(position = \"stack\", stat = \"identity\")+\n    guides(fill = \"none\")+\n    coord_flip()+\n    xlab(\"\")\n  ,\n  ggplot(temp, aes(x = region, y = area_km2, fill = factor(infrastructureIndex)))+\n    geom_bar(position = \"fill\", stat = \"identity\")+\n    guides(fill = guide_legend(\"HIF\"))+\n    coord_flip()+\n    ylab(\"Fraction of total area\")+\n    xlab(\"\")\n)\ntemp$area_km2 <- round(temp$area_km2,0)\nDT::datatable(temp)"},{"path":"homogeneous-impact-areas.html","id":"export","chapter":"8 Homogeneous Impact Areas","heading":"8.5 Export","text":"write data NINA P server.","code":"\nsaveRDS(infra_agg_discrete_vect, \"P:/41201785_okologisk_tilstand_2022_2023/data/infrastrukturindeks/homogeneous_impact_areas.rds\")\nHIA_returned <- readRDS(\"P:/41201785_okologisk_tilstand_2022_2023/data/infrastrukturindeks/homogeneous_impact_areas.rds\")"},{"path":"master-grid.html","id":"master-grid","chapter":"9 Master grid","heading":"9 Master grid","text":"Author:Anders L. KolstadMarch 2023","code":""},{"path":"master-grid.html","id":"introduction-6","chapter":"9 Master grid","heading":"9.1 Introduction","text":"chapter describes making master raster grid mainland Norway. grid used align ecosystem indicator maps becomes possible easy resamping, masking aggregating.: plan add examples use master grid real data.","code":""},{"path":"master-grid.html","id":"about-the-underlying-data-5","chapter":"9 Master grid","heading":"9.2 About the underlying data","text":"use statistical grid Norway (5x5km) resample higher resolution 50 x 50 meters.","code":""},{"path":"master-grid.html","id":"analyses-6","chapter":"9 Master grid","heading":"9.3 Analyses","text":"Import dataConfirming CRS EPSG25833:","code":"\n# Set up conditional file paths\ndir <- substr(getwd(), 1,2)\n\npData <- ifelse(dir == \"C:\", \n               \"P:/41201785_okologisk_tilstand_2022_2023/data/\",\n               \"/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/\")\n#st_layers(paste0(pData, \"Basisdata_0000_Norge_25833_StatistiskRutenett5km_FGDB.gdb\"))\ngrid_5km <- sf::read_sf(paste0(pData, \"Basisdata_0000_Norge_25833_StatistiskRutenett5km_FGDB.gdb\")) \ntmap_mode(\"view\")\ntm_shape(grid_5km$SHAPE)+\n  tm_borders()\nst_crs(grid_5km)\n#> Coordinate Reference System:\n#>   User input: ETRS89 / UTM zone 33N \n#>   wkt:\n#> PROJCRS[\"ETRS89 / UTM zone 33N\",\n#>     BASEGEOGCRS[\"ETRS89\",\n#>         ENSEMBLE[\"European Terrestrial Reference System 1989 ensemble\",\n#>             MEMBER[\"European Terrestrial Reference Frame 1989\"],\n#>             MEMBER[\"European Terrestrial Reference Frame 1990\"],\n#>             MEMBER[\"European Terrestrial Reference Frame 1991\"],\n#>             MEMBER[\"European Terrestrial Reference Frame 1992\"],\n#>             MEMBER[\"European Terrestrial Reference Frame 1993\"],\n#>             MEMBER[\"European Terrestrial Reference Frame 1994\"],\n#>             MEMBER[\"European Terrestrial Reference Frame 1996\"],\n#>             MEMBER[\"European Terrestrial Reference Frame 1997\"],\n#>             MEMBER[\"European Terrestrial Reference Frame 2000\"],\n#>             MEMBER[\"European Terrestrial Reference Frame 2005\"],\n#>             MEMBER[\"European Terrestrial Reference Frame 2014\"],\n#>             ELLIPSOID[\"GRS 1980\",6378137,298.257222101,\n#>                 LENGTHUNIT[\"metre\",1]],\n#>             ENSEMBLEACCURACY[0.1]],\n#>         PRIMEM[\"Greenwich\",0,\n#>             ANGLEUNIT[\"degree\",0.0174532925199433]],\n#>         ID[\"EPSG\",4258]],\n#>     CONVERSION[\"UTM zone 33N\",\n#>         METHOD[\"Transverse Mercator\",\n#>             ID[\"EPSG\",9807]],\n#>         PARAMETER[\"Latitude of natural origin\",0,\n#>             ANGLEUNIT[\"degree\",0.0174532925199433],\n#>             ID[\"EPSG\",8801]],\n#>         PARAMETER[\"Longitude of natural origin\",15,\n#>             ANGLEUNIT[\"degree\",0.0174532925199433],\n#>             ID[\"EPSG\",8802]],\n#>         PARAMETER[\"Scale factor at natural origin\",0.9996,\n#>             SCALEUNIT[\"unity\",1],\n#>             ID[\"EPSG\",8805]],\n#>         PARAMETER[\"False easting\",500000,\n#>             LENGTHUNIT[\"metre\",1],\n#>             ID[\"EPSG\",8806]],\n#>         PARAMETER[\"False northing\",0,\n#>             LENGTHUNIT[\"metre\",1],\n#>             ID[\"EPSG\",8807]]],\n#>     CS[Cartesian,2],\n#>         AXIS[\"(E)\",east,\n#>             ORDER[1],\n#>             LENGTHUNIT[\"metre\",1]],\n#>         AXIS[\"(N)\",north,\n#>             ORDER[2],\n#>             LENGTHUNIT[\"metre\",1]],\n#>     USAGE[\n#>         SCOPE[\"Engineering survey, topographic mapping.\"],\n#>         AREA[\"Europe between 12°E and 18°E: Austria; Denmark - offshore and offshore; Germany - onshore and offshore; Norway including Svalbard - onshore and offshore.\"],\n#>         BBOX[46.4,12,84.42,18]],\n#>     ID[\"EPSG\",25833]]"},{"path":"master-grid.html","id":"make-grid","chapter":"9 Master grid","heading":"9.3.1 Make grid","text":"Use bbox split 50 x 50 meter cellsThis file 6GB.Number cells, millions, :, quite lot. area accounts might consider using 10x10m.","code":"\n(masterGrid_50m <- st_as_stars(st_bbox(grid_5km), dx = 50, dy = 50))\n#> stars object with 2 dimensions and 1 attribute\n#> attribute(s), summary of first 1e+05 cells:\n#>         Min. 1st Qu. Median Mean 3rd Qu. Max.\n#> values     0       0      0    0       0    0\n#> dimension(s):\n#>   from    to  offset delta                refsys x/y\n#> x    1 24500  -1e+05    50 ETRS89 / UTM zone 33N [x]\n#> y    1 30800 7965000   -50 ETRS89 / UTM zone 33N [y]\n(nrow(masterGrid_50m)*ncol(masterGrid_50m))/10^6\n#>     x \n#> 754.6"},{"path":"master-grid.html","id":"eksport-file-final-product","chapter":"9 Master grid","heading":"9.3.2 Eksport file (final product)","text":"","code":"\nstars::write_stars(masterGrid_50m, paste0(pData, \"masterGrid_50m.tiff\"))"},{"path":"master-grid.html","id":"test-import","chapter":"9 Master grid","heading":"9.3.3 Test import","text":"","code":"\ntemp <- stars::read_stars(paste0(pData, \"masterGrid_50m.tiff\"))\nst_dimensions(temp)\n#>   from    to  offset delta                refsys point x/y\n#> x    1 24500  -1e+05    50 ETRS89 / UTM zone 33N FALSE [x]\n#> y    1 30800 7965000   -50 ETRS89 / UTM zone 33N FALSE [y]"},{"path":"climate-indicators-explained.html","id":"climate-indicators-explained","chapter":"10 Climate indicators explained","heading":"10 Climate indicators explained","text":"Author date:Anders L. KolstadMarch 2023","code":""},{"path":"climate-indicators-explained.html","id":"introduction-7","chapter":"10 Climate indicators explained","heading":"10.1 Introduction","text":"chapters describes development workflow generating preparing indicators based interpolated climate data SeNorge. describe process using dummy data also discuss alternate approaches dead ends occured development process. succinct workflow example specific indicator, see Median summer temperature.","code":""},{"path":"climate-indicators-explained.html","id":"about-the-underlying-data-6","chapter":"10 Climate indicators explained","heading":"10.2 About the underlying data","text":"data raster format extends back 1957 form multiple interpolated climate variables. spatial resolution 1 x 1 km.","code":""},{"path":"climate-indicators-explained.html","id":"representativity-in-time-and-space-5","chapter":"10 Climate indicators explained","heading":"10.2.1 Representativity in time and space","text":"data includes last normal period (1961-1990) defines reference condition climate variables. Therefore temporal resolution good. Also considering daily resolution data.Spatially, 1x1 km resolution sufficient climate variables, esp. homogeneous terrain, needs evaluation variable scenario specifically.","code":""},{"path":"climate-indicators-explained.html","id":"original-units-4","chapter":"10 Climate indicators explained","heading":"10.2.2 Original units","text":"Varied. Specified parameter.","code":""},{"path":"climate-indicators-explained.html","id":"temporal-coverage-4","chapter":"10 Climate indicators explained","heading":"10.2.3 Temporal coverage","text":"1957 - present","code":""},{"path":"climate-indicators-explained.html","id":"additional-comments-about-the-data-set-1","chapter":"10 Climate indicators explained","heading":"10.2.4 Additional comments about the data set","text":"data format recently changed .BIL .nc (netcdf) now single file contains rasters one year (365 days), sometimes multiple variables also.","code":""},{"path":"climate-indicators-explained.html","id":"ecosystem-characteristic-4","chapter":"10 Climate indicators explained","heading":"10.3 Ecosystem characteristic","text":"","code":""},{"path":"climate-indicators-explained.html","id":"norwegian-standard-2","chapter":"10 Climate indicators explained","heading":"10.3.1 Norwegian standard","text":"variables typically fall abiotiske egenskaper class.","code":""},{"path":"climate-indicators-explained.html","id":"seea-ea-1","chapter":"10 Climate indicators explained","heading":"10.3.2 SEEA EA","text":"SEEA EA, variables typically fall A1 - Physical state characteristics.","code":""},{"path":"climate-indicators-explained.html","id":"collinearities-with-other-indicators-4","chapter":"10 Climate indicators explained","heading":"10.4 Collinearities with other indicators","text":"Climate variables likely correlated (e.g. temperature snow). Also, climate variables better classed pressure indicators, might causal association several condition indicators.","code":""},{"path":"climate-indicators-explained.html","id":"reference-condition-and-values-3","chapter":"10 Climate indicators explained","heading":"10.5 Reference condition and values","text":"","code":""},{"path":"climate-indicators-explained.html","id":"reference-condition-3","chapter":"10 Climate indicators explained","heading":"10.5.1 Reference condition","text":"reference condition climate variables defined normal period 1961-1990.","code":""},{"path":"climate-indicators-explained.html","id":"reference-values-thresholds-for-defining-good-ecological-condition-minimum-andor-maximum-values-4","chapter":"10 Climate indicators explained","heading":"10.5.2 Reference values, thresholds for defining good ecological condition, minimum and/or maximum values","text":"Un-scaled indicator value = median value 5 year periods (5 years pragmatic choice. long enough smooth lot inter-annual variation, ’s long enough enable estimating errors)Un-scaled indicator value = median value 5 year periods (5 years pragmatic choice. long enough smooth lot inter-annual variation, ’s long enough enable estimating errors)Upper reference level (best possible condition) = median value reference periodUpper reference level (best possible condition) = median value reference periodThresholds good ecosystem condition = 2 standard deviation units away upper reference level climate variable reference period.Thresholds good ecosystem condition = 2 standard deviation units away upper reference level climate variable reference period.Lower reference values (two-directional) = 5 standard deviation units climate variable reference period (implies linear scaling).Lower reference values (two-directional) = 5 standard deviation units climate variable reference period (implies linear scaling).choice use 2 SD units threshold values subjective choice many ways, founded empirical known relationship indicators ecosystem integrity. value comes common practice calling something extreme weather outside 2 SD units current running average. , indicator value today <0.6 implies mean variable last year referred extreme occurred 1961 1990. think conservative threshold, since one /call extreme one year outside 2SD range, mean 5 years outside range really extreme.","code":""},{"path":"climate-indicators-explained.html","id":"uncertainties-4","chapter":"10 Climate indicators explained","heading":"10.6 Uncertainties","text":"indicator map (1 x 1 km raster) uncertainty associated indicator values. aggregated indicator values (e.g. regions), uncertainty indicator value calculated spatial variation indicator values via bootstrapping. might, however, changed later temporal variation five years period.","code":""},{"path":"climate-indicators-explained.html","id":"references-5","chapter":"10 Climate indicators explained","heading":"10.7 References","text":"https://senorge./rr tm download : https://thredds.met./thredds/catalog/senorge/seNorge_2018/Archive/catalog.html","code":""},{"path":"climate-indicators-explained.html","id":"additional-resources-1","chapter":"10 Climate indicators explained","heading":"10.7.1 Additional resources","text":"Stars packageR GIS economists chapter 7","code":""},{"path":"climate-indicators-explained.html","id":"analyses-7","chapter":"10 Climate indicators explained","heading":"10.8 Analyses","text":"","code":""},{"path":"climate-indicators-explained.html","id":"data-set-1","chapter":"10 Climate indicators explained","heading":"10.8.1 Data set","text":"data downloaded local NINA server, updated regularly.folder contains folder different parametersThis table explains detail\nFigure 10.1: Table explaining available climate parameters data set.\ncontent one folders (first 10 entries)67 files, .e. 67 years data, one file per year.Importing (proxy) file:know CRS, setting manually. Although rule 32633, don’t think matters.data three dimensionInitially data four attributes, subsettet include tg.tg_1957 stars proxy object commands initiate change later, typically write file lazy operations done squeal. Therefore, prepare test data set, smaller can import memory. can perform operations data set can see results.","code":"\npath <- ifelse(dir == \"C:\", \n      \"R:/GeoSpatialData/Meteorology/Norway_SeNorge2018_v22.09/Original\",\n      \"/data/R/GeoSpatialData/Meteorology/Norway_SeNorge2018_v22.09/Original\")\n(files <- list.files(path))\n#>  [1] \"age\"        \"fsw\"        \"gwb_eva\"    \"gwb_gwtcl\" \n#>  [5] \"gwb_q\"      \"gwb_sssdev\" \"gwb_sssrel\" \"lwc\"       \n#>  [9] \"qsw\"        \"rr_tm\"      \"sd\"         \"sdfsw\"     \n#> [13] \"swe\"\nsenorgelayers <- read_delim(\"data/senorgelayers.txt\", \n    delim = \"\\t\", escape_double = FALSE, \n    trim_ws = TRUE)\nDT::datatable(senorgelayers)\n(files_tm <- list.files(paste0(path, \"/rr_tm\")))[1:10]\n#>  [1] \"seNorge2018_1957.nc\" \"seNorge2018_1958.nc\"\n#>  [3] \"seNorge2018_1959.nc\" \"seNorge2018_1960.nc\"\n#>  [5] \"seNorge2018_1961.nc\" \"seNorge2018_1962.nc\"\n#>  [7] \"seNorge2018_1963.nc\" \"seNorge2018_1964.nc\"\n#>  [9] \"seNorge2018_1965.nc\" \"seNorge2018_1966.nc\"\ntg_1957 <- stars::read_ncdf(paste0(path, \"/rr_tm/seNorge2018_1957.nc\"),\n                            var=\"tg\")\n#> Large netcdf source found, returning proxy object.\nst_crs(tg_1957) <- 25833\ndim(tg_1957)\n#>    X    Y time \n#> 1195 1550  365\nnames(tg_1957)\n#> [1] \"tg\""},{"path":"climate-indicators-explained.html","id":"dummy-data","chapter":"10 Climate indicators explained","heading":"10.8.1.1 Dummy data","text":"test data included {stars} packageA single attributeI can rename like thisAnd can add another dummy attribute.dummy data also four dimensionsX y area coordinates. Band integer:remove band dimension.Time four dates covering four months 1970:’ll add extra seasonal variation mixNow create another four copies data, adding random noise continuous decreasing trend.Saving file.","code":"\ntif = system.file(\"tif/L7_ETMs.tif\", package = \"stars\")\nt1 = as.Date(\"1970-05-31\")\nx = read_stars(c(tif, tif, tif, tif), along = \n                  list(time = c(t1, t1+1, t1+50, t1+100)), \n               RasterIO = list(nXOff = c(1), \n                               nYOff = c(1), \n                               nXSize = 50, \n                               nYSize = 50, \n                               bands = c(1:6)))\nnames(x)\n#> [1] \"L7_ETMs.tif\"\nx <- setNames(x, \"Attribute_A\")\nx <- x %>%\n  mutate(\"Attribute_B\" = Attribute_A/2)\ndim(x)\n#>    x    y band time \n#>   50   50    6    4\nst_get_dimension_values(x, \"band\")\n#> [1] 1 2 3 4 5 6\nx <- x %>% filter(band==1) %>% adrop()\n(oldTime <- st_get_dimension_values(x, \"time\"))\n#> [1] \"1970-05-31\" \"1970-06-01\" \"1970-07-20\" \"1970-09-08\"\nx$Attribute_A[,,2] <- x$Attribute_A[,,1]*1.2\nx$Attribute_A[,,3] <- x$Attribute_A[,,1]*1.4\nx$Attribute_A[,,4] <- x$Attribute_A[,,1]*1.1\n# Function to add random noise\nmyRandom <- function(x) x*rnorm(1,1,.05)\ny1 <- x\ny2 <- x %>% st_apply(1:3, myRandom) %>% st_set_dimensions(\"time\", values = oldTime %m+% years(-1)) %>% mutate(Attribute_A = Attribute_A*0.95)\ny3 <- x %>% st_apply(1:3, myRandom) %>% st_set_dimensions(\"time\", values = oldTime %m+% years(-2)) %>% mutate(Attribute_A = Attribute_A*0.90)\ny4 <- x %>% st_apply(1:3, myRandom) %>% st_set_dimensions(\"time\", values = oldTime %m+% years(-3)) %>% mutate(Attribute_A = Attribute_A*0.85)\ny5 <- x %>% st_apply(1:3, myRandom) %>% st_set_dimensions(\"time\", values = oldTime %m+% years(-4)) %>% mutate(Attribute_A = Attribute_A*0.80)\n# We combine the data into one cube for plotting:\ntemp <- c(y1, y2, y3, y4, y5) \n\nggplot() + \n  geom_stars(data = temp) +\n  coord_equal() +\n  theme_void() +\n  scale_fill_viridis_c(option = \"D\") +  \n  scale_x_discrete(expand = c(0, 0)) +\n  scale_y_discrete(expand = c(0, 0))+\n  facet_wrap(~time, ncol=4)\npath <- \"P:/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/dummy_data\"\nsaveRDS(y1, paste0(path, \"/y1.rds\"))\nsaveRDS(y2, paste0(path, \"/y2.rds\"))\nsaveRDS(y3, paste0(path, \"/y3.rds\"))\nsaveRDS(y4, paste0(path, \"/y4.rds\"))\nsaveRDS(y5, paste0(path, \"/y5.rds\"))"},{"path":"climate-indicators-explained.html","id":"dummy-regions-and-et-map","chapter":"10 Climate indicators explained","heading":"10.8.1.1.1 Dummy regions and ET map","text":"dummy data accounting areas (regions) ecosystem occurrences well, case need later.\nFigure 6.7: Showing example account area delineation (raster format)\n\nFigure 1.9: Showing example Ecosystem type delineation data.\n","code":"\ndummy_aa <- x %>%\n  filter(time == oldTime[1]) %>%\n  adrop() %>%\n  mutate(accountingAreas = rep(c(1,2), each=length(Attribute_A)/2)) %>%\n  select(accountingAreas)\n\ntm_shape(dummy_aa) +\n  tm_raster(style=\"cat\")\ndummy_et <- x %>%\n  filter(time == oldTime[1]) %>%\n  adrop() %>%\n  mutate(ecosystemType = rep(c(1,NA), length.out = length(Attribute_A))) %>%\n  select(ecosystemType)\n\ntm_shape(dummy_et) +\n  tm_raster(style=\"cat\")"},{"path":"climate-indicators-explained.html","id":"regions-2","chapter":"10 Climate indicators explained","heading":"10.8.1.2 Regions","text":"Importing shape file regional delineation.Outline NorwayRemove marine areas regions\nFigure 3.9: Five accounting areas (regions) Norway.\n","code":"\nreg <- sf::st_read(\"data/regions.shp\", options = \"ENCODING=UTF8\")\n#> options:        ENCODING=UTF8 \n#> Reading layer `regions' from data source \n#>   `/data/scratch/Matt_bookdown__debug/ecosystemCondition/data/regions.shp' \n#>   using driver `ESRI Shapefile'\n#> Simple feature collection with 5 features and 2 fields\n#> Geometry type: POLYGON\n#> Dimension:     XY\n#> Bounding box:  xmin: -99551.21 ymin: 6426048 xmax: 1121941 ymax: 7962744\n#> Projected CRS: ETRS89 / UTM zone 33N\n#st_crs(reg)\nnor <- sf::st_read(\"data/outlineOfNorway_EPSG25833.shp\")\n#> Reading layer `outlineOfNorway_EPSG25833' from data source \n#>   `/data/scratch/Matt_bookdown__debug/ecosystemCondition/data/outlineOfNorway_EPSG25833.shp' \n#>   using driver `ESRI Shapefile'\n#> Simple feature collection with 1 feature and 2 fields\n#> Geometry type: MULTIPOLYGON\n#> Dimension:     XY\n#> Bounding box:  xmin: -113472.7 ymin: 6448359 xmax: 1114618 ymax: 7939917\n#> Projected CRS: ETRS89 / UTM zone 33N\nreg <- st_intersection(reg, nor)\n#> Warning: attribute variables are assumed to be spatially\n#> constant throughout all geometries\ntm_shape(reg) +\n  tm_polygons(col=\"region\")"},{"path":"climate-indicators-explained.html","id":"ecosystem-map-2","chapter":"10 Climate indicators explained","heading":"10.8.1.3 Ecosystem map","text":"Coming soon ….climate indicators need masked ecosystem type maps. step part chapter.","code":""},{"path":"climate-indicators-explained.html","id":"conceptual-workflow-1","chapter":"10 Climate indicators explained","heading":"10.8.2 Conceptual workflow","text":"general, conceptual workflow like :Collate variable data series\nImport .nc files (loop though year 1961-1990) subset correct attribute\nFilter data dates (optional) (dplyr::filter). means reading 365 rasters memory, much quicker filter correct rasters importing step (see examples later chapter)\nAggregate across time within year (stars::st_apply). time consuming operation workflow.\nJoin data one data cube (stars:c)\nCollate variable data seriesImport .nc files (loop though year 1961-1990) subset correct attributeImport .nc files (loop though year 1961-1990) subset correct attributeFilter data dates (optional) (dplyr::filter). means reading 365 rasters memory, much quicker filter correct rasters importing step (see examples later chapter)Filter data dates (optional) (dplyr::filter). means reading 365 rasters memory, much quicker filter correct rasters importing step (see examples later chapter)Aggregate across time within year (stars::st_apply). time consuming operation workflow.Aggregate across time within year (stars::st_apply). time consuming operation workflow.Join data one data cube (stars:c)Join data one data cube (stars:c)Calculate reference values\nAggregate (st_apply) across reference years (dplyr::filter) get median sd values\nJoin existing data cube (stars:c)\nCalculate reference valuesAggregate (st_apply) across reference years (dplyr::filter) get median sd valuesAggregate (st_apply) across reference years (dplyr::filter) get median sd valuesJoin existing data cube (stars:c)Join existing data cube (stars:c)Calculate indicator values\nNormalize climate variable individual grid cell level using three reference values (mutate(across()))\nCalculate indicator valuesNormalize climate variable individual grid cell level using three reference values (mutate(across()))Mask ecosystem type (also done step one, doesn’t speed things set cells NA)Mask ecosystem type (also done step one, doesn’t speed things set cells NA)Aggregate space (accounting areas) (zonal statistics)\nAggregate across 5 year time steps smooth random inter-annual variation leave climate signal\nIntersect accounting area polygons exactextrar::exact_extract get mean/median (spatial) sd. (Alternatively, get temporal sd grid cell level step .)\nAggregate space (accounting areas) (zonal statistics)Aggregate across 5 year time steps smooth random inter-annual variation leave climate signalAggregate across 5 year time steps smooth random inter-annual variation leave climate signalIntersect accounting area polygons exactextrar::exact_extract get mean/median (spatial) sd. (Alternatively, get temporal sd grid cell level step .)Intersect accounting area polygons exactextrar::exact_extract get mean/median (spatial) sd. (Alternatively, get temporal sd grid cell level step .)Make trend figure spatially aggregated maps,Make trend figure spatially aggregated maps,","code":""},{"path":"climate-indicators-explained.html","id":"collate-variable-data-series","chapter":"10 Climate indicators explained","heading":"10.8.3 Collate variable data series","text":"include loop importing .nc files end.","code":""},{"path":"climate-indicators-explained.html","id":"filter-data-by-dates","chapter":"10 Climate indicators explained","heading":"10.8.4 Filter data by dates","text":"Say want calculate mean summer temperature. want exclude data times withing definition summer.Let’s try dummy data. Remember data four time steps.real data 365 time steps year.First define start end dates. want keep summer data, defined jun - aug.iteration need get year wellThen can create time interval objectThen filterLater discover `dplyr::filter` work reading whole object file, therefor slow use. therefore filter data different way .","code":"\nst_get_dimension_values(x, \"time\")\n#> [1] \"1970-05-31\" \"1970-06-01\" \"1970-07-20\" \"1970-09-08\"\nstart_month <-  \"06\"\nend_month <- \"08\"\n(year_temp <- year(st_get_dimension_values(x, \"time\")[1]))\n#> [1] 1970\nstart <- ym(paste(year_temp, start_month, sep=\"-\"))\nend <-  ym(paste(year_temp, end_month, sep=\"-\"))\n(myInterval <- interval(start, end))\n#> [1] 1970-06-01 UTC--1970-08-01 UTC\nx_aug <- x %>%\n  select(Attribute_A) %>%\n  adrop() %>%\n  filter(time %within% myInterval)\nst_get_dimension_values(x_aug, \"time\")\n#> [1] \"1970-06-01\" \"1970-07-20\""},{"path":"climate-indicators-explained.html","id":"aggregate-across-time-within-a-year","chapter":"10 Climate indicators explained","heading":"10.8.5 Aggregate across time within a year","text":"example want calculate mean temperature summer. therefore need aggregate time. Many climate indicators need functionality. two ways, either using st_apply using aggregate.time dimension now gone aggregated across .\nFigure 10.2: Comparing computation tome two spatial aggregation functions.\nst_apply slightly faster, aggregate advantage retains time dimension, whereas st_apply need set attribute name year. try use st_apply.let see can save time masking ET operation.\nFigure 1.12: Demonstrating effect maskig dummy data using perfectly aligne raster ET map.\n\nFigure 10.3: Comparing computation time masking raster data. performance increase masking aggregating.\nSince increase performance masking, see Fig. @ref(fig: withMasking) basically means slower mask beforehand, since masking past benchmark assessment., solution:v_ follows naming convention developed .\nFigure 10.4: Plotting dummy data showing Attribute_A two dates small maps, larger map showing mean year 2018\n’s whole first step conceptual workflow action, dummy data.result.\nFigure 10.5: Temporal aggregation dummy data set.\nNow let’s try real data.initially tried read stars proxy object add steps call_list execute st_as_stars, still returned proxy objects. Therefore read whole file without proxy. save time can subset based Julian dates.use parallelization speed things .takes 20 sec per file/year, 22 min total. bad. 6000 raster read memory. ’s test effect splitting cores.cluster: 21.401 sec elapsedNo cluster: 21.401 sec elapsedTwo clusters: 21.546 sec elapsedTwo clusters: 21.546 sec elapsedSix clusters: 14.548 sec elapsedSix clusters: 14.548 sec elapsedTen clusters: 15.29 sec elapsedTen clusters: 15.29 sec elapsedTen clusters (second run): 13.617 sec elapsedTen clusters (second run): 13.617 sec elapsedThe RStudio server 48 cores. parallel cores probably average faster. NINA guidelines use max 10 cores, remember close parallel cluster done.files 500 MB, tiff file reads lot quicker rds file, now ’ll just export tiff. (perhaps solved gc(). Later tried saving RData speed issues problems, problem RData files seemingly becoming corrupted time - stars objects saved RData files bind together using c.stars() matching stars object think related time stamp RData format. , stick tiff).Note GTiff automatically renames third dimension band also renames attribute.can rename .\nFigure 3.15: Showing three random slices year dimension.\n","code":"\ntemp_names <- year(st_get_dimension_values(x_aug, \"time\")[1])\n\nmicroOut <- microbenchmark(\nst_apply =  x_aug %>%\n  st_apply(1:2, mean) %>%\n  setNames(paste0(\"v_\",temp_names)),\naggregate = x_aug %>%\n  aggregate(by = \"year\", mean),\ntimes=30\n)\nautoplot(microOut)\n#> Coordinate system already present. Adding new coordinate\n#> system, which will replace the existing one.\nx_masked <- x_aug\nx_masked[is.na(dummy_et)] <- NA\nplot(x_masked[,,,1])\nautoplot(\n  microbenchmark(\nNo_masking =  x_aug %>%\n  st_apply(1:2, mean) %>%\n  setNames(paste0(\"v_\",temp_names)),\nMasking =  x_masked %>%\n  st_apply(1:2, mean) %>%\n  setNames(paste0(\"v_\",temp_names))\n ), times=30\n)\n#> Coordinate system already present. Adding new coordinate\n#> system, which will replace the existing one.\n# setNames dont work on stars proxy obejct, so I use rename instead\nlookup <- setNames(\"mean\", paste0(\"v_\", temp_names))\n\nx_summerMean <-   x_aug %>%\n  st_apply(1:2, mean) %>%\n  rename(all_of(lookup))\nggarrange(\nggplot() + \n  geom_stars(data = x_aug) +\n  coord_equal() +\n  facet_wrap(~time) +\n  theme_void() +\n  scale_fill_viridis_c(option = \"D\") +  scale_x_discrete(expand = c(0, 0)) +\n  scale_y_discrete(expand = c(0, 0)),  \n  \n  \nggplot() + \n  geom_stars(data = x_summerMean) +\n  coord_equal() +\n  #facet_wrap(~time) +\n  theme_void() +\n  scale_fill_viridis_c(option = \"D\") +\n  scale_x_discrete(expand = c(0, 0)) +\n  scale_y_discrete(expand = c(0, 0))\n)\n\n# Setting up the parameters\ndir <- substr(getwd(), 1,2)\npath <- ifelse(dir == \"C:\",\n       \"P:/\", \n       \"/data/P-Prosjekter2/\")\npath2 <- paste0(path, \n                \"41201785_okologisk_tilstand_2022_2023/data/climate_indicators/dummy_data\")\nstart_month <-  \"06\"\nend_month <- \"08\"\nmyFiles <- list.files(path2, pattern=\".rds\", full.names = T)\nsummerTemp_fullSeries <- NULL\n\n# Looping though the files in the directory\nsystem.time({\nfor(i in 1:length(myFiles)){\n  \n  temp <- readRDS(myFiles[i]) %>%\n    select(Attribute_A)\n  \n  year_temp <- year(st_get_dimension_values(temp, \"time\")[1])\n  start <- ym(paste(year_temp, start_month, sep=\"-\"))\n  end <-  ym(paste(year_temp, end_month, sep=\"-\"))\n  myInterval <- interval(start, end)\n  lookup <- setNames(\"mean\", paste0(\"v_\", year_temp))\n\n  temp <- temp %>%\n    filter(time %within% myInterval) %>%\n    st_apply(1:2, mean) %>%\n    rename(all_of(lookup))\n  \n  summerTemp_fullSeries <- c(temp, summerTemp_fullSeries)\n  rm(temp) # same computation time with and without this function, but more tidy this way\n}\n\n\n# Turn the attributes into a dimension and rename the new attribute\nsummerTemp_fullSeries <- summerTemp_fullSeries %>%\n  merge(name=\"Year\") %>%\n  setNames(\"Attribute_A\")\n})\n#>    user  system elapsed \n#>   0.134   0.000   0.143\nggplot()+\n  geom_stars(data = summerTemp_fullSeries) +\n  coord_equal() +\n  theme_void() +\n  scale_fill_viridis_c(option = \"D\") +  \n  scale_x_discrete(expand = c(0, 0)) +\n  scale_y_discrete(expand = c(0, 0))+\n  facet_wrap(~Year)\npath <- path <- ifelse(dir == \"C:\", \n      \"R:/\",\n      \"/data/R/\")\n  \npath2 <- paste0(path, \"GeoSpatialData/Meteorology/Norway_SeNorge2018_v22.09/Original/rr_tm/\")\n\nmyFiles <- list.files(path2, pattern=\".nc$\",full.names = T)\n# The last file (the last year) is incomplete and don't include all julian dates that we select below, so I will not include it:\nmyFiles <- myFiles[-length(myFiles)]\n\nreal_temp_summer <- NULL\n\n# set up parallel cluster using 10 cores\ncl <- makeCluster(10L)\n\n# Get julian days after defining months\ntemp <- stars::read_ncdf(paste(myFiles[1]), var=\"tg\")\nstart_month_num <-  6\nend_month_num <- 8\n\njulian_start <- yday(st_get_dimension_values(temp, \"time\")[1] %m+%\n                       months(+start_month_num))\njulian_end <- yday(st_get_dimension_values(temp, \"time\")[1] %m+%\n                     months(+end_month_num))\nstep <- julian_end-julian_start\n\n\n\nfor(i in 1:length(myFiles)){\n  \n  tic(\"init\")\n  temp <- stars::read_ncdf(paste(myFiles[i]), var=\"tg\", proxy=F,\n                           ncsub = cbind(start = c(1, 1, julian_start), \n                              count = c(NA, NA, step)))\n  year_temp <- year(st_get_dimension_values(temp, \"time\")[1])\n  print(year_temp)\n  lookup <- setNames(\"mean\", paste0(\"v_\", year_temp)) \n    # Perhaps leave out the v_ to get a numeric vector instead, \n    # which is easier to subset\n  st_crs(temp) <- 25833\n  toc()\n\n  tic(\"filter and st_apply\")\n  temp <- temp %>%\n    #filter(time %within% myInterval) %>%\n    st_apply(1:2, mean, CLUSTER = cl) %>%\n    rename(all_of(lookup)) \n  toc()\n  \n  tic(\"c()\")\n  real_temp_summer <- c(temp, real_temp_summer)\n  #rm(temp)\n  toc()\n}\n\ntic(\"Merge\")\nreal_temp_summer <- real_temp_summer %>%\n  merge(name = \"Year\") %>%\n  setNames(\"climate_variable\")\ntoc()\n\nstopCluster(cl)\ncl <- makeCluster(2L)\ncl2 <- makeCluster(6L)\ncl3 <- makeCluster(10L)\n\n\ntic(\"No cluster\")\ntemp %>%\n    #filter(time %within% myInterval) %>%\n    st_apply(1:2, mean) %>%\n    rename(all_of(lookup)) \ntoc()\n\ntic(\"Two clusters\")\ntemp %>%\n    #filter(time %within% myInterval) %>%\n    st_apply(1:2, mean, CLUSTER = cl) %>%\n    rename(all_of(lookup)) \nstopCluster(cl)\ntoc()\n\ntic(\"Six clusters\")\ntemp %>%\n    #filter(time %within% myInterval) %>%\n    st_apply(1:2, mean, CLUSTER = cl2) %>%\n    rename(all_of(lookup)) \nstopCluster(cl2)\ntoc()\n\ntic(\"Ten clusters\")\ntemp %>%\n    #filter(time %within% myInterval) %>%\n    st_apply(1:2, mean, CLUSTER = cl3) %>%\n    rename(all_of(lookup)) \nstopCluster(cl3)\ntoc()\n  \n#saveRDS(real_temp_summer, \"/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/aggregated_climate_time_series/real_temp_summer.rds\")\n#write_stars(real_temp_summer, \"/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/aggregated_climate_time_series/real_temp_summer.tiff\")\nsummer_median_temp <- read_stars(paste0(pData, \"climate_indicators/aggregated_climate_time_series/real_temp_summer.tiff\"),\n                                 proxy=F)\nnames(summer_median_temp)\n#> [1] \"real_temp_summer.tiff\"\ndim(summer_median_temp)\n#>    x    y band \n#> 1195 1550   66\nst_get_dimension_values(summer_median_temp, \"Year\")\n#> NULL\nst_get_dimension_values(summer_median_temp, \"band\")\n#>  [1] \"v_2022\" \"v_2021\" \"v_2020\" \"v_2019\" \"v_2018\" \"v_2017\"\n#>  [7] \"v_2016\" \"v_2015\" \"v_2014\" \"v_2013\" \"v_2012\" \"v_2011\"\n#> [13] \"v_2010\" \"v_2009\" \"v_2008\" \"v_2007\" \"v_2006\" \"v_2005\"\n#> [19] \"v_2004\" \"v_2003\" \"v_2002\" \"v_2001\" \"v_2000\" \"v_1999\"\n#> [25] \"v_1998\" \"v_1997\" \"v_1996\" \"v_1995\" \"v_1994\" \"v_1993\"\n#> [31] \"v_1992\" \"v_1991\" \"v_1990\" \"v_1989\" \"v_1988\" \"v_1987\"\n#> [37] \"v_1986\" \"v_1985\" \"v_1984\" \"v_1983\" \"v_1982\" \"v_1981\"\n#> [43] \"v_1980\" \"v_1979\" \"v_1978\" \"v_1977\" \"v_1976\" \"v_1975\"\n#> [49] \"v_1974\" \"v_1973\" \"v_1972\" \"v_1971\" \"v_1970\" \"v_1969\"\n#> [55] \"v_1968\" \"v_1967\" \"v_1966\" \"v_1965\" \"v_1964\" \"v_1963\"\n#> [61] \"v_1962\" \"v_1961\" \"v_1960\" \"v_1959\" \"v_1958\" \"v_1957\"\nsummer_median_temp <- summer_median_temp %>% \n  st_set_dimensions(names = c(\"x\", \"y\", \"v_YEAR\")) %>%\n  setNames(\"temperature\")\ndim(summer_median_temp)\n#>      x      y v_YEAR \n#>   1195   1550     66\nggplot()+\n  geom_stars(data = summer_median_temp[,,,c(1,11,22)], downsample = c(10, 10, 0)) +\n  coord_equal() +\n  theme_void() +\n  scale_fill_viridis_c(option = \"D\") +  \n  scale_x_discrete(expand = c(0, 0)) +\n  scale_y_discrete(expand = c(0, 0))+\n  facet_wrap(~v_YEAR)"},{"path":"climate-indicators-explained.html","id":"calculate-reference-values","chapter":"10 Climate indicators explained","heading":"10.8.6 Calculate reference values","text":"","code":""},{"path":"climate-indicators-explained.html","id":"aggregate-across-reference-years","chapter":"10 Climate indicators explained","heading":"10.8.6.1 Aggregate across reference years","text":"need first define reference period subset data summer_median_temp. can practice dummy data y.Now aggregate across years, using st_apply.’s perhaps easier median sd unique attributes, rather levels dimension.attribute name mean can change something meaningful.\nFigure 3.20: Showing upper reference levels standard deviation dummy data set.\nLet’s transfer real data. First need rename dimension values turn back dates.can filter leave reference period.calculate median sd like aboveThis also something can export.Pivot turn dimension attributes:attribute name mean. can change something meaningful.\nFigure 10.6: Showing upper reference levels standard deviation actual data median summer temperatures.\n","code":"\ndir <- substr(getwd(), 1,2)\npath <- ifelse(dir == \"C:\",\n       \"P:/\", \n       \"/data/P-Prosjekter2/\")\npath2 <- paste0(path, \n                \"41201785_okologisk_tilstand_2022_2023/data/climate_indicators/dummy_data\")\nmyFiles <- list.files(path2, pattern=\".rds\", full.names = T)\ny <- NULL\n\n# Looping though the files in the directory\nfor(i in 1:length(myFiles)){\n  temp <- readRDS(myFiles[i])\n  y <- c(temp, y)\n}\nst_get_dimension_values(y, \"time\")\n#>  [1] \"1966-05-31\" \"1966-06-01\" \"1966-07-20\" \"1966-09-08\"\n#>  [5] \"1967-05-31\" \"1967-06-01\" \"1967-07-20\" \"1967-09-08\"\n#>  [9] \"1968-05-31\" \"1968-06-01\" \"1968-07-20\" \"1968-09-08\"\n#> [13] \"1969-05-31\" \"1969-06-01\" \"1969-07-20\" \"1969-09-08\"\n#> [17] \"1970-05-31\" \"1970-06-01\" \"1970-07-20\" \"1970-09-08\"\ny_filtered <- y %>%\n  select(Attribute_A) %>%\n  filter(time %within% interval(\"1961-01-01\", \"1990-12-31\"))\nmedian_sd <- function(x) { c(median = median(x), sd = sd(x))}\ny_ref <- y_filtered %>%\n  st_apply(c(\"x\", \"y\"), FUN =  median_sd)\ndim(y_ref)\n#> median_sd         x         y \n#>         2        50        50\nst_get_dimension_values(y_ref, \"median_sd\")\n#> [1] \"median\" \"sd\"\ny_ref <- y_ref %>% split(\"median_sd\")\ny_ref <- setNames(y_ref, c(\"reference_upper\", \"sd\"))\ntmap_arrange(\ntm_shape(y_ref)+\n  tm_raster(\"reference_upper\")\n,\ntm_shape(y_ref)+\n  tm_raster(\"sd\",\n            palette = \"-viridis\")\n)\nnew_dims <- as.Date(paste0(\n  substr(st_get_dimension_values(summer_median_temp, \"v_YEAR\"), 3, 6), \"-01-01\"))\nsummer_median_temp_ref <- summer_median_temp %>%\n  st_set_dimensions(\"v_YEAR\", values = new_dims)\nsummer_median_temp_ref <- summer_median_temp_ref %>%\n  filter(v_YEAR %within% interval(\"1961-01-01\", \"1990-12-31\"))\nst_get_dimension_values(summer_median_temp_ref, \"v_YEAR\")\n#>  [1] \"1990-01-01\" \"1989-01-01\" \"1988-01-01\" \"1987-01-01\"\n#>  [5] \"1986-01-01\" \"1985-01-01\" \"1984-01-01\" \"1983-01-01\"\n#>  [9] \"1982-01-01\" \"1981-01-01\" \"1980-01-01\" \"1979-01-01\"\n#> [13] \"1978-01-01\" \"1977-01-01\" \"1976-01-01\" \"1975-01-01\"\n#> [17] \"1974-01-01\" \"1973-01-01\" \"1972-01-01\" \"1971-01-01\"\n#> [21] \"1970-01-01\" \"1969-01-01\" \"1968-01-01\" \"1967-01-01\"\n#> [25] \"1966-01-01\" \"1965-01-01\" \"1964-01-01\" \"1963-01-01\"\n#> [29] \"1962-01-01\" \"1961-01-01\"\nsystem.time({\ncl <- makeCluster(10L)\nsummer_median_temp_ref <- summer_median_temp_ref %>%\n  st_apply(c(\"x\", \"y\"), \n           FUN =  median_sd,\n           CLUSTER = cl)\nstopCluster(cl)\n})\n# Note that write_stars can only export a single attribute, but we have put the 'attributes' as dimensions, and these will be read in as 'band' when importing tiff.\nwrite_stars(summer_median_temp_ref, \"/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/aggregated_climate_time_series/summer_median_temp_ref.tiff\")\n\n# I initially saved as RData, like this, but ran into problems later when trying to bind stars objects using c.stars(). It appears RData becomes corrutpt in a sense, over time, perhaps due to some time stamp. If I recreated the object in the global environment and saved as RDatam I could read it in and work with it, but the next day it would not work again.\n#saveRDS(summer_median_temp_ref, \"/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/aggregated_climate_time_series/summer_median_temp_ref.RData\")\nsummer_median_temp_ref_long <- summer_median_temp_ref %>% split(\"band\")\nsummer_median_temp_ref_long <- setNames(summer_median_temp_ref_long, c(\"reference_upper\", \"sd\"))\ntmap_arrange(\ntm_shape(st_downsample(summer_median_temp_ref_long, 10))+\n  tm_raster(\"reference_upper\")\n,\ntm_shape(st_downsample(summer_median_temp_ref_long, 10))+\n  tm_raster(\"sd\",\n            palette = \"-viridis\")\n)"},{"path":"climate-indicators-explained.html","id":"combine","chapter":"10 Climate indicators explained","heading":"10.8.6.2 Combine","text":"need combine variables ref values one data cube","code":"\ny_var <- summer_median_temp %>%\n  split(3) %>%\n  c(summer_median_temp_ref_long)"},{"path":"climate-indicators-explained.html","id":"normalise-variable","chapter":"10 Climate indicators explained","heading":"10.8.7 Normalise variable","text":"Writing file, time RData (use rds) tiff don’t allow multiple attributes, don’t need use c.stars() object.\nFigure 10.7: Example showing median summer tempretur 1970, upper lwoer reference temperture, .e. median 5 SD units temperature 1961-1990, finally, scaled indicator values.\nreal indicator values means 5 year periods. Calculating running mean time steps time consuming. Therefore, scaled, regional indicator values calculated distinct time steps. time series can perhaps best presented yearly resolution.","code":"\n# select the columns to normalise\ncols <- names(y_var)[!names(y_var) %in% c(\"reference_upper\", \"sd\") ]\ncols_new <- cols\nnames(cols_new) <- gsub(\"v_\", \"i_\", cols)\n# Mutate\n\n# The break point scaling is actually not needed here, since \n# having the lower ref value to be 5 sd implies that the threshold is\n# 2 sd in a linear scaling.\n\nsystem.time(\ny_var_norm <- y_var %>%\n  mutate(reference_low = reference_upper - 5*sd ) %>%\n  mutate(reference_low2 = reference_upper + 5*sd ) %>%\n  mutate(threshold_low = reference_upper -2*sd ) %>%\n  mutate(threshold_high = reference_upper +2*sd ) %>%\n  mutate(across(all_of(cols), ~ \n                  if_else(.x < reference_upper,\n                  if_else(.x < threshold_low, \n                                        (.x - reference_low) / (threshold_low - reference_low),\n                                        (.x - threshold_low) / (reference_upper - threshold_low),\n                                        ),\n                  if_else(.x > threshold_high, \n                                        (reference_low2 - .x) / (reference_low2 - threshold_high),\n                                        (threshold_high - .x) / (threshold_high - reference_upper),\n                                        )\n                ))) %>%\n  mutate(across(all_of(cols), ~ if_else(.x > 1, 1, .x))) %>%\n  mutate(across(all_of(cols), ~ if_else(.x < 0, 0, .x))) %>%\n  rename(all_of(cols_new)) %>%\n  c(select(y_var, all_of(cols)))\n)\ngc()\nsaveRDS(y_var_norm, \"/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/aggregated_climate_time_series/summer_median_temp_normalised.RData\")\n\nlims <- c(-5, 22)\n\nggarrange(\nggplot() + \n  geom_stars(data = st_downsample(y_var_norm[\"v_1970\"],10)) +\n  coord_equal() +\n  theme_void() +\n  scale_fill_viridis_c(option = \"D\",\n                       limits = lims) +  \n  scale_x_discrete(expand = c(0, 0)) +\n  scale_y_discrete(expand = c(0, 0))\n,\nggplot() + \n  geom_stars(data = st_downsample(y_var_norm[\"reference_upper\"], 10)) +\n  coord_equal() +\n  theme_void() +\n  scale_fill_viridis_c(option = \"D\",\n                       limits = lims) +  \n  scale_x_discrete(expand = c(0, 0)) +\n  scale_y_discrete(expand = c(0, 0))\n,\nggplot() + \n  geom_stars(data = st_downsample(y_var_norm[\"reference_low\"], 10)) +\n  coord_equal() +\n  theme_void() +\n  scale_fill_viridis_c(option = \"D\",\n                       limits = lims) +  \n  scale_x_discrete(expand = c(0, 0)) +\n  scale_y_discrete(expand = c(0, 0))\n,\n\nggplot() + \n  geom_stars(data = st_downsample(y_var_norm[\"reference_low2\"], 10)) +\n  coord_equal() +\n  theme_void() +\n  scale_fill_viridis_c(option = \"D\",\n                       limits = lims) +  \n  scale_x_discrete(expand = c(0, 0)) +\n  scale_y_discrete(expand = c(0, 0))\n,\n\nggplot() + \n  geom_stars(data = st_downsample(y_var_norm[\"i_1970\"],10)) +\n  coord_equal() +\n  theme_void() +\n  scale_fill_viridis_c(option = \"A\",\n                       limits = c(0, 1)) +  \n  scale_x_discrete(expand = c(0, 0)) +\n  scale_y_discrete(expand = c(0, 0))\n, ncol=2, nrow=3, align = \"hv\"\n)"},{"path":"climate-indicators-explained.html","id":"plot-time-series-as-line-graphs","chapter":"10 Climate indicators explained","heading":"10.8.8 Plot time series as line graphs","text":"also plot time series series maps, need average 5 year time periods first. can get later.plot time series first need spatial aggregation. One option spatially aggregate stars object directly, using reg data set:However, preserve region name, subsequent st_intersection taks little gives boundary problems.can also convert pixels points intersection.also took long.can perhaps aggregate, turn points intersect, work perfect either.can rasterize regions data set, turn coded dimension use st_apply, tedious.Let try using exact_extract, alternative aggregate. requires us turn terra package bit.user; system; elapsed: 7.603; 3.071; 10.697That fast!also get sd:user; system; elapsed: 7.420; 2.921; 10.355Reshape plot\nFigure 10.8: Times series median summer temperature centered median value reference period. reference period indicated thick horizontal line. Dottet horisontal lines 2 sd units reference period.\ncan take mean last 5 years add spatial representation.\nFigure 10.9: Scaled indicator values, aggregated 5 year intervals. Errors represent spatial variation within regions across years.\nFinally, can add values sp object.\nFigure 10.10: Summer tempreature indicator values five accounting areas Norway. SD spatial variation.\n","code":"\ntemp <- y_var_norm[1,,] %>%\n  aggregate(reg, mean, na.rm=T)\nplot(temp)\ntemp2 <- temp %>%\n  st_as_sf() # too slowtemp_points <- y_var_norm[1,,] %>%\n  st_as_sf(as_points = TRUE, merge = FALSE)\ntemp_points2 <- temp_points %>%\n  st_intersection(reg) \" too slow\"\nsystem.time(\nregional_means <- rast(y_var_norm) %>%\n  exact_extract(reg, fun = 'mean', append_cols = \"region\", progress=T) %>%\n  setNames(c(\"region\", names(y_var_norm)))\n  )\nsystem.time(\nregional_sd <- rast(y_var_norm) %>%\n  exact_extract(reg, fun = 'stdev', append_cols = \"region\", progress=T) %>%\n  setNames(c(\"region\", names(y_var_norm)))\n  )\nsaveRDS(regional_means, \"temp/regional_means.rds\")\nsaveRDS(regional_sd, \"temp/regional_sd.rds\")\ndiv <- c(\"reference_upper\",\n         \"reference_low\",\n         \"reference_low2\",\n         \"threshold_low\",\n         \"threshold_high\",\n         \"sd\")\n\ntemp <- regional_means %>%\n  as.data.frame() %>%\n  select(region, div)\n  \nregional_means_long <- regional_means %>%\n  as.data.frame() %>%\n  select(!all_of(div)) %>%\n  pivot_longer(!region) %>%\n  separate(name, into=c(\"type\", \"year\")) %>%\n  pivot_wider(#id_cols = region,\n              names_from = type)  %>%\n  left_join(temp, by=join_by(region)) %>% \n  mutate(diff = v-reference_upper) %>%\n  mutate(threshold_low_centered = threshold_low-reference_upper) %>%\n  mutate(threshold_high_centered = threshold_high-reference_upper)\n\n#Adding the spatial sd\n(\nregional_means_long <- regional_sd %>%\n  select(!all_of(div)) %>%\n  pivot_longer(!region) %>%\n  separate(name, into=c(\"type\", \"year\")) %>%\n  pivot_wider(names_from = type) %>%\n  rename(i_sd = i,\n         v_sd = v) %>%\n  left_join(regional_means_long, by=join_by(region, year))\n)\n#> # A tibble: 330 × 15\n#>    region     year   i_sd  v_sd     i     v reference_upper\n#>    <chr>      <chr> <dbl> <dbl> <dbl> <dbl>           <dbl>\n#>  1 Nord-Norge 2022  0.246  1.90 0.523  11.5            10.2\n#>  2 Nord-Norge 2021  0.255  1.65 0.672  10.8            10.2\n#>  3 Nord-Norge 2020  0.143  1.82 0.784  10.3            10.2\n#>  4 Nord-Norge 2019  0.290  1.77 0.623  10.8            10.2\n#>  5 Nord-Norge 2018  0.344  1.64 0.523  12.5            10.2\n#>  6 Nord-Norge 2017  0.145  1.79 0.794  10.1            10.2\n#>  7 Nord-Norge 2016  0.175  1.74 0.705  10.8            10.2\n#>  8 Nord-Norge 2015  0.198  1.61 0.682  10.6            10.2\n#>  9 Nord-Norge 2014  0.297  1.65 0.545  13.1            10.2\n#> 10 Nord-Norge 2013  0.202  1.65 0.479  11.4            10.2\n#> # ℹ 320 more rows\n#> # ℹ 8 more variables: reference_low <dbl>,\n#> #   reference_low2 <dbl>, threshold_low <dbl>,\n#> #   threshold_high <dbl>, sd <dbl>, diff <dbl>,\n#> #   threshold_low_centered <dbl>,\n#> #   threshold_high_centered <dbl>\nregOrder = c(\"Østlandet\",\"Sørlandet\",\"Vestlandet\",\"Midt-Norge\",\"Nord-Norge\")\n\nregional_means_long %>%\n  mutate(col = if_else(diff>0, \"1\", \"2\")) %>%\n  ggplot(aes(x = as.numeric(year), \n           y = diff, fill = col))+\n  geom_bar(stat=\"identity\")+\n  geom_hline(aes(yintercept = threshold_low_centered),\n        linetype=2)+\n  geom_hline(aes(yintercept = threshold_high_centered),\n        linetype=2)+\n  geom_segment(x = 1961, xend=1990,\n               y = 0, yend = 0,\n               linewidth=2)+\n  scale_fill_hue(l=70, c=60)+\n  theme_bw(base_size = 12)+\n  ylab(\"Sommertempratur\\navvik fra 1961-1990\")+\n  xlab(\"\")+\n  guides(fill=\"none\")+\n  facet_wrap( .~ factor(region, levels = regOrder),\n              ncol=3,\n              scales = \"free_y\")\n(\ni_aggregatedToPeriods <- regional_means_long %>%\n  mutate(year = as.numeric(year)) %>%\n  mutate(period = case_when(\n    year %between% c(2018, 2022) ~ \"2018-2022\",\n    year %between% c(2013, 2017) ~ \"2013-2017\",\n    year %between% c(2008, 2012) ~ \"2008-2012\",\n    year %between% c(2003, 2007) ~ \"2003-2007\",\n    .default = \"pre 2003\"\n  )) %>%\n  mutate(period_rank = case_when(\n   period == \"2018-2022\" ~ 5,\n   period == \"2013-2017\" ~ 4,\n   period == \"2008-2012\" ~ 3,\n   period == \"2003-2007\" ~ 2,\n    .default = 1\n  )) %>%\n  group_by(region, period, period_rank) %>%\n  summarise(indicator = mean(i),\n            spatial_sd = sqrt(sum(i_sd^2))/length(i_sd)\n            #,\n            #spatial_sd_mean = mean(i_sd),\n            #spatial_sd2_max = max(i_sd),\n            #spatial_sd2_length = length(i_sd)\n            )\n)\n#> `summarise()` has grouped output by 'region', 'period'. You\n#> can override using the `.groups` argument.\n#> # A tibble: 25 × 5\n#> # Groups:   region, period [25]\n#>    region     period    period_rank indicator spatial_sd\n#>    <chr>      <chr>           <dbl>     <dbl>      <dbl>\n#>  1 Midt-Norge 2003-2007           2     0.427     0.101 \n#>  2 Midt-Norge 2008-2012           3     0.573     0.143 \n#>  3 Midt-Norge 2013-2017           4     0.536     0.0986\n#>  4 Midt-Norge 2018-2022           5     0.607     0.130 \n#>  5 Midt-Norge pre 2003            1     0.642     0.0277\n#>  6 Nord-Norge 2003-2007           2     0.460     0.122 \n#>  7 Nord-Norge 2008-2012           3     0.675     0.109 \n#>  8 Nord-Norge 2013-2017           4     0.641     0.0937\n#>  9 Nord-Norge 2018-2022           5     0.625     0.118 \n#> 10 Nord-Norge pre 2003            1     0.625     0.0266\n#> # ℹ 15 more rows\nlabs <- unique(i_aggregatedToPeriods$period[order(i_aggregatedToPeriods$period_rank)])\n\ni_aggregatedToPeriods %>%\n  ggplot(aes(x = period_rank, \n             y = indicator,\n             colour=region))+\n  geom_line() +\n  geom_point() +\n  geom_errorbar(aes(ymin=indicator-spatial_sd, \n                    ymax=indicator+spatial_sd), \n                    width=.2,\n                 position=position_dodge(0.2)) +\n  theme_bw(base_size = 12)+\n  scale_x_continuous(breaks = 1:5,\n                     labels = labs)+\n  labs(x = \"\", y = \"indikatorverdi\")\nreg2 <- reg %>%\n  left_join(i_aggregatedToPeriods[i_aggregatedToPeriods$period_rank==5,], by=join_by(region))\nnames(reg2)\n#> [1] \"id\"          \"region\"      \"GID_0\"       \"NAME_0\"     \n#> [5] \"period\"      \"period_rank\" \"indicator\"   \"spatial_sd\" \n#> [9] \"geometry\"\nmyCol <- \"RdYlGn\"\nmyCol2 <- \"-RdYlGn\"\n\ntm_main <- tm_shape(reg2)+\n  tm_polygons(col=\"indicator\",\n              title=\"Indikator:\\nsommertemperatur\",\n    palette = myCol,\n    style=\"fixed\",\n    breaks = seq(0,1,.2)) \n  \ntm_inset <- tm_shape(reg2)+\n  tm_polygons(col=\"spatial_sd\",\n              title=\"SD\",\n              palette = myCol2,\n              style=\"cont\")+\n  tm_layout(legend.format = list(digits=2))\n\ntmap_arrange(tm_main, \n             tm_inset)"}]
