<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 7 Trophic level biomass ratios | Indicators for Ecosystem Condition in Norway</title>
<meta name="author" content="Anders L. Kolstad">
<meta name="description" content="Author and date: James Speed June 2023   7.1 Introduction Here we will develop indicators of ecological condition for Norway, based on the distribution of biomass between trophic levels -...">
<meta name="generator" content="bookdown 0.34 with bs4_book()">
<meta property="og:title" content="Chapter 7 Trophic level biomass ratios | Indicators for Ecosystem Condition in Norway">
<meta property="og:type" content="book">
<meta property="og:url" content="https://ninanor.github.io/ecosystemCondition/index.html/trophic-level-biomass-ratios.html">
<meta property="og:image" content="https://ninanor.github.io/ecosystemCondition/index.html/images/Picture1.png">
<meta property="og:description" content="Author and date: James Speed June 2023   7.1 Introduction Here we will develop indicators of ecological condition for Norway, based on the distribution of biomass between trophic levels -...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 7 Trophic level biomass ratios | Indicators for Ecosystem Condition in Norway">
<meta name="twitter:description" content="Author and date: James Speed June 2023   7.1 Introduction Here we will develop indicators of ecological condition for Norway, based on the distribution of biomass between trophic levels -...">
<meta name="twitter:image" content="https://ninanor.github.io/ecosystemCondition/index.html/images/Picture1.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.28/datatables.js"></script><link href="libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Indicators for Ecosystem Condition in Norway</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About </a></li>
<li><a class="" href="overview-of-indicators.html">Overview of indicators</a></li>
<li><a class="" href="gjengroing.html"><span class="header-section-number">1</span> Vegetation regrowth/encroachment (gjengroing)</a></li>
<li class="book-part">INDICATORS</li>
<li><a class="" href="slitasje-og-kj%C3%B8respor.html"><span class="header-section-number">2</span> Slitasje og kjørespor</a></li>
<li><a class="" href="median-summer-temp.html"><span class="header-section-number">3</span> Median Summer Temperature</a></li>
<li><a class="" href="alien-species.html"><span class="header-section-number">4</span> Alien species</a></li>
<li><a class="" href="Functional-plant-indicators-wetland.html"><span class="header-section-number">5</span> Functional plant indicators (Moisture, Light, pH, Nitrogen)</a></li>
<li><a class="" href="Functional-plant-indicators-seminat.html"><span class="header-section-number">6</span> Functional plant indicators, semi-natural ecosystems (Light, Moisture, pH, Nitrogen, Phosphorus, Grazing_mowing, Soil disturbance)</a></li>
<li><a class="active" href="trophic-level-biomass-ratios.html"><span class="header-section-number">7</span> Trophic level biomass ratios</a></li>
<li class="book-part">INDICATORS FROM THE ALPINE ASSESSMENT</li>
<li><a class="" href="areal-av-isbreer.html"><span class="header-section-number">8</span> Areal av isbreer</a></li>
<li class="book-part">DEPRECATED</li>
<li><a class="" href="areal-uten-d%C3%B8d-eller-skadet-r%C3%B8sslyng-i-kystlynghei.html"><span class="header-section-number">9</span> Areal uten død eller skadet røsslyng i kystlynghei</a></li>
<li class="book-part">GENERAL TOPICS</li>
<li><a class="" href="naturtype.html"><span class="header-section-number">10</span> Nature types</a></li>
<li><a class="" href="scaling-functions.html"><span class="header-section-number">11</span> Scaling functions</a></li>
<li><a class="" href="homogeneous-impact-areas.html"><span class="header-section-number">12</span> Homogeneous Impact Areas</a></li>
<li><a class="" href="master-grid.html"><span class="header-section-number">13</span> Master grid</a></li>
<li><a class="" href="climate-indicators-explained.html"><span class="header-section-number">14</span> Climate indicators explained</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/NINAnor/ecosystemCondition">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="trophic-level-biomass-ratios" class="section level1" number="7">
<h1>
<span class="header-section-number">7</span> Trophic level biomass ratios<a class="anchor" aria-label="anchor" href="#trophic-level-biomass-ratios"><i class="fas fa-link"></i></a>
</h1>
<p><br></p>
<p><em>Author and date:</em>
James Speed</p>
<p>June 2023</p>
<p><br></p>
<!-- Load all you dependencies here -->
<!-- Don't remove these three html lines -->
<br><br><hr>
<!-- Document you work below. Try not to change  the headers too much. Data can be stored on NINA server. Since the book is rendered on the R Server this works fine, but note that directory paths are different on the server compared to you local machine. If it is not too big you may store under /data/ on this repository --><div id="introduction-6" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-6"><i class="fas fa-link"></i></a>
</h2>
<p>Here we will develop indicators of ecological condition for Norway, based on the distribution of biomass between trophic levels - specifically between vegetation and vertebrate consumers. This includes three trophic levels, plants, herbivores and carnivores. Indicators of trophic interactions are based on deviation between the observed biomass at each consumer trophic level from the expected biomass based on the biomass at the prey trophic level. The expected biomass estimates are derived from global relationships between plants and vertebrate herbivores (<a href="https://doi.org/10.1111/1365-2664.14047">Fløjgaard et al. 2022</a>) and between vertebrate prey and predators (<a href="https://www.science.org/doi/pdf/10.1126/science.aac6284?casa_token=mM3vaCIMkpAAAAAA:bo4aODtkJORM0kIeFfezII4T_0wo7Y7X8ktWxI6vHN64sGmMw9Xi9xCc_g33c437swJaeTeiEE_N">Hatton et al 2015</a>)</p>
<p>As the plant biomass level we use Net Primary Productivity. MODIS NPP was selected since it provides the highest temporal extent of available data sources (1999 to present). Spatial resolution is low relative to other remote sensing sources, however, the spatial resolution is still far higher than the consumer data, so the temporal extent was prioritised.</p>
<p>The herbivore data is an extension of the data presented in Austrheim et al. 2008 <a href="https://onlinelibrary.wiley.com/doi/pdf/10.2981/10-038" class="uri">https://onlinelibrary.wiley.com/doi/pdf/10.2981/10-038</a> and Speed et al. 2015 <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0217166" class="uri">https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0217166</a>. For the development of the trophic interaction indicators the same methods were applied to herbivore data going back to 1907 (contra 1949 in the two studies above). This data was extracted by Gunnar Austrheim (livestock) and Erling J. Solberg (wild cervids). In each dataset, the metabolic biomass and the raw biomass of a given species is provided for each year and municipality. The 2007 municipalities were used. The data were rasterized to the same grid as the NPP data.</p>
<p>Metabolic biomass measures were used in the previous studies on Norwegian herbivores cited above. However, for consistency with the global studies used to find predicted biomass, we use raw (unscaled) biomass here.</p>
<p>Herbivore species are wild herbivores: moose/elg, red deer/hjort, roe deer/rådyr, wild reindeer/villrein and livestock: cattle/storfe, sheep/sau, horses/hest, goats/geit and semi-domestic reindeer/tamrein</p>
<p>The carnivore data is taken from back-cast population modelling for the large carnivores in Norway (wolf/ulv, brown bear/bjørn, lynx/gaupe and wolverine/jerv). The data was based on hunting statistics, and was collated and modelled by Anna Sobocinski in a master thesis: <a href="https://ntnuopen.ntnu.no/ntnu-xmlui/handle/11250/3047580" class="uri">https://ntnuopen.ntnu.no/ntnu-xmlui/handle/11250/3047580</a> The thesis also presented metabolic biomass, but we use raw biomass to make the indicators. This data was also rasterized.</p>
<p>We calculate indicators (1) across all ecosystems and the total consumer communities (all localities and all herbivores and all carnivores) and (2) specific indicators for each main ecosystem type</p>
</div>
<div id="part-1-total-communities" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> Part 1: Total communities<a class="anchor" aria-label="anchor" href="#part-1-total-communities"><i class="fas fa-link"></i></a>
</h2>
<p>We start by calculation biomass ratios across all herbivores and carnivores, with no regard to the ecosystem type.</p>
<div class="sourceCode" id="cb242"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#NPP</span></span>
<span><span class="co">#Read in</span></span>
<span><span class="va">npprast</span><span class="op">&lt;-</span><span class="fu">rast</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">pData</span>,<span class="st">"/Trophic_levels/NPP.tiff"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">viltrast</span><span class="op">&lt;-</span><span class="fu">rast</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">pData</span>,<span class="st">"/Trophic_levels/Vilt_RawBiomass.tiff"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">livestockrast</span><span class="op">&lt;-</span><span class="fu">rast</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">pData</span>,<span class="st">"/Trophic_levels/Livestock_RawBiomass.tiff"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">carnivorerast</span><span class="op">&lt;-</span><span class="fu">rast</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">pData</span>,<span class="st">"/Trophic_levels/Carnivores_RawBiomass.tiff"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Vector of years we work with</span></span>
<span><span class="va">allyears_vect</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1907</span>,<span class="fl">1917</span>,<span class="fl">1929</span>,<span class="fl">1938</span>,<span class="fl">1949</span>,<span class="fl">1959</span>,<span class="fl">1969</span>,<span class="fl">1979</span>,<span class="fl">1989</span>,<span class="fl">1999</span>,<span class="fl">2009</span>,<span class="fl">2015</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Livestock data from 1939 and vilt from 1938</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">livestockrast</span><span class="op">)</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="fl">1939</span>,<span class="fl">1938</span>,<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">livestockrast</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">livestockrast</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "RawBiomassDensity_sau_1907"    </span></span>
<span><span class="co">#&gt;  [2] "RawBiomassDensity_sau_1917"    </span></span>
<span><span class="co">#&gt;  [3] "RawBiomassDensity_sau_1929"    </span></span>
<span><span class="co">#&gt;  [4] "RawBiomassDensity_sau_1938"    </span></span>
<span><span class="co">#&gt;  [5] "RawBiomassDensity_sau_1949"    </span></span>
<span><span class="co">#&gt;  [6] "RawBiomassDensity_sau_1959"    </span></span>
<span><span class="co">#&gt;  [7] "RawBiomassDensity_sau_1969"    </span></span>
<span><span class="co">#&gt;  [8] "RawBiomassDensity_sau_1979"    </span></span>
<span><span class="co">#&gt;  [9] "RawBiomassDensity_sau_1989"    </span></span>
<span><span class="co">#&gt; [10] "RawBiomassDensity_sau_1999"    </span></span>
<span><span class="co">#&gt; [11] "RawBiomassDensity_sau_2009"    </span></span>
<span><span class="co">#&gt; [12] "RawBiomassDensity_sau_2015"    </span></span>
<span><span class="co">#&gt; [13] "RawBiomassDensity_geit_1907"   </span></span>
<span><span class="co">#&gt; [14] "RawBiomassDensity_geit_1917"   </span></span>
<span><span class="co">#&gt; [15] "RawBiomassDensity_geit_1929"   </span></span>
<span><span class="co">#&gt; [16] "RawBiomassDensity_geit_1938"   </span></span>
<span><span class="co">#&gt; [17] "RawBiomassDensity_geit_1949"   </span></span>
<span><span class="co">#&gt; [18] "RawBiomassDensity_geit_1959"   </span></span>
<span><span class="co">#&gt; [19] "RawBiomassDensity_geit_1969"   </span></span>
<span><span class="co">#&gt; [20] "RawBiomassDensity_geit_1979"   </span></span>
<span><span class="co">#&gt; [21] "RawBiomassDensity_geit_1989"   </span></span>
<span><span class="co">#&gt; [22] "RawBiomassDensity_geit_1999"   </span></span>
<span><span class="co">#&gt; [23] "RawBiomassDensity_geit_2009"   </span></span>
<span><span class="co">#&gt; [24] "RawBiomassDensity_geit_2015"   </span></span>
<span><span class="co">#&gt; [25] "RawBiomassDensity_storf_1907"  </span></span>
<span><span class="co">#&gt; [26] "RawBiomassDensity_storf_1917"  </span></span>
<span><span class="co">#&gt; [27] "RawBiomassDensity_storf_1929"  </span></span>
<span><span class="co">#&gt; [28] "RawBiomassDensity_storf_1938"  </span></span>
<span><span class="co">#&gt; [29] "RawBiomassDensity_storf_1949"  </span></span>
<span><span class="co">#&gt; [30] "RawBiomassDensity_storf_1959"  </span></span>
<span><span class="co">#&gt; [31] "RawBiomassDensity_storf_1969"  </span></span>
<span><span class="co">#&gt; [32] "RawBiomassDensity_storf_1979"  </span></span>
<span><span class="co">#&gt; [33] "RawBiomassDensity_storf_1989"  </span></span>
<span><span class="co">#&gt; [34] "RawBiomassDensity_storf_1999"  </span></span>
<span><span class="co">#&gt; [35] "RawBiomassDensity_storf_2009"  </span></span>
<span><span class="co">#&gt; [36] "RawBiomassDensity_storf_2015"  </span></span>
<span><span class="co">#&gt; [37] "RawBiomassDensity_hest_1907"   </span></span>
<span><span class="co">#&gt; [38] "RawBiomassDensity_hest_1917"   </span></span>
<span><span class="co">#&gt; [39] "RawBiomassDensity_hest_1929"   </span></span>
<span><span class="co">#&gt; [40] "RawBiomassDensity_hest_1938"   </span></span>
<span><span class="co">#&gt; [41] "RawBiomassDensity_hest_1949"   </span></span>
<span><span class="co">#&gt; [42] "RawBiomassDensity_hest_1959"   </span></span>
<span><span class="co">#&gt; [43] "RawBiomassDensity_hest_1969"   </span></span>
<span><span class="co">#&gt; [44] "RawBiomassDensity_hest_1979"   </span></span>
<span><span class="co">#&gt; [45] "RawBiomassDensity_hest_1989"   </span></span>
<span><span class="co">#&gt; [46] "RawBiomassDensity_hest_1999"   </span></span>
<span><span class="co">#&gt; [47] "RawBiomassDensity_hest_2009"   </span></span>
<span><span class="co">#&gt; [48] "RawBiomassDensity_hest_2015"   </span></span>
<span><span class="co">#&gt; [49] "RawBiomassDensity_tamrein_1907"</span></span>
<span><span class="co">#&gt; [50] "RawBiomassDensity_tamrein_1917"</span></span>
<span><span class="co">#&gt; [51] "RawBiomassDensity_tamrein_1929"</span></span>
<span><span class="co">#&gt; [52] "RawBiomassDensity_tamrein_1938"</span></span>
<span><span class="co">#&gt; [53] "RawBiomassDensity_tamrein_1949"</span></span>
<span><span class="co">#&gt; [54] "RawBiomassDensity_tamrein_1959"</span></span>
<span><span class="co">#&gt; [55] "RawBiomassDensity_tamrein_1969"</span></span>
<span><span class="co">#&gt; [56] "RawBiomassDensity_tamrein_1979"</span></span>
<span><span class="co">#&gt; [57] "RawBiomassDensity_tamrein_1989"</span></span>
<span><span class="co">#&gt; [58] "RawBiomassDensity_tamrein_1999"</span></span>
<span><span class="co">#&gt; [59] "RawBiomassDensity_tamrein_2009"</span></span>
<span><span class="co">#&gt; [60] "RawBiomassDensity_tamrein_2015"</span></span>
<span><span class="co">#&gt; [61] "Livestock_Raw_1907"            </span></span>
<span><span class="co">#&gt; [62] "Livestock_Raw_1917"            </span></span>
<span><span class="co">#&gt; [63] "Livestock_Raw_1929"            </span></span>
<span><span class="co">#&gt; [64] "Livestock_Raw_1938"            </span></span>
<span><span class="co">#&gt; [65] "Livestock_Raw_1949"            </span></span>
<span><span class="co">#&gt; [66] "Livestock_Raw_1959"            </span></span>
<span><span class="co">#&gt; [67] "Livestock_Raw_1969"            </span></span>
<span><span class="co">#&gt; [68] "Livestock_Raw_1979"            </span></span>
<span><span class="co">#&gt; [69] "Livestock_Raw_1989"            </span></span>
<span><span class="co">#&gt; [70] "Livestock_Raw_1999"            </span></span>
<span><span class="co">#&gt; [71] "Livestock_Raw_2009"            </span></span>
<span><span class="co">#&gt; [72] "Livestock_Raw_2015"            </span></span>
<span><span class="co">#&gt; [73] "TotalHerbivoreBiomass_Raw_1907"</span></span>
<span><span class="co">#&gt; [74] "TotalHerbivoreBiomass_Raw_1917"</span></span>
<span><span class="co">#&gt; [75] "TotalHerbivoreBiomass_Raw_1929"</span></span>
<span><span class="co">#&gt; [76] "TotalHerbivoreBiomass_Raw_1938"</span></span>
<span><span class="co">#&gt; [77] "TotalHerbivoreBiomass_Raw_1949"</span></span>
<span><span class="co">#&gt; [78] "TotalHerbivoreBiomass_Raw_1959"</span></span>
<span><span class="co">#&gt; [79] "TotalHerbivoreBiomass_Raw_1969"</span></span>
<span><span class="co">#&gt; [80] "TotalHerbivoreBiomass_Raw_1979"</span></span>
<span><span class="co">#&gt; [81] "TotalHerbivoreBiomass_Raw_1989"</span></span>
<span><span class="co">#&gt; [82] "TotalHerbivoreBiomass_Raw_1999"</span></span>
<span><span class="co">#&gt; [83] "TotalHerbivoreBiomass_Raw_2009"</span></span>
<span><span class="co">#&gt; [84] "TotalHerbivoreBiomass_Raw_2015"</span></span>
<span></span>
<span><span class="co">#Norwegian counties to help plotting</span></span>
<span><span class="va">norcounty_shp</span><span class="op">&lt;-</span><span class="fu">st_read</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">pData</span>,<span class="st">"/Trophic_levels/"</span><span class="op">)</span>,<span class="st">"ViltdataCounty"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading layer `ViltdataCounty' from data source </span></span>
<span><span class="co">#&gt;   `/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/Trophic_levels' </span></span>
<span><span class="co">#&gt;   using driver `ESRI Shapefile'</span></span>
<span><span class="co">#&gt; Simple feature collection with 912 features and 8 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -76208 ymin: 6450245 xmax: 1114929 ymax: 7939986</span></span>
<span><span class="co">#&gt; Projected CRS: ETRS89 / UTM zone 33N</span></span>
<span><span class="co">#Simplify by county nr</span></span>
<span><span class="va">norcounty</span><span class="op">&lt;-</span><span class="va">norcounty_shp</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">FylkeNr</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu">st_union</span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p>Now we can plot the raw biomass data.</p>
<p>First NPP</p>
<div class="sourceCode" id="cb243"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Select relevant years for NPP</span></span>
<span><span class="va">npprast_yrs</span><span class="op">&lt;-</span><span class="va">npprast</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">npprast</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NPP_2000"</span>,<span class="st">"NPP_2009"</span>,<span class="st">"NPP_2015"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu">geom_sf</span><span class="op">(</span>data<span class="op">=</span><span class="va">norcounty</span>,fill<span class="op">=</span><span class="st">"white"</span>,lwd<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>         <span class="fu">geom_spatraster</span><span class="op">(</span>data<span class="op">=</span><span class="va">npprast_yrs</span><span class="op">)</span><span class="op">+</span><span class="fu">facet_grid</span><span class="op">(</span><span class="op">~</span><span class="va">lyr</span><span class="op">)</span><span class="op">+</span></span>
<span>         <span class="fu">scale_fill_continuous</span><span class="op">(</span>low<span class="op">=</span><span class="st">"lightgreen"</span>,high<span class="op">=</span><span class="st">"darkgreen"</span>,na.value<span class="op">=</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="st">'kgC km'</span><span class="op">^</span><span class="op">-</span><span class="fl">2</span><span class="op">~</span><span class="st">'year'</span><span class="op">^</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; SpatRaster resampled to ncells = 500703</span></span></code></pre></div>
<div class="inline-figure"><img src="trophic_levels-biomass_indicators_files/figure-html/Plotting%20basic%20data-1.png" width="672"></div>
<p>Next total herbivore biomass</p>
<div class="sourceCode" id="cb244"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Total herbivore biomass</span></span>
<span><span class="co">#For some reason need to read the raster in again</span></span>
<span><span class="va">livestockrast</span><span class="op">&lt;-</span><span class="fu">rast</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">pData</span>,<span class="st">"/Trophic_levels/Livestock_RawBiomass.tiff"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">totalherbivorebiomass</span><span class="op">&lt;-</span><span class="va">livestockrast</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">livestockrast</span><span class="op">)</span>,<span class="st">"_"</span><span class="op">)</span>,<span class="st">'['</span>,<span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="st">"TotalHerbivoreBiomass"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">totalherbivorebiomass</span><span class="op">)</span><span class="op">&lt;-</span><span class="va">allyears_vect</span></span>
<span><span class="va">totalherbivorebiomass</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 3378, 2701, 12  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 440.9985, 441.0127  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -76208, 1114929, 6450245, 7939986  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : +proj=utm +zone=33 +ellps=GRS80 +units=m +no_defs </span></span>
<span><span class="co">#&gt; source      : Livestock_RawBiomass.tiff </span></span>
<span><span class="co">#&gt; names       :     1907,     1917,     1929,     1938,        1949,        1959, ... </span></span>
<span><span class="co">#&gt; min values  :     0.00,     0.00,     0.00,     0.00,    36.40469,    37.53634, ... </span></span>
<span><span class="co">#&gt; max values  : 24068.81, 32279.18, 33138.37, 36387.98, 15082.97559, 22528.81055, ...</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu">geom_sf</span><span class="op">(</span>data<span class="op">=</span><span class="va">norcounty</span>,fill<span class="op">=</span><span class="st">"white"</span>,lwd<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_spatraster</span><span class="op">(</span>data<span class="op">=</span><span class="va">totalherbivorebiomass</span><span class="op">)</span><span class="op">+</span><span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">lyr</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_fill_continuous</span><span class="op">(</span>trans<span class="op">=</span><span class="st">'log10'</span>,low<span class="op">=</span><span class="st">"lightskyblue"</span>,high<span class="op">=</span><span class="st">"darkblue"</span>, na.value<span class="op">=</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="st">'Herbivore \nbiomass \nkg km'</span><span class="op">^</span><span class="op">-</span><span class="fl">2</span> <span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; SpatRaster resampled to ncells = 500703</span></span>
<span><span class="co">#&gt; Warning: Transformation introduced infinite values in discrete</span></span>
<span><span class="co">#&gt; y-axis</span></span></code></pre></div>
<div class="inline-figure"><img src="trophic_levels-biomass_indicators_files/figure-html/PlotTotalHerbivoreBiomass-1.png" width="672"></div>
<p>And finally total carnivore biomass</p>
<div class="sourceCode" id="cb245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">carnivorerast</span><span class="op">&lt;-</span><span class="fu">rast</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">pData</span>,<span class="st">"/Trophic_levels/Carnivores_RawBiomass.tiff"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">totalcarnivores</span><span class="op">&lt;-</span><span class="va">carnivorerast</span><span class="op">[[</span><span class="fl">49</span><span class="op">:</span><span class="fl">60</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu">geom_sf</span><span class="op">(</span>data<span class="op">=</span><span class="va">norcounty</span>,fill<span class="op">=</span><span class="st">"white"</span>,lwd<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_spatraster</span><span class="op">(</span>data<span class="op">=</span><span class="va">totalcarnivores</span><span class="op">)</span><span class="op">+</span><span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">lyr</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_fill_continuous</span><span class="op">(</span>low<span class="op">=</span><span class="st">'white'</span>,high<span class="op">=</span><span class="st">'red'</span>, na.value<span class="op">=</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="st">'Carnviore\nBiomass \nkg km'</span><span class="op">^</span><span class="op">-</span><span class="fl">2</span> <span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; SpatRaster resampled to ncells = 500703</span></span></code></pre></div>
<div class="inline-figure"><img src="trophic_levels-biomass_indicators_files/figure-html/Plot%20carnivore%20biomass-1.png" width="672"></div>
<p>Now we use the NPP to estimate the expected herbivore biomass Fløjgaard et al. 2015 Figure 1/Table 1 Global relationship (mean NPP1km)</p>
<div class="sourceCode" id="cb246"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># npprast&lt;-rast("Vertebrates/data/TrophicBiomassData/NPP.tiff")</span></span>
<span><span class="co"># npprast_yrs&lt;-npprast[[names(npprast)%in%c("NPP_2000","NPP_2009","NPP_2015")]]</span></span>
<span></span>
<span><span class="va">expected_herbivore_biomass</span><span class="op">&lt;-</span><span class="op">(</span><span class="va">npprast_yrs</span><span class="op">^</span><span class="fl">0.47</span> <span class="op">*</span> <span class="fl">0.643</span><span class="op">)</span><span class="co">#Global </span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu">geom_sf</span><span class="op">(</span>data<span class="op">=</span><span class="va">norcounty</span>,fill<span class="op">=</span><span class="st">"white"</span>,lwd<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Expected herbivore biomass"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_spatraster</span><span class="op">(</span>data<span class="op">=</span><span class="va">expected_herbivore_biomass</span><span class="op">)</span><span class="op">+</span><span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">lyr</span><span class="op">)</span><span class="op">+</span><span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_fill_continuous</span><span class="op">(</span>low<span class="op">=</span><span class="st">'lightskyblue'</span>,high<span class="op">=</span><span class="st">"darkblue"</span>,na.value<span class="op">=</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="st">'kg km'</span><span class="op">^</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; SpatRaster resampled to ncells = 500703</span></span></code></pre></div>
<div class="inline-figure"><img src="trophic_levels-biomass_indicators_files/figure-html/Calculating%20expected%20herbivore%20biomass-1.png" width="672"></div>
<div class="sourceCode" id="cb247"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#writeRaster(expected_herbivore_biomass,paste0(pData,"/Trophic_levels/expectedherbivorebiomass.tif"),overwrite=TRUE)</span></span></code></pre></div>
<p>Now we can calculate the deviation between the observed herbivore biomass and the expected herbivore biomass. We calculate this as a % change.</p>
<p>100 x (ActualBiomass – ExpectedBiomass)/(ExpectedBiomass +1)</p>
<p>To display this we truncated to 100%|-100%</p>
<p>A value of 0 indicates that the locality has expected biomass. Value of 100 indicates that the locality has 100% (or more) higher biomass than expected Value of -100 indicates that the locality has 100% (or more) lower biomass than expected</p>
<p>«Good» condition assumed to be 0 to |40%|</p>
<div class="sourceCode" id="cb248"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#expected_herbivore_biomass&lt;-rast("Vertebrates/outputs/expectedbiomass/expectedherbivorebiomass.tif")</span></span>
<span><span class="co">#livestockrast&lt;-rast("Vertebrates/data/TrophicBiomassData/Livestock_RawBiomass.tiff")</span></span>
<span></span>
<span><span class="va">totalherbivorebiomass</span><span class="op">&lt;-</span><span class="va">livestockrast</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">livestockrast</span><span class="op">)</span>,<span class="st">"_"</span><span class="op">)</span>,<span class="st">'['</span>,<span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="st">"TotalHerbivoreBiomass"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">totalherbivorebiomass</span><span class="op">)</span><span class="op">&lt;-</span><span class="va">allyears_vect</span></span>
<span><span class="va">totalherbivorebiomass_npp</span><span class="op">&lt;-</span><span class="va">totalherbivorebiomass</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">totalherbivorebiomass</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1999"</span>,<span class="st">"2009"</span>,<span class="st">"2015"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span> </span>
<span> <span class="va">diffherb</span><span class="op">&lt;-</span><span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="va">totalherbivorebiomass_npp</span><span class="op">-</span><span class="va">expected_herbivore_biomass</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">expected_herbivore_biomass</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">diffherb</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2000"</span>,<span class="st">'2009'</span>,<span class="st">'2015'</span><span class="op">)</span></span>
<span>   </span>
<span><span class="co"># #Plot on a diverging colour scale around 0</span></span>
<span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu">geom_sf</span><span class="op">(</span>data<span class="op">=</span><span class="va">norcounty</span>,fill<span class="op">=</span><span class="st">"white"</span>,lwd<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>   <span class="fu">geom_spatraster</span><span class="op">(</span>data<span class="op">=</span><span class="va">diffherb</span><span class="op">)</span><span class="op">+</span></span>
<span>   <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Difference from expected herbivore biomass"</span><span class="op">)</span><span class="op">+</span></span>
<span>   <span class="fu">scale_fill_distiller</span><span class="op">(</span>type<span class="op">=</span><span class="st">"div"</span>,limit<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>,<span class="fl">100</span><span class="op">)</span>,oob<span class="op">=</span><span class="va">squish</span>, na.value<span class="op">=</span><span class="cn">NA</span>,<span class="st">'% Difference from \nexpected biomass'</span><span class="op">)</span><span class="op">+</span></span>
<span>   <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">lyr</span><span class="op">)</span><span class="op">+</span><span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; SpatRaster resampled to ncells = 500703</span></span></code></pre></div>
<div class="inline-figure"><img src="trophic_levels-biomass_indicators_files/figure-html/DifferenceHerbivoreBiomass-1.png" width="672"></div>
<div class="sourceCode" id="cb249"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> </span>
<span><span class="co">#writeRaster(diffherb,paste0(pData,"/Trophic_levels/HerbivoreBiomassDiffExpected.tif"),overwrite=TRUE)</span></span></code></pre></div>
<p>Above we see that on the West coast, Trøndelag, Oppland have double herbivore biomass than expected. There is more herbivore biomass than expected in parts of Finnmark, while Nordland and Lierne have lower herbivore biomass than expected based on NPP. Vestfold &amp; Telemark (and parts of Viken) change from having more herbivore biomass than expected in 2000 to less than expected in 2015 (this is consistent with reduction in moose population in these regions)</p>
<p>– Next we move on to estimate the expected carnivore biomass based on observed herbivore biomass and calculate the deviation as a % difference from expected as for the herbivores. This is based on Hatton et al. 2015 Figure 1 (predator prey biomass relationships)</p>
<div class="sourceCode" id="cb250"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#livestockrast&lt;-rast(paste0(pData,"/Trophic_levels/Livestock_RawBiomass.tiff"))</span></span>
<span></span>
<span><span class="va">totalherbivorebiomass</span><span class="op">&lt;-</span><span class="va">livestockrast</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">livestockrast</span><span class="op">)</span>,<span class="st">"_"</span><span class="op">)</span>,<span class="st">'['</span>,<span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="st">"TotalHerbivoreBiomass"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">totalherbivorebiomass</span><span class="op">)</span><span class="op">&lt;-</span><span class="va">allyears_vect</span></span>
<span><span class="co">#carnivorerast&lt;-rast(paste0(pData,"/Trophic_levels/Carnivores_RawBiomass.tiff"))</span></span>
<span><span class="va">totalcarnivores</span><span class="op">&lt;-</span><span class="va">carnivorerast</span><span class="op">[[</span><span class="fl">49</span><span class="op">:</span><span class="fl">60</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co">#Expected carnivore biomass </span></span>
<span><span class="co">#Taken from Hatton et al. Figure 1</span></span>
<span><span class="va">expected_carnivore_biomass</span><span class="op">&lt;-</span><span class="op">(</span><span class="va">totalherbivorebiomass</span><span class="op">^</span><span class="fl">0.73</span><span class="op">)</span><span class="op">*</span><span class="fl">0.014</span><span class="co">#African carnivore and herbivore communities</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu">geom_spatraster</span><span class="op">(</span>data<span class="op">=</span><span class="va">expected_carnivore_biomass</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Expected carnivore biomass"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">lyr</span><span class="op">)</span><span class="op">+</span><span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_fill_continuous</span><span class="op">(</span>low<span class="op">=</span><span class="st">'lightskyblue'</span>,high<span class="op">=</span><span class="st">"darkblue"</span>,na.value<span class="op">=</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="st">'kg km'</span><span class="op">^</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span>,trans<span class="op">=</span><span class="st">'log10'</span><span class="op">)</span></span>
<span><span class="co">#&gt; SpatRaster resampled to ncells = 500703</span></span>
<span><span class="co">#&gt; Warning: Transformation introduced infinite values in discrete</span></span>
<span><span class="co">#&gt; y-axis</span></span></code></pre></div>
<div class="inline-figure"><img src="trophic_levels-biomass_indicators_files/figure-html/Expected%20carnivore%20biomass-1.png" width="672"></div>
<div class="sourceCode" id="cb251"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">diffcarn</span><span class="op">&lt;-</span><span class="fl">100</span><span class="op">*</span> <span class="op">(</span><span class="va">totalcarnivores</span><span class="op">-</span><span class="va">expected_carnivore_biomass</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">expected_carnivore_biomass</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">diffcarn</span><span class="op">)</span><span class="op">&lt;-</span><span class="va">allyears_vect</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu">geom_sf</span><span class="op">(</span>data<span class="op">=</span><span class="va">norcounty</span>,fill<span class="op">=</span><span class="st">"white"</span>,lwd<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_spatraster</span><span class="op">(</span>data<span class="op">=</span><span class="va">diffcarn</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">'Difference from expected carnivore biomass'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_fill_distiller</span><span class="op">(</span>type<span class="op">=</span><span class="st">"div"</span>,limit<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>,<span class="fl">100</span><span class="op">)</span>,oob<span class="op">=</span><span class="va">squish</span>,na.value<span class="op">=</span><span class="cn">NA</span>,<span class="st">"%difference from \nexpected biomass"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">lyr</span><span class="op">)</span><span class="op">+</span><span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; SpatRaster resampled to ncells = 500703</span></span></code></pre></div>
<div class="inline-figure"><img src="trophic_levels-biomass_indicators_files/figure-html/Expected%20carnivore%20biomass-2.png" width="672"></div>
<div class="sourceCode" id="cb252"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#writeRaster(expected_carnivore_biomass,paste0(pData,"/Trophic_levels/expectedcarnivorebiomass.tif"),overwrite=TRUE)</span></span>
<span></span>
<span><span class="co">#writeRaster(diffcarn,paste0(pData,"/Trophic_levels/CarnivoreBiomassDiffExpected.tif"),overwrite=TRUE)</span></span></code></pre></div>
<p>From the above we see that Norway has had less carnivore biomass than expected based on the available herbivore biomass across the time period. Some counties and time periods (e.g. Hedmark today and Finnmark in 1907 had about the same carnivore biomass as predicted.</p>
</div>
<div id="part-2---habitat-specific-biomass-distributions" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> Part 2 - Habitat specific biomass distributions<a class="anchor" aria-label="anchor" href="#part-2---habitat-specific-biomass-distributions"><i class="fas fa-link"></i></a>
</h2>
<p>We now create biomass ratios for specific habitat types. To do this we need an ecosystem map and to place each consumer species within each habitat.</p>
<p>Indicators were not developed for mire ecosystems. This decision was taken in conversation with the mire ecosystem group, on the basis that herbivores have minimum use of the mrie ecosystems.</p>
<p>Table of the consumer species associated with each habitat.</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="24%">
<col width="26%">
<col width="24%">
<col width="24%">
</colgroup>
<thead><tr class="header">
<th>Ecosystem</th>
<th>Livestock</th>
<th>Wild herbivores</th>
<th>Carnivores</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Forest</td>
<td>Storfe</td>
<td>Elg, rådyr, hjort</td>
<td>Ulv, gaupe, bjørn</td>
</tr>
<tr class="even">
<td>Alpine</td>
<td>Sau, tamrein, geit</td>
<td>Villrein</td>
<td>Jerv</td>
</tr>
<tr class="odd">
<td>Semi-naturlig mark</td>
<td>Sau, hest, geit, storfe</td>
<td>Hjort</td>
<td>Gaupe, ulv</td>
</tr>
<tr class="even">
<td>Naturlig åpne områder</td>
<td>Sau, geit, storfe</td>
<td>Hjort</td>
<td>Gaupe, ulv</td>
</tr>
<tr class="odd">
<td>Myr</td>
<td>---</td>
<td>---</td>
<td>---</td>
</tr>
</tbody>
</table></div>
<p>Since a suitable ecosystem map is still under development, we use the AR50 land-cover map as a place-holding solution. AR50 does not give a good representation of naturlig åpen områder or semi-naturlig mark, so we demonstrate the habitat specific biomass distributions using the forest class in AR50 and the species outlined above.</p>
<div class="sourceCode" id="cb253"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Forest</span></span>
<span><span class="co">#AR50 type raster</span></span>
<span><span class="va">artype50</span><span class="op">&lt;-</span><span class="fu">rast</span><span class="op">(</span><span class="st">"/data/R/GeoSpatialData/LandCover/Norway_LandResource_AR50/Processed/Raster/AR50_Norge.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#artype50&lt;-rast("Vertebrates/AR50/AR50_artype_25_ETRS_1989_UTM_Zone_33N.tif")</span></span>
<span></span>
<span><span class="co">#Reclassify</span></span>
<span><span class="va">artype50_F</span><span class="op">&lt;-</span><span class="va">artype50</span></span>
<span><span class="va">arTdf</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">50</span>,<span class="fl">60</span>,<span class="fl">70</span>,<span class="fl">81</span>,<span class="fl">82</span>,<span class="fl">128</span><span class="op">)</span>,label<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BuiltUp"</span>,<span class="st">"Pastures/Arable"</span>,<span class="st">"Forest"</span>,<span class="st">"Open"</span>,<span class="st">"Mires"</span>,<span class="st">"Ice"</span>,<span class="st">"Freshwater"</span>,<span class="st">"Sea"</span>,<span class="st">"Unmapped"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">artype50_F</span><span class="op">)</span><span class="op">&lt;-</span><span class="va">arTdf</span></span>
<span></span>
<span><span class="va">arcols</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="st">"orange"</span>,<span class="st">"darkgreen"</span>,<span class="st">"wheat"</span>,<span class="st">"lightblue"</span>,<span class="st">"white"</span>,<span class="st">"blue"</span>,<span class="st">"blue"</span>,<span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu">geom_spatraster</span><span class="op">(</span>data<span class="op">=</span><span class="va">artype50_F</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_fill_manual</span><span class="op">(</span>values<span class="op">=</span><span class="va">arcols</span>,na.value <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="co">#&gt; SpatRaster resampled to ncells = 501014</span></span></code></pre></div>
<div class="inline-figure"><img src="trophic_levels-biomass_indicators_files/figure-html/Habitat%20specific%20rasters-1.png" width="672"></div>
<div class="sourceCode" id="cb254"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="co">#Load biomass rasters</span></span>
<span><span class="co"># npprast&lt;-rast("Vertebrates/data/TrophicBiomassData/NPP.tiff")</span></span>
<span><span class="co"># viltrast&lt;-rast("Vertebrates/data/TrophicBiomassData/Vilt_RawBiomass.tiff")</span></span>
<span><span class="co"># livestockrast&lt;-rast("Vertebrates/data/TrophicBiomassData/Livestock_RawBiomass.tiff")</span></span>
<span><span class="co"># carnivorerast&lt;-rast("Vertebrates/data/TrophicBiomassData/Carnivores_RawBiomass.tiff")</span></span>
<span><span class="co"># expected_herbivore_biomass&lt;-rast("Vertebrates/outputs/expectedbiomass/expectedherbivorebiomass.tif")</span></span>
<span><span class="co"># expected_carnivore_biomass&lt;-rast("Vertebrates/outputs/expectedbiomass/expectedcarnivorebiomass.tif")</span></span>
<span></span>
<span><span class="co">#Project the AR50 to the NPP rasters</span></span>
<span></span>
<span><span class="co">### NEED TO CHECK IF THIS IS THE CORRECT LAYER OR GET THE CORRECT ONE FROM JAMES</span></span>
<span></span>
<span><span class="va">artype50_FR</span><span class="op">&lt;-</span><span class="fu">project</span><span class="op">(</span><span class="fu">resample</span><span class="op">(</span><span class="va">artype50_F</span>,<span class="va">npprast</span>,method<span class="op">=</span><span class="st">'near'</span><span class="op">)</span>,<span class="va">npprast</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Combine herbivores</span></span>
<span><span class="va">allherbivores</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">viltrast</span>,<span class="va">livestockrast</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Mask out forest from rasters</span></span>
<span><span class="va">forest_expected_herbivore_biomass</span><span class="op">&lt;-</span><span class="fu">mask</span><span class="op">(</span><span class="va">expected_herbivore_biomass</span>,<span class="va">artype50_FR</span>,maskvalues<span class="op">=</span><span class="fl">30</span>,inverse<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">forest_herbivores</span><span class="op">&lt;-</span><span class="fu">mask</span><span class="op">(</span><span class="va">allherbivores</span>,<span class="va">artype50_FR</span>,maskvalues<span class="op">=</span><span class="fl">30</span>,inverse<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">forest_carnivores</span><span class="op">&lt;-</span><span class="fu">mask</span><span class="op">(</span><span class="va">carnivorerast</span>,<span class="va">artype50_FR</span>,maskvalues<span class="op">=</span><span class="fl">30</span>,inverse<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">forest_expected_carnivore_biomass</span><span class="op">&lt;-</span><span class="fu">mask</span><span class="op">(</span><span class="va">expected_carnivore_biomass</span>,<span class="va">artype50_FR</span>,maskvalues<span class="op">=</span><span class="fl">30</span>,inverse<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Sum up selected forest herbivore species</span></span>
<span><span class="co">#Here we select the relevant herbivore species for the ecosystem type</span></span>
<span><span class="va">allyears_vect</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1907</span>,<span class="fl">1917</span>,<span class="fl">1929</span>,<span class="fl">1938</span>,<span class="fl">1949</span>,<span class="fl">1959</span>,<span class="fl">1969</span>,<span class="fl">1979</span>,<span class="fl">1989</span>,<span class="fl">1999</span>,<span class="fl">2009</span>,<span class="fl">2015</span><span class="op">)</span></span>
<span></span>
<span><span class="va">forest_herbivores_selectspp</span><span class="op">&lt;-</span><span class="fu">rast</span><span class="op">(</span><span class="va">forest_herbivores</span>,nlyrs<span class="op">=</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">allyears_vect</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="va">forest_herbivores_selectspp</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">forest_herbivores</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">forest_herbivores</span><span class="op">)</span>,<span class="st">"_"</span><span class="op">)</span>,<span class="st">'['</span>,<span class="fl">3</span><span class="op">)</span></span>
<span>                                                         <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">allyears_vect</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&amp;</span></span>
<span>                                      <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">forest_herbivores</span><span class="op">)</span>,<span class="st">"_"</span><span class="op">)</span>,<span class="st">'['</span>,<span class="fl">2</span><span class="op">)</span></span>
<span>                                                          <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"roe"</span>,<span class="st">"hjort"</span>,<span class="st">"elg"</span>,<span class="st">"storf"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="co">#&gt; [1] 7</span></span>
<span><span class="co">#&gt; [1] 8</span></span>
<span><span class="co">#&gt; [1] 9</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="co">#&gt; [1] 11</span></span>
<span><span class="co">#&gt; [1] 12</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">forest_herbivores_selectspp</span><span class="op">)</span><span class="op">&lt;-</span><span class="va">allyears_vect</span></span>
<span> </span>
<span> <span class="co">#Sum up selected forest carnivore species</span></span>
<span> <span class="co">#Here we select the relevant carnivore species for the habitat type</span></span>
<span> <span class="va">forest_carnivores_selectspp</span><span class="op">&lt;-</span><span class="fu">rast</span><span class="op">(</span><span class="va">forest_carnivores</span>,nlyrs<span class="op">=</span><span class="fl">12</span><span class="op">)</span></span>
<span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">allyears_vect</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>   <span class="va">forest_carnivores_selectspp</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">forest_carnivores</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">forest_carnivores</span><span class="op">)</span>,<span class="st">"_"</span><span class="op">)</span>,<span class="st">'['</span>,<span class="fl">3</span><span class="op">)</span> </span>
<span>                                                            <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">allyears_vect</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&amp;</span></span>
<span>                                                              <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">forest_carnivores</span><span class="op">)</span>,<span class="st">"_"</span><span class="op">)</span>,<span class="st">'['</span>,<span class="fl">2</span><span class="op">)</span></span>
<span>                                                            <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Wolf"</span>,<span class="st">"Lynx"</span>,<span class="st">"Bear"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span>   <span class="op">)</span></span>
<span> <span class="op">}</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="co">#&gt; [1] 7</span></span>
<span><span class="co">#&gt; [1] 8</span></span>
<span><span class="co">#&gt; [1] 9</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="co">#&gt; [1] 11</span></span>
<span><span class="co">#&gt; [1] 12</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">forest_carnivores_selectspp</span><span class="op">)</span><span class="op">&lt;-</span><span class="va">allyears_vect</span></span>
<span> </span>
<span> </span>
<span> <span class="co">#Difference in expected and actual biomass in forest</span></span>
<span> <span class="va">forest_herbivores_selectspp_nppyrs</span><span class="op">&lt;-</span><span class="va">forest_herbivores_selectspp</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">forest_herbivores_selectspp</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1999"</span>,<span class="st">"2009"</span>,<span class="st">"2015"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span> </span>
<span><span class="va">forest_diffherb</span><span class="op">&lt;-</span><span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="va">forest_herbivores_selectspp_nppyrs</span> <span class="op">-</span> <span class="va">forest_expected_herbivore_biomass</span><span class="op">)</span><span class="op">/</span></span>
<span> <span class="op">(</span><span class="va">forest_expected_herbivore_biomass</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#norcounty_shp&lt;-st_read("Vertebrates/data/Processed/","ViltdataCounty")</span></span>
<span> <span class="co">#Simplify by county nr</span></span>
<span><span class="va">norcounty</span><span class="op">&lt;-</span><span class="va">norcounty_shp</span> <span class="op">%&gt;%</span> </span>
<span>   <span class="fu">group_by</span><span class="op">(</span><span class="va">FylkeNr</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">summarise</span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu">st_union</span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span> </span>
<span> </span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu">geom_sf</span><span class="op">(</span>data<span class="op">=</span><span class="va">norcounty</span>,fill<span class="op">=</span><span class="st">"white"</span>,lwd<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>   <span class="fu">geom_spatraster</span><span class="op">(</span>data<span class="op">=</span><span class="va">forest_diffherb</span><span class="op">)</span><span class="op">+</span></span>
<span>   <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Difference in forest herbivores from expectation"</span><span class="op">)</span><span class="op">+</span></span>
<span>   <span class="fu">scale_fill_distiller</span><span class="op">(</span>type<span class="op">=</span><span class="st">"div"</span>,palette<span class="op">=</span><span class="st">'RdYlBu'</span>,limit<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>,<span class="fl">100</span><span class="op">)</span>,oob<span class="op">=</span><span class="va">squish</span>,na.value<span class="op">=</span><span class="cn">NA</span>, <span class="st">"% difference from \nexpected biomass"</span><span class="op">)</span><span class="op">+</span></span>
<span>   <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">lyr</span><span class="op">)</span><span class="op">+</span><span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; SpatRaster resampled to ncells = 500703</span></span></code></pre></div>
<div class="inline-figure"><img src="trophic_levels-biomass_indicators_files/figure-html/Habitat%20specific%20rasters-2.png" width="672"></div>
<div class="sourceCode" id="cb255"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> </span>
<span> </span>
<span><span class="va">forest_diffcarn</span><span class="op">&lt;-</span><span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="va">forest_carnivores_selectspp</span><span class="op">-</span><span class="va">forest_expected_carnivore_biomass</span><span class="op">)</span><span class="op">/</span></span>
<span>   <span class="op">(</span><span class="va">forest_expected_carnivore_biomass</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span> </span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu">geom_sf</span><span class="op">(</span>data<span class="op">=</span><span class="va">norcounty</span>,fill<span class="op">=</span><span class="st">"white"</span>,lwd<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>   <span class="fu">geom_spatraster</span><span class="op">(</span>data<span class="op">=</span><span class="va">forest_diffcarn</span><span class="op">)</span><span class="op">+</span></span>
<span>   <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Difference from expected carnivore biomass"</span><span class="op">)</span><span class="op">+</span></span>
<span>   <span class="fu">scale_fill_distiller</span><span class="op">(</span>type<span class="op">=</span><span class="st">"div"</span>,palette<span class="op">=</span><span class="st">'RdYlBu'</span>,limit<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>,<span class="fl">100</span><span class="op">)</span>,oob<span class="op">=</span><span class="va">squish</span>,na.value<span class="op">=</span><span class="cn">NA</span>,<span class="st">"% difference from\nexpected biomass"</span><span class="op">)</span><span class="op">+</span></span>
<span>   <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">lyr</span><span class="op">)</span><span class="op">+</span><span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; SpatRaster resampled to ncells = 500703</span></span></code></pre></div>
<div class="inline-figure"><img src="trophic_levels-biomass_indicators_files/figure-html/Habitat%20specific%20rasters-3.png" width="672"></div>
<div class="sourceCode" id="cb256"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> </span>
<span> </span>
<span> </span>
<span><span class="co"># #Scaling as indicators</span></span>
<span> </span>
<span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu">geom_sf</span><span class="op">(</span>data<span class="op">=</span><span class="va">norcounty</span>,fill<span class="op">=</span><span class="st">"white"</span>,lwd<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>   <span class="fu">geom_spatraster</span><span class="op">(</span>data<span class="op">=</span><span class="va">forest_diffherb</span><span class="op">)</span><span class="op">+</span></span>
<span>   <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Difference from expected herbivore biomass"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>colors<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"yellow"</span>,<span class="st">'yellow'</span> ,  <span class="st">"red"</span><span class="op">)</span>,</span>
<span>                       breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>,<span class="op">-</span><span class="fl">40</span>,<span class="fl">0</span>,<span class="fl">40</span>,<span class="fl">100</span><span class="op">)</span>,limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>,<span class="fl">100</span><span class="op">)</span>,na.value<span class="op">=</span><span class="cn">NA</span>,<span class="st">"% difference from\nexpected biomass"</span><span class="op">)</span><span class="op">+</span></span>
<span>   <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">lyr</span><span class="op">)</span><span class="op">+</span><span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; SpatRaster resampled to ncells = 500703</span></span></code></pre></div>
<div class="inline-figure"><img src="trophic_levels-biomass_indicators_files/figure-html/Habitat%20specific%20rasters-4.png" width="672"></div>
<div class="sourceCode" id="cb257"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> </span>
<span> </span>
<span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu">geom_sf</span><span class="op">(</span>data<span class="op">=</span><span class="va">norcounty</span>,fill<span class="op">=</span><span class="st">"white"</span>,lwd<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>   <span class="fu">geom_spatraster</span><span class="op">(</span>data<span class="op">=</span><span class="va">forest_diffcarn</span><span class="op">)</span><span class="op">+</span></span>
<span>   <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Difference from expected carnivore biomass"</span><span class="op">)</span><span class="op">+</span></span>
<span>   <span class="fu">scale_fill_gradientn</span><span class="op">(</span>colors<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"yellow"</span>,<span class="st">'yellow'</span> ,  <span class="st">"red"</span><span class="op">)</span>,</span>
<span>                     breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>,<span class="op">-</span><span class="fl">40</span>,<span class="fl">0</span>,<span class="fl">40</span>,<span class="fl">100</span><span class="op">)</span>,limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>,<span class="fl">100</span><span class="op">)</span>,na.value<span class="op">=</span><span class="cn">NA</span>,<span class="st">"% difference from\nexpected biomass"</span><span class="op">)</span><span class="op">+</span></span>
<span>   <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">lyr</span><span class="op">)</span><span class="op">+</span><span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; SpatRaster resampled to ncells = 500703</span></span></code></pre></div>
<div class="inline-figure"><img src="trophic_levels-biomass_indicators_files/figure-html/Habitat%20specific%20rasters-5.png" width="672"></div>
<div class="sourceCode" id="cb258"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> </span>
<span> <span class="co">#writeRaster(forest_diffcarn,paste0(pData,"/Trophic_levels/forest_carnivores_diffexpected.tif"),overwrite=TRUE)</span></span>
<span> <span class="co">#writeRaster(forest_diffherb,paste0(pData,"/Trophic_levels/forest_herbivores_diffexpected.tif"),overwrite=TRUE)</span></span></code></pre></div>
<p>In the above maps, yellow indicates good condition (within 40% of expected biomass between 60% and 140% of expected biomass). Blue indicates poor condition, with &gt;40% less biomass than expected (i.e. &lt;60% of expected biomass), while red indicates poor conditions with &gt;40% biomass than expected (i.e. &gt;140% of expected biomass).</p>
</div>
<div id="part-3-county-averages-over-time" class="section level2" number="7.4">
<h2>
<span class="header-section-number">7.4</span> Part 3 County averages over time<a class="anchor" aria-label="anchor" href="#part-3-county-averages-over-time"><i class="fas fa-link"></i></a>
</h2>
<p>Finally we summarise the biomass deviations by county over time. 0% deviation represents reference condition. The lines at 40% and -40% show the limits for good condition.</p>
<div class="sourceCode" id="cb259"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#forest_diffcarn&lt;-rast("Vertebrates/outputs/forest_carnivores_diffexpected.tif")</span></span>
<span><span class="co">#forest_diffherb&lt;-rast("Vertebrates/outputs/forest_herbivores_diffexpected.tif")</span></span>
<span></span>
<span><span class="co">#norcounty_shp&lt;-st_read("Vertebrates/data/Processed/","ViltdataCounty")</span></span>
<span> <span class="co">#Simplify by county nr</span></span>
<span><span class="va">norcounty</span><span class="op">&lt;-</span><span class="va">norcounty_shp</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">FylkeNr</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span> <span class="fu">summarise</span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu">st_union</span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">#County timegraphs</span></span>
<span><span class="co">#Make spatVect </span></span>
<span><span class="va">norcounty</span><span class="op">$</span><span class="va">CountyName</span><span class="op">&lt;-</span><span class="va">norcounty</span><span class="op">$</span><span class="va">FylkeNr</span></span>
<span><span class="co">#Provide names (some issues with encoding...)</span></span>
<span><span class="va">norcounty</span><span class="op">$</span><span class="va">CountyName</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"_stfold"</span>,<span class="st">"Akershus"</span>,<span class="st">"Oslo"</span>,<span class="st">"Hedmark"</span>,<span class="st">"Oppland"</span>,<span class="st">"Buskerud"</span>,<span class="st">"Vestfold"</span>,<span class="st">"Telemark"</span>,<span class="st">"Aust-Agder"</span>,<span class="st">"Vest-Agder"</span>,<span class="st">"Rogaland"</span>,<span class="st">"Hordaland"</span>,<span class="st">"Sogn og Fjordane"</span>,</span>
<span>                        <span class="st">"M_re og Romsdal"</span>,<span class="st">"S_r-Tr_ndelag"</span>,<span class="st">"Nord-Tr_ndelag"</span>,<span class="st">"Nordland"</span>,<span class="st">"Troms"</span>,<span class="st">"Finnmark"</span><span class="op">)</span></span>
<span><span class="va">norcounty_vect</span><span class="op">&lt;-</span><span class="fu">vect</span><span class="op">(</span><span class="va">norcounty</span><span class="op">)</span></span>
<span></span>
<span><span class="va">forest_carn_herb_county</span><span class="op">&lt;-</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/extract.html">extract</a></span><span class="op">(</span><span class="va">forest_diffcarn</span>,<span class="va">norcounty_vect</span>,<span class="va">mean</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">forest_carn_herb_county</span><span class="op">$</span><span class="va">ID</span><span class="op">&lt;-</span><span class="va">norcounty_vect</span><span class="op">$</span><span class="va">FylkeNr</span><span class="co">#Replace IDs with Fylke Nrs</span></span>
<span><span class="va">forest_carn_herb_county</span><span class="op">$</span><span class="va">CountyName</span><span class="op">&lt;-</span><span class="va">norcounty_vect</span><span class="op">$</span><span class="va">CountyName</span><span class="co">#Replace IDs with Fylke Nrs</span></span>
<span><span class="va">forest_carn_herb_countyDF</span><span class="op">&lt;-</span><span class="fu">gather</span><span class="op">(</span><span class="va">forest_carn_herb_county</span>,key<span class="op">=</span><span class="st">"Year"</span>,value<span class="op">=</span><span class="st">"Difference"</span>,<span class="op">-</span><span class="va">ID</span>,<span class="op">-</span><span class="va">CountyName</span><span class="op">)</span></span>
<span><span class="va">forest_carn_herb_countyDF</span><span class="op">$</span><span class="va">YearN</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">forest_carn_herb_countyDF</span><span class="op">$</span><span class="va">Year</span>,<span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data<span class="op">=</span><span class="va">forest_carn_herb_countyDF</span>,<span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">YearN</span>,y<span class="op">=</span><span class="va">Difference</span>,color<span class="op">=</span><span class="va">CountyName</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_color_discrete</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Forest: % Difference from expected carnivore biomass"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu">xlim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1905</span>,<span class="fl">2025</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu">geom_hline</span><span class="op">(</span>yintercept<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">40</span>,<span class="fl">0</span><span class="op">)</span>,lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span>data<span class="op">=</span><span class="va">forest_carn_herb_countyDF</span><span class="op">[</span><span class="va">forest_carn_herb_countyDF</span><span class="op">$</span><span class="va">YearN</span><span class="op">==</span><span class="fl">2015</span>,<span class="op">]</span>,<span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">CountyName</span>, x <span class="op">=</span> <span class="fl">2015</span>, y <span class="op">=</span> <span class="va">Difference</span><span class="op">)</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">.1</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Warning: Removed 228 rows containing missing values</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 19 rows containing missing values</span></span>
<span><span class="co">#&gt; (`geom_text()`).</span></span></code></pre></div>
<div class="inline-figure"><img src="trophic_levels-biomass_indicators_files/figure-html/CountySummaries-1.png" width="672"></div>
<div class="sourceCode" id="cb260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="va">forest_herb_veg_county</span><span class="op">&lt;-</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/extract.html">extract</a></span><span class="op">(</span><span class="va">forest_diffherb</span>,<span class="va">norcounty_vect</span>,<span class="va">mean</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">forest_herb_veg_county</span><span class="op">$</span><span class="va">ID</span><span class="op">&lt;-</span><span class="va">norcounty_vect</span><span class="op">$</span><span class="va">FylkeNr</span><span class="co">#Replace IDs with Fylke Nrs</span></span>
<span><span class="va">forest_herb_veg_county</span><span class="op">$</span><span class="va">CountyName</span><span class="op">&lt;-</span><span class="va">norcounty_vect</span><span class="op">$</span><span class="va">CountyName</span><span class="co">#Replace IDs with Fylke Nrs</span></span>
<span><span class="va">forest_herb_veg_countyDF</span><span class="op">&lt;-</span><span class="fu">gather</span><span class="op">(</span><span class="va">forest_herb_veg_county</span>,key<span class="op">=</span><span class="st">"Year"</span>,value<span class="op">=</span><span class="st">"Difference"</span>,<span class="op">-</span><span class="va">ID</span>,<span class="op">-</span><span class="va">CountyName</span><span class="op">)</span></span>
<span><span class="va">forest_herb_veg_countyDF</span><span class="op">$</span><span class="va">YearN</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">forest_herb_veg_countyDF</span><span class="op">$</span><span class="va">Year</span>,<span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data<span class="op">=</span><span class="va">forest_herb_veg_countyDF</span>,<span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">YearN</span>,y<span class="op">=</span><span class="va">Difference</span>,color<span class="op">=</span><span class="va">CountyName</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_color_discrete</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Forest: % Difference from expected herbivore biomass"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu">xlim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1999</span>,<span class="fl">2018</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu">geom_hline</span><span class="op">(</span>yintercept<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">40</span>,<span class="fl">0</span>,<span class="fl">40</span><span class="op">)</span>,lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span>data<span class="op">=</span><span class="va">forest_herb_veg_countyDF</span><span class="op">[</span><span class="va">forest_herb_veg_countyDF</span><span class="op">$</span><span class="va">YearN</span><span class="op">==</span><span class="fl">2015</span>,<span class="op">]</span>,<span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">CountyName</span>, x <span class="op">=</span> <span class="fl">2015</span>, y <span class="op">=</span> <span class="va">Difference</span><span class="op">)</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">.1</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Warning: Removed 57 rows containing missing values (`geom_line()`).</span></span>
<span><span class="co">#&gt; Removed 19 rows containing missing values (`geom_text()`).</span></span></code></pre></div>
<div class="inline-figure"><img src="trophic_levels-biomass_indicators_files/figure-html/CountySummaries-2.png" width="672"></div>

</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="Functional-plant-indicators-seminat.html"><span class="header-section-number">6</span> Functional plant indicators, semi-natural ecosystems (Light, Moisture, pH, Nitrogen, Phosphorus, Grazing_mowing, Soil disturbance)</a></div>
<div class="next"><a href="areal-av-isbreer.html"><span class="header-section-number">8</span> Areal av isbreer</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#trophic-level-biomass-ratios"><span class="header-section-number">7</span> Trophic level biomass ratios</a></li>
<li><a class="nav-link" href="#introduction-6"><span class="header-section-number">7.1</span> Introduction</a></li>
<li><a class="nav-link" href="#part-1-total-communities"><span class="header-section-number">7.2</span> Part 1: Total communities</a></li>
<li><a class="nav-link" href="#part-2---habitat-specific-biomass-distributions"><span class="header-section-number">7.3</span> Part 2 - Habitat specific biomass distributions</a></li>
<li><a class="nav-link" href="#part-3-county-averages-over-time"><span class="header-section-number">7.4</span> Part 3 County averages over time</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/NINAnor/ecosystemCondition/blob/master/trophic_levels-biomass_indicators.rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/NINAnor/ecosystemCondition/edit/master/trophic_levels-biomass_indicators.rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Indicators for Ecosystem Condition in Norway</strong>" was written by Anders L. Kolstad. It was last built on 2023-09-07.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
