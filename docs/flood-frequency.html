<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 11 Flood frequency | Indicators for Ecosystem Condition in Norway</title>
<meta name="author" content="Anders L. Kolstad">
<meta name="description" content="Norwegian name: Oversvømmelseshyppighet Author and date: Vegar Bakkestuen October 2023   .cl-80b3c2fc{table-layout:auto;}.cl-80acb7aa{font-family:'DejaVu...">
<meta name="generator" content="bookdown 0.33 with bs4_book()">
<meta property="og:title" content="Chapter 11 Flood frequency | Indicators for Ecosystem Condition in Norway">
<meta property="og:type" content="book">
<meta property="og:url" content="https://ninanor.github.io/ecosystemCondition/index.html/flood-frequency.html">
<meta property="og:image" content="https://ninanor.github.io/ecosystemCondition/index.html/images/Picture1.png">
<meta property="og:description" content="Norwegian name: Oversvømmelseshyppighet Author and date: Vegar Bakkestuen October 2023   .cl-80b3c2fc{table-layout:auto;}.cl-80acb7aa{font-family:'DejaVu...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 11 Flood frequency | Indicators for Ecosystem Condition in Norway">
<meta name="twitter:description" content="Norwegian name: Oversvømmelseshyppighet Author and date: Vegar Bakkestuen October 2023   .cl-80b3c2fc{table-layout:auto;}.cl-80acb7aa{font-family:'DejaVu...">
<meta name="twitter:image" content="https://ninanor.github.io/ecosystemCondition/index.html/images/Picture1.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.1.3/tabwid.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.27/datatables.js"></script><link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Indicators for Ecosystem Condition in Norway</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About </a></li>
<li class="book-part">INDICATORS</li>
<li><a class="" href="gjengroing.html"><span class="header-section-number">1</span> Enchroachment</a></li>
<li><a class="" href="nature-index-product.html"><span class="header-section-number">2</span> Nature index product</a></li>
<li><a class="" href="slitasje.html"><span class="header-section-number">3</span> Anthropogenic disturbance to soils and vegetation (ADSV)</a></li>
<li><a class="" href="median-summer-temp.html"><span class="header-section-number">4</span> Median Summer Temperature</a></li>
<li><a class="" href="alien-species.html"><span class="header-section-number">5</span> Alien species</a></li>
<li><a class="" href="functional-plant-indicators-wetland.html"><span class="header-section-number">6</span> Functional Plant Indicators - Wetlands</a></li>
<li><a class="" href="functional-plant-indicators-seminat.html"><span class="header-section-number">7</span> Functional Plant Indicators - Semi-Natural Ecosystems</a></li>
<li><a class="" href="functional-plant-indicators-open.html"><span class="header-section-number">8</span> Functional Plant Indicators - Naturally Open Ecosystems</a></li>
<li><a class="" href="trophic-level-biomass-ratios.html"><span class="header-section-number">9</span> Trophic level biomass ratios</a></li>
<li><a class="" href="insect-indicators.html"><span class="header-section-number">10</span> Insect indicators</a></li>
<li><a class="active" href="flood-frequency.html"><span class="header-section-number">11</span> Flood frequency</a></li>
<li class="book-part">R &amp; D</li>
<li><a class="" href="NDVI-indicator-natopen.html"><span class="header-section-number">12</span> NDVI - Naturally Open Ecosystems</a></li>
<li><a class="" href="NDVI-indicator-seminat.html"><span class="header-section-number">13</span> NDVI - Semi-natural Ecosystems</a></li>
<li><a class="" href="NDVI-indicator-wetland.html"><span class="header-section-number">14</span> NDVI - wetland ecosystems</a></li>
<li class="book-part">INDICATORS FROM THE ALPINE ASSESSMENT</li>
<li><a class="" href="areal-av-isbreer.html"><span class="header-section-number">15</span> Areal av isbreer</a></li>
<li class="book-part">DEPRECATED</li>
<li><a class="" href="areal-uten-d%C3%B8d-eller-skadet-r%C3%B8sslyng-i-kystlynghei.html"><span class="header-section-number">16</span> Areal uten død eller skadet røsslyng i kystlynghei</a></li>
<li class="book-part">GENERAL TOPICS</li>
<li><a class="" href="naturtype.html"><span class="header-section-number">17</span> Nature types</a></li>
<li><a class="" href="scaling-functions.html"><span class="header-section-number">18</span> Scaling functions</a></li>
<li><a class="" href="homogeneous-impact-areas.html"><span class="header-section-number">19</span> Homogeneous Impact Areas</a></li>
<li><a class="" href="master-grid.html"><span class="header-section-number">20</span> Master grid</a></li>
<li><a class="" href="climate-indicators-explained.html"><span class="header-section-number">21</span> Climate indicators explained</a></li>
<li><a class="" href="oversikt-over-indikatorforslag.html"><span class="header-section-number">22</span> Oversikt over indikatorforslag</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/NINAnor/ecosystemCondition">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="flood-frequency" class="section level1" number="11">
<h1>
<span class="header-section-number">11</span> Flood frequency<a class="anchor" aria-label="anchor" href="#flood-frequency"><i class="fas fa-link"></i></a>
</h1>
<p><br>
Norwegian name: <strong>Oversvømmelseshyppighet</strong>
<br></p>
<p><em>Author and date:</em></p>
<p>Vegar Bakkestuen</p>
<p>October 2023</p>
<p><br></p>
<!-- Load all you dependencies here -->
<!-- Fill in which ecosystem the indicator belongs to, as well as the ecosystem characteristic it should be linked to. It's OK to use some Norwegian here -->
<div class="tabwid">
<style>.cl-80b3c2fc{table-layout:auto;}.cl-80acb7aa{font-family:'DejaVu Sans';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-80acb7b4{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-80b010c6{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-80b02796{background-color:rgba(173, 216, 230, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-80b027a0{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<div class="inline-table"><table data-quarto-disable-processing="true" class="cl-80b3c2fc">
<thead><tr style="overflow-wrap:break-word;">
<th class="cl-80b02796"><p class="cl-80b010c6"><span class="cl-80acb7aa">Ecosystem</span></p></th>
<th class="cl-80b02796"><p class="cl-80b010c6"><span class="cl-80acb7aa">Økologisk egenskap</span></p></th>
<th class="cl-80b02796"><p class="cl-80b010c6"><span class="cl-80acb7aa">ECT class</span></p></th>
</tr></thead>
<tbody><tr style="overflow-wrap:break-word;">
<td class="cl-80b027a0"><p class="cl-80b010c6"><span class="cl-80acb7b4">Våtmark</span></p></td>
<td class="cl-80b027a0"><p class="cl-80b010c6"><span class="cl-80acb7b4">Abiotiske forhold</span></p></td>
<td class="cl-80b027a0"><p class="cl-80b010c6"><span class="cl-80acb7b4">A1 Physical state characteristics</span></p></td>
</tr></tbody>
</table></div>
</div>
<!-- Don't remove these three html lines -->
<br><br><hr>
<div class="figure">
<span style="display:block;" id="fig:ff-example"></span>
<img src="images/floodFreqExample.png" alt="Flood frequency last 5 years, somewhere in Norway. Light blue areas are flooded once, and dark blue areas are flooded five times." width="100%"><p class="caption">
Figure 11.1: Flood frequency last 5 years, somewhere in Norway. Light blue areas are flooded once, and dark blue areas are flooded five times.
</p>
</div>
<div id="intro-ff" class="section level2" number="11.1">
<h2>
<span class="header-section-number">11.1</span> Introduction<a class="anchor" aria-label="anchor" href="#intro-ff"><i class="fas fa-link"></i></a>
</h2>
<p>Water and inundated areas is a land cover class that can be relatively easily distinguished from other land cover classes with high accuracy using remote sensing data, particularly Copernicus Sentinel-1 data.
Sentinel-1 employs Synthetic Aperture Radar (SAR) instruments that can <em>see through</em> clouds.
In Norway, Sentinel-1 data is available at a minimum frequency of once a week.
Utilizing Google Earth Engine, all available Sentinel-1 data can be accessed, and there are pre-established scripts for distinguishing water-covered areas from other land cover classes.
For example, you can refer to “Flood Mapping and Area Calculation of Flood Extent Using Sentinel-I SAR Data in Google Earth Engine:</p>
<p>“the case of Super Typhoon Odette (Rai)”, and;</p>
<p>“Applying Google Earth Engine for flood mapping and monitoring in the downstream provinces of the Mekong river”.</p>
<p>By aggregating Sentinel-1 images over an entire growing season, it becomes possible to model when areas are covered by water.
This approach has been successfully used in various countries to map deltas and floodplains that are periodically submerged.
We aim to apply this methodology to the deltas and floodplains in Norway to assess the accuracy of this method in Norwegian conditions.
The code is developed in Java for Google Earth Engine and calculates flood frequency over a five-year period, which can be extended to ten years.
Reference states need to be defined both before and after flood events, which is accomplished by specifying pre- and post-flood dates.
You can determine these dates using hydrology scripts.
This script uses Sentinel-1 imagery in a change detection approach, comparing images before and after a flood event.
The key pre-processing steps for Sentinel-1 Ground Range Detected (GRD) data are thermal noise removal, radiometric calibration, and terrain correction.
Therefore, the primary pre-processing step is applying a speckle filter.
In this script, you can define your study area, select your desired time frame, and set SAR parameters.
Make sure to adjust these parameters according to your study area’s specific conditions.</p>
<p><strong>Workflow</strong>:</p>
<p>Calculate Flood Indicator Using Google Earth Engine Script</p>
<ol style="list-style-type: decimal">
<li>
<p>Initialization:</p>
<p>• Set up your Google Earth Engine environment.</p>
<p>• Import the necessary geometries or AOI.</p>
</li>
<li>
<p>Define Functions:</p>
<p>• Define a function for calculating flood extent and area based on the provided script. The function should take parameters like the year, polarization, and AOI.</p>
</li>
<li>
<p>Define Constants:</p>
<p>• Set constant values such as polarization, pass direction, smoothing radius, and difference threshold. Ensure these values are appropriate for your study area.</p>
</li>
<li>
<p>Define Years and Date Ranges:</p>
<p>• Create an array or list of years for which you want to calculate the flood indicator.</p>
<p>• Define the “before” and “after” date ranges for each year based on your specific study periods.</p>
</li>
<li>
<p>Loop Through Years:</p>
<p>• Use a loop to iterate through each year in your defined list.</p>
<p>• For each year, call the flood extent calculation function you defined, passing the appropriate parameters (e.g., SAR collections for “before” and “after,” polarization, AOI).</p>
</li>
<li>
<p>Calculate Flood Frequency:</p>
<p>• After calculating flood extent for each year, calculate the flood frequency. You can create a frequency count image by accumulating flood extent layers from each year.</p>
</li>
<li>
<p>Data Visualization:</p>
<p>• Define a color palette for displaying flood frequency on the map.</p>
<p>• Add the flood frequency layer to the map for visualization.</p>
<p>• Optionally, you can also display individual flood extents for each year.</p>
</li>
<li>
<p>Print Results:</p>
<p>• In the loop, after calculating flood extent for each year, print the calculated flood extent areas to the console for each year.</p>
</li>
<li>
<p>Data Export (Optional):</p>
<p>• If needed, you can export the results, such as the frequency map, for further analysis or reporting.</p>
</li>
<li>
<p>Fine-Tuning:</p>
<p>• As needed, adjust parameters in the script, such as smoothing radius, difference threshold, or additional data sources, to optimize the flood indicator calculation.</p>
</li>
<li>
<p>Interpretation:</p>
<p>• Analyze the results to understand the flood extent areas and frequencies for different years.</p>
</li>
</ol>
</div>
<div id="underlying-data-ff" class="section level2" number="11.2">
<h2>
<span class="header-section-number">11.2</span> About the underlying data<a class="anchor" aria-label="anchor" href="#underlying-data-ff"><i class="fas fa-link"></i></a>
</h2>
<p>The flood frequency indicator is derived from a time series of Sentinel-1 SAR data covering multiple years. The analysis involves the following steps:</p>
<ol style="list-style-type: decimal">
<li>Data Collection: Sentinel-1 GRD imagery, including the VH polarization, was used to create a comprehensive dataset. The data covered several years, enabling a temporal perspective on flood frequency.</li>
<li>Preprocessing: The data underwent preprocessing, including thermal-noise removal, radiometric calibration, and terrain correction, resulting in high-quality radar backscatter information. A speckle filter was applied for data refinement.</li>
<li>Flood Extent Calculation: Flood extents for each year were determined through a change detection approach, comparing “before” and “after” flood event images. The selected polarization, VH, was utilized to differentiate flooded areas.</li>
<li>Flood Frequency Mapping: The accumulated flood extents for different years were used to create a flood frequency map. This map illustrates the frequency of flooding events in the study area over the analyzed period.</li>
</ol>
<div id="rep-time-space-ff" class="section level3" number="11.2.1">
<h3>
<span class="header-section-number">11.2.1</span> Representativity in time and space<a class="anchor" aria-label="anchor" href="#rep-time-space-ff"><i class="fas fa-link"></i></a>
</h3>
<p>The analysis spans multiple years, offering a long-term view of flooding events in the study area. This extended time frame enables the identification of recurrent patterns and trends, which is vital for understanding wetland dynamics.</p>
</div>
<div id="original-units-5" class="section level3" number="11.2.2">
<h3>
<span class="header-section-number">11.2.2</span> Original units<a class="anchor" aria-label="anchor" href="#original-units-5"><i class="fas fa-link"></i></a>
</h3>
<p>The original units of the calculated flood extent area are in square meters.</p>
</div>
<div id="temporal-coverage-6" class="section level3" number="11.2.3">
<h3>
<span class="header-section-number">11.2.3</span> Temporal coverage<a class="anchor" aria-label="anchor" href="#temporal-coverage-6"><i class="fas fa-link"></i></a>
</h3>
<p>The data covers the last five years. It is possible to go back to 2015.</p>
</div>
<div id="aditional-comments-about-the-dataset-2" class="section level3" number="11.2.4">
<h3>
<span class="header-section-number">11.2.4</span> Aditional comments about the dataset<a class="anchor" aria-label="anchor" href="#aditional-comments-about-the-dataset-2"><i class="fas fa-link"></i></a>
</h3>
<p>Sentinel-1 data provides valuable information; however, its spatial and temporal resolution can affect the accuracy of flood extent mapping. In this analysis, a 10-meter spatial resolution was used, which means that smaller-scale features may not be fully captured. Additionally, Sentinel-1 data has a temporal revisit time, which may result in missed flood events or difficulties in distinguishing between different flood events that occurred close in time.</p>
</div>
</div>
<div id="ecosystem-characteristic-6" class="section level2" number="11.3">
<h2>
<span class="header-section-number">11.3</span> Ecosystem characteristic<a class="anchor" aria-label="anchor" href="#ecosystem-characteristic-6"><i class="fas fa-link"></i></a>
</h2>
<p>In the context of the Norwegian standard, the ‘Flood frequency’ indicator aligns with the ecosystem characteristic known as <em>Abiotiske forhold</em>.
Flood frequency is a crucial factor in understanding how changes in hydrology, including flood events, influence the composition and distribution of species within ecosystems.
It can also be instrumental in evaluating the resilience of ecosystems to such disturbances.</p>
<p>Furthermore, the indicator could also be relevant in the context of ‘funksjonelt viktige arter og strukturer,’ or ‘functionally important species and structures.’ Flood frequency plays a pivotal role in shaping the habitat availability and accessibility for species critical to ecosystem functioning. This includes species that are essential for nutrient cycling, species recruitment, and other key ecosystem functions. Frequent or infrequent flood events can have far-reaching consequences on the viability of these functionally important components of ecosystems.</p>
<p>Therefore, understanding and monitoring flood frequency not only serve as a hydrological metric but also have profound implications for ecosystem dynamics, which are vital for the overall health and sustainability of ecosystems. This integrated perspective highlights the interconnectedness of hydrological patterns and ecosystem characteristics, emphasizing the indicator’s significance in ecological and conservation assessments.</p>
<div id="seea-ea-un-standard-1" class="section level3" number="11.3.1">
<h3>
<span class="header-section-number">11.3.1</span> SEEA EA (UN standard)<a class="anchor" aria-label="anchor" href="#seea-ea-un-standard-1"><i class="fas fa-link"></i></a>
</h3>
<p>In the framework of the United Nations System of Environmental-Economic Accounting (SEEA EA), the “Flood frequency” indicator can be classified as a <em>Physical state characteristics</em>.</p>
</div>
</div>
<div id="collinearities-with-other-indicators-9" class="section level2" number="11.4">
<h2>
<span class="header-section-number">11.4</span> Collinearities with other indicators<a class="anchor" aria-label="anchor" href="#collinearities-with-other-indicators-9"><i class="fas fa-link"></i></a>
</h2>
<p>Flood frequency is not thought to exhibit collinearity with any other indicator at the present.</p>
</div>
<div id="reference-condition-and-values-5" class="section level2" number="11.5">
<h2>
<span class="header-section-number">11.5</span> Reference condition and values<a class="anchor" aria-label="anchor" href="#reference-condition-and-values-5"><i class="fas fa-link"></i></a>
</h2>
<div id="reference-condition-5" class="section level3" number="11.5.1">
<h3>
<span class="header-section-number">11.5.1</span> Reference condition<a class="anchor" aria-label="anchor" href="#reference-condition-5"><i class="fas fa-link"></i></a>
</h3>
<p>The reference condition is one where human activities that impact large scale hydrological patterns are minimal. The most important drivers of anthropogenic change are climate change, water regulation, draning and flood prevention and river channelization.</p>
</div>
<div id="reference-values-thresholds-for-defining-good-ecological-condition-minimum-andor-maximum-values-5" class="section level3" number="11.5.2">
<h3>
<span class="header-section-number">11.5.2</span> Reference values, thresholds for defining <em>good ecological condition</em>, minimum and/or maximum values<a class="anchor" aria-label="anchor" href="#reference-values-thresholds-for-defining-good-ecological-condition-minimum-andor-maximum-values-5"><i class="fas fa-link"></i></a>
</h3>
<p>Reference values are not yet developed for this indicator.
Note that the term reference level when used for this indicator sometime pertains to baseline hydrological conditions, and not a reference for the level of flood frequency under the reference condition.</p>
</div>
</div>
<div id="references-8" class="section level2" number="11.6">
<h2>
<span class="header-section-number">11.6</span> References<a class="anchor" aria-label="anchor" href="#references-8"><i class="fas fa-link"></i></a>
</h2>
</div>
<div id="analyses-3" class="section level2" number="11.7">
<h2>
<span class="header-section-number">11.7</span> Analyses<a class="anchor" aria-label="anchor" href="#analyses-3"><i class="fas fa-link"></i></a>
</h2>
<div id="nve-data" class="section level3" number="11.7.1">
<h3>
<span class="header-section-number">11.7.1</span> NVE data<a class="anchor" aria-label="anchor" href="#nve-data"><i class="fas fa-link"></i></a>
</h3>
<p>Innsynsløsning: <a href="https://nina.maps.arcgis.com/apps/instant/basic/index.html?appid=4344dd7f769048ed9dedf1803638ff48" class="uri">https://nina.maps.arcgis.com/apps/instant/basic/index.html?appid=4344dd7f769048ed9dedf1803638ff48</a></p>
<p>Baseline data for hydrological parameters, such as water level, water flow, and temperature, are crucial for assessing the ecological condition of aquatic ecosystems.
In the context of this analysis, we are planning to derive baseline values from extensive datasets collected by the Norwegian Water Resources and Energy Directorate (NVE) through its hydrological API (HydAPI).
NVE has been instrumental in gathering long-term hydrological data, with records dating back to the 1800s.
These historical measurements serve as a valuable baseline to evaluate contemporary conditions.</p>
<p>W Data Retrieval Solution - Python Code (get-observations-NINA.py):</p>
<p>This Python script (get-observations-NINA.py) serves as a data retrieval solution to access hydrological data from the Norwegian Water Resources and Energy Directorate’s (NVE) Hydrological API (HydAPI).
It is designed to fetch observational data and metadata for hydrological stations across Norway.
The script is versatile and allows users to specify parameters such as the station ID, observed parameters, resolution time, reference time, and a mandatory API key.</p>
<p>• Station ID (-s): Users can input one or multiple station IDs separated by a comma, allowing access to specific hydrological data from various locations.</p>
<p>• Parameters (-p): This parameter allows users to specify the type of observation data they need. Multiple parameters can be specified, enhancing flexibility.</p>
<p>• Resolution Time (-r): Users can select the resolution time, choosing between instantaneous (0), hourly (60), or daily (1440) data.</p>
<p>• API Key (-a): The API key is a mandatory component to authenticate and access the HydAPI data. Users need to register and obtain their API key from the HydAPI platform.</p>
<p>The script leverages Python’s request library to send HTTP requests to the HydAPI, and it retrieves data in JSON format.
It also provides the ability to define a reference time for data retrieval.
The retrieved data is written to a user-defined output file, facilitating further analysis and utilization.</p>
<p>Data Retrieval Procedure:</p>
<p>To retrieve data using the code:</p>
<ol style="list-style-type: decimal">
<li>Set Working Directory: Define the desired folder path, typically using the os.chdir() function, to ensure that the script operates in the intended directory.</li>
<li>Define the Command: Create a command as a list of strings, including the Python interpreter (python), the script name (get-observations-NINA.py), and the various parameters required for data retrieval (e.g., station, parameters, resolution time, and API key).</li>
<li>Execute the Command: Use subprocess.call() to execute the command, which triggers the Python script to fetch the requested data from the HydAPI.</li>
<li>Data Output: The retrieved data is written to a JSON file named according to the station, e.g., output_file = r’C:_xxx.json’.</li>
</ol>
<p>Script (in python)</p>
<p>Koden er skrevet i python og henter hydrologiske data fra NVE sin API. Skriptet heter get-observations-NINA.py. Den fungerer hvis man oppretter en mappe på <code>C:/</code> kalt <code>Konnektivetet/python</code> og legger scriptet der.</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb402-1"><a href="flood-frequency.html#cb402-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/python</span></span>
<span id="cb402-2"><a href="flood-frequency.html#cb402-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-3"><a href="flood-frequency.html#cb402-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> getopt</span>
<span id="cb402-4"><a href="flood-frequency.html#cb402-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb402-5"><a href="flood-frequency.html#cb402-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb402-6"><a href="flood-frequency.html#cb402-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-7"><a href="flood-frequency.html#cb402-7" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span><span class="op">:</span></span>
<span id="cb402-8"><a href="flood-frequency.html#cb402-8" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> urllib<span class="op">.</span><span class="at">request</span> <span class="im">import</span> Request<span class="op">,</span> urlopen  # Python <span class="dv">3</span></span>
<span id="cb402-9"><a href="flood-frequency.html#cb402-9" aria-hidden="true" tabindex="-1"></a>except ImportError<span class="op">:</span></span>
<span id="cb402-10"><a href="flood-frequency.html#cb402-10" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> urllib2 <span class="im">import</span> Request<span class="op">,</span> urlopen  # Python <span class="dv">2</span></span>
<span id="cb402-11"><a href="flood-frequency.html#cb402-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-12"><a href="flood-frequency.html#cb402-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-13"><a href="flood-frequency.html#cb402-13" aria-hidden="true" tabindex="-1"></a>def <span class="fu">usage</span>()<span class="op">:</span></span>
<span id="cb402-14"><a href="flood-frequency.html#cb402-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>()</span>
<span id="cb402-15"><a href="flood-frequency.html#cb402-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"Get observations from the NVE Hydrological API (HydAPI)"</span>)</span>
<span id="cb402-16"><a href="flood-frequency.html#cb402-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"Parameters:"</span>)</span>
<span id="cb402-17"><a href="flood-frequency.html#cb402-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"   -a: ApiKey (mandatory). "</span>)</span>
<span id="cb402-18"><a href="flood-frequency.html#cb402-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"   -s: StationId (mandatory). Several stations can be given separated by a comma. Example </span><span class="sc">\"</span><span class="st">6.10.0,12.209.0</span><span class="sc">\"</span><span class="st">"</span>)</span>
<span id="cb402-19"><a href="flood-frequency.html#cb402-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"   -p: Parameter (mandatory). Several Parameters can be given separated by a comma."</span>)</span>
<span id="cb402-20"><a href="flood-frequency.html#cb402-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"   -r: Resolution time. 0 (instantaneous), 60 (hourly), or 1440 (daily). (mandatory)"</span>)</span>
<span id="cb402-21"><a href="flood-frequency.html#cb402-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"   -t: Reference time. See documentation for reference time. Example </span><span class="sc">\"</span><span class="st">P1D/</span><span class="sc">\"</span><span class="st">, gives one day back in time. If none given, the last observed value will be returned"</span>)</span>
<span id="cb402-22"><a href="flood-frequency.html#cb402-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"   -h: This help"</span>)</span>
<span id="cb402-23"><a href="flood-frequency.html#cb402-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>()</span>
<span id="cb402-24"><a href="flood-frequency.html#cb402-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"Example:"</span>)</span>
<span id="cb402-25"><a href="flood-frequency.html#cb402-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"    python get-observations.py -a </span><span class="sc">\"</span><span class="st">INSERT_APIKEY_HERE</span><span class="sc">\"</span><span class="st"> -s </span><span class="sc">\"</span><span class="st">6.10.0,12.209.0</span><span class="sc">\"</span><span class="st"> -p </span><span class="sc">\"</span><span class="st">1000,1001</span><span class="sc">\"</span><span class="st"> -r 60 -t </span><span class="sc">\"</span><span class="st">P1D/</span><span class="sc">\"</span><span class="st">"</span>)</span>
<span id="cb402-26"><a href="flood-frequency.html#cb402-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>()</span>
<span id="cb402-27"><a href="flood-frequency.html#cb402-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-28"><a href="flood-frequency.html#cb402-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-29"><a href="flood-frequency.html#cb402-29" aria-hidden="true" tabindex="-1"></a>def <span class="fu">main</span>(argv)<span class="op">:</span></span>
<span id="cb402-30"><a href="flood-frequency.html#cb402-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span><span class="op">:</span></span>
<span id="cb402-31"><a href="flood-frequency.html#cb402-31" aria-hidden="true" tabindex="-1"></a>        opts<span class="op">,</span> args <span class="op">=</span> getopt<span class="op">.</span><span class="fu">getopt</span>(argv<span class="op">,</span> <span class="st">"a:s:p:r:ht:"</span>)</span>
<span id="cb402-32"><a href="flood-frequency.html#cb402-32" aria-hidden="true" tabindex="-1"></a>    except getopt<span class="op">.</span><span class="at">GetoptError</span> <span class="im">as</span> err<span class="op">:</span></span>
<span id="cb402-33"><a href="flood-frequency.html#cb402-33" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(<span class="fu">str</span>(err))  # will print something like <span class="st">"option -a not recognized"</span></span>
<span id="cb402-34"><a href="flood-frequency.html#cb402-34" aria-hidden="true" tabindex="-1"></a>        <span class="fu">usage</span>()</span>
<span id="cb402-35"><a href="flood-frequency.html#cb402-35" aria-hidden="true" tabindex="-1"></a>        sys<span class="op">.</span><span class="fu">exit</span>(<span class="dv">2</span>)</span>
<span id="cb402-36"><a href="flood-frequency.html#cb402-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-37"><a href="flood-frequency.html#cb402-37" aria-hidden="true" tabindex="-1"></a>    station <span class="op">=</span> None</span>
<span id="cb402-38"><a href="flood-frequency.html#cb402-38" aria-hidden="true" tabindex="-1"></a>    parameter <span class="op">=</span> None</span>
<span id="cb402-39"><a href="flood-frequency.html#cb402-39" aria-hidden="true" tabindex="-1"></a>    resolution_time <span class="op">=</span> None</span>
<span id="cb402-40"><a href="flood-frequency.html#cb402-40" aria-hidden="true" tabindex="-1"></a>    api_key <span class="op">=</span> None</span>
<span id="cb402-41"><a href="flood-frequency.html#cb402-41" aria-hidden="true" tabindex="-1"></a>    reference_time <span class="op">=</span> None</span>
<span id="cb402-42"><a href="flood-frequency.html#cb402-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-43"><a href="flood-frequency.html#cb402-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> opt<span class="op">,</span> arg <span class="kw">in</span> opts<span class="op">:</span></span>
<span id="cb402-44"><a href="flood-frequency.html#cb402-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> opt <span class="op">==</span> <span class="st">"-s"</span><span class="op">:</span></span>
<span id="cb402-45"><a href="flood-frequency.html#cb402-45" aria-hidden="true" tabindex="-1"></a>            station <span class="op">=</span> arg</span>
<span id="cb402-46"><a href="flood-frequency.html#cb402-46" aria-hidden="true" tabindex="-1"></a>        elif opt <span class="op">==</span> <span class="st">"-p"</span><span class="op">:</span></span>
<span id="cb402-47"><a href="flood-frequency.html#cb402-47" aria-hidden="true" tabindex="-1"></a>            parameter <span class="op">=</span> arg</span>
<span id="cb402-48"><a href="flood-frequency.html#cb402-48" aria-hidden="true" tabindex="-1"></a>        elif opt <span class="op">==</span> <span class="st">"-r"</span><span class="op">:</span></span>
<span id="cb402-49"><a href="flood-frequency.html#cb402-49" aria-hidden="true" tabindex="-1"></a>            resolution_time <span class="op">=</span> arg</span>
<span id="cb402-50"><a href="flood-frequency.html#cb402-50" aria-hidden="true" tabindex="-1"></a>        elif opt <span class="op">==</span> <span class="st">"-a"</span><span class="op">:</span></span>
<span id="cb402-51"><a href="flood-frequency.html#cb402-51" aria-hidden="true" tabindex="-1"></a>            api_key <span class="op">=</span> arg</span>
<span id="cb402-52"><a href="flood-frequency.html#cb402-52" aria-hidden="true" tabindex="-1"></a>        elif opt <span class="op">==</span> <span class="st">"-t"</span><span class="op">:</span></span>
<span id="cb402-53"><a href="flood-frequency.html#cb402-53" aria-hidden="true" tabindex="-1"></a>            reference_time <span class="op">=</span> arg</span>
<span id="cb402-54"><a href="flood-frequency.html#cb402-54" aria-hidden="true" tabindex="-1"></a>        elif opt <span class="op">==</span> <span class="st">"-h"</span><span class="op">:</span></span>
<span id="cb402-55"><a href="flood-frequency.html#cb402-55" aria-hidden="true" tabindex="-1"></a>            <span class="fu">usage</span>()</span>
<span id="cb402-56"><a href="flood-frequency.html#cb402-56" aria-hidden="true" tabindex="-1"></a>            sys<span class="op">.</span><span class="fu">exit</span>()</span>
<span id="cb402-57"><a href="flood-frequency.html#cb402-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span><span class="op">:</span></span>
<span id="cb402-58"><a href="flood-frequency.html#cb402-58" aria-hidden="true" tabindex="-1"></a>            assert False<span class="op">,</span> <span class="st">"unhandled option"</span></span>
<span id="cb402-59"><a href="flood-frequency.html#cb402-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-60"><a href="flood-frequency.html#cb402-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> api_key is None<span class="op">:</span></span>
<span id="cb402-61"><a href="flood-frequency.html#cb402-61" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(<span class="st">"Error: You must supply the API key with your request (-a)"</span>)</span>
<span id="cb402-62"><a href="flood-frequency.html#cb402-62" aria-hidden="true" tabindex="-1"></a>        <span class="fu">usage</span>()</span>
<span id="cb402-63"><a href="flood-frequency.html#cb402-63" aria-hidden="true" tabindex="-1"></a>        sys<span class="op">.</span><span class="fu">exit</span>(<span class="dv">2</span>)</span>
<span id="cb402-64"><a href="flood-frequency.html#cb402-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-65"><a href="flood-frequency.html#cb402-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> station is None or parameter is None or resolution_time is None<span class="op">:</span></span>
<span id="cb402-66"><a href="flood-frequency.html#cb402-66" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(<span class="st">"Error: You must supply the parameters station (-s), parameter (-p), and resolution time (-r)"</span>)</span>
<span id="cb402-67"><a href="flood-frequency.html#cb402-67" aria-hidden="true" tabindex="-1"></a>        <span class="fu">usage</span>()</span>
<span id="cb402-68"><a href="flood-frequency.html#cb402-68" aria-hidden="true" tabindex="-1"></a>        sys<span class="op">.</span><span class="fu">exit</span>(<span class="dv">2</span>)</span>
<span id="cb402-69"><a href="flood-frequency.html#cb402-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-70"><a href="flood-frequency.html#cb402-70" aria-hidden="true" tabindex="-1"></a>    baseurl <span class="op">=</span> <span class="st">"https://hydapi.nve.no/api/v1/Observations?StationId={station}&amp;Parameter={parameter}&amp;ResolutionTime={resolution_time}"</span></span>
<span id="cb402-71"><a href="flood-frequency.html#cb402-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-72"><a href="flood-frequency.html#cb402-72" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> baseurl<span class="op">.</span><span class="fu">format</span>(station<span class="op">=</span>station<span class="op">,</span> parameter<span class="op">=</span>parameter<span class="op">,</span> resolution_time<span class="op">=</span>resolution_time)</span>
<span id="cb402-73"><a href="flood-frequency.html#cb402-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-74"><a href="flood-frequency.html#cb402-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> reference_time is not None<span class="op">:</span></span>
<span id="cb402-75"><a href="flood-frequency.html#cb402-75" aria-hidden="true" tabindex="-1"></a>        url <span class="op">=</span> <span class="st">"{url}&amp;ReferenceTime={reference_time}"</span><span class="op">.</span><span class="fu">format</span>(url<span class="op">=</span>url<span class="op">,</span> reference_time<span class="op">=</span>reference_time)</span>
<span id="cb402-76"><a href="flood-frequency.html#cb402-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-77"><a href="flood-frequency.html#cb402-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(url)</span>
<span id="cb402-78"><a href="flood-frequency.html#cb402-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-79"><a href="flood-frequency.html#cb402-79" aria-hidden="true" tabindex="-1"></a>    request_headers <span class="op">=</span> {</span>
<span id="cb402-80"><a href="flood-frequency.html#cb402-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Accept"</span><span class="op">:</span> <span class="st">"application/json"</span><span class="op">,</span></span>
<span id="cb402-81"><a href="flood-frequency.html#cb402-81" aria-hidden="true" tabindex="-1"></a>        <span class="st">"X-API-Key"</span><span class="op">:</span> api_key</span>
<span id="cb402-82"><a href="flood-frequency.html#cb402-82" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb402-83"><a href="flood-frequency.html#cb402-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-84"><a href="flood-frequency.html#cb402-84" aria-hidden="true" tabindex="-1"></a>    request <span class="op">=</span> <span class="fu">Request</span>(url<span class="op">,</span> headers<span class="op">=</span>request_headers)</span>
<span id="cb402-85"><a href="flood-frequency.html#cb402-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-86"><a href="flood-frequency.html#cb402-86" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> <span class="fu">urlopen</span>(request)</span>
<span id="cb402-87"><a href="flood-frequency.html#cb402-87" aria-hidden="true" tabindex="-1"></a>    content <span class="op">=</span> response<span class="op">.</span><span class="fu">read</span>()<span class="op">.</span><span class="fu">decode</span>(<span class="st">'utf-8'</span>)</span>
<span id="cb402-88"><a href="flood-frequency.html#cb402-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-89"><a href="flood-frequency.html#cb402-89" aria-hidden="true" tabindex="-1"></a>    output_file <span class="op">=</span> r<span class="st">'C:</span><span class="sc">\K</span><span class="st">onnektivitet</span><span class="sc">\S</span><span class="st">tasjon_xxx.json'</span>  # Definerer stien til utdatafilen</span>
<span id="cb402-90"><a href="flood-frequency.html#cb402-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-91"><a href="flood-frequency.html#cb402-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="fu">open</span>(output_file<span class="op">,</span> <span class="st">'w'</span>) <span class="im">as</span> outfile<span class="op">:</span></span>
<span id="cb402-92"><a href="flood-frequency.html#cb402-92" aria-hidden="true" tabindex="-1"></a>        outfile<span class="op">.</span><span class="fu">write</span>(content)</span>
<span id="cb402-93"><a href="flood-frequency.html#cb402-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-94"><a href="flood-frequency.html#cb402-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(f<span class="st">"Data written to {output_file}"</span>)</span>
<span id="cb402-95"><a href="flood-frequency.html#cb402-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-96"><a href="flood-frequency.html#cb402-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-97"><a href="flood-frequency.html#cb402-97" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> __name__ <span class="op">==</span> <span class="st">"__main__"</span><span class="op">:</span></span>
<span id="cb402-98"><a href="flood-frequency.html#cb402-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">main</span>(sys<span class="op">.</span><span class="at">argv</span>[<span class="dv">1</span><span class="op">:</span>])</span></code></pre></div>
<script type="text/javascript">
#!/usr/bin/python

import getopt
import json
import sys

try:
    from urllib.request import Request, urlopen  # Python 3
except ImportError:
    from urllib2 import Request, urlopen  # Python 2


def usage():
    print()
    print("Get observations from the NVE Hydrological API (HydAPI)")
    print("Parameters:")
    print("   -a: ApiKey (mandatory). ")
    print("   -s: StationId (mandatory). Several stations can be given separated by a comma. Example \"6.10.0,12.209.0\"")
    print("   -p: Parameter (mandatory). Several Parameters can be given separated by a comma.")
    print("   -r: Resolution time. 0 (instantaneous), 60 (hourly), or 1440 (daily). (mandatory)")
    print("   -t: Reference time. See documentation for reference time. Example \"P1D/\", gives one day back in time. If none given, the last observed value will be returned")
    print("   -h: This help")
    print()
    print("Example:")
    print("    python get-observations.py -a \"INSERT_APIKEY_HERE\" -s \"6.10.0,12.209.0\" -p \"1000,1001\" -r 60 -t \"P1D/\"")
    print()


def main(argv):
    try:
        opts, args = getopt.getopt(argv, "a:s:p:r:ht:")
    except getopt.GetoptError as err:
        print(str(err))  # will print something like "option -a not recognized"
        usage()
        sys.exit(2)

    station = None
    parameter = None
    resolution_time = None
    api_key = None
    reference_time = None

    for opt, arg in opts:
        if opt == "-s":
            station = arg
        elif opt == "-p":
            parameter = arg
        elif opt == "-r":
            resolution_time = arg
        elif opt == "-a":
            api_key = arg
        elif opt == "-t":
            reference_time = arg
        elif opt == "-h":
            usage()
            sys.exit()
        else:
            assert False, "unhandled option"

    if api_key is None:
        print("Error: You must supply the API key with your request (-a)")
        usage()
        sys.exit(2)

    if station is None or parameter is None or resolution_time is None:
        print("Error: You must supply the parameters station (-s), parameter (-p), and resolution time (-r)")
        usage()
        sys.exit(2)

    baseurl = "https://hydapi.nve.no/api/v1/Observations?StationId={station}&Parameter={parameter}&ResolutionTime={resolution_time}"

    url = baseurl.format(station=station, parameter=parameter, resolution_time=resolution_time)

    if reference_time is not None:
        url = "{url}&ReferenceTime={reference_time}".format(url=url, reference_time=reference_time)

    print(url)

    request_headers = {
        "Accept": "application/json",
        "X-API-Key": api_key
    }

    request = Request(url, headers=request_headers)

    response = urlopen(request)
    content = response.read().decode('utf-8')

    output_file = r'C:\Konnektivitet\Stasjon_xxx.json'  # Definerer stien til utdatafilen

    with open(output_file, 'w') as outfile:
        outfile.write(content)

    print(f"Data written to {output_file}")


if __name__ == "__main__":
    main(sys.argv[1:])

</script><p>Dataene hentes ut ved å skrive inn følgende kommandoer i python vinduet:</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb403-1"><a href="flood-frequency.html#cb403-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb403-2"><a href="flood-frequency.html#cb403-2" aria-hidden="true" tabindex="-1"></a>#Angi banen til den ønskede mappen</span>
<span id="cb403-3"><a href="flood-frequency.html#cb403-3" aria-hidden="true" tabindex="-1"></a>ny_mappe <span class="op">=</span> r<span class="st">'C:</span><span class="sc">\K</span><span class="st">onnektivitet</span><span class="sc">\p</span><span class="st">ython'</span></span>
<span id="cb403-4"><a href="flood-frequency.html#cb403-4" aria-hidden="true" tabindex="-1"></a>Endre den aktive mappen til den nye mappen</span>
<span id="cb403-5"><a href="flood-frequency.html#cb403-5" aria-hidden="true" tabindex="-1"></a>os<span class="op">.</span><span class="fu">chdir</span>(ny_mappe)</span>
<span id="cb403-6"><a href="flood-frequency.html#cb403-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb403-7"><a href="flood-frequency.html#cb403-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb403-8"><a href="flood-frequency.html#cb403-8" aria-hidden="true" tabindex="-1"></a># Definer kommandoen som en liste av strenger</span>
<span id="cb403-9"><a href="flood-frequency.html#cb403-9" aria-hidden="true" tabindex="-1"></a>kommando <span class="op">=</span> [</span>
<span id="cb403-10"><a href="flood-frequency.html#cb403-10" aria-hidden="true" tabindex="-1"></a>     <span class="st">'python'</span><span class="op">,</span>                # Dette er kommandoen du vil <span class="fu">kjøre</span> (Python)</span>
<span id="cb403-11"><a href="flood-frequency.html#cb403-11" aria-hidden="true" tabindex="-1"></a>     <span class="st">'get-observations-NINA.py'</span><span class="op">,</span>   # Dette er navnet på Python<span class="op">-</span>skriptet du vil kjøre</span>
<span id="cb403-12"><a href="flood-frequency.html#cb403-12" aria-hidden="true" tabindex="-1"></a>     <span class="st">'-a'</span><span class="op">,</span> <span class="st">'4B2BQZYxbEiommYw8YCB8w=='</span><span class="op">,</span> # Mulig alle må lage sin egen API key<span class="op">:</span> hydapi<span class="op">.</span><span class="at">nve</span><span class="op">.</span><span class="at">no</span><span class="op">/</span>Users</span>
<span id="cb403-13"><a href="flood-frequency.html#cb403-13" aria-hidden="true" tabindex="-1"></a>     <span class="st">'-s'</span><span class="op">,</span> <span class="st">'12.209.0'</span><span class="op">,</span> # Dette er stasjonsnummer som kan hentes fra NINA <span class="fu">innsynsløsning</span> (se under)<span class="op">.</span></span>
<span id="cb403-14"><a href="flood-frequency.html#cb403-14" aria-hidden="true" tabindex="-1"></a>     <span class="st">'-p'</span><span class="op">,</span> <span class="st">'1000'</span><span class="op">,</span> # spesifikk type observasjon – se hydapi<span class="op">.</span><span class="at">nve</span><span class="op">.</span><span class="at">no</span><span class="op">/</span>UserDocumentation<span class="op">/</span></span>
<span id="cb403-15"><a href="flood-frequency.html#cb403-15" aria-hidden="true" tabindex="-1"></a>     <span class="st">'-r'</span><span class="op">,</span> <span class="st">'60'</span><span class="op">,</span> # oppløsningstid<span class="op">.</span> <span class="dv">60</span> indikerer en times oppløsning</span>
<span id="cb403-16"><a href="flood-frequency.html#cb403-16" aria-hidden="true" tabindex="-1"></a>     <span class="st">'-t'</span><span class="op">,</span> <span class="st">'2018-01-01T10:00:00/2018-01-14T20:00:00'</span>  # Merk at timestamp er uten ekstra anførselstegn</span>
<span id="cb403-17"><a href="flood-frequency.html#cb403-17" aria-hidden="true" tabindex="-1"></a> ]</span>
<span id="cb403-18"><a href="flood-frequency.html#cb403-18" aria-hidden="true" tabindex="-1"></a>subprocess<span class="op">.</span><span class="fu">call</span>(kommando)</span></code></pre></div>
<script type="text/javascript">
import os
#Angi banen til den ønskede mappen
ny_mappe = r'C:\Konnektivitet\python'
Endre den aktive mappen til den nye mappen
os.chdir(ny_mappe)

import subprocess
# Definer kommandoen som en liste av strenger
kommando = [
     'python',                # Dette er kommandoen du vil kjøre (Python)
     'get-observations-NINA.py',   # Dette er navnet på Python-skriptet du vil kjøre
     '-a', '4B2BQZYxbEiommYw8YCB8w==', # Mulig alle må lage sin egen API key: hydapi.nve.no/Users
     '-s', '12.209.0', # Dette er stasjonsnummer som kan hentes fra NINA innsynsløsning (se under).
     '-p', '1000', # spesifikk type observasjon – se hydapi.nve.no/UserDocumentation/
     '-r', '60', # oppløsningstid. 60 indikerer en times oppløsning
     '-t', '2018-01-01T10:00:00/2018-01-14T20:00:00'  # Merk at timestamp er uten ekstra anførselstegn
 ]
subprocess.call(kommando)
</script><p>Sentinel-1 radar data can be affected by speckle noise, which appears as random variations in pixel values.
While speckle filtering was applied to reduce this noise, some level of uncertainty remains, particularly in areas with complex terrain.</p>
</div>
<div id="scaled-indicator-values" class="section level3" number="11.7.2">
<h3>
<span class="header-section-number">11.7.2</span> Scaled indicator values<a class="anchor" aria-label="anchor" href="#scaled-indicator-values"><i class="fas fa-link"></i></a>
</h3>
<p>The indicator is not scaled.</p>
</div>
<div id="uncertainty-1" class="section level3" number="11.7.3">
<h3>
<span class="header-section-number">11.7.3</span> Uncertainty<a class="anchor" aria-label="anchor" href="#uncertainty-1"><i class="fas fa-link"></i></a>
</h3>
<p>We have no measure for the uncertainty or errors assosiated with the estimated frequency of floods.</p>
</div>
</div>
<div id="java-code" class="section level2" number="11.8">
<h2>
<span class="header-section-number">11.8</span> JAVA code<a class="anchor" aria-label="anchor" href="#java-code"><i class="fas fa-link"></i></a>
</h2>
<p>You must run the whole code below. There is a maximum of 5000 wetland polygons for each export.</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb404-1"><a href="flood-frequency.html#cb404-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-2"><a href="flood-frequency.html#cb404-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*===========================================================================================</span></span>
<span id="cb404-3"><a href="flood-frequency.html#cb404-3" aria-hidden="true" tabindex="-1"></a><span class="co">                       SAR-FLOOD MAPPING USING A CHANGE DETECTION APPROACH</span></span>
<span id="cb404-4"><a href="flood-frequency.html#cb404-4" aria-hidden="true" tabindex="-1"></a><span class="co">  ===========================================================================================</span></span>
<span id="cb404-5"><a href="flood-frequency.html#cb404-5" aria-hidden="true" tabindex="-1"></a><span class="co">  This script uses Sentinel-1 SAR data to create a flood extent map. It employs a change </span></span>
<span id="cb404-6"><a href="flood-frequency.html#cb404-6" aria-hidden="true" tabindex="-1"></a><span class="co">  detection method, comparing before- and after-flood images. The script is designed to work </span></span>
<span id="cb404-7"><a href="flood-frequency.html#cb404-7" aria-hidden="true" tabindex="-1"></a><span class="co">  with Ground Range Detected (GRD) imagery, which undergoes preprocessing steps, including </span></span>
<span id="cb404-8"><a href="flood-frequency.html#cb404-8" aria-hidden="true" tabindex="-1"></a><span class="co">  Thermal-Noise Removal, Radiometric Calibration, and Terrain Correction. Therefore, only a </span></span>
<span id="cb404-9"><a href="flood-frequency.html#cb404-9" aria-hidden="true" tabindex="-1"></a><span class="co">  Speckle filter needs to be applied during preprocessing.</span></span>
<span id="cb404-10"><a href="flood-frequency.html#cb404-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-11"><a href="flood-frequency.html#cb404-11" aria-hidden="true" tabindex="-1"></a><span class="co">  ===========================================================================================</span></span>
<span id="cb404-12"><a href="flood-frequency.html#cb404-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-13"><a href="flood-frequency.html#cb404-13" aria-hidden="true" tabindex="-1"></a><span class="co">                                  SELECT YOUR OWN STUDY AREA</span></span>
<span id="cb404-14"><a href="flood-frequency.html#cb404-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-15"><a href="flood-frequency.html#cb404-15" aria-hidden="true" tabindex="-1"></a><span class="co">   Use the polygon tool in the top left corner of the map pane to outline your study area. </span></span>
<span id="cb404-16"><a href="flood-frequency.html#cb404-16" aria-hidden="true" tabindex="-1"></a><span class="co">   Single clicks add vertices, and double-clicking completes the polygon.</span></span>
<span id="cb404-17"><a href="flood-frequency.html#cb404-17" aria-hidden="true" tabindex="-1"></a><span class="co">   **</span><span class="al">CAUTION</span><span class="co">**: Under 'Geometry Imports' (top left in the map panel), uncheck the </span></span>
<span id="cb404-18"><a href="flood-frequency.html#cb404-18" aria-hidden="true" tabindex="-1"></a><span class="co">               geometry box to avoid obscuring the view of the imagery later.</span></span>
<span id="cb404-19"><a href="flood-frequency.html#cb404-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-20"><a href="flood-frequency.html#cb404-20" aria-hidden="true" tabindex="-1"></a><span class="co">  *******************************************************************************************</span></span>
<span id="cb404-21"><a href="flood-frequency.html#cb404-21" aria-hidden="true" tabindex="-1"></a><span class="co">                                       SET TIME FRAME</span></span>
<span id="cb404-22"><a href="flood-frequency.html#cb404-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-23"><a href="flood-frequency.html#cb404-23" aria-hidden="true" tabindex="-1"></a><span class="co">   Specify the start and end dates for a period BEFORE the flood event. Ensure that the </span></span>
<span id="cb404-24"><a href="flood-frequency.html#cb404-24" aria-hidden="true" tabindex="-1"></a><span class="co">   duration is sufficient for Sentinel-1 to acquire images (repetition rate = 6 days). </span></span>
<span id="cb404-25"><a href="flood-frequency.html#cb404-25" aria-hidden="true" tabindex="-1"></a><span class="co">   Adjust these parameters if the ImageCollections (see Console) are empty.</span></span>
<span id="cb404-26"><a href="flood-frequency.html#cb404-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-27"><a href="flood-frequency.html#cb404-27" aria-hidden="true" tabindex="-1"></a><span class="co">/********************************************************************************************</span></span>
<span id="cb404-28"><a href="flood-frequency.html#cb404-28" aria-hidden="true" tabindex="-1"></a><span class="co">                           SET SAR PARAMETERS (can be left default)*/</span></span>
<span id="cb404-29"><a href="flood-frequency.html#cb404-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-30"><a href="flood-frequency.html#cb404-30" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> polarization <span class="op">=</span> <span class="st">"VH"</span><span class="op">;</span> <span class="co">/* or 'VV' --&gt; VH is commonly preferred for flood mapping, but </span></span>
<span id="cb404-31"><a href="flood-frequency.html#cb404-31" aria-hidden="true" tabindex="-1"></a><span class="co">                           the choice may depend on your study area. You can choose 'VV' as </span></span>
<span id="cb404-32"><a href="flood-frequency.html#cb404-32" aria-hidden="true" tabindex="-1"></a><span class="co">                           well. */</span></span>
<span id="cb404-33"><a href="flood-frequency.html#cb404-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-34"><a href="flood-frequency.html#cb404-34" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> pass_direction <span class="op">=</span> <span class="st">"DESCENDING"</span><span class="op">;</span> <span class="co">/* or 'ASCENDING'. When comparing images, use only one </span></span>
<span id="cb404-35"><a href="flood-frequency.html#cb404-35" aria-hidden="true" tabindex="-1"></a><span class="co">                           pass direction. Consider changing this parameter if your image </span></span>
<span id="cb404-36"><a href="flood-frequency.html#cb404-36" aria-hidden="true" tabindex="-1"></a><span class="co">                           collection is empty. In some areas, more Ascending images exist </span></span>
<span id="cb404-37"><a href="flood-frequency.html#cb404-37" aria-hidden="true" tabindex="-1"></a><span class="co">                           than Descending, or vice versa. */</span></span>
<span id="cb404-38"><a href="flood-frequency.html#cb404-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-39"><a href="flood-frequency.html#cb404-39" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> difference_threshold <span class="op">=</span> <span class="fl">1.25</span><span class="op">;</span> <span class="co">/* Threshold applied to the difference image (after flood</span></span>
<span id="cb404-40"><a href="flood-frequency.html#cb404-40" aria-hidden="true" tabindex="-1"></a><span class="co">                           - before flood). The value is chosen through trial and error. </span></span>
<span id="cb404-41"><a href="flood-frequency.html#cb404-41" aria-hidden="true" tabindex="-1"></a><span class="co">                           If your flood extent result contains many false positives or </span></span>
<span id="cb404-42"><a href="flood-frequency.html#cb404-42" aria-hidden="true" tabindex="-1"></a><span class="co">                           negatives, consider adjusting it. */</span></span>
<span id="cb404-43"><a href="flood-frequency.html#cb404-43" aria-hidden="true" tabindex="-1"></a><span class="co">//var relative_orbit = 79; </span></span>
<span id="cb404-44"><a href="flood-frequency.html#cb404-44" aria-hidden="true" tabindex="-1"></a>                          <span class="co">/* If you know the relative orbit for your study area, you can </span></span>
<span id="cb404-45"><a href="flood-frequency.html#cb404-45" aria-hidden="true" tabindex="-1"></a><span class="co">                           filter your image collection by it here to avoid errors due to </span></span>
<span id="cb404-46"><a href="flood-frequency.html#cb404-46" aria-hidden="true" tabindex="-1"></a><span class="co">                           comparisons across different relative orbits. */</span></span>
<span id="cb404-47"><a href="flood-frequency.html#cb404-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-48"><a href="flood-frequency.html#cb404-48" aria-hidden="true" tabindex="-1"></a><span class="co">/********************************************************************************************</span></span>
<span id="cb404-49"><a href="flood-frequency.html#cb404-49" aria-hidden="true" tabindex="-1"></a><span class="co">  ----&gt;&gt;&gt; DO NOT EDIT THE SCRIPT PAST THIS POINT! (unless you know what you are doing) &lt;&lt;&lt;---</span></span>
<span id="cb404-50"><a href="flood-frequency.html#cb404-50" aria-hidden="true" tabindex="-1"></a><span class="co">  ------------------&gt;&gt;&gt; now hit the 'RUN' at the top of the script! &lt;&lt;&lt;-----------------------</span></span>
<span id="cb404-51"><a href="flood-frequency.html#cb404-51" aria-hidden="true" tabindex="-1"></a><span class="co">  -----&gt; The final flood product will be ready for download on the right (under tasks) &lt;-----</span></span>
<span id="cb404-52"><a href="flood-frequency.html#cb404-52" aria-hidden="true" tabindex="-1"></a><span class="co">  ******************************************************************************************/</span></span>
<span id="cb404-53"><a href="flood-frequency.html#cb404-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-54"><a href="flood-frequency.html#cb404-54" aria-hidden="true" tabindex="-1"></a><span class="co">//---------------------------------- Translating User Inputs ------------------------------//</span></span>
<span id="cb404-55"><a href="flood-frequency.html#cb404-55" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setCenter</span>(<span class="fl">9.98383</span><span class="op">,</span>  <span class="fl">60.95329</span><span class="op">,</span> <span class="dv">14</span>)<span class="op">;</span> <span class="co">// Sets the map center.</span></span>
<span id="cb404-56"><a href="flood-frequency.html#cb404-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-57"><a href="flood-frequency.html#cb404-57" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_start <span class="op">=</span> <span class="st">'2023-04-01'</span><span class="op">;</span></span>
<span id="cb404-58"><a href="flood-frequency.html#cb404-58" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_end <span class="op">=</span> <span class="st">'2023-07-01'</span><span class="op">;</span> </span>
<span id="cb404-59"><a href="flood-frequency.html#cb404-59" aria-hidden="true" tabindex="-1"></a><span class="co">// Define the start and end dates for the period before the flood.</span></span>
<span id="cb404-60"><a href="flood-frequency.html#cb404-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-61"><a href="flood-frequency.html#cb404-61" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_start <span class="op">=</span> <span class="st">'2023-08-01'</span><span class="op">;</span> </span>
<span id="cb404-62"><a href="flood-frequency.html#cb404-62" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_end <span class="op">=</span> <span class="st">'2023-08-25'</span><span class="op">;</span> </span>
<span id="cb404-63"><a href="flood-frequency.html#cb404-63" aria-hidden="true" tabindex="-1"></a><span class="co">// Define the start and end dates for the period after the flood.</span></span>
<span id="cb404-64"><a href="flood-frequency.html#cb404-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-65"><a href="flood-frequency.html#cb404-65" aria-hidden="true" tabindex="-1"></a><span class="co">//------------------------------- DATA SELECTION &amp; PREPROCESSING --------------------------//</span></span>
<span id="cb404-66"><a href="flood-frequency.html#cb404-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-67"><a href="flood-frequency.html#cb404-67" aria-hidden="true" tabindex="-1"></a><span class="co">// Rename the selected geometry feature </span></span>
<span id="cb404-68"><a href="flood-frequency.html#cb404-68" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> aoi <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(geometry)<span class="op">;</span></span>
<span id="cb404-69"><a href="flood-frequency.html#cb404-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-70"><a href="flood-frequency.html#cb404-70" aria-hidden="true" tabindex="-1"></a><span class="co">// Load and filter Sentinel-1 GRD data based on predefined parameters </span></span>
<span id="cb404-71"><a href="flood-frequency.html#cb404-71" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> collection <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">'COPERNICUS/S1_GRD'</span>)</span>
<span id="cb404-72"><a href="flood-frequency.html#cb404-72" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'instrumentMode'</span><span class="op">,</span> <span class="st">'IW'</span>))</span>
<span id="cb404-73"><a href="flood-frequency.html#cb404-73" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">listContains</span>(<span class="st">'transmitterReceiverPolarisation'</span><span class="op">,</span> polarization))</span>
<span id="cb404-74"><a href="flood-frequency.html#cb404-74" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'orbitProperties_pass'</span><span class="op">,</span> pass_direction)) </span>
<span id="cb404-75"><a href="flood-frequency.html#cb404-75" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'resolution_meters'</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb404-76"><a href="flood-frequency.html#cb404-76" aria-hidden="true" tabindex="-1"></a>  <span class="co">//.filter(ee.Filter.eq('relativeOrbitNumber_start', relative_orbit ))</span></span>
<span id="cb404-77"><a href="flood-frequency.html#cb404-77" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filterBounds</span>(aoi)</span>
<span id="cb404-78"><a href="flood-frequency.html#cb404-78" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(polarization)<span class="op">;</span></span>
<span id="cb404-79"><a href="flood-frequency.html#cb404-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-80"><a href="flood-frequency.html#cb404-80" aria-hidden="true" tabindex="-1"></a><span class="co">// Select images based on predefined dates</span></span>
<span id="cb404-81"><a href="flood-frequency.html#cb404-81" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_collection <span class="op">=</span> collection<span class="op">.</span><span class="fu">filterDate</span>(before_start<span class="op">,</span> before_end)<span class="op">;</span></span>
<span id="cb404-82"><a href="flood-frequency.html#cb404-82" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_collection <span class="op">=</span> collection<span class="op">.</span><span class="fu">filterDate</span>(after_start<span class="op">,</span> after_end)<span class="op">;</span></span>
<span id="cb404-83"><a href="flood-frequency.html#cb404-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-84"><a href="flood-frequency.html#cb404-84" aria-hidden="true" tabindex="-1"></a><span class="co">// Print selected tiles to the console</span></span>
<span id="cb404-85"><a href="flood-frequency.html#cb404-85" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">dates</span>(imgcol) {</span>
<span id="cb404-86"><a href="flood-frequency.html#cb404-86" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> range <span class="op">=</span> imgcol<span class="op">.</span><span class="fu">reduceColumns</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">minMax</span>()<span class="op">,</span> [<span class="st">"system:time_start"</span>])<span class="op">;</span></span>
<span id="cb404-87"><a href="flood-frequency.html#cb404-87" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> printed <span class="op">=</span> ee<span class="op">.</span><span class="fu">String</span>(<span class="st">'from '</span>)</span>
<span id="cb404-88"><a href="flood-frequency.html#cb404-88" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">cat</span>(ee<span class="op">.</span><span class="fu">Date</span>(range<span class="op">.</span><span class="fu">get</span>(<span class="st">'min'</span>))<span class="op">.</span><span class="fu">format</span>(<span class="st">'YYYY-MM-dd'</span>))</span>
<span id="cb404-89"><a href="flood-frequency.html#cb404-89" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">cat</span>(<span class="st">' to '</span>)</span>
<span id="cb404-90"><a href="flood-frequency.html#cb404-90" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">cat</span>(ee<span class="op">.</span><span class="fu">Date</span>(range<span class="op">.</span><span class="fu">get</span>(<span class="st">'max'</span>))<span class="op">.</span><span class="fu">format</span>(<span class="st">'YYYY-MM-dd'</span>))<span class="op">;</span></span>
<span id="cb404-91"><a href="flood-frequency.html#cb404-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> printed<span class="op">;</span></span>
<span id="cb404-92"><a href="flood-frequency.html#cb404-92" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb404-93"><a href="flood-frequency.html#cb404-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-94"><a href="flood-frequency.html#cb404-94" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_count <span class="op">=</span> before_collection<span class="op">.</span><span class="fu">size</span>()<span class="op">;</span></span>
<span id="cb404-95"><a href="flood-frequency.html#cb404-95" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ee<span class="op">.</span><span class="fu">String</span>(<span class="st">'Tiles selected: Before Flood '</span>)<span class="op">.</span><span class="fu">cat</span>(<span class="st">'('</span>)<span class="op">.</span><span class="fu">cat</span>(before_count)<span class="op">.</span><span class="fu">cat</span>(<span class="st">')'</span>)<span class="op">,</span></span>
<span id="cb404-96"><a href="flood-frequency.html#cb404-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dates</span>(before_collection)<span class="op">,</span> before_collection)<span class="op">;</span></span>
<span id="cb404-97"><a href="flood-frequency.html#cb404-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-98"><a href="flood-frequency.html#cb404-98" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_count <span class="op">=</span> before_collection<span class="op">.</span><span class="fu">size</span>()<span class="op">;</span></span>
<span id="cb404-99"><a href="flood-frequency.html#cb404-99" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ee<span class="op">.</span><span class="fu">String</span>(<span class="st">'Tiles selected: After Flood '</span>)<span class="op">.</span><span class="fu">cat</span>(<span class="st">'('</span>)<span class="op">.</span><span class="fu">cat</span>(after_count)<span class="op">.</span><span class="fu">cat</span>(<span class="st">')'</span>)<span class="op">,</span></span>
<span id="cb404-100"><a href="flood-frequency.html#cb404-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dates</span>(after_collection)<span class="op">,</span> after_collection)<span class="op">;</span></span>
<span id="cb404-101"><a href="flood-frequency.html#cb404-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-102"><a href="flood-frequency.html#cb404-102" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a mosaic of selected tiles and clip to the study area</span></span>
<span id="cb404-103"><a href="flood-frequency.html#cb404-103" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before <span class="op">=</span> before_collection<span class="op">.</span><span class="fu">mosaic</span>()<span class="op">.</span><span class="fu">clip</span>(aoi)<span class="op">;</span></span>
<span id="cb404-104"><a href="flood-frequency.html#cb404-104" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after <span class="op">=</span> after_collection<span class="op">.</span><span class="fu">mosaic</span>()<span class="op">.</span><span class="fu">clip</span>(aoi)<span class="op">;</span></span>
<span id="cb404-105"><a href="flood-frequency.html#cb404-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-106"><a href="flood-frequency.html#cb404-106" aria-hidden="true" tabindex="-1"></a><span class="co">// Apply radar speckle reduction by smoothing  </span></span>
<span id="cb404-107"><a href="flood-frequency.html#cb404-107" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> smoothing_radius <span class="op">=</span> <span class="dv">50</span><span class="op">;</span></span>
<span id="cb404-108"><a href="flood-frequency.html#cb404-108" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_filtered <span class="op">=</span> before<span class="op">.</span><span class="fu">focal_mean</span>(smoothing_radius<span class="op">,</span> <span class="st">'circle'</span><span class="op">,</span> <span class="st">'meters'</span>)<span class="op">;</span></span>
<span id="cb404-109"><a href="flood-frequency.html#cb404-109" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_filtered <span class="op">=</span> after<span class="op">.</span><span class="fu">focal_mean</span>(smoothing_radius<span class="op">,</span> <span class="st">'circle'</span><span class="op">,</span> <span class="st">'meters'</span>)<span class="op">;</span></span>
<span id="cb404-110"><a href="flood-frequency.html#cb404-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-111"><a href="flood-frequency.html#cb404-111" aria-hidden="true" tabindex="-1"></a><span class="co">//------------------------------- FLOOD EXTENT CALCULATION -------------------------------//</span></span>
<span id="cb404-112"><a href="flood-frequency.html#cb404-112" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate the difference between the before and after images</span></span>
<span id="cb404-113"><a href="flood-frequency.html#cb404-113" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> difference <span class="op">=</span> after_filtered<span class="op">.</span><span class="fu">divide</span>(before_filtered)<span class="op">;</span></span>
<span id="cb404-114"><a href="flood-frequency.html#cb404-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-115"><a href="flood-frequency.html#cb404-115" aria-hidden="true" tabindex="-1"></a><span class="co">//Map.addLayer(difference, {}, 'Difference 2023', 1);</span></span>
<span id="cb404-116"><a href="flood-frequency.html#cb404-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-117"><a href="flood-frequency.html#cb404-117" aria-hidden="true" tabindex="-1"></a><span class="co">// Apply the predefined difference threshold to create the flood extent mask </span></span>
<span id="cb404-118"><a href="flood-frequency.html#cb404-118" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> threshold <span class="op">=</span> difference_threshold<span class="op">;</span></span>
<span id="cb404-119"><a href="flood-frequency.html#cb404-119" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> difference_binary <span class="op">=</span> difference<span class="op">.</span><span class="fu">gt</span>(threshold)<span class="op">;</span></span>
<span id="cb404-120"><a href="flood-frequency.html#cb404-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-121"><a href="flood-frequency.html#cb404-121" aria-hidden="true" tabindex="-1"></a><span class="co">// Refine the flood result using additional datasets</span></span>
<span id="cb404-122"><a href="flood-frequency.html#cb404-122" aria-hidden="true" tabindex="-1"></a><span class="co">// Include the JRC layer on surface water seasonality to mask flood pixels from areas</span></span>
<span id="cb404-123"><a href="flood-frequency.html#cb404-123" aria-hidden="true" tabindex="-1"></a><span class="co">// with "permanent" water (water &gt; 10 months of the year)</span></span>
<span id="cb404-124"><a href="flood-frequency.html#cb404-124" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> swater <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">'JRC/GSW1_0/GlobalSurfaceWater'</span>)<span class="op">.</span><span class="fu">select</span>(<span class="st">'seasonality'</span>)<span class="op">;</span></span>
<span id="cb404-125"><a href="flood-frequency.html#cb404-125" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> swater_mask <span class="op">=</span> swater<span class="op">.</span><span class="fu">gte</span>(<span class="dv">10</span>)<span class="op">.</span><span class="fu">updateMask</span>(swater<span class="op">.</span><span class="fu">gte</span>(<span class="dv">10</span>))<span class="op">;</span></span>
<span id="cb404-126"><a href="flood-frequency.html#cb404-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-127"><a href="flood-frequency.html#cb404-127" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a flooded mask where perennial water bodies (water &gt; 10 mo/yr) are assigned a 0 value</span></span>
<span id="cb404-128"><a href="flood-frequency.html#cb404-128" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flooded_mask <span class="op">=</span> difference_binary<span class="op">.</span><span class="fu">where</span>(swater_mask<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb404-129"><a href="flood-frequency.html#cb404-129" aria-hidden="true" tabindex="-1"></a><span class="co">// Create the final flooded area without pixels in perennial water bodies</span></span>
<span id="cb404-130"><a href="flood-frequency.html#cb404-130" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flooded <span class="op">=</span> flooded_mask<span class="op">.</span><span class="fu">updateMask</span>(flooded_mask)<span class="op">;</span></span>
<span id="cb404-131"><a href="flood-frequency.html#cb404-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-132"><a href="flood-frequency.html#cb404-132" aria-hidden="true" tabindex="-1"></a><span class="co">// Compute the connectivity of pixels to eliminate those connected to 8 or fewer neighbors</span></span>
<span id="cb404-133"><a href="flood-frequency.html#cb404-133" aria-hidden="true" tabindex="-1"></a><span class="co">// This operation reduces noise in the flood extent product</span></span>
<span id="cb404-134"><a href="flood-frequency.html#cb404-134" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> connections <span class="op">=</span> flooded<span class="op">.</span><span class="fu">connectedPixelCount</span>()<span class="op">;</span></span>
<span id="cb404-135"><a href="flood-frequency.html#cb404-135" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flooded <span class="op">=</span> flooded<span class="op">.</span><span class="fu">updateMask</span>(connections<span class="op">.</span><span class="fu">gte</span>(<span class="dv">8</span>))<span class="op">;</span></span>
<span id="cb404-136"><a href="flood-frequency.html#cb404-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-137"><a href="flood-frequency.html#cb404-137" aria-hidden="true" tabindex="-1"></a><span class="co">// Mask out areas with more than 5 percent slope using the Norwegian Digital Elevation Model</span></span>
<span id="cb404-138"><a href="flood-frequency.html#cb404-138" aria-hidden="true" tabindex="-1"></a><span class="co">//var DEM = ee.Image('WWF/HydroSHEDS/03VFDEM');</span></span>
<span id="cb404-139"><a href="flood-frequency.html#cb404-139" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> DEM <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">'users/vegar/dem_10m_kartverket'</span>)<span class="op">;</span></span>
<span id="cb404-140"><a href="flood-frequency.html#cb404-140" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> terrain <span class="op">=</span> ee<span class="op">.</span><span class="at">Algorithms</span><span class="op">.</span><span class="fu">Terrain</span>(DEM)<span class="op">;</span></span>
<span id="cb404-141"><a href="flood-frequency.html#cb404-141" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> slope <span class="op">=</span> terrain<span class="op">.</span><span class="fu">select</span>(<span class="st">'slope'</span>)<span class="op">;</span></span>
<span id="cb404-142"><a href="flood-frequency.html#cb404-142" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flooded <span class="op">=</span> flooded<span class="op">.</span><span class="fu">updateMask</span>(slope<span class="op">.</span><span class="fu">lt</span>(<span class="dv">5</span>))<span class="op">;</span></span>
<span id="cb404-143"><a href="flood-frequency.html#cb404-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-144"><a href="flood-frequency.html#cb404-144" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate flood extent area</span></span>
<span id="cb404-145"><a href="flood-frequency.html#cb404-145" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a raster layer containing the area information of each pixel </span></span>
<span id="cb404-146"><a href="flood-frequency.html#cb404-146" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flood_pixelarea <span class="op">=</span> flooded<span class="op">.</span><span class="fu">select</span>(polarization)</span>
<span id="cb404-147"><a href="flood-frequency.html#cb404-147" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">multiply</span>(ee<span class="op">.</span><span class="at">Image</span><span class="op">.</span><span class="fu">pixelArea</span>())<span class="op">;</span></span>
<span id="cb404-148"><a href="flood-frequency.html#cb404-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-149"><a href="flood-frequency.html#cb404-149" aria-hidden="true" tabindex="-1"></a><span class="co">// Sum the areas of flooded pixels</span></span>
<span id="cb404-150"><a href="flood-frequency.html#cb404-150" aria-hidden="true" tabindex="-1"></a><span class="co">// The default 'bestEffort' is set to true to reduce computation time; for a more </span></span>
<span id="cb404-151"><a href="flood-frequency.html#cb404-151" aria-hidden="true" tabindex="-1"></a><span class="co">// accurate result, set 'bestEffort' to false and increase 'maxPixels'. </span></span>
<span id="cb404-152"><a href="flood-frequency.html#cb404-152" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flood_stats <span class="op">=</span> flood_pixelarea<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb404-153"><a href="flood-frequency.html#cb404-153" aria-hidden="true" tabindex="-1"></a>  <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">sum</span>()<span class="op">,</span>              </span>
<span id="cb404-154"><a href="flood-frequency.html#cb404-154" aria-hidden="true" tabindex="-1"></a>  <span class="dt">geometry</span><span class="op">:</span> aoi<span class="op">,</span></span>
<span id="cb404-155"><a href="flood-frequency.html#cb404-155" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="co">// native resolution </span></span>
<span id="cb404-156"><a href="flood-frequency.html#cb404-156" aria-hidden="true" tabindex="-1"></a>  <span class="co">//maxPixels: 1e9,</span></span>
<span id="cb404-157"><a href="flood-frequency.html#cb404-157" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bestEffort</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb404-158"><a href="flood-frequency.html#cb404-158" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb404-159"><a href="flood-frequency.html#cb404-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-160"><a href="flood-frequency.html#cb404-160" aria-hidden="true" tabindex="-1"></a><span class="co">// Convert the flood extent to hectares (area calculations are originally given in meters)  </span></span>
<span id="cb404-161"><a href="flood-frequency.html#cb404-161" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flood_area_ha <span class="op">=</span> flood_stats</span>
<span id="cb404-162"><a href="flood-frequency.html#cb404-162" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">getNumber</span>(polarization)</span>
<span id="cb404-163"><a href="flood-frequency.html#cb404-163" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">divide</span>(<span class="dv">10000</span>)</span>
<span id="cb404-164"><a href="flood-frequency.html#cb404-164" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">round</span>()<span class="op">;</span></span>
<span id="cb404-165"><a href="flood-frequency.html#cb404-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-166"><a href="flood-frequency.html#cb404-166" aria-hidden="true" tabindex="-1"></a><span class="co">// Set visualization parameters</span></span>
<span id="cb404-167"><a href="flood-frequency.html#cb404-167" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> frequencyVis <span class="op">=</span> {</span>
<span id="cb404-168"><a href="flood-frequency.html#cb404-168" aria-hidden="true" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb404-169"><a href="flood-frequency.html#cb404-169" aria-hidden="true" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb404-170"><a href="flood-frequency.html#cb404-170" aria-hidden="true" tabindex="-1"></a>  <span class="dt">palette</span><span class="op">:</span> [<span class="st">'white'</span><span class="op">,</span> <span class="st">'lightblue'</span><span class="op">,</span> <span class="st">'mediumblue'</span><span class="op">,</span> <span class="st">'darkblue'</span><span class="op">,</span> <span class="st">'black'</span>]</span>
<span id="cb404-171"><a href="flood-frequency.html#cb404-171" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb404-172"><a href="flood-frequency.html#cb404-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-173"><a href="flood-frequency.html#cb404-173" aria-hidden="true" tabindex="-1"></a><span class="co">// Display flooded areas</span></span>
<span id="cb404-174"><a href="flood-frequency.html#cb404-174" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(flooded<span class="op">,</span> { <span class="dt">palette</span><span class="op">:</span> <span class="st">"0000FF"</span> }<span class="op">,</span> <span class="st">'Flooded areas Hans 2023'</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb404-175"><a href="flood-frequency.html#cb404-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-176"><a href="flood-frequency.html#cb404-176" aria-hidden="true" tabindex="-1"></a><span class="co">//----------------------------- Compare with the previous year 2022------------------------</span></span>
<span id="cb404-177"><a href="flood-frequency.html#cb404-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-178"><a href="flood-frequency.html#cb404-178" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_start2 <span class="op">=</span> <span class="st">'2022-04-01'</span><span class="op">;</span></span>
<span id="cb404-179"><a href="flood-frequency.html#cb404-179" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_end2 <span class="op">=</span> <span class="st">'2022-09-01'</span><span class="op">;</span></span>
<span id="cb404-180"><a href="flood-frequency.html#cb404-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-181"><a href="flood-frequency.html#cb404-181" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_start2 <span class="op">=</span> <span class="st">'2023-08-01'</span><span class="op">;</span> <span class="co">// Should match the reference state </span></span>
<span id="cb404-182"><a href="flood-frequency.html#cb404-182" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_end2 <span class="op">=</span> <span class="st">'2023-08-25'</span><span class="op">;</span> <span class="co">// Should match the reference state </span></span>
<span id="cb404-183"><a href="flood-frequency.html#cb404-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-184"><a href="flood-frequency.html#cb404-184" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_collection2 <span class="op">=</span> collection<span class="op">.</span><span class="fu">filterDate</span>(before_start2<span class="op">,</span> before_end2)<span class="op">;</span></span>
<span id="cb404-185"><a href="flood-frequency.html#cb404-185" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_collection2 <span class="op">=</span> collection<span class="op">.</span><span class="fu">filterDate</span>(after_start2<span class="op">,</span> after_end2)<span class="op">;</span></span>
<span id="cb404-186"><a href="flood-frequency.html#cb404-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-187"><a href="flood-frequency.html#cb404-187" aria-hidden="true" tabindex="-1"></a><span class="co">//----------------------------- Compare with the previous year 2022------------------------</span></span>
<span id="cb404-188"><a href="flood-frequency.html#cb404-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-189"><a href="flood-frequency.html#cb404-189" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_start2 <span class="op">=</span> <span class="st">'2022-04-01'</span><span class="op">;</span></span>
<span id="cb404-190"><a href="flood-frequency.html#cb404-190" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_end2 <span class="op">=</span> <span class="st">'2022-09-01'</span><span class="op">;</span></span>
<span id="cb404-191"><a href="flood-frequency.html#cb404-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-192"><a href="flood-frequency.html#cb404-192" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_start2 <span class="op">=</span> <span class="st">'2023-08-01'</span><span class="op">;</span> <span class="co">// Should match the reference state </span></span>
<span id="cb404-193"><a href="flood-frequency.html#cb404-193" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_end2 <span class="op">=</span> <span class="st">'2023-08-25'</span><span class="op">;</span> <span class="co">// Should match the reference state </span></span>
<span id="cb404-194"><a href="flood-frequency.html#cb404-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-195"><a href="flood-frequency.html#cb404-195" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_collection2 <span class="op">=</span> collection<span class="op">.</span><span class="fu">filterDate</span>(before_start2<span class="op">,</span> before_end2)<span class="op">;</span></span>
<span id="cb404-196"><a href="flood-frequency.html#cb404-196" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_collection2 <span class="op">=</span> collection<span class="op">.</span><span class="fu">filterDate</span>(after_start2<span class="op">,</span> after_end2)<span class="op">;</span></span>
<span id="cb404-197"><a href="flood-frequency.html#cb404-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-198"><a href="flood-frequency.html#cb404-198" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a mosaic of selected tiles and clip to the study area</span></span>
<span id="cb404-199"><a href="flood-frequency.html#cb404-199" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before2 <span class="op">=</span> before_collection2<span class="op">.</span><span class="fu">mosaic</span>()<span class="op">.</span><span class="fu">clip</span>(aoi)<span class="op">;</span></span>
<span id="cb404-200"><a href="flood-frequency.html#cb404-200" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after2 <span class="op">=</span> after_collection2<span class="op">.</span><span class="fu">mosaic</span>()<span class="op">.</span><span class="fu">clip</span>(aoi)<span class="op">;</span></span>
<span id="cb404-201"><a href="flood-frequency.html#cb404-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-202"><a href="flood-frequency.html#cb404-202" aria-hidden="true" tabindex="-1"></a><span class="co">// Apply radar speckle reduction by smoothing  </span></span>
<span id="cb404-203"><a href="flood-frequency.html#cb404-203" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> smoothing_radius <span class="op">=</span> <span class="dv">50</span><span class="op">;</span></span>
<span id="cb404-204"><a href="flood-frequency.html#cb404-204" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_filtered2 <span class="op">=</span> before2<span class="op">.</span><span class="fu">focal_mean</span>(smoothing_radius<span class="op">,</span> <span class="st">'circle'</span><span class="op">,</span> <span class="st">'meters'</span>)<span class="op">;</span></span>
<span id="cb404-205"><a href="flood-frequency.html#cb404-205" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_filtered2 <span class="op">=</span> after2<span class="op">.</span><span class="fu">focal_mean</span>(smoothing_radius<span class="op">,</span> <span class="st">'circle'</span><span class="op">,</span> <span class="st">'meters'</span>)<span class="op">;</span></span>
<span id="cb404-206"><a href="flood-frequency.html#cb404-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-207"><a href="flood-frequency.html#cb404-207" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate the difference between the before and after images</span></span>
<span id="cb404-208"><a href="flood-frequency.html#cb404-208" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> difference2 <span class="op">=</span> after_filtered2<span class="op">.</span><span class="fu">divide</span>(before_filtered2)<span class="op">;</span></span>
<span id="cb404-209"><a href="flood-frequency.html#cb404-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-210"><a href="flood-frequency.html#cb404-210" aria-hidden="true" tabindex="-1"></a><span class="co">// Apply the predefined difference-threshold and create the flood extent mask </span></span>
<span id="cb404-211"><a href="flood-frequency.html#cb404-211" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> threshold2 <span class="op">=</span> difference_threshold<span class="op">;</span></span>
<span id="cb404-212"><a href="flood-frequency.html#cb404-212" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> difference_binary2 <span class="op">=</span> difference2<span class="op">.</span><span class="fu">gt</span>(threshold2)<span class="op">;</span></span>
<span id="cb404-213"><a href="flood-frequency.html#cb404-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-214"><a href="flood-frequency.html#cb404-214" aria-hidden="true" tabindex="-1"></a><span class="co">// Refine the flood result using additional datasets</span></span>
<span id="cb404-215"><a href="flood-frequency.html#cb404-215" aria-hidden="true" tabindex="-1"></a><span class="co">// Include the JRC layer on surface water seasonality to mask flood pixels from areas</span></span>
<span id="cb404-216"><a href="flood-frequency.html#cb404-216" aria-hidden="true" tabindex="-1"></a><span class="co">// with "permanent" water (water &gt; 10 months of the year)</span></span>
<span id="cb404-217"><a href="flood-frequency.html#cb404-217" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> swater <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">'JRC/GSW1_0/GlobalSurfaceWater'</span>)<span class="op">.</span><span class="fu">select</span>(<span class="st">'seasonality'</span>)<span class="op">;</span></span>
<span id="cb404-218"><a href="flood-frequency.html#cb404-218" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> swater_mask <span class="op">=</span> swater<span class="op">.</span><span class="fu">gte</span>(<span class="dv">10</span>)<span class="op">.</span><span class="fu">updateMask</span>(swater<span class="op">.</span><span class="fu">gte</span>(<span class="dv">10</span>))<span class="op">;</span></span>
<span id="cb404-219"><a href="flood-frequency.html#cb404-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-220"><a href="flood-frequency.html#cb404-220" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a flooded mask where perennial water bodies (water &gt; 10 mo/yr) are assigned a 0 value</span></span>
<span id="cb404-221"><a href="flood-frequency.html#cb404-221" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flooded_mask2 <span class="op">=</span> difference_binary2<span class="op">.</span><span class="fu">where</span>(swater_mask<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb404-222"><a href="flood-frequency.html#cb404-222" aria-hidden="true" tabindex="-1"></a><span class="co">// Create the final flooded area without pixels in perennial water bodies</span></span>
<span id="cb404-223"><a href="flood-frequency.html#cb404-223" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flooded2 <span class="op">=</span> flooded_mask2<span class="op">.</span><span class="fu">updateMask</span>(flooded_mask2)<span class="op">;</span></span>
<span id="cb404-224"><a href="flood-frequency.html#cb404-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-225"><a href="flood-frequency.html#cb404-225" aria-hidden="true" tabindex="-1"></a><span class="co">// Compute the connectivity of pixels to eliminate those connected to 8 or fewer neighbors</span></span>
<span id="cb404-226"><a href="flood-frequency.html#cb404-226" aria-hidden="true" tabindex="-1"></a><span class="co">// This operation reduces noise in the flood extent product</span></span>
<span id="cb404-227"><a href="flood-frequency.html#cb404-227" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> connections2 <span class="op">=</span> flooded2<span class="op">.</span><span class="fu">connectedPixelCount</span>()<span class="op">;</span></span>
<span id="cb404-228"><a href="flood-frequency.html#cb404-228" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flooded2 <span class="op">=</span> flooded2<span class="op">.</span><span class="fu">updateMask</span>(connections2<span class="op">.</span><span class="fu">gte</span>(<span class="dv">8</span>))<span class="op">;</span></span>
<span id="cb404-229"><a href="flood-frequency.html#cb404-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-230"><a href="flood-frequency.html#cb404-230" aria-hidden="true" tabindex="-1"></a><span class="co">// Mask out areas with more than 5 percent slope using a Digital Elevation Model</span></span>
<span id="cb404-231"><a href="flood-frequency.html#cb404-231" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> DEM <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">'users/vegar/dem_10m_kartverket'</span>)<span class="op">;</span></span>
<span id="cb404-232"><a href="flood-frequency.html#cb404-232" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> terrain <span class="op">=</span> ee<span class="op">.</span><span class="at">Algorithms</span><span class="op">.</span><span class="fu">Terrain</span>(DEM)<span class="op">;</span></span>
<span id="cb404-233"><a href="flood-frequency.html#cb404-233" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> slope <span class="op">=</span> terrain<span class="op">.</span><span class="fu">select</span>(<span class="st">'slope'</span>)<span class="op">;</span></span>
<span id="cb404-234"><a href="flood-frequency.html#cb404-234" aria-hidden="true" tabindex="-1"></a>flooded2 <span class="op">=</span> flooded2<span class="op">.</span><span class="fu">updateMask</span>(slope<span class="op">.</span><span class="fu">lt</span>(<span class="dv">5</span>))<span class="op">;</span></span>
<span id="cb404-235"><a href="flood-frequency.html#cb404-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-236"><a href="flood-frequency.html#cb404-236" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate flood extent area</span></span>
<span id="cb404-237"><a href="flood-frequency.html#cb404-237" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a raster layer containing the area information of each pixel </span></span>
<span id="cb404-238"><a href="flood-frequency.html#cb404-238" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flood_pixelarea2 <span class="op">=</span> flooded2<span class="op">.</span><span class="fu">select</span>(polarization)</span>
<span id="cb404-239"><a href="flood-frequency.html#cb404-239" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">multiply</span>(ee<span class="op">.</span><span class="at">Image</span><span class="op">.</span><span class="fu">pixelArea</span>())<span class="op">;</span></span>
<span id="cb404-240"><a href="flood-frequency.html#cb404-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-241"><a href="flood-frequency.html#cb404-241" aria-hidden="true" tabindex="-1"></a><span class="co">// Sum the areas of flooded pixels</span></span>
<span id="cb404-242"><a href="flood-frequency.html#cb404-242" aria-hidden="true" tabindex="-1"></a><span class="co">// The default 'bestEffort' is set to true to reduce computation time; for a more </span></span>
<span id="cb404-243"><a href="flood-frequency.html#cb404-243" aria-hidden="true" tabindex="-1"></a><span class="co">// accurate result, set 'bestEffort' to false and increase 'maxPixels'. </span></span>
<span id="cb404-244"><a href="flood-frequency.html#cb404-244" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flood_stats2 <span class="op">=</span> flood_pixelarea2<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb404-245"><a href="flood-frequency.html#cb404-245" aria-hidden="true" tabindex="-1"></a>  <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">sum</span>()<span class="op">,</span>              </span>
<span id="cb404-246"><a href="flood-frequency.html#cb404-246" aria-hidden="true" tabindex="-1"></a>  <span class="dt">geometry</span><span class="op">:</span> aoi<span class="op">,</span></span>
<span id="cb404-247"><a href="flood-frequency.html#cb404-247" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="co">// native resolution </span></span>
<span id="cb404-248"><a href="flood-frequency.html#cb404-248" aria-hidden="true" tabindex="-1"></a>  <span class="co">//maxPixels: 1e9,</span></span>
<span id="cb404-249"><a href="flood-frequency.html#cb404-249" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bestEffort</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb404-250"><a href="flood-frequency.html#cb404-250" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb404-251"><a href="flood-frequency.html#cb404-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-252"><a href="flood-frequency.html#cb404-252" aria-hidden="true" tabindex="-1"></a><span class="co">// Convert the flood extent to hectares (area calculations are originally given in meters)  </span></span>
<span id="cb404-253"><a href="flood-frequency.html#cb404-253" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flood_area_ha2 <span class="op">=</span> flood_stats2</span>
<span id="cb404-254"><a href="flood-frequency.html#cb404-254" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">getNumber</span>(polarization)</span>
<span id="cb404-255"><a href="flood-frequency.html#cb404-255" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">divide</span>(<span class="dv">10000</span>)</span>
<span id="cb404-256"><a href="flood-frequency.html#cb404-256" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">round</span>()<span class="op">;</span></span>
<span id="cb404-257"><a href="flood-frequency.html#cb404-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-258"><a href="flood-frequency.html#cb404-258" aria-hidden="true" tabindex="-1"></a><span class="co">// Flooded areas</span></span>
<span id="cb404-259"><a href="flood-frequency.html#cb404-259" aria-hidden="true" tabindex="-1"></a><span class="co">//Map.addLayer(flooded2, {palette: "0FFFFF"}, 'Flooded areas 2022', 1);</span></span>
<span id="cb404-260"><a href="flood-frequency.html#cb404-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-261"><a href="flood-frequency.html#cb404-261" aria-hidden="true" tabindex="-1"></a><span class="co">//----------------------------- Compare with the previous year 2021------------------------</span></span>
<span id="cb404-262"><a href="flood-frequency.html#cb404-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-263"><a href="flood-frequency.html#cb404-263" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_start3 <span class="op">=</span> <span class="st">'2021-04-01'</span><span class="op">;</span></span>
<span id="cb404-264"><a href="flood-frequency.html#cb404-264" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_end3 <span class="op">=</span> <span class="st">'2021-09-01'</span><span class="op">;</span></span>
<span id="cb404-265"><a href="flood-frequency.html#cb404-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-266"><a href="flood-frequency.html#cb404-266" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_start3 <span class="op">=</span> <span class="st">'2023-08-01'</span><span class="op">;</span> <span class="co">// Should match the reference state </span></span>
<span id="cb404-267"><a href="flood-frequency.html#cb404-267" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_end3 <span class="op">=</span> <span class="st">'2023-08-25'</span><span class="op">;</span> <span class="co">// Should match the reference state </span></span>
<span id="cb404-268"><a href="flood-frequency.html#cb404-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-269"><a href="flood-frequency.html#cb404-269" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_collection3 <span class="op">=</span> collection<span class="op">.</span><span class="fu">filterDate</span>(before_start3<span class="op">,</span> before_end3)<span class="op">;</span></span>
<span id="cb404-270"><a href="flood-frequency.html#cb404-270" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_collection3 <span class="op">=</span> collection<span class="op">.</span><span class="fu">filterDate</span>(after_start3<span class="op">,</span> after_end3)<span class="op">;</span></span>
<span id="cb404-271"><a href="flood-frequency.html#cb404-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-272"><a href="flood-frequency.html#cb404-272" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a mosaic of selected tiles and clip to the study area</span></span>
<span id="cb404-273"><a href="flood-frequency.html#cb404-273" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before3 <span class="op">=</span> before_collection3<span class="op">.</span><span class="fu">mosaic</span>()<span class="op">.</span><span class="fu">clip</span>(aoi)<span class="op">;</span></span>
<span id="cb404-274"><a href="flood-frequency.html#cb404-274" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after3 <span class="op">=</span> after_collection3<span class="op">.</span><span class="fu">mosaic</span>()<span class="op">.</span><span class="fu">clip</span>(aoi)<span class="op">;</span></span>
<span id="cb404-275"><a href="flood-frequency.html#cb404-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-276"><a href="flood-frequency.html#cb404-276" aria-hidden="true" tabindex="-1"></a><span class="co">// Apply radar speckle reduction by smoothing  </span></span>
<span id="cb404-277"><a href="flood-frequency.html#cb404-277" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_filtered3 <span class="op">=</span> before3<span class="op">.</span><span class="fu">focal_mean</span>(smoothing_radius<span class="op">,</span> <span class="st">'circle'</span><span class="op">,</span> <span class="st">'meters'</span>)<span class="op">;</span></span>
<span id="cb404-278"><a href="flood-frequency.html#cb404-278" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_filtered3 <span class="op">=</span> after3<span class="op">.</span><span class="fu">focal_mean</span>(smoothing_radius<span class="op">,</span> <span class="st">'circle'</span><span class="op">,</span> <span class="st">'meters'</span>)<span class="op">;</span></span>
<span id="cb404-279"><a href="flood-frequency.html#cb404-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-280"><a href="flood-frequency.html#cb404-280" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate the difference between the before and after images</span></span>
<span id="cb404-281"><a href="flood-frequency.html#cb404-281" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> difference3 <span class="op">=</span> after_filtered3<span class="op">.</span><span class="fu">divide</span>(before_filtered3)<span class="op">;</span></span>
<span id="cb404-282"><a href="flood-frequency.html#cb404-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-283"><a href="flood-frequency.html#cb404-283" aria-hidden="true" tabindex="-1"></a><span class="co">// Apply the predefined difference-threshold and create the flood extent mask </span></span>
<span id="cb404-284"><a href="flood-frequency.html#cb404-284" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> threshold3 <span class="op">=</span> difference_threshold<span class="op">;</span></span>
<span id="cb404-285"><a href="flood-frequency.html#cb404-285" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> difference_binary3 <span class="op">=</span> difference3<span class="op">.</span><span class="fu">gt</span>(threshold3)<span class="op">;</span></span>
<span id="cb404-286"><a href="flood-frequency.html#cb404-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-287"><a href="flood-frequency.html#cb404-287" aria-hidden="true" tabindex="-1"></a><span class="co">// Refine the flood result using additional datasets</span></span>
<span id="cb404-288"><a href="flood-frequency.html#cb404-288" aria-hidden="true" tabindex="-1"></a><span class="co">// Include the JRC layer on surface water seasonality to mask flood pixels from areas</span></span>
<span id="cb404-289"><a href="flood-frequency.html#cb404-289" aria-hidden="true" tabindex="-1"></a><span class="co">// with "permanent" water (water &gt; 10 months of the year)</span></span>
<span id="cb404-290"><a href="flood-frequency.html#cb404-290" aria-hidden="true" tabindex="-1"></a>swater <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">'JRC/GSW1_0/GlobalSurfaceWater'</span>)<span class="op">.</span><span class="fu">select</span>(<span class="st">'seasonality'</span>)<span class="op">;</span></span>
<span id="cb404-291"><a href="flood-frequency.html#cb404-291" aria-hidden="true" tabindex="-1"></a>swater_mask <span class="op">=</span> swater<span class="op">.</span><span class="fu">gte</span>(<span class="dv">10</span>)<span class="op">.</span><span class="fu">updateMask</span>(swater<span class="op">.</span><span class="fu">gte</span>(<span class="dv">10</span>))<span class="op">;</span></span>
<span id="cb404-292"><a href="flood-frequency.html#cb404-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-293"><a href="flood-frequency.html#cb404-293" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a flooded mask where perennial water bodies (water &gt; 10 mo/yr) are assigned a 0 value</span></span>
<span id="cb404-294"><a href="flood-frequency.html#cb404-294" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flooded_mask3 <span class="op">=</span> difference_binary3<span class="op">.</span><span class="fu">where</span>(swater_mask<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb404-295"><a href="flood-frequency.html#cb404-295" aria-hidden="true" tabindex="-1"></a><span class="co">// Create the final flooded area without pixels in perennial water bodies</span></span>
<span id="cb404-296"><a href="flood-frequency.html#cb404-296" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flooded3 <span class="op">=</span> flooded_mask3<span class="op">.</span><span class="fu">updateMask</span>(flooded_mask3)<span class="op">;</span></span>
<span id="cb404-297"><a href="flood-frequency.html#cb404-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-298"><a href="flood-frequency.html#cb404-298" aria-hidden="true" tabindex="-1"></a><span class="co">// Compute the connectivity of pixels to eliminate those connected to 8 or fewer neighbors</span></span>
<span id="cb404-299"><a href="flood-frequency.html#cb404-299" aria-hidden="true" tabindex="-1"></a><span class="co">// This operation reduces noise in the flood extent product</span></span>
<span id="cb404-300"><a href="flood-frequency.html#cb404-300" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> connections3 <span class="op">=</span> flooded3<span class="op">.</span><span class="fu">connectedPixelCount</span>()<span class="op">;</span></span>
<span id="cb404-301"><a href="flood-frequency.html#cb404-301" aria-hidden="true" tabindex="-1"></a>flooded3 <span class="op">=</span> flooded3<span class="op">.</span><span class="fu">updateMask</span>(connections3<span class="op">.</span><span class="fu">gte</span>(<span class="dv">8</span>))<span class="op">;</span></span>
<span id="cb404-302"><a href="flood-frequency.html#cb404-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-303"><a href="flood-frequency.html#cb404-303" aria-hidden="true" tabindex="-1"></a><span class="co">// Mask out areas with more than 5 percent slope using a Digital Elevation Model</span></span>
<span id="cb404-304"><a href="flood-frequency.html#cb404-304" aria-hidden="true" tabindex="-1"></a>flooded3 <span class="op">=</span> flooded3<span class="op">.</span><span class="fu">updateMask</span>(slope<span class="op">.</span><span class="fu">lt</span>(<span class="dv">5</span>))<span class="op">;</span></span>
<span id="cb404-305"><a href="flood-frequency.html#cb404-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-306"><a href="flood-frequency.html#cb404-306" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate flood extent area</span></span>
<span id="cb404-307"><a href="flood-frequency.html#cb404-307" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a raster layer containing the area information of each pixel </span></span>
<span id="cb404-308"><a href="flood-frequency.html#cb404-308" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flood_pixelarea3 <span class="op">=</span> flooded3<span class="op">.</span><span class="fu">select</span>(polarization)</span>
<span id="cb404-309"><a href="flood-frequency.html#cb404-309" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">multiply</span>(ee<span class="op">.</span><span class="at">Image</span><span class="op">.</span><span class="fu">pixelArea</span>())<span class="op">;</span></span>
<span id="cb404-310"><a href="flood-frequency.html#cb404-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-311"><a href="flood-frequency.html#cb404-311" aria-hidden="true" tabindex="-1"></a><span class="co">// Sum the areas of flooded pixels</span></span>
<span id="cb404-312"><a href="flood-frequency.html#cb404-312" aria-hidden="true" tabindex="-1"></a><span class="co">// The default 'bestEffort' is set to true to reduce computation time; for a more </span></span>
<span id="cb404-313"><a href="flood-frequency.html#cb404-313" aria-hidden="true" tabindex="-1"></a><span class="co">// accurate result, set 'bestEffort' to false and increase 'maxPixels'. </span></span>
<span id="cb404-314"><a href="flood-frequency.html#cb404-314" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flood_stats3 <span class="op">=</span> flood_pixelarea3<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb404-315"><a href="flood-frequency.html#cb404-315" aria-hidden="true" tabindex="-1"></a>  <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">sum</span>()<span class="op">,</span>              </span>
<span id="cb404-316"><a href="flood-frequency.html#cb404-316" aria-hidden="true" tabindex="-1"></a>  <span class="dt">geometry</span><span class="op">:</span> aoi<span class="op">,</span></span>
<span id="cb404-317"><a href="flood-frequency.html#cb404-317" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="co">// native resolution </span></span>
<span id="cb404-318"><a href="flood-frequency.html#cb404-318" aria-hidden="true" tabindex="-1"></a>  <span class="co">//maxPixels: 1e9,</span></span>
<span id="cb404-319"><a href="flood-frequency.html#cb404-319" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bestEffort</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb404-320"><a href="flood-frequency.html#cb404-320" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb404-321"><a href="flood-frequency.html#cb404-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-322"><a href="flood-frequency.html#cb404-322" aria-hidden="true" tabindex="-1"></a><span class="co">// Convert the flood extent to hectares (area calculations are originally given in meters)  </span></span>
<span id="cb404-323"><a href="flood-frequency.html#cb404-323" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flood_area_ha3 <span class="op">=</span> flood_stats3</span>
<span id="cb404-324"><a href="flood-frequency.html#cb404-324" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">getNumber</span>(polarization)</span>
<span id="cb404-325"><a href="flood-frequency.html#cb404-325" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">divide</span>(<span class="dv">10000</span>)</span>
<span id="cb404-326"><a href="flood-frequency.html#cb404-326" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">round</span>()<span class="op">;</span></span>
<span id="cb404-327"><a href="flood-frequency.html#cb404-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-328"><a href="flood-frequency.html#cb404-328" aria-hidden="true" tabindex="-1"></a><span class="co">// Flooded areas</span></span>
<span id="cb404-329"><a href="flood-frequency.html#cb404-329" aria-hidden="true" tabindex="-1"></a><span class="co">//Map.addLayer(flooded3, {palette: "0FFFFF"}, 'Flooded areas 2021', 1);</span></span>
<span id="cb404-330"><a href="flood-frequency.html#cb404-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-331"><a href="flood-frequency.html#cb404-331" aria-hidden="true" tabindex="-1"></a><span class="co">//----------------------------- Compare with the previous year 2020------------------------</span></span>
<span id="cb404-332"><a href="flood-frequency.html#cb404-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-333"><a href="flood-frequency.html#cb404-333" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_start4 <span class="op">=</span> <span class="st">'2020-04-01'</span><span class="op">;</span> </span>
<span id="cb404-334"><a href="flood-frequency.html#cb404-334" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_end4 <span class="op">=</span> <span class="st">'2020-09-01'</span><span class="op">;</span></span>
<span id="cb404-335"><a href="flood-frequency.html#cb404-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-336"><a href="flood-frequency.html#cb404-336" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_start4 <span class="op">=</span> <span class="st">'2023-08-01'</span><span class="op">;</span> <span class="co">// Should match the reference state </span></span>
<span id="cb404-337"><a href="flood-frequency.html#cb404-337" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_end4 <span class="op">=</span> <span class="st">'2023-08-25'</span><span class="op">;</span> <span class="co">// Should match the reference state </span></span>
<span id="cb404-338"><a href="flood-frequency.html#cb404-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-339"><a href="flood-frequency.html#cb404-339" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_collection4 <span class="op">=</span> collection<span class="op">.</span><span class="fu">filterDate</span>(before_start4<span class="op">,</span> before_end4)<span class="op">;</span></span>
<span id="cb404-340"><a href="flood-frequency.html#cb404-340" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_collection4 <span class="op">=</span> collection<span class="op">.</span><span class="fu">filterDate</span>(after_start4<span class="op">,</span> after_end4)<span class="op">;</span></span>
<span id="cb404-341"><a href="flood-frequency.html#cb404-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-342"><a href="flood-frequency.html#cb404-342" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a mosaic of selected tiles and clip to the study area</span></span>
<span id="cb404-343"><a href="flood-frequency.html#cb404-343" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before4 <span class="op">=</span> before_collection4<span class="op">.</span><span class="fu">mosaic</span>()<span class="op">.</span><span class="fu">clip</span>(aoi)<span class="op">;</span></span>
<span id="cb404-344"><a href="flood-frequency.html#cb404-344" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after4 <span class="op">=</span> after_collection4<span class="op">.</span><span class="fu">mosaic</span>()<span class="op">.</span><span class="fu">clip</span>(aoi)<span class="op">;</span></span>
<span id="cb404-345"><a href="flood-frequency.html#cb404-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-346"><a href="flood-frequency.html#cb404-346" aria-hidden="true" tabindex="-1"></a><span class="co">// Apply radar speckle reduction by smoothing  </span></span>
<span id="cb404-347"><a href="flood-frequency.html#cb404-347" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_filtered4 <span class="op">=</span> before4<span class="op">.</span><span class="fu">focal_mean</span>(smoothing_radius<span class="op">,</span> <span class="st">'circle'</span><span class="op">,</span> <span class="st">'meters'</span>)<span class="op">;</span></span>
<span id="cb404-348"><a href="flood-frequency.html#cb404-348" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_filtered4 <span class="op">=</span> after4<span class="op">.</span><span class="fu">focal_mean</span>(smoothing_radius<span class="op">,</span> <span class="st">'circle'</span><span class="op">,</span> <span class="st">'meters'</span>)<span class="op">;</span></span>
<span id="cb404-349"><a href="flood-frequency.html#cb404-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-350"><a href="flood-frequency.html#cb404-350" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate the difference between the before and after images</span></span>
<span id="cb404-351"><a href="flood-frequency.html#cb404-351" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> difference4 <span class="op">=</span> after_filtered4<span class="op">.</span><span class="fu">divide</span>(before_filtered4)<span class="op">;</span></span>
<span id="cb404-352"><a href="flood-frequency.html#cb404-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-353"><a href="flood-frequency.html#cb404-353" aria-hidden="true" tabindex="-1"></a><span class="co">// Apply the predefined difference-threshold and create the flood extent mask </span></span>
<span id="cb404-354"><a href="flood-frequency.html#cb404-354" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> threshold4 <span class="op">=</span> difference_threshold<span class="op">;</span></span>
<span id="cb404-355"><a href="flood-frequency.html#cb404-355" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> difference_binary4 <span class="op">=</span> difference4<span class="op">.</span><span class="fu">gt</span>(threshold4)<span class="op">;</span></span>
<span id="cb404-356"><a href="flood-frequency.html#cb404-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-357"><a href="flood-frequency.html#cb404-357" aria-hidden="true" tabindex="-1"></a><span class="co">// Refine the flood result using additional datasets</span></span>
<span id="cb404-358"><a href="flood-frequency.html#cb404-358" aria-hidden="true" tabindex="-1"></a><span class="co">// Include the JRC layer on surface water seasonality to mask flood pixels from areas</span></span>
<span id="cb404-359"><a href="flood-frequency.html#cb404-359" aria-hidden="true" tabindex="-1"></a><span class="co">// with "permanent" water (water &gt; 10 months of the year)</span></span>
<span id="cb404-360"><a href="flood-frequency.html#cb404-360" aria-hidden="true" tabindex="-1"></a>swater <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">'JRC/GSW1_0/GlobalSurfaceWater'</span>)<span class="op">.</span><span class="fu">select</span>(<span class="st">'seasonality'</span>)<span class="op">;</span></span>
<span id="cb404-361"><a href="flood-frequency.html#cb404-361" aria-hidden="true" tabindex="-1"></a>swater_mask <span class="op">=</span> swater<span class="op">.</span><span class="fu">gte</span>(<span class="dv">10</span>)<span class="op">.</span><span class="fu">updateMask</span>(swater<span class="op">.</span><span class="fu">gte</span>(<span class="dv">10</span>))<span class="op">;</span></span>
<span id="cb404-362"><a href="flood-frequency.html#cb404-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-363"><a href="flood-frequency.html#cb404-363" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a flooded mask where perennial water bodies (water &gt; 10 mo/yr) are assigned a 0 value</span></span>
<span id="cb404-364"><a href="flood-frequency.html#cb404-364" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flooded_mask4 <span class="op">=</span> difference_binary4<span class="op">.</span><span class="fu">where</span>(swater_mask<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb404-365"><a href="flood-frequency.html#cb404-365" aria-hidden="true" tabindex="-1"></a><span class="co">// Create the final flooded area without pixels in perennial water bodies</span></span>
<span id="cb404-366"><a href="flood-frequency.html#cb404-366" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flooded4 <span class="op">=</span> flooded_mask4<span class="op">.</span><span class="fu">updateMask</span>(flooded_mask4)<span class="op">;</span></span>
<span id="cb404-367"><a href="flood-frequency.html#cb404-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-368"><a href="flood-frequency.html#cb404-368" aria-hidden="true" tabindex="-1"></a><span class="co">// Compute the connectivity of pixels to eliminate those connected to 8 or fewer neighbors</span></span>
<span id="cb404-369"><a href="flood-frequency.html#cb404-369" aria-hidden="true" tabindex="-1"></a><span class="co">// This operation reduces noise in the flood extent product</span></span>
<span id="cb404-370"><a href="flood-frequency.html#cb404-370" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> connections4 <span class="op">=</span> flooded4<span class="op">.</span><span class="fu">connectedPixelCount</span>()<span class="op">;</span></span>
<span id="cb404-371"><a href="flood-frequency.html#cb404-371" aria-hidden="true" tabindex="-1"></a>flooded4 <span class="op">=</span> flooded4<span class="op">.</span><span class="fu">updateMask</span>(connections4<span class="op">.</span><span class="fu">gte</span>(<span class="dv">8</span>))<span class="op">;</span></span>
<span id="cb404-372"><a href="flood-frequency.html#cb404-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-373"><a href="flood-frequency.html#cb404-373" aria-hidden="true" tabindex="-1"></a><span class="co">// Mask out areas with more than 5 percent slope using a Digital Elevation Model</span></span>
<span id="cb404-374"><a href="flood-frequency.html#cb404-374" aria-hidden="true" tabindex="-1"></a>flooded4 <span class="op">=</span> flooded4<span class="op">.</span><span class="fu">updateMask</span>(slope<span class="op">.</span><span class="fu">lt</span>(<span class="dv">5</span>))<span class="op">;</span></span>
<span id="cb404-375"><a href="flood-frequency.html#cb404-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-376"><a href="flood-frequency.html#cb404-376" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate flood extent area</span></span>
<span id="cb404-377"><a href="flood-frequency.html#cb404-377" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a raster layer containing the area information of each pixel </span></span>
<span id="cb404-378"><a href="flood-frequency.html#cb404-378" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flood_pixelarea4 <span class="op">=</span> flooded4<span class="op">.</span><span class="fu">select</span>(polarization)</span>
<span id="cb404-379"><a href="flood-frequency.html#cb404-379" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">multiply</span>(ee<span class="op">.</span><span class="at">Image</span><span class="op">.</span><span class="fu">pixelArea</span>())<span class="op">;</span></span>
<span id="cb404-380"><a href="flood-frequency.html#cb404-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-381"><a href="flood-frequency.html#cb404-381" aria-hidden="true" tabindex="-1"></a><span class="co">// Sum the areas of flooded pixels</span></span>
<span id="cb404-382"><a href="flood-frequency.html#cb404-382" aria-hidden="true" tabindex="-1"></a><span class="co">// The default 'bestEffort' is set to true to reduce computation time; for a more </span></span>
<span id="cb404-383"><a href="flood-frequency.html#cb404-383" aria-hidden="true" tabindex="-1"></a><span class="co">// accurate result, set 'bestEffort' to false and increase 'maxPixels'. </span></span>
<span id="cb404-384"><a href="flood-frequency.html#cb404-384" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flood_stats4 <span class="op">=</span> flood_pixelarea4<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb404-385"><a href="flood-frequency.html#cb404-385" aria-hidden="true" tabindex="-1"></a>  <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">sum</span>()<span class="op">,</span>              </span>
<span id="cb404-386"><a href="flood-frequency.html#cb404-386" aria-hidden="true" tabindex="-1"></a>  <span class="dt">geometry</span><span class="op">:</span> aoi<span class="op">,</span></span>
<span id="cb404-387"><a href="flood-frequency.html#cb404-387" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="co">// native resolution </span></span>
<span id="cb404-388"><a href="flood-frequency.html#cb404-388" aria-hidden="true" tabindex="-1"></a>  <span class="co">//maxPixels: 1e9,</span></span>
<span id="cb404-389"><a href="flood-frequency.html#cb404-389" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bestEffort</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb404-390"><a href="flood-frequency.html#cb404-390" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb404-391"><a href="flood-frequency.html#cb404-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-392"><a href="flood-frequency.html#cb404-392" aria-hidden="true" tabindex="-1"></a><span class="co">// Convert the flood extent to hectares (area calculations are originally given in meters)  </span></span>
<span id="cb404-393"><a href="flood-frequency.html#cb404-393" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flood_area_ha4 <span class="op">=</span> flood_stats4</span>
<span id="cb404-394"><a href="flood-frequency.html#cb404-394" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">getNumber</span>(polarization)</span>
<span id="cb404-395"><a href="flood-frequency.html#cb404-395" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">divide</span>(<span class="dv">10000</span>)</span>
<span id="cb404-396"><a href="flood-frequency.html#cb404-396" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">round</span>()<span class="op">;</span></span>
<span id="cb404-397"><a href="flood-frequency.html#cb404-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-398"><a href="flood-frequency.html#cb404-398" aria-hidden="true" tabindex="-1"></a><span class="co">// Flooded areas</span></span>
<span id="cb404-399"><a href="flood-frequency.html#cb404-399" aria-hidden="true" tabindex="-1"></a><span class="co">//Map.addLayer(flooded4, {palette: "0FFFFF"}, 'Flooded areas 2020', 1);</span></span>
<span id="cb404-400"><a href="flood-frequency.html#cb404-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-401"><a href="flood-frequency.html#cb404-401" aria-hidden="true" tabindex="-1"></a><span class="co">//----------------------------- Compare with the previous year 2019------------------------</span></span>
<span id="cb404-402"><a href="flood-frequency.html#cb404-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-403"><a href="flood-frequency.html#cb404-403" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_start5 <span class="op">=</span> <span class="st">'2019-04-01'</span><span class="op">;</span></span>
<span id="cb404-404"><a href="flood-frequency.html#cb404-404" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_end5 <span class="op">=</span> <span class="st">'2019-09-01'</span><span class="op">;</span></span>
<span id="cb404-405"><a href="flood-frequency.html#cb404-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-406"><a href="flood-frequency.html#cb404-406" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_start5 <span class="op">=</span> <span class="st">'2019-08-01'</span><span class="op">;</span> <span class="co">// Should match the reference state </span></span>
<span id="cb404-407"><a href="flood-frequency.html#cb404-407" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_end5 <span class="op">=</span> <span class="st">'2019-08-25'</span><span class="op">;</span> <span class="co">// Should match the reference state </span></span>
<span id="cb404-408"><a href="flood-frequency.html#cb404-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-409"><a href="flood-frequency.html#cb404-409" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_collection5 <span class="op">=</span> collection<span class="op">.</span><span class="fu">filterDate</span>(before_start5<span class="op">,</span> before_end5)<span class="op">;</span></span>
<span id="cb404-410"><a href="flood-frequency.html#cb404-410" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_collection5 <span class="op">=</span> collection<span class="op">.</span><span class="fu">filterDate</span>(after_start5<span class="op">,</span> after_end5)<span class="op">;</span></span>
<span id="cb404-411"><a href="flood-frequency.html#cb404-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-412"><a href="flood-frequency.html#cb404-412" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a mosaic of selected tiles and clip to the study area</span></span>
<span id="cb404-413"><a href="flood-frequency.html#cb404-413" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before5 <span class="op">=</span> before_collection5<span class="op">.</span><span class="fu">mosaic</span>()<span class="op">.</span><span class="fu">clip</span>(aoi)<span class="op">;</span></span>
<span id="cb404-414"><a href="flood-frequency.html#cb404-414" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after5 <span class="op">=</span> after_collection5<span class="op">.</span><span class="fu">mosaic</span>()<span class="op">.</span><span class="fu">clip</span>(aoi)<span class="op">;</span></span>
<span id="cb404-415"><a href="flood-frequency.html#cb404-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-416"><a href="flood-frequency.html#cb404-416" aria-hidden="true" tabindex="-1"></a><span class="co">// Apply radar speckle reduction by smoothing  </span></span>
<span id="cb404-417"><a href="flood-frequency.html#cb404-417" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> before_filtered5 <span class="op">=</span> before5<span class="op">.</span><span class="fu">focal_mean</span>(smoothing_radius<span class="op">,</span> <span class="st">'circle'</span><span class="op">,</span> <span class="st">'meters'</span>)<span class="op">;</span></span>
<span id="cb404-418"><a href="flood-frequency.html#cb404-418" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> after_filtered5 <span class="op">=</span> after5<span class="op">.</span><span class="fu">focal_mean</span>(smoothing_radius<span class="op">,</span> <span class="st">'circle'</span><span class="op">,</span> <span class="st">'meters'</span>)<span class="op">;</span></span>
<span id="cb404-419"><a href="flood-frequency.html#cb404-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-420"><a href="flood-frequency.html#cb404-420" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate the difference between the before and after images</span></span>
<span id="cb404-421"><a href="flood-frequency.html#cb404-421" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> difference5 <span class="op">=</span> after_filtered5<span class="op">.</span><span class="fu">divide</span>(before_filtered5)<span class="op">;</span></span>
<span id="cb404-422"><a href="flood-frequency.html#cb404-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-423"><a href="flood-frequency.html#cb404-423" aria-hidden="true" tabindex="-1"></a><span class="co">// Apply the predefined difference-threshold and create the flood extent mask </span></span>
<span id="cb404-424"><a href="flood-frequency.html#cb404-424" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> threshold5 <span class="op">=</span> difference_threshold<span class="op">;</span></span>
<span id="cb404-425"><a href="flood-frequency.html#cb404-425" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> difference_binary5 <span class="op">=</span> difference5<span class="op">.</span><span class="fu">gt</span>(threshold5)<span class="op">;</span></span>
<span id="cb404-426"><a href="flood-frequency.html#cb404-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-427"><a href="flood-frequency.html#cb404-427" aria-hidden="true" tabindex="-1"></a><span class="co">// Refine the flood result using additional datasets</span></span>
<span id="cb404-428"><a href="flood-frequency.html#cb404-428" aria-hidden="true" tabindex="-1"></a><span class="co">// Include the JRC layer on surface water seasonality to mask flood pixels from areas</span></span>
<span id="cb404-429"><a href="flood-frequency.html#cb404-429" aria-hidden="true" tabindex="-1"></a><span class="co">// with "permanent" water (water &gt; 10 months of the year)</span></span>
<span id="cb404-430"><a href="flood-frequency.html#cb404-430" aria-hidden="true" tabindex="-1"></a>swater <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">'JRC/GSW1_0/GlobalSurfaceWater'</span>)<span class="op">.</span><span class="fu">select</span>(<span class="st">'seasonality'</span>)<span class="op">;</span></span>
<span id="cb404-431"><a href="flood-frequency.html#cb404-431" aria-hidden="true" tabindex="-1"></a>swater_mask <span class="op">=</span> swater<span class="op">.</span><span class="fu">gte</span>(<span class="dv">10</span>)<span class="op">.</span><span class="fu">updateMask</span>(swater<span class="op">.</span><span class="fu">gte</span>(<span class="dv">10</span>))<span class="op">;</span></span>
<span id="cb404-432"><a href="flood-frequency.html#cb404-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-433"><a href="flood-frequency.html#cb404-433" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a flooded mask where perennial water bodies (water &gt; 10 mo/yr) are assigned a 0 value</span></span>
<span id="cb404-434"><a href="flood-frequency.html#cb404-434" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flooded_mask5 <span class="op">=</span> difference_binary5<span class="op">.</span><span class="fu">where</span>(swater_mask<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb404-435"><a href="flood-frequency.html#cb404-435" aria-hidden="true" tabindex="-1"></a><span class="co">// Create the final flooded area without pixels in perennial water bodies</span></span>
<span id="cb404-436"><a href="flood-frequency.html#cb404-436" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flooded5 <span class="op">=</span> flooded_mask5<span class="op">.</span><span class="fu">updateMask</span>(flooded_mask5)<span class="op">;</span></span>
<span id="cb404-437"><a href="flood-frequency.html#cb404-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-438"><a href="flood-frequency.html#cb404-438" aria-hidden="true" tabindex="-1"></a><span class="co">// Compute the connectivity of pixels to eliminate those connected to 8 or fewer neighbors</span></span>
<span id="cb404-439"><a href="flood-frequency.html#cb404-439" aria-hidden="true" tabindex="-1"></a><span class="co">// This operation reduces noise in the flood extent product</span></span>
<span id="cb404-440"><a href="flood-frequency.html#cb404-440" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> connections5 <span class="op">=</span> flooded5<span class="op">.</span><span class="fu">connectedPixelCount</span>()<span class="op">;</span></span>
<span id="cb404-441"><a href="flood-frequency.html#cb404-441" aria-hidden="true" tabindex="-1"></a>flooded5 <span class="op">=</span> flooded5<span class="op">.</span><span class="fu">updateMask</span>(connections5<span class="op">.</span><span class="fu">gte</span>(<span class="dv">8</span>))<span class="op">;</span></span>
<span id="cb404-442"><a href="flood-frequency.html#cb404-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-443"><a href="flood-frequency.html#cb404-443" aria-hidden="true" tabindex="-1"></a><span class="co">// Mask out areas with more than 5 percent slope using a Digital Elevation Model</span></span>
<span id="cb404-444"><a href="flood-frequency.html#cb404-444" aria-hidden="true" tabindex="-1"></a>flooded5 <span class="op">=</span> flooded5<span class="op">.</span><span class="fu">updateMask</span>(slope<span class="op">.</span><span class="fu">lt</span>(<span class="dv">5</span>))<span class="op">;</span></span>
<span id="cb404-445"><a href="flood-frequency.html#cb404-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-446"><a href="flood-frequency.html#cb404-446" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate flood extent area</span></span>
<span id="cb404-447"><a href="flood-frequency.html#cb404-447" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a raster layer containing the area information of each pixel </span></span>
<span id="cb404-448"><a href="flood-frequency.html#cb404-448" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flood_pixelarea5 <span class="op">=</span> flooded5<span class="op">.</span><span class="fu">select</span>(polarization)</span>
<span id="cb404-449"><a href="flood-frequency.html#cb404-449" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">multiply</span>(ee<span class="op">.</span><span class="at">Image</span><span class="op">.</span><span class="fu">pixelArea</span>())<span class="op">;</span></span>
<span id="cb404-450"><a href="flood-frequency.html#cb404-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-451"><a href="flood-frequency.html#cb404-451" aria-hidden="true" tabindex="-1"></a><span class="co">// Sum the areas of flooded pixels</span></span>
<span id="cb404-452"><a href="flood-frequency.html#cb404-452" aria-hidden="true" tabindex="-1"></a><span class="co">// The default 'bestEffort' is set to true to reduce computation time; for a more </span></span>
<span id="cb404-453"><a href="flood-frequency.html#cb404-453" aria-hidden="true" tabindex="-1"></a><span class="co">// accurate result, set 'bestEffort' to false and increase 'maxPixels'. </span></span>
<span id="cb404-454"><a href="flood-frequency.html#cb404-454" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flood_stats5 <span class="op">=</span> flood_pixelarea5<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb404-455"><a href="flood-frequency.html#cb404-455" aria-hidden="true" tabindex="-1"></a>  <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">sum</span>()<span class="op">,</span>              </span>
<span id="cb404-456"><a href="flood-frequency.html#cb404-456" aria-hidden="true" tabindex="-1"></a>  <span class="dt">geometry</span><span class="op">:</span> aoi<span class="op">,</span></span>
<span id="cb404-457"><a href="flood-frequency.html#cb404-457" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="co">// native resolution </span></span>
<span id="cb404-458"><a href="flood-frequency.html#cb404-458" aria-hidden="true" tabindex="-1"></a>  <span class="co">//maxPixels: 1e9,</span></span>
<span id="cb404-459"><a href="flood-frequency.html#cb404-459" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bestEffort</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb404-460"><a href="flood-frequency.html#cb404-460" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb404-461"><a href="flood-frequency.html#cb404-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-462"><a href="flood-frequency.html#cb404-462" aria-hidden="true" tabindex="-1"></a><span class="co">// Convert the flood extent to hectares (area calculations are originally given in meters)  </span></span>
<span id="cb404-463"><a href="flood-frequency.html#cb404-463" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flood_area_ha5 <span class="op">=</span> flood_stats5</span>
<span id="cb404-464"><a href="flood-frequency.html#cb404-464" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">getNumber</span>(polarization)</span>
<span id="cb404-465"><a href="flood-frequency.html#cb404-465" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">divide</span>(<span class="dv">10000</span>)</span>
<span id="cb404-466"><a href="flood-frequency.html#cb404-466" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">round</span>()<span class="op">;</span></span>
<span id="cb404-467"><a href="flood-frequency.html#cb404-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-468"><a href="flood-frequency.html#cb404-468" aria-hidden="true" tabindex="-1"></a><span class="co">// Flooded areas</span></span>
<span id="cb404-469"><a href="flood-frequency.html#cb404-469" aria-hidden="true" tabindex="-1"></a><span class="co">//Map.addLayer(flooded5, {palette: "0FFFFF"}, 'Flooded areas 2019', 1);</span></span>
<span id="cb404-470"><a href="flood-frequency.html#cb404-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-471"><a href="flood-frequency.html#cb404-471" aria-hidden="true" tabindex="-1"></a><span class="co">//----------------------------- Frequency ----------------------------//</span></span>
<span id="cb404-472"><a href="flood-frequency.html#cb404-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-473"><a href="flood-frequency.html#cb404-473" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate the frequency</span></span>
<span id="cb404-474"><a href="flood-frequency.html#cb404-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-475"><a href="flood-frequency.html#cb404-475" aria-hidden="true" tabindex="-1"></a><span class="co">// Unmask the two images and add them together</span></span>
<span id="cb404-476"><a href="flood-frequency.html#cb404-476" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flooded_unmasked <span class="op">=</span> flooded<span class="op">.</span><span class="fu">unmask</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb404-477"><a href="flood-frequency.html#cb404-477" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flooded2_unmasked <span class="op">=</span> flooded2<span class="op">.</span><span class="fu">unmask</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb404-478"><a href="flood-frequency.html#cb404-478" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flooded3_unmasked <span class="op">=</span> flooded3<span class="op">.</span><span class="fu">unmask</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb404-479"><a href="flood-frequency.html#cb404-479" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flooded4_unmasked <span class="op">=</span> flooded4<span class="op">.</span><span class="fu">unmask</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb404-480"><a href="flood-frequency.html#cb404-480" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> flooded5_unmasked <span class="op">=</span> flooded5<span class="op">.</span><span class="fu">unmask</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb404-481"><a href="flood-frequency.html#cb404-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-482"><a href="flood-frequency.html#cb404-482" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> floodFrequency <span class="op">=</span> flooded_unmasked<span class="op">.</span><span class="fu">add</span>(flooded2_unmasked)</span>
<span id="cb404-483"><a href="flood-frequency.html#cb404-483" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">add</span>(flooded3_unmasked)</span>
<span id="cb404-484"><a href="flood-frequency.html#cb404-484" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">add</span>(flooded4_unmasked)</span>
<span id="cb404-485"><a href="flood-frequency.html#cb404-485" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">add</span>(flooded5_unmasked)<span class="op">;</span></span>
<span id="cb404-486"><a href="flood-frequency.html#cb404-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-487"><a href="flood-frequency.html#cb404-487" aria-hidden="true" tabindex="-1"></a><span class="co">// Define the flood frequency image with a mask for zero values</span></span>
<span id="cb404-488"><a href="flood-frequency.html#cb404-488" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> maskedFloodFrequency <span class="op">=</span> floodFrequency<span class="op">.</span><span class="fu">updateMask</span>(floodFrequency<span class="op">.</span><span class="fu">gt</span>(<span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb404-489"><a href="flood-frequency.html#cb404-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-490"><a href="flood-frequency.html#cb404-490" aria-hidden="true" tabindex="-1"></a><span class="co">// Define a color palette for flood frequency</span></span>
<span id="cb404-491"><a href="flood-frequency.html#cb404-491" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> colorPalette <span class="op">=</span> [<span class="st">'lightblue'</span><span class="op">,</span> <span class="st">'blue'</span><span class="op">,</span> <span class="st">'purple'</span><span class="op">,</span> <span class="st">'pink'</span><span class="op">,</span> <span class="st">'red'</span>]<span class="op">;</span></span>
<span id="cb404-492"><a href="flood-frequency.html#cb404-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-493"><a href="flood-frequency.html#cb404-493" aria-hidden="true" tabindex="-1"></a><span class="co">// Add the flood frequency image to the map with the updated color palette</span></span>
<span id="cb404-494"><a href="flood-frequency.html#cb404-494" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(maskedFloodFrequency<span class="op">,</span> {<span class="dt">min</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> colorPalette}<span class="op">,</span> <span class="st">'Flood Frequency'</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb404-495"><a href="flood-frequency.html#cb404-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-496"><a href="flood-frequency.html#cb404-496" aria-hidden="true" tabindex="-1"></a><span class="co">//----------------------------- Affected wetland land ----------------------------//</span></span>
<span id="cb404-497"><a href="flood-frequency.html#cb404-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-498"><a href="flood-frequency.html#cb404-498" aria-hidden="true" tabindex="-1"></a><span class="co">// Load the wetland map</span></span>
<span id="cb404-499"><a href="flood-frequency.html#cb404-499" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myrpred2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">'users/vegarbakkestuen/Myr153'</span>)<span class="op">;</span></span>
<span id="cb404-500"><a href="flood-frequency.html#cb404-500" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> myr <span class="op">=</span> myrpred2<span class="op">.</span><span class="fu">mean</span>()<span class="op">.</span><span class="fu">select</span>(<span class="st">'impervious'</span>)<span class="op">;</span> <span class="co">// Select the band 'b1' from the wetland map</span></span>
<span id="cb404-501"><a href="flood-frequency.html#cb404-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-502"><a href="flood-frequency.html#cb404-502" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate affected wetland areas using the resampled flood layer and wetland map</span></span>
<span id="cb404-503"><a href="flood-frequency.html#cb404-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-504"><a href="flood-frequency.html#cb404-504" aria-hidden="true" tabindex="-1"></a><span class="co">// Use areas from the myr dataset as geometry</span></span>
<span id="cb404-505"><a href="flood-frequency.html#cb404-505" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> wetlandAreas <span class="op">=</span> myr<span class="op">.</span><span class="fu">gt</span>(<span class="fl">0.8</span>)<span class="op">.</span><span class="fu">selfMask</span>()<span class="op">;</span> <span class="co">// Select areas with wetlands and use geometry as a mask</span></span>
<span id="cb404-506"><a href="flood-frequency.html#cb404-506" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> wetlandAffected <span class="op">=</span> maskedFloodFrequency<span class="op">.</span><span class="fu">updateMask</span>(wetlandAreas)<span class="op">;</span></span>
<span id="cb404-507"><a href="flood-frequency.html#cb404-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-508"><a href="flood-frequency.html#cb404-508" aria-hidden="true" tabindex="-1"></a><span class="co">// Get pixel area of the affected wetland layer</span></span>
<span id="cb404-509"><a href="flood-frequency.html#cb404-509" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> wetlandPixelArea <span class="op">=</span> wetlandAffected<span class="op">.</span><span class="fu">multiply</span>(ee<span class="op">.</span><span class="at">Image</span><span class="op">.</span><span class="fu">pixelArea</span>())<span class="op">;</span> <span class="co">// Calculate the area of each pixel </span></span>
<span id="cb404-510"><a href="flood-frequency.html#cb404-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-511"><a href="flood-frequency.html#cb404-511" aria-hidden="true" tabindex="-1"></a><span class="co">// Sum the pixels of the affected wetland layer</span></span>
<span id="cb404-512"><a href="flood-frequency.html#cb404-512" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> wetlandStats <span class="op">=</span> wetlandPixelArea<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb404-513"><a href="flood-frequency.html#cb404-513" aria-hidden="true" tabindex="-1"></a>  <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">sum</span>()<span class="op">,</span> <span class="co">// Sum all pixels with area information                </span></span>
<span id="cb404-514"><a href="flood-frequency.html#cb404-514" aria-hidden="true" tabindex="-1"></a>  <span class="dt">geometry</span><span class="op">:</span> aoi<span class="op">,</span></span>
<span id="cb404-515"><a href="flood-frequency.html#cb404-515" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">500</span><span class="op">,</span></span>
<span id="cb404-516"><a href="flood-frequency.html#cb404-516" aria-hidden="true" tabindex="-1"></a>  <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e9</span></span>
<span id="cb404-517"><a href="flood-frequency.html#cb404-517" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb404-518"><a href="flood-frequency.html#cb404-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-519"><a href="flood-frequency.html#cb404-519" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(wetlandAffected<span class="op">,</span> {<span class="dt">min</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> colorPalette}<span class="op">,</span> <span class="st">'Flood Frequency in Wetlands'</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">

/*===========================================================================================
                       SAR-FLOOD MAPPING USING A CHANGE DETECTION APPROACH
  ===========================================================================================
  This script uses Sentinel-1 SAR data to create a flood extent map. It employs a change 
  detection method, comparing before- and after-flood images. The script is designed to work 
  with Ground Range Detected (GRD) imagery, which undergoes preprocessing steps, including 
  Thermal-Noise Removal, Radiometric Calibration, and Terrain Correction. Therefore, only a 
  Speckle filter needs to be applied during preprocessing.

  ===========================================================================================

                                  SELECT YOUR OWN STUDY AREA

   Use the polygon tool in the top left corner of the map pane to outline your study area. 
   Single clicks add vertices, and double-clicking completes the polygon.
   **CAUTION**: Under 'Geometry Imports' (top left in the map panel), uncheck the 
               geometry box to avoid obscuring the view of the imagery later.

  *******************************************************************************************
                                       SET TIME FRAME

   Specify the start and end dates for a period BEFORE the flood event. Ensure that the 
   duration is sufficient for Sentinel-1 to acquire images (repetition rate = 6 days). 
   Adjust these parameters if the ImageCollections (see Console) are empty.

/********************************************************************************************
                           SET SAR PARAMETERS (can be left default)*/

var polarization = "VH"; /* or 'VV' --> VH is commonly preferred for flood mapping, but 
                           the choice may depend on your study area. You can choose 'VV' as 
                           well. */

var pass_direction = "DESCENDING"; /* or 'ASCENDING'. When comparing images, use only one 
                           pass direction. Consider changing this parameter if your image 
                           collection is empty. In some areas, more Ascending images exist 
                           than Descending, or vice versa. */

var difference_threshold = 1.25; /* Threshold applied to the difference image (after flood
                           - before flood). The value is chosen through trial and error. 
                           If your flood extent result contains many false positives or 
                           negatives, consider adjusting it. */
//var relative_orbit = 79; 
                          /* If you know the relative orbit for your study area, you can 
                           filter your image collection by it here to avoid errors due to 
                           comparisons across different relative orbits. */

/********************************************************************************************
  ---->>> DO NOT EDIT THE SCRIPT PAST THIS POINT! (unless you know what you are doing) <<<---
  ------------------>>> now hit the 'RUN' at the top of the script! <<<-----------------------
  -----> The final flood product will be ready for download on the right (under tasks) <-----
  ******************************************************************************************/

//---------------------------------- Translating User Inputs ------------------------------//
Map.setCenter(9.98383,  60.95329, 14); // Sets the map center.

var before_start = '2023-04-01';
var before_end = '2023-07-01'; 
// Define the start and end dates for the period before the flood.

var after_start = '2023-08-01'; 
var after_end = '2023-08-25'; 
// Define the start and end dates for the period after the flood.

//------------------------------- DATA SELECTION & PREPROCESSING --------------------------//

// Rename the selected geometry feature 
var aoi = ee.FeatureCollection(geometry);

// Load and filter Sentinel-1 GRD data based on predefined parameters 
var collection = ee.ImageCollection('COPERNICUS/S1_GRD')
  .filter(ee.Filter.eq('instrumentMode', 'IW'))
  .filter(ee.Filter.listContains('transmitterReceiverPolarisation', polarization))
  .filter(ee.Filter.eq('orbitProperties_pass', pass_direction)) 
  .filter(ee.Filter.eq('resolution_meters', 10))
  //.filter(ee.Filter.eq('relativeOrbitNumber_start', relative_orbit ))
  .filterBounds(aoi)
  .select(polarization);

// Select images based on predefined dates
var before_collection = collection.filterDate(before_start, before_end);
var after_collection = collection.filterDate(after_start, after_end);

// Print selected tiles to the console
function dates(imgcol) {
    var range = imgcol.reduceColumns(ee.Reducer.minMax(), ["system:time_start"]);
    var printed = ee.String('from ')
      .cat(ee.Date(range.get('min')).format('YYYY-MM-dd'))
      .cat(' to ')
      .cat(ee.Date(range.get('max')).format('YYYY-MM-dd'));
    return printed;
}

var before_count = before_collection.size();
print(ee.String('Tiles selected: Before Flood ').cat('(').cat(before_count).cat(')'),
    dates(before_collection), before_collection);

var after_count = before_collection.size();
print(ee.String('Tiles selected: After Flood ').cat('(').cat(after_count).cat(')'),
    dates(after_collection), after_collection);

// Create a mosaic of selected tiles and clip to the study area
var before = before_collection.mosaic().clip(aoi);
var after = after_collection.mosaic().clip(aoi);

// Apply radar speckle reduction by smoothing  
var smoothing_radius = 50;
var before_filtered = before.focal_mean(smoothing_radius, 'circle', 'meters');
var after_filtered = after.focal_mean(smoothing_radius, 'circle', 'meters');

//------------------------------- FLOOD EXTENT CALCULATION -------------------------------//
// Calculate the difference between the before and after images
var difference = after_filtered.divide(before_filtered);

//Map.addLayer(difference, {}, 'Difference 2023', 1);

// Apply the predefined difference threshold to create the flood extent mask 
var threshold = difference_threshold;
var difference_binary = difference.gt(threshold);

// Refine the flood result using additional datasets
// Include the JRC layer on surface water seasonality to mask flood pixels from areas
// with "permanent" water (water > 10 months of the year)
var swater = ee.Image('JRC/GSW1_0/GlobalSurfaceWater').select('seasonality');
var swater_mask = swater.gte(10).updateMask(swater.gte(10));

// Create a flooded mask where perennial water bodies (water > 10 mo/yr) are assigned a 0 value
var flooded_mask = difference_binary.where(swater_mask, 0);
// Create the final flooded area without pixels in perennial water bodies
var flooded = flooded_mask.updateMask(flooded_mask);

// Compute the connectivity of pixels to eliminate those connected to 8 or fewer neighbors
// This operation reduces noise in the flood extent product
var connections = flooded.connectedPixelCount();
var flooded = flooded.updateMask(connections.gte(8));

// Mask out areas with more than 5 percent slope using the Norwegian Digital Elevation Model
//var DEM = ee.Image('WWF/HydroSHEDS/03VFDEM');
var DEM = ee.Image('users/vegar/dem_10m_kartverket');
var terrain = ee.Algorithms.Terrain(DEM);
var slope = terrain.select('slope');
var flooded = flooded.updateMask(slope.lt(5));

// Calculate flood extent area
// Create a raster layer containing the area information of each pixel 
var flood_pixelarea = flooded.select(polarization)
  .multiply(ee.Image.pixelArea());

// Sum the areas of flooded pixels
// The default 'bestEffort' is set to true to reduce computation time; for a more 
// accurate result, set 'bestEffort' to false and increase 'maxPixels'. 
var flood_stats = flood_pixelarea.reduceRegion({
  reducer: ee.Reducer.sum(),              
  geometry: aoi,
  scale: 10, // native resolution 
  //maxPixels: 1e9,
  bestEffort: true
});

// Convert the flood extent to hectares (area calculations are originally given in meters)  
var flood_area_ha = flood_stats
  .getNumber(polarization)
  .divide(10000)
  .round();

// Set visualization parameters
var frequencyVis = {
  min: 0,
  max: 4,
  palette: ['white', 'lightblue', 'mediumblue', 'darkblue', 'black']
};

// Display flooded areas
Map.addLayer(flooded, { palette: "0000FF" }, 'Flooded areas Hans 2023', 0);

//----------------------------- Compare with the previous year 2022------------------------

var before_start2 = '2022-04-01';
var before_end2 = '2022-09-01';

var after_start2 = '2023-08-01'; // Should match the reference state 
var after_end2 = '2023-08-25'; // Should match the reference state 

var before_collection2 = collection.filterDate(before_start2, before_end2);
var after_collection2 = collection.filterDate(after_start2, after_end2);

//----------------------------- Compare with the previous year 2022------------------------

var before_start2 = '2022-04-01';
var before_end2 = '2022-09-01';

var after_start2 = '2023-08-01'; // Should match the reference state 
var after_end2 = '2023-08-25'; // Should match the reference state 

var before_collection2 = collection.filterDate(before_start2, before_end2);
var after_collection2 = collection.filterDate(after_start2, after_end2);

// Create a mosaic of selected tiles and clip to the study area
var before2 = before_collection2.mosaic().clip(aoi);
var after2 = after_collection2.mosaic().clip(aoi);

// Apply radar speckle reduction by smoothing  
var smoothing_radius = 50;
var before_filtered2 = before2.focal_mean(smoothing_radius, 'circle', 'meters');
var after_filtered2 = after2.focal_mean(smoothing_radius, 'circle', 'meters');

// Calculate the difference between the before and after images
var difference2 = after_filtered2.divide(before_filtered2);

// Apply the predefined difference-threshold and create the flood extent mask 
var threshold2 = difference_threshold;
var difference_binary2 = difference2.gt(threshold2);

// Refine the flood result using additional datasets
// Include the JRC layer on surface water seasonality to mask flood pixels from areas
// with "permanent" water (water > 10 months of the year)
var swater = ee.Image('JRC/GSW1_0/GlobalSurfaceWater').select('seasonality');
var swater_mask = swater.gte(10).updateMask(swater.gte(10));

// Create a flooded mask where perennial water bodies (water > 10 mo/yr) are assigned a 0 value
var flooded_mask2 = difference_binary2.where(swater_mask, 0);
// Create the final flooded area without pixels in perennial water bodies
var flooded2 = flooded_mask2.updateMask(flooded_mask2);

// Compute the connectivity of pixels to eliminate those connected to 8 or fewer neighbors
// This operation reduces noise in the flood extent product
var connections2 = flooded2.connectedPixelCount();
var flooded2 = flooded2.updateMask(connections2.gte(8));

// Mask out areas with more than 5 percent slope using a Digital Elevation Model
var DEM = ee.Image('users/vegar/dem_10m_kartverket');
var terrain = ee.Algorithms.Terrain(DEM);
var slope = terrain.select('slope');
flooded2 = flooded2.updateMask(slope.lt(5));

// Calculate flood extent area
// Create a raster layer containing the area information of each pixel 
var flood_pixelarea2 = flooded2.select(polarization)
  .multiply(ee.Image.pixelArea());

// Sum the areas of flooded pixels
// The default 'bestEffort' is set to true to reduce computation time; for a more 
// accurate result, set 'bestEffort' to false and increase 'maxPixels'. 
var flood_stats2 = flood_pixelarea2.reduceRegion({
  reducer: ee.Reducer.sum(),              
  geometry: aoi,
  scale: 10, // native resolution 
  //maxPixels: 1e9,
  bestEffort: true
});

// Convert the flood extent to hectares (area calculations are originally given in meters)  
var flood_area_ha2 = flood_stats2
  .getNumber(polarization)
  .divide(10000)
  .round();

// Flooded areas
//Map.addLayer(flooded2, {palette: "0FFFFF"}, 'Flooded areas 2022', 1);

//----------------------------- Compare with the previous year 2021------------------------

var before_start3 = '2021-04-01';
var before_end3 = '2021-09-01';

var after_start3 = '2023-08-01'; // Should match the reference state 
var after_end3 = '2023-08-25'; // Should match the reference state 

var before_collection3 = collection.filterDate(before_start3, before_end3);
var after_collection3 = collection.filterDate(after_start3, after_end3);

// Create a mosaic of selected tiles and clip to the study area
var before3 = before_collection3.mosaic().clip(aoi);
var after3 = after_collection3.mosaic().clip(aoi);

// Apply radar speckle reduction by smoothing  
var before_filtered3 = before3.focal_mean(smoothing_radius, 'circle', 'meters');
var after_filtered3 = after3.focal_mean(smoothing_radius, 'circle', 'meters');

// Calculate the difference between the before and after images
var difference3 = after_filtered3.divide(before_filtered3);

// Apply the predefined difference-threshold and create the flood extent mask 
var threshold3 = difference_threshold;
var difference_binary3 = difference3.gt(threshold3);

// Refine the flood result using additional datasets
// Include the JRC layer on surface water seasonality to mask flood pixels from areas
// with "permanent" water (water > 10 months of the year)
swater = ee.Image('JRC/GSW1_0/GlobalSurfaceWater').select('seasonality');
swater_mask = swater.gte(10).updateMask(swater.gte(10));

// Create a flooded mask where perennial water bodies (water > 10 mo/yr) are assigned a 0 value
var flooded_mask3 = difference_binary3.where(swater_mask, 0);
// Create the final flooded area without pixels in perennial water bodies
var flooded3 = flooded_mask3.updateMask(flooded_mask3);

// Compute the connectivity of pixels to eliminate those connected to 8 or fewer neighbors
// This operation reduces noise in the flood extent product
var connections3 = flooded3.connectedPixelCount();
flooded3 = flooded3.updateMask(connections3.gte(8));

// Mask out areas with more than 5 percent slope using a Digital Elevation Model
flooded3 = flooded3.updateMask(slope.lt(5));

// Calculate flood extent area
// Create a raster layer containing the area information of each pixel 
var flood_pixelarea3 = flooded3.select(polarization)
  .multiply(ee.Image.pixelArea());

// Sum the areas of flooded pixels
// The default 'bestEffort' is set to true to reduce computation time; for a more 
// accurate result, set 'bestEffort' to false and increase 'maxPixels'. 
var flood_stats3 = flood_pixelarea3.reduceRegion({
  reducer: ee.Reducer.sum(),              
  geometry: aoi,
  scale: 10, // native resolution 
  //maxPixels: 1e9,
  bestEffort: true
});

// Convert the flood extent to hectares (area calculations are originally given in meters)  
var flood_area_ha3 = flood_stats3
  .getNumber(polarization)
  .divide(10000)
  .round();

// Flooded areas
//Map.addLayer(flooded3, {palette: "0FFFFF"}, 'Flooded areas 2021', 1);

//----------------------------- Compare with the previous year 2020------------------------

var before_start4 = '2020-04-01'; 
var before_end4 = '2020-09-01';

var after_start4 = '2023-08-01'; // Should match the reference state 
var after_end4 = '2023-08-25'; // Should match the reference state 

var before_collection4 = collection.filterDate(before_start4, before_end4);
var after_collection4 = collection.filterDate(after_start4, after_end4);

// Create a mosaic of selected tiles and clip to the study area
var before4 = before_collection4.mosaic().clip(aoi);
var after4 = after_collection4.mosaic().clip(aoi);

// Apply radar speckle reduction by smoothing  
var before_filtered4 = before4.focal_mean(smoothing_radius, 'circle', 'meters');
var after_filtered4 = after4.focal_mean(smoothing_radius, 'circle', 'meters');

// Calculate the difference between the before and after images
var difference4 = after_filtered4.divide(before_filtered4);

// Apply the predefined difference-threshold and create the flood extent mask 
var threshold4 = difference_threshold;
var difference_binary4 = difference4.gt(threshold4);

// Refine the flood result using additional datasets
// Include the JRC layer on surface water seasonality to mask flood pixels from areas
// with "permanent" water (water > 10 months of the year)
swater = ee.Image('JRC/GSW1_0/GlobalSurfaceWater').select('seasonality');
swater_mask = swater.gte(10).updateMask(swater.gte(10));

// Create a flooded mask where perennial water bodies (water > 10 mo/yr) are assigned a 0 value
var flooded_mask4 = difference_binary4.where(swater_mask, 0);
// Create the final flooded area without pixels in perennial water bodies
var flooded4 = flooded_mask4.updateMask(flooded_mask4);

// Compute the connectivity of pixels to eliminate those connected to 8 or fewer neighbors
// This operation reduces noise in the flood extent product
var connections4 = flooded4.connectedPixelCount();
flooded4 = flooded4.updateMask(connections4.gte(8));

// Mask out areas with more than 5 percent slope using a Digital Elevation Model
flooded4 = flooded4.updateMask(slope.lt(5));

// Calculate flood extent area
// Create a raster layer containing the area information of each pixel 
var flood_pixelarea4 = flooded4.select(polarization)
  .multiply(ee.Image.pixelArea());

// Sum the areas of flooded pixels
// The default 'bestEffort' is set to true to reduce computation time; for a more 
// accurate result, set 'bestEffort' to false and increase 'maxPixels'. 
var flood_stats4 = flood_pixelarea4.reduceRegion({
  reducer: ee.Reducer.sum(),              
  geometry: aoi,
  scale: 10, // native resolution 
  //maxPixels: 1e9,
  bestEffort: true
});

// Convert the flood extent to hectares (area calculations are originally given in meters)  
var flood_area_ha4 = flood_stats4
  .getNumber(polarization)
  .divide(10000)
  .round();

// Flooded areas
//Map.addLayer(flooded4, {palette: "0FFFFF"}, 'Flooded areas 2020', 1);

//----------------------------- Compare with the previous year 2019------------------------

var before_start5 = '2019-04-01';
var before_end5 = '2019-09-01';

var after_start5 = '2019-08-01'; // Should match the reference state 
var after_end5 = '2019-08-25'; // Should match the reference state 

var before_collection5 = collection.filterDate(before_start5, before_end5);
var after_collection5 = collection.filterDate(after_start5, after_end5);

// Create a mosaic of selected tiles and clip to the study area
var before5 = before_collection5.mosaic().clip(aoi);
var after5 = after_collection5.mosaic().clip(aoi);

// Apply radar speckle reduction by smoothing  
var before_filtered5 = before5.focal_mean(smoothing_radius, 'circle', 'meters');
var after_filtered5 = after5.focal_mean(smoothing_radius, 'circle', 'meters');

// Calculate the difference between the before and after images
var difference5 = after_filtered5.divide(before_filtered5);

// Apply the predefined difference-threshold and create the flood extent mask 
var threshold5 = difference_threshold;
var difference_binary5 = difference5.gt(threshold5);

// Refine the flood result using additional datasets
// Include the JRC layer on surface water seasonality to mask flood pixels from areas
// with "permanent" water (water > 10 months of the year)
swater = ee.Image('JRC/GSW1_0/GlobalSurfaceWater').select('seasonality');
swater_mask = swater.gte(10).updateMask(swater.gte(10));

// Create a flooded mask where perennial water bodies (water > 10 mo/yr) are assigned a 0 value
var flooded_mask5 = difference_binary5.where(swater_mask, 0);
// Create the final flooded area without pixels in perennial water bodies
var flooded5 = flooded_mask5.updateMask(flooded_mask5);

// Compute the connectivity of pixels to eliminate those connected to 8 or fewer neighbors
// This operation reduces noise in the flood extent product
var connections5 = flooded5.connectedPixelCount();
flooded5 = flooded5.updateMask(connections5.gte(8));

// Mask out areas with more than 5 percent slope using a Digital Elevation Model
flooded5 = flooded5.updateMask(slope.lt(5));

// Calculate flood extent area
// Create a raster layer containing the area information of each pixel 
var flood_pixelarea5 = flooded5.select(polarization)
  .multiply(ee.Image.pixelArea());

// Sum the areas of flooded pixels
// The default 'bestEffort' is set to true to reduce computation time; for a more 
// accurate result, set 'bestEffort' to false and increase 'maxPixels'. 
var flood_stats5 = flood_pixelarea5.reduceRegion({
  reducer: ee.Reducer.sum(),              
  geometry: aoi,
  scale: 10, // native resolution 
  //maxPixels: 1e9,
  bestEffort: true
});

// Convert the flood extent to hectares (area calculations are originally given in meters)  
var flood_area_ha5 = flood_stats5
  .getNumber(polarization)
  .divide(10000)
  .round();

// Flooded areas
//Map.addLayer(flooded5, {palette: "0FFFFF"}, 'Flooded areas 2019', 1);

//----------------------------- Frequency ----------------------------//

// Calculate the frequency

// Unmask the two images and add them together
var flooded_unmasked = flooded.unmask(0);
var flooded2_unmasked = flooded2.unmask(0);
var flooded3_unmasked = flooded3.unmask(0);
var flooded4_unmasked = flooded4.unmask(0);
var flooded5_unmasked = flooded5.unmask(0);

var floodFrequency = flooded_unmasked.add(flooded2_unmasked)
  .add(flooded3_unmasked)
  .add(flooded4_unmasked)
  .add(flooded5_unmasked);

// Define the flood frequency image with a mask for zero values
var maskedFloodFrequency = floodFrequency.updateMask(floodFrequency.gt(0));

// Define a color palette for flood frequency
var colorPalette = ['lightblue', 'blue', 'purple', 'pink', 'red'];

// Add the flood frequency image to the map with the updated color palette
Map.addLayer(maskedFloodFrequency, {min: 1, max: 5, palette: colorPalette}, 'Flood Frequency', 0);

//----------------------------- Affected wetland land ----------------------------//

// Load the wetland map
var myrpred2 = ee.ImageCollection('users/vegarbakkestuen/Myr153');
var myr = myrpred2.mean().select('impervious'); // Select the band 'b1' from the wetland map

// Calculate affected wetland areas using the resampled flood layer and wetland map

// Use areas from the myr dataset as geometry
var wetlandAreas = myr.gt(0.8).selfMask(); // Select areas with wetlands and use geometry as a mask
var wetlandAffected = maskedFloodFrequency.updateMask(wetlandAreas);

// Get pixel area of the affected wetland layer
var wetlandPixelArea = wetlandAffected.multiply(ee.Image.pixelArea()); // Calculate the area of each pixel 

// Sum the pixels of the affected wetland layer
var wetlandStats = wetlandPixelArea.reduceRegion({
  reducer: ee.Reducer.sum(), // Sum all pixels with area information                
  geometry: aoi,
  scale: 500,
  maxPixels: 1e9
});

Map.addLayer(wetlandAffected, {min: 1, max: 5, palette: colorPalette}, 'Flood Frequency in Wetlands');


</script>
</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="insect-indicators.html"><span class="header-section-number">10</span> Insect indicators</a></div>
<div class="next"><a href="NDVI-indicator-natopen.html"><span class="header-section-number">12</span> NDVI - Naturally Open Ecosystems</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#flood-frequency"><span class="header-section-number">11</span> Flood frequency</a></li>
<li><a class="nav-link" href="#intro-ff"><span class="header-section-number">11.1</span> Introduction</a></li>
<li>
<a class="nav-link" href="#underlying-data-ff"><span class="header-section-number">11.2</span> About the underlying data</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#rep-time-space-ff"><span class="header-section-number">11.2.1</span> Representativity in time and space</a></li>
<li><a class="nav-link" href="#original-units-5"><span class="header-section-number">11.2.2</span> Original units</a></li>
<li><a class="nav-link" href="#temporal-coverage-6"><span class="header-section-number">11.2.3</span> Temporal coverage</a></li>
<li><a class="nav-link" href="#aditional-comments-about-the-dataset-2"><span class="header-section-number">11.2.4</span> Aditional comments about the dataset</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#ecosystem-characteristic-6"><span class="header-section-number">11.3</span> Ecosystem characteristic</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#seea-ea-un-standard-1"><span class="header-section-number">11.3.1</span> SEEA EA (UN standard)</a></li></ul>
</li>
<li><a class="nav-link" href="#collinearities-with-other-indicators-9"><span class="header-section-number">11.4</span> Collinearities with other indicators</a></li>
<li>
<a class="nav-link" href="#reference-condition-and-values-5"><span class="header-section-number">11.5</span> Reference condition and values</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#reference-condition-5"><span class="header-section-number">11.5.1</span> Reference condition</a></li>
<li><a class="nav-link" href="#reference-values-thresholds-for-defining-good-ecological-condition-minimum-andor-maximum-values-5"><span class="header-section-number">11.5.2</span> Reference values, thresholds for defining good ecological condition, minimum and/or maximum values</a></li>
</ul>
</li>
<li><a class="nav-link" href="#references-8"><span class="header-section-number">11.6</span> References</a></li>
<li>
<a class="nav-link" href="#analyses-3"><span class="header-section-number">11.7</span> Analyses</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#nve-data"><span class="header-section-number">11.7.1</span> NVE data</a></li>
<li><a class="nav-link" href="#scaled-indicator-values"><span class="header-section-number">11.7.2</span> Scaled indicator values</a></li>
<li><a class="nav-link" href="#uncertainty-1"><span class="header-section-number">11.7.3</span> Uncertainty</a></li>
</ul>
</li>
<li><a class="nav-link" href="#java-code"><span class="header-section-number">11.8</span> JAVA code</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/NINAnor/ecosystemCondition/blob/master/flood_frequency.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/NINAnor/ecosystemCondition/edit/master/flood_frequency.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Indicators for Ecosystem Condition in Norway</strong>" was written by Anders L. Kolstad. It was last built on 2023-10-23.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
