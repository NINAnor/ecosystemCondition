<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Indicators for Ecosystem Condition in Norway</title>

    <meta name="author" content="Anders L. Kolstad" />
  
   <meta name="description" content="<p>This is a site for documenting the analyses related to the development and design of ecosystem condition indicators.</p>" />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="Indicators for Ecosystem Condition in Norway" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="<a href="https://ninanor.github.io/ecosystemCondition/index.html" class="uri">https://ninanor.github.io/ecosystemCondition/index.html</a>" />
  
  <meta property="og:description" content="<p>This is a site for documenting the analyses related to the development and design of ecosystem condition indicators.</p>" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Indicators for Ecosystem Condition in Norway" />
  
  <meta name="twitter:description" content="<p>This is a site for documenting the analyses related to the development and design of ecosystem condition indicators.</p>" />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.4.2/transition.js"></script>
    <script src="libs/bs3compat-0.4.2/tabs.js"></script>
    <script src="libs/bs3compat-0.4.2/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.27/datatables.js"></script>
    <link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
      <link rel="stylesheet" href="style.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<!--bookdown:title:start-->
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Indicators for Ecosystem Condition in Norway</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="about" class="section level1 unnumbered">
<h1 class="unnumbered">About <img src="images/hexSticker_EC.png" align="right" height="139"/></h1>
<p>On this site you may view the nitty gritty details for how certain indicators for ecosystem condition for Norway has been calculated.</p>
<p>The web page is made to document the work related to a R&amp;D project to develop indicators for ecosystem condition for three main ecosystems in Norway: wetlands, open areas below the forest line, and semi-natural land. These indicators are not yet used in real assessments, and may represent unfinished work pending future data availability. In addition, we may chose to also present some analyses documenting indicators that <em>are</em> used in existing assessments of ecosystem condition.</p>
<div id="eatools" class="section level2 unnumbered">
<h2 class="unnumbered">eaTools <img src="images/eaTools-logo.png" align="right" height="139"/></h2>
<p><code>eaTools</code> is an R package aimed at solving common tasks in GIS oriented ecosystem accounting, especially ecosystem condition accounting. We will use functions from this package, such as this function to normalise condition variables seen in Figure @ref(fig:eaTools-example).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#devtools::install_github(&quot;NINAnor/eaTools&quot;)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(eaTools)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Import example data</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;ex_polygons&quot;</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the questionmark to readabout the example data sets or to view the  function documentation </span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#?ex_polygons</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>eaTools<span class="sc">::</span><span class="fu">ea_normalise</span>(<span class="at">data =</span> ex_polygons,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">vector =</span> <span class="st">&quot;condition_variable_2&quot;</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">upper_reference_level =</span> <span class="dv">7</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">scaling_function =</span> <span class="st">&quot;sigmoid&quot;</span>,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">plot =</span> T)</span></code></pre></div>
<div class="figure">
<img src="index_files/figure-html/eaTools-example-1.png" alt="A normalised condition variable is called an indicator. This indicator had been transformed with a sigmoid function." width="672" />
<p class="caption">
(#fig:eaTools-example)A normalised condition variable is called an indicator. This indicator had been transformed with a sigmoid function.
</p>
</div>
<p>See the <a href="https://ninanor.github.io/eaTools/index.html">package documentation</a>, especially under <em>Articles</em> for more information and examples of use.</p>
</div>
<div id="community-review" class="section level2 unnumbered">
<h2 class="unnumbered">Community review</h2>
<p>We want our work to be transparent and credible. Therefor we encourage all types of feedback on the analyses of the indicators for ecological condition that you can read about on this web site. To submit your comments, please to to <a href="https://github.com/NINAnor/ecosystemCondition/issues"><em>this github repository</em></a> and open a new <em>issue</em> and we will answer them there.</p>
<p><img src="images/newIssue.PNG" width="600"/></p>
</div>
<div id="author-guidelines" class="section level2 unnumbered">
<h2 class="unnumbered">Author guidelines</h2>
<p>This project uses a type of standardised reporting where reproducible workflows (typically code) for calculating each indicator is presented on separate webpages within a shared website. The website is built from the GitHub repo using seperate RMarkdown files for each chapter. These files must be in English. The process of authoring and sharing/distributing these Rmarkdown-files is explained below.</p>
<p>It is highly encouraged that the indicators are delivered as georeferenced maps, hereafter called indicator maps, and not a simple tables. There is a common structure that all indicator maps should follow. The indicator maps can be vector formats raster formats. For vector data, .Rdata or .rds files can be used, as for example shape files do not allow field names (i.e. column names) that are as long as the ones we use. All georeferenced data should use EPSG:25833 - ETRS89 / UTM zone 33N.</p>
<p>Indicator maps should have the highest possible spatial resolution possible but weighing this against the need for spatial representativity. For example, you may need to aggregate x number of data points to get an average which is stable and representative for a given region. There is no need to spatially aggregate indicator maps any further, for example to produce a national estimate.</p>
<p>The indicator values, reference values ect should be mapped to the following columns (vector data) or bands (raster data):</p>
<ul>
<li><code>v_YYYY</code> for variable value (i.e. un-scaled or raw indicator values) for year YYYY.</li>
<li><code>sd_YYYY</code> for the standard deviation associated with v_YYYY. Other measures for uncertainty is currently not supported.</li>
<li><code>referance_high</code> for the reference value, i.e. the value of the variable <em>v</em> under reference conditions. This value cannot vary between years.</li>
<li><code>referance_low</code> for the lower limit reference value, i.e. the worst possible value of the variable <em>v</em>. This value cannot vary between years. If missing, this value is assumed to be zero.</li>
<li><code>thr</code> for the threshold value defining <em>good condition</em> for variable <em>v</em>. If missing, this value will default to 0.6.</li>
<li><code>i_YYYY</code> for the indicator value at year YYYY. This value depends on all the above values, but also the scaling function (.e. linear, exponential, two-sided, ect.). The scaling function needs to be presented in other documentation.</li>
</ul>
<p>The rest of the workflow is as follows.</p>
<ul>
<li>Obtain a <em>go ahead</em> signal from the coordination group to make sure you are free to start your work</li>
<li>Read the <a href="template.Rmd"><code>template.Rmd</code></a> file. Make a copy of it and store it, in the same (root) folder as <code>DRAFT_myIndicator.Rmd</code>. (For an example, see <code>DRAFT_breareal.Rmd</code>). Finish your documentation and analyses there.
<ul>
<li>You can load data from internal NINA servers, from web hosts, of store smaller data set under <code>data</code>. The <code>data</code> folder also contains some supporting data sets that you may want to use, such as a delineation of the five regions used in the ecosystem assessment (<code>data/regions.shp</code>), and an outline of Norway (<code>outlineOfNorway_EPSG25833.shp</code>).</li>
<li>To preview you rmarkdown file as html in R, type <code>rmarkdown::render('DRAFT_myIndicator.Rmd', output_format = "html_document", output_dir = "temp")</code> in the console (the knitr shortcuts don’t work as expected inside bookdown projects).</li>
<li>When filling out the template.Rmd file with your own work, try not to change the headers too much.</li>
<li>Final result from the analyses should be written to the <code>indicators</code> folder. The preferred output is georeferenced data (rasters or shape files), and these should be placed under <code>indators/indicatorMaps</code>. Non-georeferenced data, like data tables, can be stored under <code>indicators</code>.</li>
</ul></li>
<li>Make a pull request to the main <a href="https://github.com/NINAnor/ecosystemCondition"><em>GitHub repository</em></a> to submit your file. If you are not comfortable using GitHub, contac Anders to rrange sending the files via email.</li>
<li>Anders or someone else in the project wil conduct a rapid code review, making sure the code is reproducible, interpretable and that it renders locally on the R Studio server.</li>
<li>When approved, the reviewer will make a copy of the DRAFT_ file, removing the DRAFT_ part of the name, as well as the YML header, and as well as updating the rmd_files part of _bookdown.yml. (For an example of such a file, see <code>breareal.Rmd</code>.)</li>
<li>To update the web site (this web site), an admin user needs to pull down the repo to R Studio server, compile the book there (Ctr+Shift+B), commit and push to main. The html version of the book will be in the <code>docs</code> folder.</li>
</ul>
<!--chapter:end:index.Rmd-->
</div>
</div>
<div id="overview-of-indicators" class="section level1 unnumbered">
<h1 class="unnumbered">Overview of indicators</h1>
<p><em><em>Lacking content</em></em>
The idea of this page is to give a quick overview of the available indicators, and to possibly present the Norwegian fact sheets for each. For now this page is just an example what it could look like.</p>
<div id="areal-av-isbreer-glacier-area" class="section level2 unnumbered">
<h2 class="unnumbered">Areal av isbreer / Glacier area</h2>
<p>This indicator reflects the relative loss of glacial area between tha last climatic normal persion and today.</p>
<table>
<caption>
(#tab:unnamed-chunk-1)Fakatark for tilstandindikatoren Areal av isbreer
</caption>
<tbody>
<tr>
<td style="text-align:left;">
Indikator
</td>
<td style="text-align:left;">
Areal av isbreer
</td>
</tr>
<tr>
<td style="text-align:left;">
Utfylling.av.protokollen
</td>
<td style="text-align:left;">
Anders L. Kolstad
</td>
</tr>
<tr>
<td style="text-align:left;">
Data.utfylt.revidert
</td>
<td style="text-align:left;">
08.12.2021
</td>
</tr>
</tbody>
</table>
</div>
<div id="indicator-x" class="section level2 unnumbered">
<h2 class="unnumbered">Indicator X</h2>
<p>And this indicator is about…</p>
<!--chapter:end:02-overview.Rmd-->
</div>
</div>
<div id="part-indicators-from-the-alpine-assessment" class="section level1 unnumbered">
<h1 class="unnumbered">(PART*) INDICATORS FROM THE ALPINE ASSESSMENT</h1>
</div>
<div id="areal-av-isbreer" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Areal av isbreer</h1>
<p><br /></p>
<p><em>Author and date:</em>
Anders Kolstad</p>
<pre><code>#&gt; [1] &quot;2023-03-24&quot;</code></pre>
<p><br /></p>
<table>
<colgroup>
<col width="12%" />
<col width="36%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Ecosystem</th>
<th align="left">Økologisk.egenskap</th>
<th align="left">ECT.class</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Fjell</td>
<td align="left">Landskapsøkologiske mønstre</td>
<td align="left">Landscape and seascape characteristics</td>
</tr>
</tbody>
</table>
<br />
<br />
<hr />
<div id="introduction" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Introduction</h2>
<p>This indicator describes the relative change in glacial extent for each of fire regions in Norway. A <a href="https://ninanor.github.io/IBECA/faktaark.html#Areal_av_isbreer">slightly different indicator</a> was used in the alpine assessment.</p>
</div>
<div id="about-the-underlying-data" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> About the underlying data</h2>
<p>The indicator uses the maps of glacier extent ( <em>breatlas</em> ) from <a href="https://www.nve.no/vann-og-vassdrag/vannets-kretsloep/bre/publikasjoner-publications/breatlas-glacier-inventories/">2018-2019</a> and compares it to a similar map from 1947-1985. Both maps are owned by NVE (Norsk vassdrags og energidirektorat). The new map is based on Sentinel images, and the old map is a digitised version of the N50 maps, with some additional areal photo interpretation on top.</p>
<div id="representativity-in-time-and-space" class="section level3" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> Representativity in time and space</h3>
<p>The data set (map) covers the entire Norwegian mainland. There are only two time steps, but we expect changes in glacial extent to be relatively linear or consistent over time.
The older map may have underestimated the glacial extent due to a better chance of smaller snow and ice patches being captured by Sentinel contra aerial photo interpretations.</p>
</div>
<div id="original-units" class="section level3" number="1.2.2">
<h3><span class="header-section-number">1.2.2</span> Original units</h3>
<p>Area units (e.g. km2)</p>
</div>
<div id="temporal-coverage" class="section level3" number="1.2.3">
<h3><span class="header-section-number">1.2.3</span> Temporal coverage</h3>
<p>1947-2019</p>
</div>
<div id="aditional-comments-about-the-dataset" class="section level3" number="1.2.4">
<h3><span class="header-section-number">1.2.4</span> Aditional comments about the dataset</h3>
<p>None</p>
</div>
</div>
<div id="ecosystem-characteristic" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Ecosystem characteristic</h2>
<div id="norwegian-standard" class="section level3" number="1.3.1">
<h3><span class="header-section-number">1.3.1</span> Norwegian standard</h3>
<p>The indicator was initially assigned the <em>Abiotiske forhold</em> characteristic, but now it is considered under <em>Landskapsøkologiske mønstre</em>. The initial justificaton was that glacial melting would influence water availability downstream. Now we put more weight on glaciers as not just resevoirs of ice and water, but as a habitat, and the presence or abundance of a specific habitat can be though of as an aspect of landscape state.</p>
</div>
<div id="seea-ect" class="section level3" number="1.3.2">
<h3><span class="header-section-number">1.3.2</span> SEEA ECT</h3>
<p>The indicator is similarly assiged to the SEEA ECT class <em>C1 Landscape characteristics</em>.</p>
</div>
</div>
<div id="collinearities-with-other-indicators" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> Collinearities with other indicators</h2>
<p>None that are known.</p>
</div>
<div id="reference-state-and-values" class="section level2" number="1.5">
<h2><span class="header-section-number">1.5</span> Reference state and values</h2>
<div id="reference-state" class="section level3" number="1.5.1">
<h3><span class="header-section-number">1.5.1</span> Reference state</h3>
<p>The indicator uses the same reference state as all or most of the indicators developed in this and in similar projects, and is defined in <a href="https://www.regjeringen.no/no/dokumenter/fagsystem-for-fastsetting-av-god-okologisk-tilstand/id2558481/">Nybø et al (2017): Fagsystem for fastsetting av god økologisk tilstand</a>. As glacial extent is primarily, or solely, dependent on climate, we are in a case where we have actual data from the climatic reference period which is the previous normal period 1961-1990.</p>
</div>
<div id="reference-values-thresholds-for-defining-good-ecological-condition-minimum-andor-maximum-values" class="section level3" number="1.5.2">
<h3><span class="header-section-number">1.5.2</span> Reference values, thresholds for defining <em>good ecological condition</em>, minimum and/or maximum values</h3>
<p>The reference value is zero change in glacial extent over time. The threshold for defining good ecological condition as set at a 40% reduction in glacial extent, as a default solution. This normalization follows a linear model, although a sigmoidal weibull function might be more appropriate.</p>
<p>The minimum value is set to zero.</p>
</div>
</div>
<div id="uncertainties" class="section level2" number="1.6">
<h2><span class="header-section-number">1.6</span> Uncertainties</h2>
<p>Here we add a 3% error on each side of the estimates, same as what is reported for the glacier maps from NVE.</p>
</div>
<div id="references" class="section level2" number="1.7">
<h2><span class="header-section-number">1.7</span> References</h2>
<ul>
<li><p>Andreassen, L.M., &amp; Winsvold, S.H. (eds.). 2012. Inventory of Norwegian glaciers. NVE Rapport 38, Norges Vassdrags- og energidirektorat, 236 s</p></li>
<li><p>Andreassen, L.M., Elvehøy, H., Kjøllmoen, B. &amp; Belart, J.M.C. 2020. Glacier change in Norway since the 1960s – an overview of mass balance, area, length and surface elevation changes. Journal of Glaciology 66: 313–328</p></li>
<li><p>Andreassen, L.M., Nagy, T., Kjøllmoen, B. &amp; Leigh, J.R. 2022. A Sentinel-2 based inventory of Norway’s glaciers and ice-marginal lakes 2018/2019. Journal of Glaciology (in review)</p></li>
<li><p>Winsvold, S.H., Andreassen, L.M. &amp; Kienholz, C.. 2014. Glacier area and length changes in Norway from repeat inventories. The Cryosphere 8: 1885-1903</p></li>
</ul>
</div>
<div id="analyses" class="section level2" number="1.8">
<h2><span class="header-section-number">1.8</span> Analyses</h2>
<div id="importing-the-data-sets" class="section level3" number="1.8.1">
<h3><span class="header-section-number">1.8.1</span> Importing the data sets</h3>
<p>There are four data sets:</p>
<ul>
<li>glacial atlas</li>
<li>n50 (the old glacial atlas)</li>
<li>the regional delineation for Norway (fire regions)</li>
<li>an outline of mainland Norway</li>
</ul>
<p>We are assuming all glaciers are found in the mountins, se we do not need to mask the glacial atlas data using an ecosystem delineation map.</p>
<div id="glacial-atlas" class="section level4" number="1.8.1.1">
<h4><span class="header-section-number">1.8.1.1</span> Glacial atlas</h4>
<p>This is the new glacial atlas from 2018 and 2019 based on Sentinell (ref. Liss Marie Andreassen, NVE)</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># server path</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>breatlas_path <span class="ot">&lt;-</span> <span class="st">&#39;/data/P-Prosjekter/41201042_okologisk_tilstand_fastlandsnorge_2020_dataanaly/fjell2021/data/breatlas/breatlas_2018_2019/Breatlas_20182019_temp20210922_lma.shp&#39;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># local path </span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#breatlas_path &lt;- &#39;P:/41201042_okologisk_tilstand_fastlandsnorge_2020_dataanaly/fjell2021/data/breatlas/breatlas_2018_2019/Breatlas_20182019_temp20210922_lma.shp&#39;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>breatlas <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(breatlas_path)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Reading layer `Breatlas_20182019_temp20210922_lma&#39; from data source `/data/P-Prosjekter/41201042_okologisk_tilstand_fastlandsnorge_2020_dataanaly/fjell2021/data/breatlas/breatlas_2018_2019/Breatlas_20182019_temp20210922_lma.shp&#39; </span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   using driver `ESRI Shapefile&#39;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 6915 features and 27 fields (with 4 geometries empty)</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -9874.591 ymin: 6624398 xmax: 810132 ymax: 7836994</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Projected CRS: ETRS89 / UTM zone 33N</span></span></code></pre></div>
<p>All maps made in this project need to have the same CRS: EPSG:25833 - ETRS89 / UTM zone 33N.
This one is in UTM 33N ETRS89, even if it is defined in the old Proj.4 way.</p>
<p>There are 6915 polygons. Let’s calculate the area of the polygons and study the distribution of size classes.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>breatlas<span class="sc">$</span>area <span class="ot">&lt;-</span> <span class="fu">st_area</span>(breatlas)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(breatlas<span class="sc">$</span>area)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(breatlas<span class="sc">$</span>area)</span></code></pre></div>
<p><img src="breareal_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Most polygons are small, and then there are a couple of very big ones. The largest polygon is 50 km2, but note that some polygons are somewhat arbitrarily split.</p>
</div>
<div id="map-of-norway" class="section level4" number="1.8.1.2">
<h4><span class="header-section-number">1.8.1.2</span> Map of Norway</h4>
<p>This map is stored on the GitHub repository under <em>indicators/data/</em>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>nor <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">&quot;data/outlineOfNorway_EPSG25833.shp&quot;</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nor<span class="sc">$</span>geometry, <span class="at">axes=</span>T, <span class="at">main =</span> <span class="st">&quot;Breatlas 2018-2019&quot;</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(breatlas<span class="sc">$</span>geometry, <span class="at">add=</span>T, <span class="at">border =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="breareal_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="n50" class="section level4" number="1.8.1.3">
<h4><span class="header-section-number">1.8.1.3</span> N50</h4>
<p>This is the old glacial extent map. Import it and transform it, same as before.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># server path</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>n50_path <span class="ot">&lt;-</span> <span class="st">&#39;/data/P-Prosjekter/41201042_okologisk_tilstand_fastlandsnorge_2020_dataanaly/fjell2021/data/breatlas/n50/cryoclim_GAO_NO_1952_1985_UTM_33N.shp&#39;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># local path</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#n50_path &lt;- &#39;P:/41201042_okologisk_tilstand_fastlandsnorge_2020_dataanaly/fjell2021/data/breatlas/n50/cryoclim_GAO_NO_1952_1985_UTM_33N.shp&#39;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>n50 <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(n50_path)<span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">crs</span>(breatlas))</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Reading layer `cryoclim_GAO_NO_1952_1985_UTM_33N&#39; from data source `/data/P-Prosjekter/41201042_okologisk_tilstand_fastlandsnorge_2020_dataanaly/fjell2021/data/breatlas/n50/cryoclim_GAO_NO_1952_1985_UTM_33N.shp&#39; </span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   using driver `ESRI Shapefile&#39;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 7141 features and 30 fields</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -7278.562 ymin: 6623024 xmax: 812207.8 ymax: 7841654</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Projected CRS: WGS 84 / UTM zone 33N</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nor<span class="sc">$</span>geometry, <span class="at">axes=</span>T, <span class="at">main =</span> <span class="st">&quot;n50 - 1952-1985&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(n50<span class="sc">$</span>geometry, <span class="at">add=</span>T, <span class="at">border =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="breareal_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Let’s now plot it all on top of each other.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># define some boundary boxes for zooming in on specific regions</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>myExt <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">extent</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100000</span>, <span class="dv">6840000</span>, <span class="dv">6900000</span>))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>myExt2 <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">extent</span>(<span class="fu">c</span>(<span class="dv">5000</span>, <span class="dv">10000</span>, <span class="dv">6880000</span>, <span class="dv">6885000</span>))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare plotting device with one row, three columns</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create three maps, each zooming in a bit further.</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nor<span class="sc">$</span>geometry, <span class="at">axes=</span>T)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(n50<span class="sc">$</span>geometry,  <span class="at">border =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">col =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(<span class="st">&quot;orange&quot;</span>, <span class="dv">1</span>), <span class="at">add=</span>T)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(myExt, <span class="at">add=</span>T, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nor<span class="sc">$</span>geometry, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100000</span>),</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">6840000</span>, <span class="dv">6900000</span>),</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">axes=</span>T)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(n50<span class="sc">$</span>geometry, <span class="at">add=</span>T, <span class="at">col =</span> <span class="st">&quot;grey&quot;</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(myExt2, <span class="at">add=</span>T, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">&quot;orange&quot;</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co"># for this last map I plot the old extent in red and the new as grey on top. The red areas still visible will be areas where the glaciers have retreated.        </span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nor<span class="sc">$</span>geometry, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">5000</span>, <span class="dv">10000</span>),</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">6880000</span>, <span class="dv">6885000</span>),</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">axes=</span>T)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(n50<span class="sc">$</span>geometry, <span class="at">add=</span>T, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(breatlas<span class="sc">$</span>geometry, <span class="at">add=</span>T, <span class="at">col =</span> <span class="st">&quot;grey&quot;</span>)</span></code></pre></div>
<p><img src="breareal_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>The red areas in the map to the far right is where the ice has retreated for a selected glacier on the west coast.
Now we need to devide the map into regions to then compare the area in n50 with the new glacial extent map <em>breatlas</em>.</p>
</div>
<div id="regions" class="section level4" number="1.8.1.4">
<h4><span class="header-section-number">1.8.1.4</span> Regions</h4>
<p>Importing a shape file with the regional delineation.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>reg <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;data/regions.shp&quot;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Reading layer `regions&#39; from data source </span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   `/data/scratch/Matt_bookdown__debug/ecosystemCondition/data/regions.shp&#39; </span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   using driver `ESRI Shapefile&#39;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 5 features and 2 fields</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -99551.21 ymin: 6426048 xmax: 1121941 ymax: 7962744</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Projected CRS: ETRS89 / UTM zone 33N</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(reg)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Coordinate Reference System:</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   User input: ETRS89 / UTM zone 33N </span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   wkt:</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; PROJCRS[&quot;ETRS89 / UTM zone 33N&quot;,</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     BASEGEOGCRS[&quot;ETRS89&quot;,</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         ENSEMBLE[&quot;European Terrestrial Reference System 1989 ensemble&quot;,</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             MEMBER[&quot;European Terrestrial Reference Frame 1989&quot;],</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             MEMBER[&quot;European Terrestrial Reference Frame 1990&quot;],</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             MEMBER[&quot;European Terrestrial Reference Frame 1991&quot;],</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             MEMBER[&quot;European Terrestrial Reference Frame 1992&quot;],</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             MEMBER[&quot;European Terrestrial Reference Frame 1993&quot;],</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             MEMBER[&quot;European Terrestrial Reference Frame 1994&quot;],</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             MEMBER[&quot;European Terrestrial Reference Frame 1996&quot;],</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             MEMBER[&quot;European Terrestrial Reference Frame 1997&quot;],</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             MEMBER[&quot;European Terrestrial Reference Frame 2000&quot;],</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             MEMBER[&quot;European Terrestrial Reference Frame 2005&quot;],</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             MEMBER[&quot;European Terrestrial Reference Frame 2014&quot;],</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ELLIPSOID[&quot;GRS 1980&quot;,6378137,298.257222101,</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                 LENGTHUNIT[&quot;metre&quot;,1]],</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ENSEMBLEACCURACY[0.1]],</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         PRIMEM[&quot;Greenwich&quot;,0,</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         ID[&quot;EPSG&quot;,4258]],</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     CONVERSION[&quot;UTM zone 33N&quot;,</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         METHOD[&quot;Transverse Mercator&quot;,</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,9807]],</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         PARAMETER[&quot;Latitude of natural origin&quot;,0,</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,8801]],</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         PARAMETER[&quot;Longitude of natural origin&quot;,15,</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,8802]],</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         PARAMETER[&quot;Scale factor at natural origin&quot;,0.9996,</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             SCALEUNIT[&quot;unity&quot;,1],</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,8805]],</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         PARAMETER[&quot;False easting&quot;,500000,</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             LENGTHUNIT[&quot;metre&quot;,1],</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,8806]],</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         PARAMETER[&quot;False northing&quot;,0,</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             LENGTHUNIT[&quot;metre&quot;,1],</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,8807]]],</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     CS[Cartesian,2],</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         AXIS[&quot;(E)&quot;,east,</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ORDER[1],</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             LENGTHUNIT[&quot;metre&quot;,1]],</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         AXIS[&quot;(N)&quot;,north,</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ORDER[2],</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             LENGTHUNIT[&quot;metre&quot;,1]],</span></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     USAGE[</span></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         SCOPE[&quot;Engineering survey, topographic mapping.&quot;],</span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         AREA[&quot;Europe between 12°E and 18°E: Austria; Denmark - offshore and offshore; Germany - onshore and offshore; Norway including Svalbard - onshore and offshore.&quot;],</span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         BBOX[46.4,12,84.42,18]],</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     ID[&quot;EPSG&quot;,25833]]</span></span></code></pre></div>
<p>Let’s plot it to make sure it is correct.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nor<span class="sc">$</span>geometry, <span class="at">axes=</span>T)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(reg<span class="sc">$</span>geometry, <span class="at">add=</span>T, <span class="at">border =</span> <span class="st">&quot;black&quot;</span>, </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(<span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;red&quot;</span>, </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;green&quot;</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;yellow&quot;</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;brown&quot;</span>), .<span class="dv">2</span>))</span></code></pre></div>
<p><img src="breareal_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>Get the region names</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(reg<span class="sc">$</span>region)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Nord-Norge&quot;      &quot;Midt-Norge&quot;      &quot;Ã\u0098stlandet&quot;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4] &quot;Vestlandet&quot;      &quot;SÃ¸rlandet&quot;</span></span></code></pre></div>
<p>These are odd. Let me fix the Norwegian letters manually.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>reg<span class="sc">$</span>region[reg<span class="sc">$</span>region<span class="sc">==</span><span class="st">&quot;Ã\u0098stlandet&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Østlandet&quot;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>reg<span class="sc">$</span>region[reg<span class="sc">$</span>region<span class="sc">==</span><span class="st">&quot;SÃ¸rlandet&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Sørlandet&quot;</span></span></code></pre></div>
<p>Before going any further I need to fix a problem with glacier polygons crossing themselves.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">st_is_valid</span>(breatlas))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; FALSE  TRUE </span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    68  6847</span></span></code></pre></div>
<p>68 polygons are not valid.
Let’s look at the first four reasons for why that is.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">st_is_valid</span>(breatlas, <span class="at">reason=</span>T))[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Valid Geometry&quot;                                       </span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2] &quot;Ring Self-intersection[100236.4931 6912507.5864]&quot;     </span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3] &quot;Ring Self-intersection[92500.2095999997 6900940.8003]&quot;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4] &quot;Ring Self-intersection[91965.6612 6883260.4912]&quot;      </span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5] &quot;Ring Self-intersection[120595.9254 6853573.4955]&quot;</span></span></code></pre></div>
<p>There is a convinient function to fix this.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># requires lwgeom</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>breatlas2 <span class="ot">&lt;-</span> <span class="fu">st_make_valid</span>(breatlas)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">st_is_valid</span>(breatlas2))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; TRUE </span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6915</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># same result:</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">#breatlas2 &lt;- st_buffer(breatlas, 0.0)</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">#table(st_is_valid(breatlas2))</span></span></code></pre></div>
<p>Let me plot the new, fixed map on top of the old to see if they match. I give the new valid map a blue transparent colour, and the old map a yellow and transparent colour.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nor<span class="sc">$</span>geometry, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">5000</span>, <span class="dv">10000</span>),</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">6880000</span>, <span class="dv">6885000</span>),</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">axes=</span>T)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(breatlas2<span class="sc">$</span>geometry, <span class="at">add=</span>T, <span class="at">col =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(<span class="st">&quot;blue&quot;</span>,<span class="fl">0.5</span>))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(breatlas<span class="sc">$</span>geometry, <span class="at">add=</span>T, <span class="at">col =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(<span class="st">&quot;yellow&quot;</span>,<span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="breareal_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>This seems to have worked.
Notice also how some of these larger polygons are somewhat arbitrarely divided into several adjoining polygons. This is only so for the new map, not the old n50 map.</p>
<p>Delete the invalid data set.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>breatlas <span class="ot">&lt;-</span> breatlas2</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(breatlas2)</span></code></pre></div>
</div>
</div>
<div id="glacial-area-per-region" class="section level3" number="1.8.2">
<h3><span class="header-section-number">1.8.2</span> Glacial area per region</h3>
<div id="contemporary-area" class="section level4" number="1.8.2.1">
<h4><span class="header-section-number">1.8.2.1</span> Contemporary area</h4>
<p>Here is one method for getting the glacial area for each region.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This intersection operation is a bit heavy, so I do it once and store it locally so that I can import it again quickly. </span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#brealtas_reg &lt;- st_intersection(breatlas, reg)</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">#saveRDS(brealtas_reg, &quot;indicators/data/brealtas_reg_helperfile.rds&quot;)</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Importing what I create above</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>brealtas_reg <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/brealtas_reg_helperfile.rds&quot;</span>)</span></code></pre></div>
<p>Checking what happens to polygons that span to regions. Central Norway in red and western Norway in green. 50% transparency means we should get a third colour where and if they overlap.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(brealtas_reg<span class="sc">$</span>geometry[brealtas_reg<span class="sc">$</span>region<span class="sc">==</span><span class="st">&quot;Midt-Norge&quot;</span>], </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(<span class="st">&quot;red&quot;</span>,<span class="fl">0.5</span>), <span class="at">border=</span><span class="cn">NA</span>, <span class="at">axes=</span>T, </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">6900000</span>, <span class="dv">6905000</span>),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">85000</span>, <span class="dv">100000</span>))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(brealtas_reg<span class="sc">$</span>geometry[brealtas_reg<span class="sc">$</span>region<span class="sc">==</span><span class="st">&quot;Vestlandet&quot;</span>], </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(<span class="st">&quot;green&quot;</span>,<span class="fl">0.5</span>), <span class="at">border=</span><span class="cn">NA</span>, <span class="at">add=</span>T)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(nor<span class="sc">$</span>geometry, <span class="at">add=</span>T)</span></code></pre></div>
<p><img src="breareal_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>It worked fine.</p>
<p>Calculating the area of the polygons</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculating the area of the polygons</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>brealtas_reg<span class="sc">$</span>area_crop <span class="ot">&lt;-</span> <span class="fu">st_area</span>(brealtas_reg)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># summing the area for each region</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>bretabell <span class="ot">&lt;-</span> <span class="fu">tapply</span>(</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>       brealtas_reg<span class="sc">$</span>area_crop,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>       brealtas_reg<span class="sc">$</span>region,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">FUN =</span> sum)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co"># converting from m2 to km2</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>bretabell <span class="ot">&lt;-</span> bretabell<span class="sc">/</span><span class="dv">1000000</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  bretabell,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab=</span><span class="st">&quot;Breareal (km2)&quot;</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="breareal_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>Southern Norway has &lt;1km2 of glaciers in 2018-2019.</p>
</div>
<div id="same-for-n50" class="section level4" number="1.8.2.2">
<h4><span class="header-section-number">1.8.2.2</span> Same for N50</h4>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>n50x <span class="ot">&lt;-</span> <span class="fu">st_make_valid</span>(n50)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">#n50_reg &lt;- st_intersection(n50x, reg)</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">#saveRDS(n50_reg, &quot;indicators/data/n50_helperfile.rds&quot;)</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>n50_reg <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/n50_helperfile.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(n50_reg<span class="sc">$</span>geometry[n50_reg<span class="sc">$</span>region<span class="sc">==</span><span class="st">&quot;Midt-Norge&quot;</span>], </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(<span class="st">&quot;red&quot;</span>,<span class="fl">0.5</span>), <span class="at">border=</span><span class="cn">NA</span>, <span class="at">axes=</span>T, </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">6900000</span>, <span class="dv">6905000</span>),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">85000</span>, <span class="dv">100000</span>))</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(n50_reg<span class="sc">$</span>geometry[n50_reg<span class="sc">$</span>region<span class="sc">==</span><span class="st">&quot;Vestlandet&quot;</span>], </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(<span class="st">&quot;green&quot;</span>,<span class="fl">0.5</span>), <span class="at">border=</span><span class="cn">NA</span>, <span class="at">add=</span>T)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(nor<span class="sc">$</span>geometry, <span class="at">add=</span>T)</span></code></pre></div>
<p><img src="breareal_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>Thats good.
Now I will plot the reference values (n50) and the contemporary data together.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>n50_reg<span class="sc">$</span>area_crop <span class="ot">&lt;-</span> <span class="fu">st_area</span>(n50_reg)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>n50tabell <span class="ot">&lt;-</span> <span class="fu">tapply</span>(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>       n50_reg<span class="sc">$</span>area_crop,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>       n50_reg<span class="sc">$</span>region,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">FUN =</span> sum)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>n50tabell <span class="ot">&lt;-</span> n50tabell<span class="sc">/</span><span class="dv">1000000</span> </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  n50tabell,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab=</span><span class="st">&quot;Breareal (km2)&quot;</span>,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">col=</span><span class="st">&quot;grey&quot;</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  bretabell,</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab=</span><span class="st">&quot;Breareal (km2)&quot;</span>,</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">add=</span>T,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">col=</span><span class="st">&quot;grey30&quot;</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="breareal_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>In the figure above, the glacial area in the reference periond is in light grey and todays area is in dark grey. The height of the light grey bar depicts the reduction in glacial area.</p>
<p>There was a little more glaicers in southern Norway in the reference period, but only 4 km2. The condition here will be very poor! I’m not entirely sure this is representative. The alternative is to set it to be NA, and I think I will do this - one could argue that glaciers are not as important of central to the alpine ecosystems in the south.</p>
</div>
</div>
<div id="scaled-indicator-values" class="section level3" number="1.8.3">
<h3><span class="header-section-number">1.8.3</span> Scaled indicator values</h3>
<p>Making a table with the indicator values.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>myTbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">region           =</span> <span class="fu">names</span>(bretabell),</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">indikator        =</span> bretabell,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">referanseverdi   =</span> n50tabell)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>myTbl<span class="sc">$</span>skalert_indikator <span class="ot">&lt;-</span> myTbl<span class="sc">$</span>indikator<span class="sc">/</span>myTbl<span class="sc">$</span>referanseverdi</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(myTbl)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">region</th>
<th align="right">indikator</th>
<th align="right">referanseverdi</th>
<th align="right">skalert_indikator</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Midt-Norge</td>
<td align="right">69.8685069</td>
<td align="right">173.436069</td>
<td align="right">0.4028488</td>
</tr>
<tr class="even">
<td align="left">Nord-Norge</td>
<td align="right">928.5326204</td>
<td align="right">1409.196007</td>
<td align="right">0.6589095</td>
</tr>
<tr class="odd">
<td align="left">Østlandet</td>
<td align="right">251.3490789</td>
<td align="right">365.357472</td>
<td align="right">0.6879538</td>
</tr>
<tr class="even">
<td align="left">Sørlandet</td>
<td align="right">0.7033655</td>
<td align="right">3.739583</td>
<td align="right">0.1880866</td>
</tr>
<tr class="odd">
<td align="left">Vestlandet</td>
<td align="right">1077.9902876</td>
<td align="right">1372.939792</td>
<td align="right">0.7851694</td>
</tr>
</tbody>
</table>
<p>Scaling and clipping the regions against the outline of Norway</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># paste the scaled indicato values into the shape file with the regions, using the match function to make sure the align correctly</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>reg<span class="sc">$</span>skalert_indikator <span class="ot">&lt;-</span> myTbl<span class="sc">$</span>skalert_indikator[<span class="fu">match</span>(reg<span class="sc">$</span>region, myTbl<span class="sc">$</span>region)]</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># cutting away the marine areas</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>reg_clipped <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(reg, nor)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: attribute variables are assumed to be spatially</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; constant throughout all geometries</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># round of to 2 decimals</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>reg_clipped<span class="sc">$</span>skalert_indikator_r <span class="ot">&lt;-</span> <span class="fu">round</span>(reg_clipped<span class="sc">$</span>skalert_indikator, <span class="dv">2</span>)</span></code></pre></div>
<p>Plotting a static map with scaled indicator values</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">&quot;plot&quot;</span>) <span class="co"># mode &#39;view&#39; takes a lot longer to render, but looks better</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; tmap mode set to plotting</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(reg_clipped) <span class="sc">+</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col=</span><span class="st">&quot;skalert_indikator&quot;</span>, </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">border.col =</span> <span class="st">&quot;white&quot;</span>)<span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">&quot;skalert_indikator_r&quot;</span>, <span class="at">size=</span><span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(nor)<span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="dv">0</span>,<span class="at">border.col =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p><img src="breareal_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># removing the value for souther norway</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>reg_clipped<span class="sc">$</span>skalert_indikator[reg_clipped<span class="sc">$</span>region<span class="sc">==</span><span class="st">&quot;Sørlandet&quot;</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
<p>Calculating total change of glacier extent</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(bretabell)<span class="sc">/</span><span class="fu">sum</span>(n50tabell)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.7003536</span></span></code></pre></div>
<p>We’ve lost 30% of the glacial area over this time.</p>
</div>
<div id="uncertainty" class="section level3" number="1.8.4">
<h3><span class="header-section-number">1.8.4</span> Uncertainty</h3>
<p>NVE reports a 3% uncertainty with their method. This is interpret as if +- 3% represent a 99.9%CI for the estimate (ca 2 SD).
In the <a href="https://ninanor.github.io/IBECA/areal-av-isbreer.html">original indicator</a> I re-sampled the indicator value 10000 times here, with a 0.015sd, to get a distribution of indicator values. This time I will settle for reporting the sd as a single value below.</p>
</div>
</div>
<div id="prepare-export" class="section level2" number="1.9">
<h2><span class="header-section-number">1.9</span> Prepare export</h2>
<p>Now I can prepare the final exported data file. It will be a shape file with raw and scaled indicator values, reference reference values, and uncertainties.</p>
<p>The names of the columns are standardised (region, v_YYYY, sd_YYYY, i_YYYY, and reference).</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(reg_clipped)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;id&quot;                  &quot;region&quot;             </span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3] &quot;skalert_indikator&quot;   &quot;GID_0&quot;              </span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5] &quot;NAME_0&quot;              &quot;geometry&quot;           </span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [7] &quot;skalert_indikator_r&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># paste the raw variable estimates</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>reg_clipped<span class="sc">$</span>v_2019 <span class="ot">&lt;-</span> myTbl<span class="sc">$</span>indikator[<span class="fu">match</span>(reg_clipped<span class="sc">$</span>region, myTbl<span class="sc">$</span>region)]              </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># paste the reference values</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>reg_clipped<span class="sc">$</span>reference <span class="ot">&lt;-</span> myTbl<span class="sc">$</span>referanseverdi[<span class="fu">match</span>(reg_clipped<span class="sc">$</span>region, myTbl<span class="sc">$</span>region)]      </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># add 3% (one-sided) errors (SD=1.5% so that 1.95SD equals about 3%). </span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>reg_clipped<span class="sc">$</span>sd_2019 <span class="ot">&lt;-</span> reg_clipped<span class="sc">$</span>v_2019<span class="sc">*</span><span class="fl">0.015</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># subset the shape file to include only the columns of interest, and rename the column with the scaled indicator values, assigning the value to year 2019.</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>exp <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(reg_clipped,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>                     region,</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>                     v_2019,</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>                     sd_2019,</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>                     reference,</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">i_2019 =</span> skalert_indikator,</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>                     geometry)</span></code></pre></div>
<div id="eksport-shape-file-final-product" class="section level3" number="1.9.1">
<h3><span class="header-section-number">1.9.1</span> Eksport shape file (final product)</h3>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(exp, <span class="st">&quot;indicators/indicatorMaps/breareal.shp&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(exp[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span></code></pre></div>
<table>
<colgroup>
<col width="12%" />
<col width="14%" />
<col width="13%" />
<col width="13%" />
<col width="11%" />
<col width="34%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">region</th>
<th align="right">v_2019</th>
<th align="right">sd_2019</th>
<th align="right">reference</th>
<th align="right">i_2019</th>
<th align="left">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Nord-Norge</td>
<td align="right">928.5326204</td>
<td align="right">13.92798931</td>
<td align="right">1409.196007</td>
<td align="right">0.6589095</td>
<td align="left">MULTIPOLYGON (((353978.3 72…</td>
</tr>
<tr class="even">
<td align="left">Midt-Norge</td>
<td align="right">69.8685069</td>
<td align="right">1.04802760</td>
<td align="right">173.436069</td>
<td align="right">0.4028488</td>
<td align="left">MULTIPOLYGON (((148280.6 69…</td>
</tr>
<tr class="odd">
<td align="left">Østlandet</td>
<td align="right">251.3490789</td>
<td align="right">3.77023618</td>
<td align="right">365.357472</td>
<td align="right">0.6879538</td>
<td align="left">MULTIPOLYGON (((236668.3 66…</td>
</tr>
<tr class="even">
<td align="left">Vestlandet</td>
<td align="right">1077.9902876</td>
<td align="right">16.16985431</td>
<td align="right">1372.939792</td>
<td align="right">0.7851694</td>
<td align="left">MULTIPOLYGON (((875.0099 64…</td>
</tr>
<tr class="odd">
<td align="left">Sørlandet</td>
<td align="right">0.7033655</td>
<td align="right">0.01055048</td>
<td align="right">3.739583</td>
<td align="right">NA</td>
<td align="left">MULTIPOLYGON (((-4329.09 64…</td>
</tr>
</tbody>
</table>
<!--chapter:end:breareal.Rmd-->
</div>
</div>
</div>
<div id="part-indicators" class="section level1 unnumbered">
<h1 class="unnumbered">(PART*) INDICATORS</h1>
</div>
<div id="slitasje-og-kjørespor" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Slitasje og kjørespor</h1>
<p><em>Author and date:</em></p>
<p>Anders L. Kolstad</p>
<p>March 2023</p>
<table>
<colgroup>
<col width="48%" />
<col width="29%" />
<col width="22%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Ecosystem</th>
<th align="left">Økologisk.egenskap</th>
<th align="left">ECT.class</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Våtmark, Naturlig åpne områder under skoggrensa, Semi-naturlig mark</td>
<td align="left">Primærproduksjon (evt. Abiotiske fohold)</td>
<td align="left">Physical state characteristics</td>
</tr>
</tbody>
</table>
<hr/>
<div id="introduction-1" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Introduction</h2>
<p>This indicator represent human caused damage or <strong>disturbance to soils and vegetation</strong>, typically from things like recreational activities and off-road vehicle traffic. The data come from a combination non-random field surveys and area-representative surveys. Disturbance to soils and vegetation is recorded in the various data sets are NiN variables 7SE and 7TK, or as the similar, but more fine-scaled variable, PRSL and PRTK. Effects from domestic animal is not included in the definition of these variables, and the upper reference value is therefore set to 0% disturbance.</p>
<p>Since the data is not sampled in a systematic or random way, we must take extra care not to over-extrapolate in space. We delineate <em>homogeneous impact areas</em> (HIA) based on four classes of increasing infrastructure, and we say that the field data is representative inside the HIA and region (<em>five regions in Norway</em>) where it was recorded. We then calculate an area weighted mean (and error) indicator value for each HIA and region combination, as long as there is more than 150 data points for a give combination of HIA and region.</p>
<p>Here is a general workflow for the calculation of the indicator.</p>
<ol style="list-style-type: decimal">
<li><p>Import <a href="#NTM">Nature type data</a> data set (incl. GRUK) and <a href="#ANO-import">ANO data
set</a></p></li>
<li><p>Identify the <a href="#naturtype">relevant</a> nature types and <a href="#NTM">subset</a>
the data</p></li>
<li><p>Convert <a href="#ANO-points-to-poly">ANO points to polygons</a></p></li>
<li><p>For each polygon, extract the NiN-variable that has the lowest value
(one-out all-out principle), e.g. Fig. @ref(fig:slitasje-naturetype).</p></li>
<li><p><a href="#combine-nt-ano">Combine</a> data sets</p></li>
<li><p><a href="#scale-slitasje-ind">Scale</a> the <code>slitasje</code> variable based on
reference values.</p></li>
<li><p>Define <a href="#HIA">homogeneous impact areas</a> (HIA)</p></li>
<li><p><a href="#spread-slitasje">Aggregate and spread</a> indicator value across HIAs
and assessment regions</p></li>
<li><p>Confirm relationship between infrastructure index and indicator
values to justify the extrapolation</p></li>
<li><p>TO DO: Prepare ecosystem delineation maps and us ethese to mask the extrapolated indicator maps</p></li>
<li><p>Spatial aggregation of indicator values and uncertainties to accounting areas</p></li>
<li><p>Export indicator maps and regional extrapolated maps</p></li>
</ol>
</div>
<div id="about-the-underlying-data-1" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> About the underlying data</h2>
<p>The indicator uses a data set from a standardised field survey of nature
types. You can read more about the preliminary analyses
<a href="#naturtype">here</a>. See also the <a href="https://www.miljodirektoratet.no/ansvarsomrader/overvaking-arealplanlegging/naturkartlegging/naturtyper/">official
site</a>
of the Environment Agency. I also import a data set called
<a href="#ANO-import">ANO</a>, which you can read about
<a href="https://www.miljodirektoratet.no/ansvarsomrader/overvaking-arealplanlegging/miljoovervaking/overvakingsprogrammer/natur-pa-land/arealrepresentativ-naturovervakning-ano/">here</a></p>
<div id="representativity-in-time-and-space-1" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Representativity in time and space</h3>
<p>The nature type mapping is not random and cannot be said to be area
representative. The ANO data set however, is area representative. The
data is from 2018 to present. The data from one field season usually
becomes available early the following year.</p>
</div>
<div id="original-units-1" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Original units</h3>
<p>The variables are recorded on a coarse four-step ordinal scale (Fig.
@ref(fig:four-step)) or eigth-step scale.</p>
</div>
<div id="temporal-coverage-1" class="section level3" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Temporal coverage</h3>
<p>The data goes back to 2018. I therefore bulk all the data from 2018 to 2022 into one time step. I then use the mean date for the raw data,
and define the variable as belonging to the year 2020 (read more
<a href="#scaled-slitasje-variable">here</a>).</p>
</div>
<div id="aditional-comments-about-the-dataset-1" class="section level3" number="2.2.4">
<h3><span class="header-section-number">2.2.4</span> Aditional comments about the dataset</h3>
<p>For a run through of the nature type data set, see <a href="#naturtype">here</a>.</p>
</div>
</div>
<div id="ecosystem-characteristic-1" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Ecosystem characteristic</h2>
<div id="norwegain-standard" class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Norwegain standard</h3>
<p>The indicator is tagged to the <em>Økologisk egenskap</em> called
<strong>Primærproduksjon</strong> (Primary productivity). This is tentative, and
perhaps <em>abiotiske forhold</em> is more suited. But the thought behind the
choice is that <em>slitasje</em> affect the potential for primary productivity.</p>
</div>
<div id="un-standard" class="section level3" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> UN standard</h3>
<p>The indicator is tagged as a <strong>Physical state characteristics</strong>
indicator. This is quite clear. It’s a type of abiotic characteristic that
has to do with the physical structure rather than the chemical
composition.</p>
</div>
</div>
<div id="collinearities-with-other-indicators-1" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Collinearities with other indicators</h2>
<p><em>Slitasje</em> is not thought to exhibit collinearity with any other indicator at
the present.</p>
</div>
<div id="reference-condition-and-values" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Reference condition and values</h2>
<div id="reference-condition" class="section level3" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Reference condition</h3>
<p>The reference condition is one with minimal negative human impact. This
is also true for semi-natural ecosystems. For example, in the reference
condition, <em>slitasje</em> in semi-natural ecosystems is defined to be zero,
even though at no point in time would this condition be realized.</p>
</div>
<div id="reference-values-thresholds-for-defining-good-ecological-condition-minimum-andor-maximum-values-1" class="section level3" number="2.5.2">
<h3><span class="header-section-number">2.5.2</span> Reference values, thresholds for defining <em>good ecological condition</em>, minimum and/or maximum values</h3>
<ul>
<li><p>Upper = 0%</p></li>
<li><p>Threshold = 10%</p></li>
<li><p>Lower = 100%</p></li>
</ul>
<p>The upper reference value is 0 (no <em>slitasje</em>), and the lower reference
value is 100%. Note that 100% <em>slitasje</em> does not mean that all the area
must be scarred or damaged, but that all hypothetical quadrats around a
point is affected (the variable is frequency-driven, and not
amount-driven). The threshold for good ecosystem condition is 10%
damage. Perhaps is should be set somewhat higher, like 20 or 30%.
The indicator value could be interpretted differently at the polygon
vs at the landscape scale. At the polygon scale, 10% damage may seem
like not that much, whilst at the landscape scale, 10% seems more serious.
This final threshold value should be debated and illustrated with examples.</p>
<p>Read about the normalisation <a href="#id_#scaled-slitasje-variable">here</a>.</p>
</div>
</div>
<div id="uncertainties-1" class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Uncertainties</h2>
<p>Uncertainties/errors are estimated for aggregated indicator values by
bootstrapping individual indicator values 1000 times and calculating a
distribution of area weighted means. See the documentation for <code>eaTools::ea_spread</code> <a href="https://ninanor.github.io/eaTools/reference/ea_spread.html">here</a>.
This uncertainty is different from
the spatial variation which we could get more straight forward without
bootstrapping. When aggregating a second time,
from homogeneous impact areas to accounting areas, we assume a normal
distribution around the indicator values, with the already mentioned
errors, and sample <em>n</em> times from these and combine the resamples into an
a new, area weighted, distribution. The errors for the accounting areas
thus represents both the spatial variation, and the precision, of the
indicator values within the accounting areas.</p>
</div>
<div id="references-1" class="section level2" number="2.7">
<h2><span class="header-section-number">2.7</span> References</h2>
<p>No additional references.</p>
</div>
<div id="analyses-1" class="section level2" number="2.8">
<h2><span class="header-section-number">2.8</span> Analyses</h2>
<div id="data-sets" class="section level3" number="2.8.1">
<h3><span class="header-section-number">2.8.1</span> Data sets</h3>
<div id="NTM" class="section level4" number="2.8.1.1">
<h4><span class="header-section-number">2.8.1.1</span> Nature type mapping</h4>
<p>This indicator uses the data set
<code>Naturtyper etter Miljødirektoratets Instruks</code>, which can be found
<a href="https://kartkatalog.geonorge.no/metadata/naturtyper-miljoedirektoratets-instruks/eb48dd19-03da-41e1-afd9-7ebc3079265c">here</a>.
See also <a href="#naturtype">here</a> for a detailed description of the data set.</p>
<p>We also have a separate <a href="#id_#exp-natureType-summary">summary file</a> where
the nature types are manually mapped the NiN variables and to the correct NiN-main types. We can use this to find the nature types associated with the NiN main types
that we are interested in.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>naturetypes_summary_import <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/naturetypes/natureType_summary.rds&quot;</span>)</span></code></pre></div>
<p>We are only interested in a mapping units that include our target variables.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>myVars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;7TK&#39;</span>, <span class="st">&#39;7SE&#39;</span>, <span class="st">&#39;PRTK&#39;</span>, <span class="st">&#39;PRSL&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>naturetypes_summary <span class="ot">&lt;-</span> naturetypes_summary_import <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">keepers =</span> <span class="fu">sum</span>(<span class="fu">c_across</span>(</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">all_of</span>(myVars))<span class="sc">&gt;</span><span class="dv">0</span>, <span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(keepers <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Nature_type, NiN_mainType, Year)</span></code></pre></div>
<p>This deleted 17 nature types and left us with these:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(naturetypes_summary)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-94494b72aa0d78d02217" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-94494b72aa0d78d02217">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37"],["Slåttemyr","Eng-aktig sterkt endret fastmark","Sørlig kaldkilde","Åpen flomfastmark","Høgereligende og nordlig nedbørsmyr","Øyblandingsmyr","Strandeng","Nakent tørkeutsatt kalkberg","Kystlynghei","Sørlig slåttemyr","Konsentrisk høymyr","Boreal hei","Sanddynemark","Semi-naturlig strandeng","Rik åpen jordvannsmyr i mellomboreal sone","Sørlig nedbørsmyr","Atlantisk høymyr","Terrengdekkende myr","Åpen grunnlendt kalkrik mark i boreonemoral sone","Rik åpen sørlig jordvannsmyr","Aktiv skredmark","Semi-naturlig myr","Silt og leirskred","Eksentrisk høymyr","Øvre sandstrand uten pionervegetasjon","Kalkrik helofyttsump","Fuglefjell-eng og fugletopp","Isinnfrysingsmark","Åpen grunnlendt kalkrik mark i sørboreal sone","Sørlig etablert sanddynemark","Rik åpen jordvannsmyr i nordboreal og lavalpin sone","Fossepåvirket berg","Fosse-eng","Svært tørkeutsatt sørlig kalkberg","Kanthøymyr","Platåhøymyr","Palsmyr"],["V9","T41","V4","T18","V3","V1","T12","T1","T34","V9","V3","T31","T21","T33","V1","V3","V3","V3","T2","V1","T17","V9","T17","V3","T29","L4","T8","T20","T2","T21","V1","T1","T15","T1","V3","V3","V3"],["2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2019, 2020, 2021","2018, 2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2021, 2022"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Nature_type<\/th>\n      <th>NiN_mainType<\/th>\n      <th>Year<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Importing and sub-setting the main data file, fix duplicate <em>hovedøkosystem</em>, calculate area, split one column in two, make numeric, and select target variables:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>naturetypes <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="at">dsn =</span> path) <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(naturtype <span class="sc">%in%</span> naturetypes_summary<span class="sc">$</span>Nature_type) <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(hovedøkosystem <span class="ot">=</span> <span class="fu">recode</span>(hovedøkosystem,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;naturligÅpneOmråderUnderSkoggrensa&quot;</span> <span class="ot">=</span> <span class="st">&quot;naturligÅpneOmråderILavlandet&quot;</span>),</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">area =</span> <span class="fu">st_area</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(ninBeskrivelsesvariable, <span class="at">sep=</span><span class="st">&quot;,&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> ninBeskrivelsesvariable,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;NiN_variable_code&quot;</span>, <span class="st">&quot;NiN_variable_value&quot;</span>),</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">remove=</span>F) <span class="sc">%&gt;%</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NiN_variable_value =</span> <span class="fu">as.numeric</span>(NiN_variable_value)) <span class="sc">%&gt;%</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NiN_variable_code <span class="sc">%in%</span> myVars)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Reading layer `Naturtyper_nin_0000_norge&#39; from data source </span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   `/data/R/GeoSpatialData/Habitats_biotopes/Norway_Miljodirektoratet_Naturtyper_nin/Original/Naturtyper_nin_0000_norge_25833_FILEGDB/Naturtyper_nin_0000_norge_25833_FILEGDB.gdb&#39; </span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   using driver `OpenFileGDB&#39;</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 117427 features and 36 fields</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -74953.52 ymin: 6448986 xmax: 1075081 ymax: 7921284</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Projected CRS: ETRS89 / UTM zone 33N</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: There was 1 warning in `stopifnot()`.</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ In argument: `NiN_variable_value =</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   as.numeric(NiN_variable_value)`.</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Caused by warning:</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ! NAs introduced by coercion</span></span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> naturetypes, <span class="fu">aes</span>(<span class="at">x =</span> naturtype, <span class="at">fill =</span> hovedøkosystem))<span class="sc">+</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()<span class="sc">+</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.direction =</span> <span class="st">&quot;vertical&quot;</span>)<span class="sc">+</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#guides(fill = &quot;none&quot;)+</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>)<span class="sc">+</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Number of localities&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="slitasje_files/figure-html/unnamed-chunk-8-1.png" alt="An overview of the naturetypes for which we will calculate the indicator. Colours refer to the main ecosystem affiliation." width="672" />
<p class="caption">
(#fig:unnamed-chunk-8)An overview of the naturetypes for which we will calculate the indicator. Colours refer to the main ecosystem affiliation.
</p>
</div>
<p>Column names starting with a number is problematic, so adding a prefix</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>naturetypes<span class="sc">$</span>NiN_variable_code <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;var_&quot;</span>, naturetypes<span class="sc">$</span>NiN_variable_code)</span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(naturetypes<span class="sc">$</span>kartleggingsår))</span></code></pre></div>
<div class="figure">
<img src="slitasje_files/figure-html/unnamed-chunk-10-1.png" alt="Distribution of data points over time." width="672" />
<p class="caption">
(#fig:unnamed-chunk-10)Distribution of data points over time.
</p>
</div>
<p>Now I need to create a single row per locality with a new variable which
is a product/function of the four variables “7SE”, “7TK”, “PRTK” and
“PRSL”. I want to base this indicator on whichever of the variables have the highest value (worst condition). Therefore I first convert the ordinal scale to a continuous scale, using the median value of each ordinal step.</p>
<p>The variables use slightly different scales. PRSL and PRTK use this 8
step scale:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;images/mdirPRscale.PNG&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="images/mdirPRscale.PNG" alt="Eight step condition scale" width="314" />
<p class="caption">
(#fig:eight-step)Eight step condition scale
</p>
</div>
<p>7TK and 7SE use a 4 step scale</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;images/ninAR4b.PNG&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="images/ninAR4b.PNG" alt="Four step condition scale" width="554" />
<p class="caption">
(#fig:four-step)Four step condition scale
</p>
</div>
<p>I here transfer these ordinal variables over to a continuous scale.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>naturetypes <span class="ot">&lt;-</span> naturetypes <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NiN_variable_value =</span> <span class="fu">case_when</span>(</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    NiN_variable_code <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;var_7TK&quot;</span>, <span class="st">&quot;var_7SE&quot;</span>) <span class="sc">~</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">case_match</span>(NiN_variable_value,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>             <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>             <span class="dv">1</span> <span class="sc">~</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">16</span>))<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>             <span class="dv">2</span> <span class="sc">~</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">16</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>))<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>             <span class="dv">3</span> <span class="sc">~</span> <span class="dv">75</span>),</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    NiN_variable_code <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;var_PRTK&#39;</span>, <span class="st">&#39;var_PRSL&#39;</span>) <span class="sc">~</span> </span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">case_match</span>(NiN_variable_value,</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>             <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>             <span class="dv">1</span> <span class="sc">~</span> <span class="fl">1.5</span>,</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>             <span class="dv">2</span> <span class="sc">~</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="fl">6.25</span>)),</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>             <span class="dv">3</span> <span class="sc">~</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="fl">6.25</span>, <span class="fl">12.5</span>)),</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>             <span class="dv">4</span> <span class="sc">~</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="fl">12.5</span>, <span class="dv">25</span>)),</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>             <span class="dv">5</span> <span class="sc">~</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">50</span>)),</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>             <span class="dv">6</span> <span class="sc">~</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">75</span>)),</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>             <span class="dv">7</span> <span class="sc">~</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">75</span>, <span class="dv">100</span>)))</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>I will create a new data table where I calculate the new
variable which I then paste back into the sf object.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>naturetypes_wide <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(naturetypes,</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>                                <span class="at">names_from =</span> <span class="st">&quot;NiN_variable_code&quot;</span>,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">values_from =</span> <span class="st">&quot;NiN_variable_value&quot;</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">id_cols =</span> <span class="st">&quot;identifikasjon_lokalId&quot;</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>naturetypes_wide <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(naturetypes_wide)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(naturetypes_wide, <span class="dv">10</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    identifikasjon_lokalId var_PRSL var_7TK var_7SE var_PRTK</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1         NINFP2210087853      0.0       0      NA       NA</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2         NINFP2210087857      0.0       0      NA       NA</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3         NINFP1910012022       NA      NA   0.000       NA</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4         NINFP1910005432      1.5      NA      NA       NA</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5         NINFP2210089748       NA       0   0.000       NA</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6         NINFP2210096062       NA      NA   0.000      0.0</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7         NINFP1910029434       NA      NA   3.125      1.5</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8         NINFP2010029112       NA       0   0.000       NA</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 9         NINFP2010029325       NA       0   0.000       NA</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10        NINFP1910057556       NA      NA   0.000       NA</span></span></code></pre></div>
<p>First I will combine 7TK and PRTK, and also 7SE and PRSL</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>naturetypes_wide <span class="ot">&lt;-</span> naturetypes_wide <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TK =</span> <span class="fu">if_else</span>(</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(var_PRTK), var_7TK, var_PRTK),</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">SE =</span> <span class="fu">if_else</span>(</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(var_PRSL), var_7SE, var_PRSL)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<p>SE has 10064
NA’s, and TK has
7007.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> naturetypes_wide <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SE) <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum =</span> <span class="fu">n</span>())</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(temp, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(SE),</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> sum))<span class="sc">+</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>,</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>,</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;7SE or PRSL score&quot;</span>,</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of localities&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="slitasje_files/figure-html/unnamed-chunk-14-1.png" alt="7SE scores in the naturetype dataset" width="480" />
<p class="caption">
(#fig:unnamed-chunk-14)7SE scores in the naturetype dataset
</p>
</div>
<p>The NA fraction is quite big. These are localities with 7TK or PRTK recorded,
but not 7SE or PRSL.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> naturetypes_wide <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(TK) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum =</span> <span class="fu">n</span>())</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(temp, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(TK),</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> sum))<span class="sc">+</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>,</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>,</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;7TK og PRTK score&quot;</span>,</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of localities&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="slitasje_files/figure-html/unnamed-chunk-15-1.png" alt="7TK scores in the nature type dataset" width="480" />
<p class="caption">
(#fig:unnamed-chunk-15)7TK scores in the nature type dataset
</p>
</div>
<p>Then I can combine these two variables into a composite variable called
<code>slitasje</code></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>naturetypes_wide<span class="sc">$</span>slitasje <span class="ot">&lt;-</span> <span class="fu">apply</span>(naturetypes_wide[,<span class="fu">c</span>(<span class="st">&quot;TK&quot;</span>, <span class="st">&quot;SE&quot;</span>)], <span class="dv">1</span>, max, <span class="at">na.rm=</span>T)</span></code></pre></div>
<p>When both variables are NA, we get -Inf. There were 13 cases of this. Removing these now.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>naturetypes_wide <span class="ot">&lt;-</span> naturetypes_wide[naturetypes_wide<span class="sc">$</span>slitasje<span class="sc">&gt;=</span><span class="dv">0</span>,]</span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> naturetypes_wide <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(slitasje) <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum =</span> <span class="fu">n</span>())</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(temp, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(slitasje),</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> sum))<span class="sc">+</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>,</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>,</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Slitasje score converted to percentage&quot;</span>,</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of localities&quot;</span>) <span class="sc">+</span> </span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">90</span>, <span class="at">vjust=</span><span class="fl">0.5</span>))</span></code></pre></div>
<div class="figure">
<img src="slitasje_files/figure-html/slitasje-naturetype-1.png" alt="Slitasje scores." width="288" />
<p class="caption">
(#fig:slitasje-naturetype)Slitasje scores.
</p>
</div>
<p>It appears most localities are in good condition.</p>
<p>I would also like to know, when both tk and SE was recordedm
how often TK was defining of the slitasje-indicator, and how
often it was SE. I can do this by taking the difference.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>diff <span class="ot">&lt;-</span> naturetypes_wide<span class="sc">$</span>SE <span class="sc">-</span> naturetypes_wide<span class="sc">$</span>TK</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>diff <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(diff <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;TK and SE&quot;</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>               <span class="fu">ifelse</span>(diff <span class="sc">&lt;</span><span class="dv">0</span>, <span class="st">&quot;TK&quot;</span>, <span class="st">&quot;SE&quot;</span>))</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>diff_tbl <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(diff))</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diff_tbl, <span class="fu">aes</span>(<span class="at">x =</span> diff, <span class="at">y =</span> Freq))<span class="sc">+</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>)<span class="sc">+</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Defining variable&quot;</span>,</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of localities&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="slitasje_files/figure-html/unnamed-chunk-18-1.png" alt="Counting the number of cases where TK or SE was defining of the slitasje indicator score." width="288" />
<p class="caption">
(#fig:unnamed-chunk-18)Counting the number of cases where TK or SE was defining of the slitasje indicator score.
</p>
</div>
<p>Looks like SE (= 7SE or PRSL) is more likely to be in a detrimental state.</p>
<p>Now I will copy these slitasje-values into the sf object.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>naturetypes<span class="sc">$</span>slitasje <span class="ot">&lt;-</span> naturetypes_wide<span class="sc">$</span>slitasje[<span class="fu">match</span>(naturetypes<span class="sc">$</span>identifikasjon_lokalId, naturetypes_wide<span class="sc">$</span>identifikasjon_lokalId)]</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co">#nrow(naturetypes[is.na(naturetypes$slitasje),])  # 13 cases</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>naturetypes <span class="ot">&lt;-</span> naturetypes[<span class="sc">!</span><span class="fu">is.na</span>(naturetypes<span class="sc">$</span>slitasje),]</span></code></pre></div>
</div>
<div id="gruk" class="section level4" number="2.8.1.2">
<h4><span class="header-section-number">2.8.1.2</span> GRUK</h4>
<p>This variable is also recorded in
<a href="https://www.nina.no/Naturmangfold/Trua-natur/%C3%85pen-grunnlendt-kalkmark">GRUK</a>.
The nature type data set I’m working on here includes this data already
(presently only 2021 included). GRUK also records a related variable:
<code>% cover in 5m radii circles</code>, which is much more detailed. This data is
not published. In any case it is better to use the harmonized data set
in our case.</p>
</div>
<div id="ANO-import" class="section level4" number="2.8.1.3">
<h4><span class="header-section-number">2.8.1.3</span> ANO</h4>
<p>Arealrepresentativ Naturovervåking (ANO) consist of 1000 systematically
placed locations each with 18 sample points. In each sample point a
circle of 250 m2 is visualised, and the main ecosystem is recorded.
Depending on the main ecosystem, certain NiN variables are also
recorded. 7SE is recorded for våtmark, but not semi-natural areas or
naturally open areas. 7TK is recorded in våtmark and naturally open
areas only.</p>
<table>
<caption>Table showing which main ecosystems the two NiN variables 7SE and 7TK
is recorded in withing the ANO data set.</caption>
<thead>
<tr class="header">
<th>Variable</th>
<th>Våtmark</th>
<th>Naturlig åpne områder</th>
<th>Semi-naturlige områder</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>7SE</td>
<td>X</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="even">
<td>7TK</td>
<td>X</td>
<td>X</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>It would be very nice to have 7SE recorded for naturally open areas.
This variable is very relevant here.</p>
<p>I think I will only use våtmark here since my approach will be to the
‘worst value’ of the variable 7SE and 7TK (see below). I think not
having 7SE for naturally open areas will underestimate the degree of
degredation in these areas.</p>
<blockquote>
<p><em>ANO could harmonise better with the Naturetype data set if it included
7SE and 7TK for Naturally open and Semi natural ecosystem.</em></p>
</blockquote>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>ano <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="fu">paste0</span>(pData, <span class="st">&quot;Naturovervaking_eksport.gdb&quot;</span>),</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">layer =</span> <span class="st">&quot;ANO_SurveyPoint&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(hovedoekosystem_punkt <span class="sc">==</span> <span class="st">&quot;vaatmark&quot;</span>)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Reading layer `ANO_SurveyPoint&#39; from data source </span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   `/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/Naturovervaking_eksport.gdb&#39; </span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   using driver `OpenFileGDB&#39;</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 8974 features and 71 fields</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: POINT</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -51950 ymin: 6467050 xmax: 1094950 ymax: 7923950</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Projected CRS: ETRS89 / UTM zone 33N</span></span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(ano<span class="sc">$</span>aar)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2019 2021 </span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  130  558</span></span></code></pre></div>
<p>This data set only contains data from year 2019 and 2021. We need to
update this data set later. It is not clear why there is no data from
2020.</p>
<p>Each point/row here is 250 square meters. The data also contains
information about how big a proportion of this area is made up of the
dominant main ecosystem. However, there are
130
NA’s here, which is 19% of the data.</p>
<p>It appears the proportion of each circle that is made up of the dominant
ecosystem was only recorded after year 2019. In fact, the main ecosystem
was not recorded at all in 2019:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hard coding name change</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co">#unique(ano$hovedtype_250m2)[3]</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co">#ano$hovedtype_250m2[ano$hovedtype_250m2==unique(ano$hovedtype_250m2)[3]] &lt;- &quot;Aapen jordvassmyr&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(ano<span class="sc">$</span>hovedtype_250m2, ano<span class="sc">$</span>aar)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                             </span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                              2019 2021</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Åpen jordvannsmyr             0  416</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Boreal hei                    0    1</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Fjellhei leside og tundra     0    3</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Grøftet torvmark              0    5</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Helofytt-ferskvannssump       0    3</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Kaldkilde                     0    2</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Myr- og sumpskogsmark         0   51</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Nedbørsmyr                    0   53</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Rasmark                       0    1</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Semi-naturlig myr             0    7</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Semi-naturlig våteng          0    2</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Skogsmark                     0    2</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Strandsumpskogsmark           0    2</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Våtsnøleie og snøleiekilde    0    6</span></span></code></pre></div>
<p>I can remove the NA’s, and thus the 2019 data.</p>
<blockquote>
<p><em>All of 2019 ANO data is excluded because of missing information</em></p>
</blockquote>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>ano <span class="ot">&lt;-</span> ano[<span class="sc">!</span><span class="fu">is.na</span>(ano<span class="sc">$</span>andel_hovedoekosystem_punkt),]</span></code></pre></div>
<p>Let’s look at the variation in the recorded proportion of ecosystem
cover</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">4</span>,<span class="dv">2</span>))</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ano<span class="sc">$</span>andel_hovedoekosystem_punkt[<span class="fu">order</span>(ano<span class="sc">$</span>andel_hovedoekosystem_punkt)],</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Percentage of the 250 m2 area</span><span class="sc">\n</span><span class="st">covered by the main ecosystem&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="slitasje_files/figure-html/unnamed-chunk-25-1.png" alt="Distribution of the ANO variable andel_hovedoekosystem_punkt for wetland localities." width="672" />
<p class="caption">
(#fig:unnamed-chunk-25)Distribution of the ANO variable andel_hovedoekosystem_punkt for wetland localities.
</p>
</div>
<p>The zero in there is an obvious mistake.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>ano <span class="ot">&lt;-</span> ano[ano<span class="sc">$</span>andel_hovedoekosystem_punkt<span class="sc">&gt;</span><span class="dv">20</span>,]</span></code></pre></div>
<p>Here’s another plot of the distribution of the same variable:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ano, <span class="fu">aes</span>(<span class="at">x =</span> andel_hovedoekosystem_punkt))<span class="sc">+</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">colour=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">binwidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Percentage cover of the Våtmark main ecosystem</span><span class="sc">\n</span><span class="st"> in the 250m2 circle&quot;</span>)<span class="sc">+</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">101</span>),</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">10</span>))</span></code></pre></div>
<div class="figure">
<img src="slitasje_files/figure-html/unnamed-chunk-27-1.png" alt="Percentage cover of the Våtmark main ecosystem in the 250m2 circle" width="672" />
<p class="caption">
(#fig:unnamed-chunk-27)Percentage cover of the Våtmark main ecosystem in the 250m2 circle
</p>
</div>
<p>We can see that people tend to record the variable in steps of 5%, and
that most sample points are 100% belonging to the same main ecosystem.</p>
<p>We want to use area weighting in this indicator, so we can use this
percentage cover data to calculate the area. Note that both data sets
use m<sup>2</sup> as area units.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>ano<span class="sc">$</span>area <span class="ot">&lt;-</span> (ano<span class="sc">$</span>andel_hovedoekosystem_punkt<span class="sc">/</span><span class="dv">100</span>)<span class="sc">*</span><span class="dv">250</span></span></code></pre></div>
<p>Let’s now look at the distribution of the variables. First I need to
separate the variable name from the values themselves. Now the data
looks like this:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>ano<span class="sc">$</span>bv_7se[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;7SE_0&quot; &quot;7SE_0&quot; &quot;7SE_0&quot; &quot;7SE_0&quot; &quot;7SE_0&quot; &quot;7SE_0&quot;</span></span></code></pre></div>
<p>So I create a new variable prefixed var_:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>ano<span class="sc">$</span>var_7SE <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="at">pattern =</span> <span class="st">&quot;7SE_&quot;</span>,</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">x =</span> ano<span class="sc">$</span>bv_7se))</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: NAs introduced by coercion</span></span></code></pre></div>
<p>The NA’s is the case of blank cells. The field app should not allow
users leaving this field blank. I will need to remove these rows. There
are fourteen cases:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(ano[<span class="fu">is.na</span>(ano<span class="sc">$</span>var_7SE),])</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 14</span></span></code></pre></div>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>ano <span class="ot">&lt;-</span> ano[<span class="sc">!</span><span class="fu">is.na</span>(ano<span class="sc">$</span>var_7SE),]</span></code></pre></div>
<p>Same with the other variable 7TK</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>ano<span class="sc">$</span>var_7TK <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="at">pattern =</span> <span class="st">&quot;7TK_&quot;</span>,</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">x =</span> ano<span class="sc">$</span>bv_7tk))</span></code></pre></div>
<p>No NA’s this time.</p>
<blockquote>
<p><em>The ANO field app should not allow user to leave blank cells. This
resulted in the exclusion of data.</em></p>
</blockquote>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(ano<span class="sc">$</span>var_7TK), <span class="at">xlab=</span><span class="st">&quot;7TK scores&quot;</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(ano<span class="sc">$</span>var_7SE), <span class="at">xlab=</span><span class="st">&quot;7SE scores&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="slitasje_files/figure-html/unnamed-chunk-34-1.png" alt="Distribution of 7TK and 7SE scores in the ANO data" width="672" />
<p class="caption">
(#fig:unnamed-chunk-34)Distribution of 7TK and 7SE scores in the ANO data
</p>
</div>
<p>The ANO sites seem to be in an even better condition than the localities in the naturtype data set.</p>
<p>Combining these two variables 7TJ and 7SE into one, same as for the nature
type data.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(ano)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>temp<span class="sc">$</span>slitasje <span class="ot">&lt;-</span> <span class="fu">apply</span>(temp[,<span class="fu">c</span>(<span class="st">&quot;var_7TK&quot;</span>, <span class="st">&quot;var_7SE&quot;</span>)], <span class="dv">1</span>, max, <span class="at">na.rm=</span>T)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>ano<span class="sc">$</span>slitasje <span class="ot">&lt;-</span> temp<span class="sc">$</span>slitasje</span></code></pre></div>
<p>Then I extract the mid values for each ordinal range step, like I did previously for the nature type data set.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>ano <span class="ot">&lt;-</span> ano <span class="sc">%&gt;%</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">slitasje =</span> <span class="fu">case_match</span>(slitasje,</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>             <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>             <span class="dv">1</span> <span class="sc">~</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">16</span>))<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>             <span class="dv">2</span> <span class="sc">~</span> <span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">16</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>))<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>             <span class="dv">3</span> <span class="sc">~</span> <span class="dv">75</span>))</span></code></pre></div>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(ano<span class="sc">$</span>slitasje), <span class="at">xlab=</span><span class="st">&quot;% Slitasje&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Number of localities&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="slitasje_files/figure-html/unnamed-chunk-37-1.png" alt="Distribution of slitasje scores in the ANO data" width="576" />
<p class="caption">
(#fig:unnamed-chunk-37)Distribution of slitasje scores in the ANO data
</p>
</div>
<div id="combine-nt-ano" class="section level5" number="2.8.1.3.1">
<h5><span class="header-section-number">2.8.1.3.1</span> Combine Naturtype data and ANO</h5>
<p>We need to combine the nature type data set with the ANO data set. I
will add a column <code>origin</code> to show where the data comes from. I will
also add a column with the main ecosystem.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>ano<span class="sc">$</span>origin <span class="ot">&lt;-</span> <span class="st">&quot;ANO&quot;</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>naturetypes<span class="sc">$</span>origin <span class="ot">&lt;-</span> <span class="st">&quot;Nature type mapping&quot;</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>ano<span class="sc">$</span>hovedøkosystem <span class="ot">&lt;-</span> <span class="st">&quot;Våtmark&quot;</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>ano<span class="sc">$</span>kartleggingsår <span class="ot">&lt;-</span> ano<span class="sc">$</span>aar</span></code></pre></div>
<p>Fix class</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>naturetypes<span class="sc">$</span>kartleggingsår <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(naturetypes<span class="sc">$</span>kartleggingsår)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>naturetypes<span class="sc">$</span>area <span class="ot">&lt;-</span> units<span class="sc">::</span><span class="fu">drop_units</span>(naturetypes<span class="sc">$</span>area)</span></code></pre></div>
<p>I use <code>dplyr::select</code> to reduce the number of columns to keep things a
bit more tidy.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>slitasje_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="fu">select</span>(ano,</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>                                  GlobalID,</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>                                  origin,</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>                                  kartleggingsår,</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>                                  hovedøkosystem,</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>                                  area,</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>                                  slitasje,</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>                                  SHAPE), </span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">select</span>(naturetypes,</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>                                  identifikasjon_lokalId,</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>                                  origin,</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>                                  hovedøkosystem,</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>                                  kartleggingsår,</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>                                  area,</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>                                  slitasje,</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>                                  SHAPE))</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">st_geometry_type</span>(slitasje_data))</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] POINT        MULTIPOLYGON</span></span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 18 Levels: GEOMETRY POINT LINESTRING POLYGON ... TRIANGLE</span></span></code></pre></div>
<div id="ANO-points-to-poly" class="section level6" number="2.8.1.3.1.1">
<h6><span class="header-section-number">2.8.1.3.1.1</span> Points to polygons</h6>
<p>The ANO data is point data, and the nature type data is <em>multipolygon</em>.
Because later we might want to save this as a shape file, we cannot have
a mixed class type. I will therefore convert the points to polygons. I
use the area column to calculate a radii that gives that area.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>slitasje_data_points <span class="ot">&lt;-</span> slitasje_data <span class="sc">%&gt;%</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">g_type =</span> <span class="fu">st_geometry_type</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(g_type <span class="sc">==</span><span class="st">&quot;POINT&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="fu">sqrt</span>(slitasje_data<span class="sc">$</span>area<span class="sc">/</span>pi))</span></code></pre></div>
<p>Checking now that the new polygons have the area corresponding to the
proportion of the point that was part of the same main ecosystem:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>slitasje_data_points<span class="sc">$</span>area2 <span class="ot">&lt;-</span> <span class="fu">st_area</span>(slitasje_data_points)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(slitasje_data_points<span class="sc">$</span>area, slitasje_data_points<span class="sc">$</span>area2,</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Target area&quot;</span>,</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Area of the new polygons&quot;</span>)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span></code></pre></div>
<div class="figure">
<img src="slitasje_files/figure-html/new-area-1.png" alt="Checking that the area of the new polygons fall in line with the proportion of each point which is part of the main ecosystem." width="672" />
<p class="caption">
(#fig:new-area)Checking that the area of the new polygons fall in line with the proportion of each point which is part of the main ecosystem.
</p>
</div>
<p>The area calculation seems to have worked fine. Checking that the new
data set contains <strong>only polygons</strong>.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>slitasje_data_polygons <span class="ot">&lt;-</span> slitasje_data <span class="sc">%&gt;%</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">g_type =</span> <span class="fu">st_geometry_type</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(g_type <span class="sc">!=</span><span class="st">&quot;POINT&quot;</span>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>slitasje_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(slitasje_data_points, slitasje_data_polygons)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">st_geometry_type</span>(slitasje_data))</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] POLYGON      MULTIPOLYGON</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 18 Levels: GEOMETRY POINT LINESTRING POLYGON ... TRIANGLE</span></span></code></pre></div>
<p>Ok.</p>
</div>
</div>
</div>
<div id="distribution-of-slitasje-scores" class="section level4" number="2.8.1.4">
<h4><span class="header-section-number">2.8.1.4</span> Distribution of Slitasje scores</h4>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(slitasje_data<span class="sc">$</span>slitasje))</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(temp, <span class="fu">aes</span>(<span class="at">x =</span> Var1,</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> Freq))<span class="sc">+</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>,</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>,</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;slitasje score&quot;</span>,</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of localities&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="slitasje_files/figure-html/unnamed-chunk-43-1.png" alt="Slitasje scores (ANO Naturetype (and GRUK) data combined). The score for a locality equals the highest (worst) score of the related variables 7TK, 7SE, PRSL and PRTK." width="672" />
<p class="caption">
(#fig:unnamed-chunk-43)Slitasje scores (ANO Naturetype (and GRUK) data combined). The score for a locality equals the highest (worst) score of the related variables 7TK, 7SE, PRSL and PRTK.
</p>
</div>
<p>Let’s see the proportion of data points (not area) origination from each
data set</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(slitasje_data<span class="sc">$</span>origin))</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(temp, <span class="fu">aes</span>(<span class="at">x =</span> Var1,</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> Freq))<span class="sc">+</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>,</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>,</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Data origin&quot;</span>,</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of localities&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="slitasje_files/figure-html/unnamed-chunk-44-1.png" alt="Barplot show the contribution (number of localities) of different data sets to the slitasje indicator." width="384" />
<p class="caption">
(#fig:unnamed-chunk-44)Barplot show the contribution (number of localities) of different data sets to the slitasje indicator.
</p>
</div>
<p>So the ANO data is not very important here, but it can become more
important in the future so good to have them included in the workflow.</p>
</div>
<div id="outline-of-norway-and-regions" class="section level4" number="2.8.1.5">
<h4><span class="header-section-number">2.8.1.5</span> Outline of Norway and regions</h4>
<p>The GIS layers are used to crop out marine areas, and to define
accounting areas, respectively.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>outline <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">&quot;data/outlineOfNorway_EPSG25833.shp&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>regions <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">&quot;data/regions.shp&quot;</span>, <span class="at">options =</span> <span class="st">&quot;ENCODING=UTF8&quot;</span>)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(regions<span class="sc">$</span>region)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Nord-Norge&quot; &quot;Midt-Norge&quot; &quot;Østlandet&quot;  &quot;Vestlandet&quot;</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5] &quot;Sørlandet&quot;</span></span></code></pre></div>
</div>
</div>
<div id="scale-slitasje-ind" class="section level3" number="2.8.2">
<h3><span class="header-section-number">2.8.2</span> Scaled indicator values</h3>
<p>I can scale the indicator for each polygon, or I can chose to aggregate
them first. If the scaled value is representative and precise at the
polygon level, then I could scale at that level. I think they are.</p>
<p>However, the combined surveyed area is a very small fraction of the
total area of Norway, so that only producing indicator values for the
mapped areas leaves the indicator without much value for regional
assessments. When we do regional assessments and calculate regional
indicator values, we cannot simply do an area weighting of the polygons
in each region. This is because we don’t want to assume that the
polygons are representative far outside of the mapped area. But perhaps
we can assume them to be representative inside <em>homogeneous ecological
areas,</em> or <em>Homoegeneous Impact Areas</em> (HIAs). That’s where the
infrastructure index comes in. Here’s the plan:</p>
<ol style="list-style-type: decimal">
<li><p>normalise the indicators at the polygon level.</p></li>
<li><p>take a simplified infrastructure index (vector data set with HIAs)
and extract the corresponding indicator values that intersect with a
given HIA, and extrapolate the area weighted mean of those values to
the entire HIA withing a given geographical region. Errors are
calculated from bootstrapping.</p></li>
<li><p>Take the new area weighted indicator values for the HIAs and match
them with ecosystem occurrences of the same HIA (possibly using
randomly sampled points from the available ecosystem occurrences).
The errors are the same as for the HIAs.</p></li>
<li><p>calculate an indicator value for a region (accounting area) by doing
a weighted average based of the relative area of ecosystem
occurrences. Errors should be carried somehow, perhaps via weighted
resampling.</p></li>
</ol>
<div id="scaled-slitasje-variable" class="section level4" number="2.8.2.1">
<h4><span class="header-section-number">2.8.2.1</span> Scaled variable</h4>
<p>I will use the same reference levels/values for all of Norway:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>upper <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>lower <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="dv">5</span></span></code></pre></div>
<p>This implies that it is impossible to detect or measure a state when it
is in its most degraded form (100% disturbed). This is a problem with
the original data resolution. But I will compensate somewhat for this by
using a non-linear transformation.</p>
<p>Also, the threshold value is set quite conservatively (I think), and should be
discussed.</p>
<p>I need to do a little trick and reverse the upper and lower reference
values for the normalisation to work. This is a bug which can be fixed
inside eaTools.</p>
<!-- THE BREAKPOINT IS AT 0.5 RATHER THAN 0.6. TEST CODE FROM HERE: https://ninanor.github.io/eaTools/articles/normalise-condition-variable.html -->
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>eaTools<span class="sc">::</span><span class="fu">ea_normalise</span>(<span class="at">data =</span> slitasje_data,</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">vector =</span> <span class="st">&quot;slitasje&quot;</span>,</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">upper_reference_level =</span> lower,</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lower_reference_level =</span> upper,</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">break_point =</span> threshold,</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">plot=</span>T,</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">reverse =</span> T</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>                      )</span></code></pre></div>
<div class="figure">
<img src="slitasje_files/figure-html/slitasje-normalise-1.png" alt="Performing a linear break-point type normalisation of the slitasje variable." width="480" />
<p class="caption">
(#fig:slitasje-normalise)Performing a linear break-point type normalisation of the slitasje variable.
</p>
</div>
<p>This normalisation seems reasonable to me. I can save it as indicator
values. There is no point yet making this a time series, and I will
assign all the indicator value to the average year of the data.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(slitasje_data<span class="sc">$</span>kartleggingsår)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 2020.254</span></span></code></pre></div>
<p>Assigning the indicator to year 2020.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>slitasje_data<span class="sc">$</span>i_2020 <span class="ot">&lt;-</span> eaTools<span class="sc">::</span><span class="fu">ea_normalise</span>(<span class="at">data =</span> slitasje_data,</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">vector =</span> <span class="st">&quot;slitasje&quot;</span>,</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">upper_reference_level =</span> lower,</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lower_reference_level =</span> upper,</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">break_point =</span> threshold,</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">reverse =</span> T</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>                      )</span></code></pre></div>
</div>
</div>
<div id="HIA" class="section level3" number="2.8.3">
<h3><span class="header-section-number">2.8.3</span> Homogeneous impact areas</h3>
<p>I want to use the <a href="#HIA">Homogeneous Impact Areas</a> (HIA) to define
smaller regions into which I can extrapolate the indicator values. This
data is generated by discretizing the Norwegian Infrastructure Index. I
refer to the ordinal values of the four HIA classes as their <em>Human
Impact Factor</em> (HIF). This is just to keep the approach separate from
the Norwegian Infrastructure Index.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>HIA <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(pData, <span class="st">&quot;infrastrukturindeks/homogeneous_impact_areas.rds&quot;</span>))</span></code></pre></div>
<p>I want to check that HIF is in fact a good predictor for <em>slitasje</em>.</p>
<p>I also want to split these four HIA classes based on their region. To do
this I need the two layers to have the same CRS.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(HIA) <span class="sc">==</span> <span class="fu">st_crs</span>(regions)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Since the HIA map and the <em>region</em> map are completely overlapping (HIA was masked using the region map), we can get the
intersections</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>HIA_regions <span class="ot">&lt;-</span> eaTools<span class="sc">::</span><span class="fu">ea_homogeneous_area</span>(HIA,</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>                             regions,</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">keep1 =</span> <span class="st">&quot;infrastructureIndex&quot;</span>,</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">keep2 =</span> <span class="st">&quot;region&quot;</span>)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(HIA_regions, <span class="st">&quot;P:/41201785_okologisk_tilstand_2022_2023/data/cache/HIA_regions.rds&quot;</span>)</span></code></pre></div>
<p>Create a new column by crossing region and HIF</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>HIA_regions <span class="ot">&lt;-</span> HIA_regions <span class="sc">%&gt;%</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region_HIF =</span> <span class="fu">paste</span>(region, infrastructureIndex))</span></code></pre></div>
<div id="validate" class="section level4" number="2.8.3.1">
<h4><span class="header-section-number">2.8.3.1</span> Validate</h4>
<p>I now have 20 unique areas (for each main ecosystem) that I will, given
there is data, extrapolate indicator values over.</p>
<div id="subset-ets" class="section level6" number="2.8.3.1.0.1">
<h6><span class="header-section-number">2.8.3.1.0.1</span> Subset ETs</h6>
<p>I will subset the <code>slitasje_data</code> into the three ecosystems. Note that
only for open wetland do we have good ecosystem delineation maps to base
a spatial averaging on.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Check spelling</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co">#unique(slitasje_data$hovedøkosystem)</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename one level</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>slitasje_data <span class="ot">&lt;-</span> slitasje_data <span class="sc">%&gt;%</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(hovedøkosystem <span class="ot">=</span> <span class="fu">recode</span>(hovedøkosystem, <span class="st">&quot;Våtmark&quot;</span> <span class="ot">=</span> <span class="st">&quot;våtmark&quot;</span>))</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a><span class="co">#make valid</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>slitasje_data <span class="ot">&lt;-</span> <span class="fu">st_make_valid</span>(slitasje_data)</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a><span class="co">#subset</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>wetlands <span class="ot">&lt;-</span> slitasje_data[slitasje_data<span class="sc">$</span>hovedøkosystem <span class="sc">==</span> <span class="st">&quot;våtmark&quot;</span>,]</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>seminat <span class="ot">&lt;-</span> slitasje_data[slitasje_data<span class="sc">$</span>hovedøkosystem <span class="sc">==</span> <span class="st">&quot;semi-naturligMark&quot;</span>,]</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>natOpen <span class="ot">&lt;-</span> slitasje_data[slitasje_data<span class="sc">$</span>hovedøkosystem <span class="sc">==</span> <span class="st">&quot;naturligÅpneOmråderILavlandet&quot;</span>,]</span></code></pre></div>
<p>Creating some summary statistics.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>wetland_stats <span class="ot">&lt;-</span> <span class="fu">ea_spread</span>(<span class="at">indicator_data =</span> wetlands,</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">indicator =</span> i_2020,</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">regions =</span> HIA_regions,</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">groups =</span> region_HIF,</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">summarise =</span> <span class="cn">TRUE</span>)</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>seminat_stats <span class="ot">&lt;-</span> <span class="fu">ea_spread</span>(<span class="at">indicator_data =</span> seminat,</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">indicator =</span> i_2020,</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">regions =</span> HIA_regions,</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">groups =</span> region_HIF,</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">summarise =</span> <span class="cn">TRUE</span>)</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>natOpen_stats <span class="ot">&lt;-</span> <span class="fu">ea_spread</span>(<span class="at">indicator_data =</span> natOpen,</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">indicator =</span> i_2020,</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">regions =</span> HIA_regions,</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">groups =</span> region_HIF,</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">summarise =</span> <span class="cn">TRUE</span>)</span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>wetland_stats <span class="ot">&lt;-</span> wetland_stats <span class="sc">%&gt;%</span></span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">eco =</span> <span class="st">&quot;wetland&quot;</span>)</span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>seminat_stats <span class="ot">&lt;-</span> seminat_stats <span class="sc">%&gt;%</span></span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">eco =</span> <span class="st">&quot;semi-natural&quot;</span>)</span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a>natOpen_stats <span class="ot">&lt;-</span> natOpen_stats <span class="sc">%&gt;%</span></span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">eco =</span> <span class="st">&quot;Naturally-open&quot;</span>)</span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a>all_stats <span class="ot">&lt;-</span> <span class="fu">rbind</span>(wetland_stats,</span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a>                   seminat_stats,</span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a>                   natOpen_stats)</span>
<span id="cb91-31"><a href="#cb91-31" aria-hidden="true" tabindex="-1"></a>all_stats <span class="ot">&lt;-</span> all_stats <span class="sc">%&gt;%</span></span>
<span id="cb91-32"><a href="#cb91-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(region_HIF,</span>
<span id="cb91-33"><a href="#cb91-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;region&quot;</span>, <span class="st">&quot;HIF&quot;</span>),</span>
<span id="cb91-34"><a href="#cb91-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb91-35"><a href="#cb91-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-36"><a href="#cb91-36" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(all_stats, <span class="st">&quot;/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/cache/all_stats.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>temp_plot <span class="ot">&lt;-</span> all_stats <span class="sc">%&gt;%</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">HIF_NA =</span> <span class="fu">case_when</span>(</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>    n <span class="sc">&gt;</span> <span class="dv">150</span> <span class="sc">~</span> HIF</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>myColour_list <span class="ot">&lt;-</span> <span class="fu">unique</span>(temp_plot<span class="sc">$</span>myColour)</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(myColour_list) <span class="ot">&lt;-</span>   myColour_list</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(temp_plot, <span class="fu">aes</span>(<span class="at">x =</span> region, <span class="at">y =</span> n, <span class="at">group =</span> HIF, <span class="at">fill =</span> HIF_NA))<span class="sc">+</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">col=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">10</span>)<span class="sc">+</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Oranges&quot;</span>)<span class="sc">+</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust=</span><span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>eco),</span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(temp_plot, <span class="fu">aes</span>(<span class="at">x =</span> region, <span class="at">y =</span> w_mean, <span class="at">group =</span> HIF, <span class="at">fill =</span> HIF_NA))<span class="sc">+</span></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">col=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">10</span>)<span class="sc">+</span></span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Oranges&quot;</span>)<span class="sc">+</span></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust=</span><span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>eco),</span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(temp_plot, <span class="fu">aes</span>(<span class="at">x =</span> region, <span class="at">y =</span> sd, <span class="at">group =</span> HIF, <span class="at">fill =</span> HIF_NA))<span class="sc">+</span></span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">col=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">10</span>)<span class="sc">+</span></span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Oranges&quot;</span>)<span class="sc">+</span></span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust=</span><span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>eco),</span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a><span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure">
<img src="slitasje_files/figure-html/dense-stats-1.png" alt="Barplot showing the number of data points, the area weighted indicator values and the sd for the slitasje indicator. Transparrent bars represents categories with less than 150 data points." width="672" />
<p class="caption">
(#fig:dense-stats)Barplot showing the number of data points, the area weighted indicator values and the sd for the slitasje indicator. Transparrent bars represents categories with less than 150 data points.
</p>
</div>
<p>In the figure above, colors refer to Human Impact Factor (amount or frequency of infrastructure)
and NA means that there are less than 150 data points which we set as a threshold for evaluating the indicator values.</p>
<p>In the top row
we see that the sample size (number of polygons) varies between
ecosystems. For naturally open ecosystems many polygons are from high
infrastructure areas, not surprisingly, and there are few points for the
lowest impact class (zero such polygons in <em>Sørlandet</em> for example). We
may therefore not be able to extrapolate indicator values for Naturally
open areas in in <em>Sørlandet</em> with low levels of infrastructure.</p>
<p>In semi-natural areas and wetlands, we have very little data from HIF
class 3.</p>
<p>We can also from the middle row see the association between the indicator
values (area weighted means) and the modified infrastructure index
(HIF). We should then not put any weight on the bars were there is
little data (transparent bars). Then we se the general pattern that the indicator
value decreases with increasing HIF. But there are exceptions, like for Semi-natural areas
in Vestlandet.</p>
<p>Let us look at the indicator to pressure relationship across all ecosystems.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>temp_plot <span class="sc">%&gt;%</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(HIF_NA)) <span class="sc">%&gt;%</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> HIF_NA, <span class="at">y =</span> w_mean))<span class="sc">+</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>, <span class="at">position =</span> <span class="fu">position_dodge2</span>(.<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">alpha=</span><span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure">
<img src="slitasje_files/figure-html/unnamed-chunk-58-1.png" alt="Indicator to pressure relationship across all ecosystems." width="672" />
<p class="caption">
(#fig:unnamed-chunk-58)Indicator to pressure relationship across all ecosystems.
</p>
</div>
<p>The pattern is not perfect, and there is quite some noise. But this is perhaps also expected.</p>
<p>Let us look at the effect of sample size on the indicator uncertainty.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>temp_plot <span class="sc">%&gt;%</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> sd))<span class="sc">+</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>, <span class="at">position =</span> <span class="fu">position_dodge2</span>(.<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(.<span class="sc">~</span>eco)</span></code></pre></div>
<div class="figure">
<img src="slitasje_files/figure-html/unnamed-chunk-59-1.png" alt="Smaple size against indicator uncertainty." width="672" />
<p class="caption">
(#fig:unnamed-chunk-59)Smaple size against indicator uncertainty.
</p>
</div>
<p>This shows that the uncertainty is inflated with sample sizes less than about 300-500.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(all_stats)</span></code></pre></div>
<div class="figure">
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-9f2d6a52cc90fbd18ddf" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9f2d6a52cc90fbd18ddf">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59"],["Midt-Norge","Midt-Norge","Midt-Norge","Midt-Norge","Nord-Norge","Nord-Norge","Nord-Norge","Nord-Norge","Sørlandet","Sørlandet","Sørlandet","Sørlandet","Vestlandet","Vestlandet","Vestlandet","Vestlandet","Østlandet","Østlandet","Østlandet","Østlandet","Midt-Norge","Midt-Norge","Midt-Norge","Midt-Norge","Nord-Norge","Nord-Norge","Nord-Norge","Nord-Norge","Sørlandet","Sørlandet","Sørlandet","Sørlandet","Vestlandet","Vestlandet","Vestlandet","Vestlandet","Østlandet","Østlandet","Østlandet","Østlandet","Midt-Norge","Midt-Norge","Midt-Norge","Midt-Norge","Nord-Norge","Nord-Norge","Nord-Norge","Nord-Norge","Sørlandet","Sørlandet","Sørlandet","Vestlandet","Vestlandet","Vestlandet","Vestlandet","Østlandet","Østlandet","Østlandet","Østlandet"],["0","1","2","3","0","1","2","3","0","1","2","3","0","1","2","3","0","1","2","3","0","1","2","3","0","1","2","3","0","1","2","3","0","1","2","3","0","1","2","3","0","1","2","3","0","1","2","3","1","2","3","0","1","2","3","0","1","2","3"],[20425516.793161,55942079.0852367,25271797.033968,402403.654717704,4177429.11487822,39799602.0218486,21289663.1377251,119342.520216003,1199953.10537375,2555863.89072861,1316446.89966768,28747.3798501565,2429070.74019894,7091916.84858253,1976037.38284999,83419.9734570635,1338836.52571996,10667431.8327424,12151597.8760085,777759.443905594,45082128.9721422,105282331.371692,65698434.9289448,1458536.77645433,12119453.8140127,39689431.8549581,23764139.6700521,560734.383622149,12833361.1414629,55230811.320468,21059796.7186225,281368.955707136,62771221.3693583,171913529.764963,89577387.4688441,2762081.96649456,22722135.5559064,72301565.3418464,46433821.8958926,531602.555394967,38617.3295027119,1088104.72301855,4085898.43293656,551146.817578847,1145883.34854498,6747952.7632901,6810143.31086301,90891.4412507273,109835.996095306,882962.104436279,674506.417532786,13843.1727794531,198525.028855817,436639.782215109,47244.6292264749,17970.0303946844,671054.025118375,5315089.41465925,1026810.93562918],[1001,2507,1463,43,548,2503,1513,16,129,457,132,10,272,723,329,24,151,768,912,119,764,2361,2314,101,399,1323,1279,69,153,737,713,56,484,2239,2218,181,251,1104,1650,143,55,298,1098,189,223,1419,1422,52,39,385,254,18,111,246,34,11,216,1419,416],[0.771750910678313,0.7875186612059,0.793527794730975,0.865720748692812,0.831477335386509,0.801232017375005,0.745740593748365,0.791099692645648,0.906027687414072,0.911013644607549,0.798963551938973,1,0.957236019313803,0.880727771695884,0.825256022857242,0.791359885839299,0.788313328500717,0.791395245167583,0.750731099672693,0.923119549784727,0.902593418006151,0.83593202285124,0.80467219237372,0.807328459520766,0.873503412863498,0.83350830318046,0.831318829695963,0.951610294891564,0.94985520619026,0.888240984238651,0.853134247523411,0.729140255239416,0.9098194463842,0.869385864286768,0.885433805699666,0.916486246113373,0.737934602429538,0.722254276853415,0.706036226775658,0.630459416309339,0.951417060773914,0.95003102838554,0.84863012352793,0.810123844078759,0.844666568065667,0.814820273682474,0.803164434951812,0.753302327707886,0.838687587547142,0.645133805861738,0.642709425559455,0.933046230074286,0.969736857282128,0.834162035025874,0.545331235282478,0.893416505831439,0.872053422790955,0.826622204638684,0.810474925985478],[0.920985067564015,0.867491969852833,0.825670935712487,0.792117503059976,0.898993469074145,0.855201757890531,0.826648693776742,0.743125,0.95453488372093,0.933700909823794,0.861945773524721,1,0.946281927244582,0.933323505860086,0.90592225243961,0.835635964912281,0.896889159986058,0.858679070723684,0.816871537396122,0.871275984077842,0.948676632681179,0.90910575358345,0.862583814765955,0.849241792600313,0.955019126764279,0.91984425349087,0.921706514135221,0.946414950419527,0.984117647058824,0.955265300292794,0.900607145493467,0.773397556390977,0.953312309699869,0.930312286970217,0.924071353993641,0.907515266065717,0.877254141329419,0.820020022883295,0.779115789473684,0.738916083916084,0.972727272727273,0.917387848816673,0.891231665228645,0.857699805068226,0.95627802690583,0.904449946218612,0.883170478939966,0.845394736842105,0.857962213225371,0.683749145591251,0.664680895151264,0.916666666666667,0.935277382645804,0.854032948224219,0.826625386996904,0.931818181818182,0.864918372319688,0.815831200623122,0.732730263157895],[0.00521180430068777,0.00434945752819324,0.00602063114291312,0.0357420655181531,0.00788601096109206,0.0043498025604811,0.0057907664431112,0.0530979110767958,0.00965832014067245,0.0072080861750764,0.0181116104747688,0,0.00837811441658417,0.0056414016696469,0.00896478394465009,0.0450854963918842,0.0140911117320106,0.00740041633236665,0.00744264089345736,0.0171829338414869,0.00503700280784231,0.00364269206680451,0.00430006747608547,0.0217928162646461,0.00637942868020546,0.00453240639310002,0.00462555044884439,0.0172207735139846,0.00604208609205063,0.00471198160238452,0.00680508640195998,0.0365666211196643,0.00605252356670952,0.00328820222512962,0.00347028570681106,0.0126362557588608,0.0120587689199437,0.00661779589544552,0.00566362941182635,0.0225870247899212,0.0139374336521784,0.0107014488006716,0.00607389080650256,0.0135282003589769,0.00776844313926837,0.00526458585632371,0.00529260013803737,0.0321211661039465,0.0374330986359293,0.0147547583391982,0.0175217575275686,0.0362045873291141,0.0172631766042164,0.013918519872522,0.0378085287908935,0.0438071664018427,0.0159270768134006,0.00686810399276487,0.0135103015633108],["wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","semi-natural","semi-natural","semi-natural","semi-natural","semi-natural","semi-natural","semi-natural","semi-natural","semi-natural","semi-natural","semi-natural","semi-natural","semi-natural","semi-natural","semi-natural","semi-natural","semi-natural","semi-natural","semi-natural","semi-natural","Naturally-open","Naturally-open","Naturally-open","Naturally-open","Naturally-open","Naturally-open","Naturally-open","Naturally-open","Naturally-open","Naturally-open","Naturally-open","Naturally-open","Naturally-open","Naturally-open","Naturally-open","Naturally-open","Naturally-open","Naturally-open","Naturally-open"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>region<\/th>\n      <th>HIF<\/th>\n      <th>total_area<\/th>\n      <th>n<\/th>\n      <th>w_mean<\/th>\n      <th>mean<\/th>\n      <th>sd<\/th>\n      <th>eco<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
(#fig:unnamed-chunk-60)Summary statistics for the slitasje indicator.
</p>
</div>
<p>In addition to looking at the area weighted means and its relationship
with the pressure indicator (HIF), we can do the same at the polygon
level. Because the indicator is pseudo-continuous, boxplots for example
become useless, so I will present a relative frequency plot.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>corrCheck <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(slitasje_data, HIA_regions)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(corrCheck, <span class="st">&quot;/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/cache/corrCheck.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(corrCheck, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(infrastructureIndex), <span class="at">fill =</span> <span class="fu">factor</span>(<span class="fu">round</span>(i_2020,<span class="dv">2</span>))))<span class="sc">+</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="st">&quot;fill&quot;</span>)<span class="sc">+</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="st">&quot;Sliatsje indicator&quot;</span>))<span class="sc">+</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Fraction of data points&quot;</span>)<span class="sc">+</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;HIF&quot;</span>)<span class="sc">+</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;RdYlGn&quot;</span>)<span class="sc">+</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(hovedøkosystem<span class="sc">~</span>region)</span></code></pre></div>
<div class="figure">
<img src="slitasje_files/figure-html/slitasje-precentageplot-1.png" alt="Relative frequency plot (conditioned on region and main ecosystem) showing the distribution of polygons with different indicator values." width="672" />
<p class="caption">
(#fig:slitasje-precentageplot)Relative frequency plot (conditioned on region and main ecosystem) showing the distribution of polygons with different indicator values.
</p>
</div>
<p>The figure above I think supports the indicator-pressure relationship
and justifies using the HIA+region intersections as local reference
areas. Especially when down-weighting the importance of those
groups/categories that have very little data.</p>
</div>
</div>
<div id="looking-at-the-hia" class="section level4" number="2.8.3.2">
<h4><span class="header-section-number">2.8.3.2</span> Looking at the HIA</h4>
<p>Here is a view of the data zooming in on Trondheim</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>myBB <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">c</span>(<span class="at">xmin=</span><span class="fl">260520.12</span>, <span class="at">xmax =</span> <span class="fl">278587.56</span>,</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">ymin =</span> <span class="fl">7032142.5</span>, <span class="at">ymax =</span> <span class="fl">7045245.27</span>),</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">crs =</span> <span class="fu">st_crs</span>(HIA_regions))</span></code></pre></div>
<p>Cropping the raster to the bbox</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>HIA_trd <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_crop</span>(HIA_regions, myBB)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: attribute variables are assumed to be spatially</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; constant throughout all geometries</span></span></code></pre></div>
<p>Get map of major roads, for context</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>hw_utm <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/cache/highways_trondheim.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>(HIA_trd <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(HIA_trd)<span class="sc">+</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">&quot;infrastructureIndex&quot;</span>,</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">title=</span><span class="st">&quot;Infrastructure index</span><span class="sc">\n</span><span class="st">(modified 4-step scale)&quot;</span>,</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">&quot;-viridis&quot;</span>,</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">style=</span><span class="st">&quot;cat&quot;</span>)<span class="sc">+</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> T)<span class="sc">+</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hw_utm)<span class="sc">+</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">&quot;red&quot;</span>)<span class="sc">+</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(outline)<span class="sc">+</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>))</span></code></pre></div>
<div class="figure">
<img src="slitasje_files/figure-html/unnamed-chunk-66-1.png" alt="A closer look at the HIA designation over Trondheim" width="672" />
<p class="caption">
(#fig:unnamed-chunk-66)A closer look at the HIA designation over Trondheim
</p>
</div>
<p>Let’s calculate the areas of these polygons and compare the HIF in the
five regions.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>HIA_regions<span class="sc">$</span>area <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_area</span>(HIA_regions)</span></code></pre></div>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(HIA_regions) <span class="sc">%&gt;%</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, infrastructureIndex) <span class="sc">%&gt;%</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">area =</span> <span class="fu">mean</span>(area))</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `summarise()` has grouped output by &#39;region&#39;. You can</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; override using the `.groups` argument.</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(temp, <span class="fu">aes</span>(<span class="at">x =</span> region, <span class="at">y =</span> area, <span class="at">fill =</span> <span class="fu">factor</span>(infrastructureIndex)))<span class="sc">+</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="st">&quot;HIF&quot;</span>))</span></code></pre></div>
<div class="figure">
<img src="slitasje_files/figure-html/HIF-region-1.png" alt="Stacked barplot showing the distribution of human impact factor across five regions in Norway." width="672" />
<p class="caption">
(#fig:HIF-region)Stacked barplot showing the distribution of human impact factor across five regions in Norway.
</p>
</div>
<p>The figure above shows that <em>Nord-Norge</em> for example, has a lot of
relatively untouched areas, and that <em>Østlandet</em> has the highest
proportion of impacted areas. This is expected.</p>
</div>
</div>
<div id="spread-slitasje" class="section level3" number="2.8.4">
<h3><span class="header-section-number">2.8.4</span> Aggregate and spread (extrapolate)</h3>
<p>I now want to find the mean indicator value for each HIA (i.e. to
aggregate) and to spread these out spatially to the entire HIA within
each region (i.e. to extrapolate).</p>
<p>I want to add a threshold so that we don’t end up over extrapolating
based on too few data points. I have previousl used 150 data pionts, and I think that was about right.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>wetlands_slitasje_extr <span class="ot">&lt;-</span> <span class="fu">ea_spread</span>(<span class="at">indicator_data =</span> wetlands,</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">indicator =</span> i_2020,</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">regions =</span> HIA_regions,</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">groups =</span> region_HIF,</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">threshold =</span> <span class="dv">150</span>)</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>seminat_slitasje_extr <span class="ot">&lt;-</span> <span class="fu">ea_spread</span>(<span class="at">indicator_data =</span> seminat,</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">indicator =</span> i_2020,</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">regions =</span> HIA_regions,</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">groups =</span> region_HIF,</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">threshold =</span> <span class="dv">150</span>)</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>natOpen_slitasje_extr <span class="ot">&lt;-</span> <span class="fu">ea_spread</span>(<span class="at">indicator_data =</span> natOpen,</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">indicator =</span> i_2020,</span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">regions =</span> HIA_regions,</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">groups =</span> region_HIF,</span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">threshold =</span> <span class="dv">150</span>)</span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a><span class="co">#saveRDS(wetlands_slitasje_extr, &quot;/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/cache/wetlands_slitasje_extr.rds&quot;)</span></span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a><span class="co">#saveRDS(seminat_slitasje_extr,  &quot;/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/cache/seminat_slitasje_extr.rds&quot;)</span></span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a><span class="co">#saveRDS(natOpen_slitasje_extr,  &quot;/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/cache/natOpen_slitasje_extr.rds&quot;)</span></span></code></pre></div>
<p>It’s easier to see what’s happening if we zoom in a bit. Lets get a
boundary box around Trondheim.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>myBB <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">c</span>(<span class="at">xmin=</span><span class="fl">260520.12</span>, <span class="at">xmax =</span> <span class="fl">278587.56</span>,</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">ymin =</span> <span class="fl">7032142.5</span>, <span class="at">ymax =</span> <span class="fl">7045245.27</span>),</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">crs =</span> <span class="fu">st_crs</span>(wetlands_slitasje_extr))</span></code></pre></div>
<p>Cropping the data to the bbox</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>wetlands_slitasje_extr_trd <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_crop</span>(wetlands_slitasje_extr, myBB)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>seminat_slitasje_extr_trd <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_crop</span>(seminat_slitasje_extr, myBB)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>natOpen_slitasje_extr_trd <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_crop</span>(natOpen_slitasje_extr, myBB)</span></code></pre></div>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>myCol <span class="ot">&lt;-</span> <span class="st">&quot;RdYlGn&quot;</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(wetlands_slitasje_extr_trd)<span class="sc">+</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">&quot;w_mean&quot;</span>,</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title=</span><span class="st">&quot;Slitasje indicator&quot;</span>,</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> myCol,</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">style=</span><span class="st">&quot;cont&quot;</span>,</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> T)<span class="sc">+</span></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hw_utm)<span class="sc">+</span></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">&quot;blue&quot;</span>)<span class="sc">+</span></span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">title =</span> <span class="st">&quot;Wetland&quot;</span>),</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(seminat_slitasje_extr_trd)<span class="sc">+</span></span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">&quot;w_mean&quot;</span>,</span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title=</span><span class="st">&quot;Slitasje indicator&quot;</span>,</span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> myCol,</span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">style=</span><span class="st">&quot;cont&quot;</span>,</span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> T)<span class="sc">+</span></span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hw_utm)<span class="sc">+</span></span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">&quot;blue&quot;</span>)<span class="sc">+</span></span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">title =</span> <span class="st">&quot;Semi-natural areas&quot;</span>),</span>
<span id="cb107-24"><a href="#cb107-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-25"><a href="#cb107-25" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(natOpen_slitasje_extr_trd)<span class="sc">+</span></span>
<span id="cb107-26"><a href="#cb107-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">&quot;w_mean&quot;</span>,</span>
<span id="cb107-27"><a href="#cb107-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">title=</span><span class="st">&quot;Slitasje indicator&quot;</span>,</span>
<span id="cb107-28"><a href="#cb107-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> myCol,</span>
<span id="cb107-29"><a href="#cb107-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">style=</span><span class="st">&quot;cont&quot;</span>,</span>
<span id="cb107-30"><a href="#cb107-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb107-31"><a href="#cb107-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> T)<span class="sc">+</span></span>
<span id="cb107-32"><a href="#cb107-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hw_utm)<span class="sc">+</span></span>
<span id="cb107-33"><a href="#cb107-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">&quot;blue&quot;</span>)<span class="sc">+</span></span>
<span id="cb107-34"><a href="#cb107-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">title =</span> <span class="st">&quot;Naturally open areas&quot;</span>),</span>
<span id="cb107-35"><a href="#cb107-35" aria-hidden="true" tabindex="-1"></a>HIA_trd)</span></code></pre></div>
<div class="figure">
<img src="slitasje_files/figure-html/extrapolated-slitasje-1.png" alt="Slitasje indicator extrapolated over Trondheim" width="672" />
<p class="caption">
(#fig:extrapolated-slitasje)Slitasje indicator extrapolated over Trondheim
</p>
</div>
<p>Note that for wetland and semi-natural areas we did not
extrapolate values for the most urban areas, and that for naturally open
areas we did not extrapolate to the least affected areas.
For the other regions we generally excluded more HIFs.</p>
<blockquote>
<p><em>The maps above are easy to misunderstand, and they should therefor be
communicated with caution. They should be considered as temporary
files or as by-products.</em></p>
</blockquote>
<p>The next step now is to</p>
<ol style="list-style-type: decimal">
<li><p>Prepare ecosystem delineation maps in EPSG25833 and perfectly aligned to a master grid</p></li>
<li><p>Rasterize the extrapolated indicator map, using the ET map as a template (see Fig. @ref(fig:#masking-example))</p></li>
<li><p>and mask it using the perfectly aligned ET map.</p></li>
</ol>
<p>A faster way could be to:</p>
<ol style="list-style-type: decimal">
<li><p>Draw <em>n</em> random point samples from the ET map, and</p></li>
<li><p>extract indicator values at those points (from the extrapolated
indicator map (a stars object)).</p></li>
</ol>
<p>… but his will not provide spatially explicit indicator values for the
entire ecosystem delineation.</p>
</div>
<div id="ecosystem-map" class="section level3" number="2.8.5">
<h3><span class="header-section-number">2.8.5</span> Ecosystem map</h3>
<p>See <a href="https://github.com/NINAnor/ecosystemCondition/issues/34">here</a>.</p>
</div>
<div id="aggregate-to-region" class="section level3" number="2.8.6">
<h3><span class="header-section-number">2.8.6</span> Aggregate to region</h3>
<p>We need to aggreate the ET occurence and their indicator values, to a
regional delineation. This functionality can be developed in <code>eaTools</code>,
but will in any case build around <code>exactextratr::exact_extract()</code>.</p>
<p>To carry the errors, we can for example
produce distributions for the indicator values for each ET
occurrence (or groups of them) and resample the distributions with an
area weighting.</p>
</div>
<div id="uncertainty-1" class="section level3" number="2.8.7">
<h3><span class="header-section-number">2.8.7</span> Uncertainty</h3>
<p>The calculations of indicator uncertainty is done with bootstrapping, as
is described in eaTools.</p>
</div>
</div>
<div id="eksport-files-final-product" class="section level2" number="2.9">
<h2><span class="header-section-number">2.9</span> Eksport files (final product)</h2>
<p>According to the workflow specifications, I will export the indicator
map at its highest resolution, for use in various web interfaces etc.
For the finest resolution indicator map I will not include columns for
uncertainty (because this will only be estimated at the aggregated
level), or reference levels (because there is no spatial variation).</p>
<p>I can also export a map of the indicator where we extrapolate the
indicator values to the homogeneous areas (e.g. Fig. @ref(fig:extrapolated-slitasje) . This map should be
interpreted with caution, since they appear as providing explicit indicator
values for areas where there is no data. This map is mainly for
aggregation purposes. I will mark this map with the prefix
<em>homogeneous-areas</em>. I will also export this same map after masking it
with the ET map, and this output must come with the same disclaimers.</p>
<p>Finally I will export a map of the five accounting areas with
wall-to-wall indicator value and errors (e.g. Fig @ref(fig:wall-to-wall-summer-temp-indicator)). This map can also contain data
covering other ETs. Otherwise the maps would not we visually
interpretative.</p>
<div id="slitasje-in-wetlands" class="section level3" number="2.9.1">
<h3><span class="header-section-number">2.9.1</span> Slitasje in wetlands</h3>
<p>This is how I plan to export the final product.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># keep col names short and standardized</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>exp_wetland <span class="ot">&lt;-</span> ...</span></code></pre></div>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>exp_wetland_HIAextrapolated <span class="ot">&lt;-</span> …</span></code></pre></div>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>exp_wetland_AAextrapolated <span class="ot">&lt;-</span> …</span></code></pre></div>
<p>Write to file</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(exp_wetland, <span class="st">&quot;indicators/indicatorMaps/slitasje/wetland_slitasje.shp&quot;</span>,</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">append =</span> F)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(exp_wetlandHIAextrapolated, </span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;indicators/indicatorMaps/extrapolated_to_homogeneous_areas/slitasje/homogeneous_areas_wetland_slitasje.shp&quot;</span>,</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">append =</span> F)</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(exp_wetland, <span class="st">&quot;indicators/indicatorMaps/extrapolated_to_accounting_areas/slitasje/accounting_areas_wetland_slitasje.shp&quot;</span>,</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">append =</span> F)</span></code></pre></div>
<!--chapter:end:slitasje.Rmd-->
</div>
</div>
</div>
<div id="median-summer-temp" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Median Summer Temperature</h1>
<p><br /></p>
<p><em>Author and date:</em></p>
<p>Anders L. Kolstad</p>
<p>March 2023</p>
<p><br /></p>
<!-- Load all you dependencies here -->
<table>
<thead>
<tr class="header">
<th align="left">Ecosystem</th>
<th align="left">Økologisk.egenskap</th>
<th align="left">ECT.class</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">All</td>
<td align="left">Abiotiske egenskaper</td>
<td align="left">Physical state characteristics</td>
</tr>
</tbody>
</table>
<p><br /> <br /></p>
<hr />
<div id="introduction-2" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Introduction</h2>
<p>This chapters describes the workflow for an indicator describing the median summer temperature. For a more comprehensive documentation on the development of the workflow itself, see <a href="#climate-indicators-explained">here</a>. The data comes from interpolated climate surfaces from <a href="https://senorge.no/">SeNorge</a> which contain one 1x1km raster for each day since 1957 to present. The reference levels are extracted from the time period 1961-1990 (a temporal reference condition).</p>
<p><strong>Workflow</strong></p>
<ol style="list-style-type: decimal">
<li><p>Collate variable data series, ending up with one raster per year after aggregating across days within a year</p></li>
<li><p>Calculate spatially explicit reference values by aggregating across the years 1961-1990. The upper reference value is equal to the median value of this period, and the lower reference values (two-sided) is equal to 5 SD units. The indicator value is the mean over a five year period.</p></li>
<li><p>Calculate indicator values through spatially explicit rescaling based on the reference values</p></li>
<li><p>Mask by ecosystem type (<em>This step is not yet done as we do not have ready available ecosystem maps</em>)</p></li>
<li><p>Aggregate in space (to accounting areas) and take the mean over a five year period to get final indicator values</p></li>
<li><p>Make trend figure and spatially aggregated maps</p></li>
</ol>
</div>
<div id="about-the-underlying-data-2" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> About the underlying data</h2>
<p>The data is in a raster format and extends back to 1957 in the form of multiple interpolated climate variables. The spatial resolution is 1 x 1 km.</p>
<div id="representativity-in-time-and-space-2" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Representativity in time and space</h3>
<p>The data includes the last normal period (1961-1990) which defines the reference condition for climate variables. Therefore the temporal resolution is very good. Also considering the daily resolution of the data.</p>
<p>Spatially, a 1x1 km resolution is sufficient for most climate variables, esp. in homogeneous terrain, but this needs to be evaluation for each variable and scenario specifically.</p>
</div>
<div id="original-units-2" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Original units</h3>
<p>Varied. Specified below for each parameter.</p>
</div>
<div id="temporal-coverage-2" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Temporal coverage</h3>
<p>1957 - present</p>
</div>
<div id="additional-comments-about-the-data-set" class="section level3" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Additional comments about the data set</h3>
<p>The data format has recently changed from .BIL to .nc (netcdf) and now a single file contains all the rasters for one year (365 days), and sometimes for multiple variables also.</p>
</div>
</div>
<div id="ecosystem-characteristic-2" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Ecosystem characteristic</h2>
<div id="norwegian-standard-1" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Norwegian standard</h3>
<p>These variables typically will fall under the <em>abiotiske egenskaper</em> class.</p>
</div>
<div id="seea-ea" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> SEEA EA</h3>
<p>In SEEA EA, these variables will typically fall under A1 - Physical state characteristics.</p>
</div>
</div>
<div id="collinearities-with-other-indicators-2" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Collinearities with other indicators</h2>
<p>Climate variables are most likely to be correlated with each other (e.g. temperature and snow). Also, some climate variables are better classed as pressure indicators, and these might have a causal association with several condition indicators.</p>
</div>
<div id="reference-condition-and-values-1" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Reference condition and values</h2>
<div id="reference-condition-1" class="section level3" number="3.5.1">
<h3><span class="header-section-number">3.5.1</span> Reference condition</h3>
<p>The reference condition for climate variables is defined as the normal period 1961-1990.</p>
</div>
<div id="reference-values-thresholds-for-defining-good-ecological-condition-minimum-andor-maximum-values-2" class="section level3" number="3.5.2">
<h3><span class="header-section-number">3.5.2</span> Reference values, thresholds for defining <em>good ecological condition</em>, minimum and/or maximum values</h3>
<ul>
<li><p>Un-scaled indicator value = median value over 5 year periods (5 years being a pragmatic choice. It is long enough to smooth out a lot of inter-annual variation, and it’s long enough to enable estimating errors)</p></li>
<li><p>Upper reference level (best possible condition) = median value from the reference period</p></li>
<li><p>Thresholds for good ecosystem condition = 2 standard deviation units away from the upper reference level for the climate variable during the reference period.</p></li>
<li><p>Lower reference values (two-directional) = 5 standard deviation units for the climate variable during the reference period (implies linear scaling).</p></li>
</ul>
<p>The choice to use 2 SD units as the threshold values is a subjective choice in many ways, and not founded in any empirical or known relationship between the indicators and ecosystem integrity. The value comes from the common practice of calling something <em>extreme weather</em> when it is outside 2 SD units of the current running average. So, if the indicator value today is &lt;0.6 it implies that the mean for that variable over the last year would have been referred to as <em>extreme</em> if it had occurred between 1961 and 1990. This is I think a conservative threshold, since one would/could call it <em>extreme</em> if only one year is outside the 2SD range, and having the mean of 5 years being outside this range is <em>really</em> extreme.</p>
</div>
</div>
<div id="uncertainties-2" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> Uncertainties</h2>
<p>For the indicator map (1 x 1 km raster) there is no uncertainty associated with the indicator values. For aggregated indicator values (e.g. for regions), the uncertainty in the indicator value is calculated from the spatial variation in the indicator values via bootstrapping. This might, however, be changed later to the temporal variation between the five years of each period.</p>
</div>
<div id="references-2" class="section level2" number="3.7">
<h2><span class="header-section-number">3.7</span> References</h2>
<p><a href="https://senorge.no/" class="uri">https://senorge.no/</a></p>
<p><em>rr and tm are being download from:</em> <a href="https://thredds.met.no/thredds/catalog/senorge/seNorge_2018/Archive/catalog.html" class="uri">https://thredds.met.no/thredds/catalog/senorge/seNorge_2018/Archive/catalog.html</a></p>
<div id="additional-resources" class="section level3" number="3.7.1">
<h3><span class="header-section-number">3.7.1</span> Additional resources</h3>
<p><a href="https://r-spatial.github.io/stars/">Stars package</a></p>
<p><a href="https://tmieno2.github.io/R-as-GIS-for-Economists/stars-basics.html">R as a GIS for economists</a> chapter 7</p>
<p><hl/></p>
</div>
</div>
<div id="analyses-2" class="section level2" number="3.8">
<h2><span class="header-section-number">3.8</span> Analyses</h2>
<div id="data-set" class="section level3" number="3.8.1">
<h3><span class="header-section-number">3.8.1</span> Data set</h3>
<p>The data is downloaded to a local NINA server, and updated regularly.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dir <span class="sc">==</span> <span class="st">&quot;C:&quot;</span>, </span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;R:/GeoSpatialData/Meteorology/Norway_SeNorge2018_v22.09/Original&quot;</span>,</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;/data/R/GeoSpatialData/Meteorology/Norway_SeNorge2018_v22.09/Original&quot;</span>)</span></code></pre></div>
<p>This folder contains folder for the different parameters</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>(files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(path))</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;age&quot;        &quot;fsw&quot;        &quot;gwb_eva&quot;    &quot;gwb_gwtcl&quot; </span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;gwb_q&quot;      &quot;gwb_sssdev&quot; &quot;gwb_sssrel&quot; &quot;lwc&quot;       </span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;qsw&quot;        &quot;rr_tm&quot;      &quot;sd&quot;         &quot;sdfsw&quot;     </span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [13] &quot;swe&quot;</span></span></code></pre></div>
<p>We are interested in <em>tm</em>, which is temperatur in celcius. For some reason the same variable is called <em>tg</em> in the data itself.</p>
<div id="regions-1" class="section level4" number="3.8.1.1">
<h4><span class="header-section-number">3.8.1.1</span> Regions</h4>
<p>Importing a shape file with the regional delineation.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>reg <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">&quot;data/regions.shp&quot;</span>, <span class="at">options =</span> <span class="st">&quot;ENCODING=UTF8&quot;</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; options:        ENCODING=UTF8 </span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Reading layer `regions&#39; from data source </span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   `/data/scratch/Matt_bookdown__debug/ecosystemCondition/data/regions.shp&#39; </span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   using driver `ESRI Shapefile&#39;</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 5 features and 2 fields</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -99551.21 ymin: 6426048 xmax: 1121941 ymax: 7962744</span></span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Projected CRS: ETRS89 / UTM zone 33N</span></span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a><span class="co">#st_crs(reg)</span></span></code></pre></div>
<p>Outline of Norway</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>nor <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">&quot;data/outlineOfNorway_EPSG25833.shp&quot;</span>)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Reading layer `outlineOfNorway_EPSG25833&#39; from data source </span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   `/data/scratch/Matt_bookdown__debug/ecosystemCondition/data/outlineOfNorway_EPSG25833.shp&#39; </span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   using driver `ESRI Shapefile&#39;</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 1 feature and 2 fields</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -113472.7 ymin: 6448359 xmax: 1114618 ymax: 7939917</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Projected CRS: ETRS89 / UTM zone 33N</span></span></code></pre></div>
<p>Remove marine areas from regions</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>reg <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(reg, nor)</span></code></pre></div>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(reg) <span class="sc">+</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col=</span><span class="st">&quot;region&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="medianSummerTemperature_files/figure-html/unnamed-chunk-8-1.png" alt="Five accounting areas (regions) in Norway." width="672" />
<p class="caption">
(#fig:unnamed-chunk-8)Five accounting areas (regions) in Norway.
</p>
</div>
</div>
<div id="ecosystem-map-1" class="section level4" number="3.8.1.2">
<h4><span class="header-section-number">3.8.1.2</span> Ecosystem map</h4>
<p>Coming soon ….</p>
<p>The climate indicators need to be masked with ecosystem type maps. This step is part of this chapter.</p>
</div>
</div>
<div id="conceptual-workflow" class="section level3" number="3.8.2">
<h3><span class="header-section-number">3.8.2</span> Conceptual workflow</h3>
<p>The general, the conceptual workflow is like this:</p>
<ol style="list-style-type: decimal">
<li><p>Collate variable data series</p>
<ul>
<li><p>Import .nc files (loop though year 1961-1990) and subset to the correct attribute</p></li>
<li><p>Filter data by dates (optional) (<code>dplyr::filter</code>). <em>This means reading all 365 rasters into memory, and it is much quicker to filter out the correct rasters in the importing step above (see examples later in this chapter)</em></p></li>
<li><p>Aggregate across time within a year (<code>stars::st_apply</code>). <em>This is the most time consuming operation in the workflow.</em></p></li>
<li><p>Join all data into one data cube (<code>stars:c</code>)</p></li>
</ul></li>
<li><p>Calculate reference values</p>
<ul>
<li><p>Aggregate (<code>st_apply)</code> across reference years (<code>dplyr::filter</code>) to get median and sd values</p></li>
<li><p>Join with existing data cube (<code>stars:c</code>)</p></li>
</ul></li>
<li><p>Calculate indicator values</p>
<ul>
<li>Normalize climate variable at the individual grid cell level using the three reference values (<code>mutate(across()))</code></li>
</ul></li>
<li><p>Mask by ecosystem type (<em>This could also be done in step one, but it doesn’t speed things up to set some cells to NA</em>)</p></li>
<li><p>Aggregate in space (to accounting areas) (<em>zonal statistics</em>)</p>
<ul>
<li><p>Aggregate across 5 year time steps to smooth out random inter-annual variation and leave climate signal</p></li>
<li><p>Intersect with accounting area polygons <code>exactextrar::exact_extract</code> and get mean/median and (spatial) sd. (<em>Alternatively, get temporal sd at the grid cell level in the step above.</em>)</p></li>
</ul></li>
<li><p>Make trend figure and spatially aggregated maps</p></li>
</ol>
</div>
<div id="step-1---temporal-aggregation-within-a-year" class="section level3" number="3.8.3">
<h3><span class="header-section-number">3.8.3</span> Step 1 - temporal aggregation within a year</h3>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> path <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dir <span class="sc">==</span> <span class="st">&quot;C:&quot;</span>, </span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;R:/&quot;</span>,</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;/data/R/&quot;</span>)</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>path2 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(path, <span class="st">&quot;GeoSpatialData/Meteorology/Norway_SeNorge2018_v22.09/Original/rr_tm/&quot;</span>)</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>myFiles <span class="ot">&lt;-</span> <span class="fu">list.files</span>(path2, <span class="at">pattern=</span><span class="st">&quot;.nc$&quot;</span>,<span class="at">full.names =</span> T)</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The last file (the last year) is incomplete and don&#39;t include all julian dates that we select below, so I will not include it:</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>myFiles <span class="ot">&lt;-</span> myFiles[<span class="sc">-</span><span class="fu">length</span>(myFiles)]</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>real_temp_summer <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a><span class="co"># set up parallel cluster using 10 cores</span></span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(10L)</span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Get julian days after defining months</span></span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> stars<span class="sc">::</span><span class="fu">read_ncdf</span>(<span class="fu">paste</span>(myFiles[<span class="dv">1</span>]), <span class="at">var=</span><span class="st">&quot;tg&quot;</span>)</span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a>start_month_num <span class="ot">&lt;-</span>  <span class="dv">6</span></span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a>end_month_num <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb118-20"><a href="#cb118-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-21"><a href="#cb118-21" aria-hidden="true" tabindex="-1"></a>julian_start <span class="ot">&lt;-</span> <span class="fu">yday</span>(<span class="fu">st_get_dimension_values</span>(temp, <span class="st">&quot;time&quot;</span>)[<span class="dv">1</span>] <span class="sc">%m+%</span></span>
<span id="cb118-22"><a href="#cb118-22" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">months</span>(<span class="sc">+</span>start_month_num))</span>
<span id="cb118-23"><a href="#cb118-23" aria-hidden="true" tabindex="-1"></a>julian_end <span class="ot">&lt;-</span> <span class="fu">yday</span>(<span class="fu">st_get_dimension_values</span>(temp, <span class="st">&quot;time&quot;</span>)[<span class="dv">1</span>] <span class="sc">%m+%</span></span>
<span id="cb118-24"><a href="#cb118-24" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">months</span>(<span class="sc">+</span>end_month_num))</span>
<span id="cb118-25"><a href="#cb118-25" aria-hidden="true" tabindex="-1"></a>step <span class="ot">&lt;-</span> julian_end<span class="sc">-</span>julian_start</span>
<span id="cb118-26"><a href="#cb118-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-27"><a href="#cb118-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-28"><a href="#cb118-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-29"><a href="#cb118-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(myFiles)){</span>
<span id="cb118-30"><a href="#cb118-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb118-31"><a href="#cb118-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tic</span>(<span class="st">&quot;init&quot;</span>)</span>
<span id="cb118-32"><a href="#cb118-32" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> stars<span class="sc">::</span><span class="fu">read_ncdf</span>(<span class="fu">paste</span>(myFiles[i]), <span class="at">var=</span><span class="st">&quot;tg&quot;</span>, <span class="at">proxy=</span>F,</span>
<span id="cb118-33"><a href="#cb118-33" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ncsub =</span> <span class="fu">cbind</span>(<span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, julian_start), </span>
<span id="cb118-34"><a href="#cb118-34" aria-hidden="true" tabindex="-1"></a>                              <span class="at">count =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, step)))</span>
<span id="cb118-35"><a href="#cb118-35" aria-hidden="true" tabindex="-1"></a>  year_temp <span class="ot">&lt;-</span> <span class="fu">year</span>(<span class="fu">st_get_dimension_values</span>(temp, <span class="st">&quot;time&quot;</span>)[<span class="dv">1</span>])</span>
<span id="cb118-36"><a href="#cb118-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(year_temp)</span>
<span id="cb118-37"><a href="#cb118-37" aria-hidden="true" tabindex="-1"></a>  lookup <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="st">&quot;mean&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;v_&quot;</span>, year_temp)) </span>
<span id="cb118-38"><a href="#cb118-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Perhaps leave out the v_ to get a numeric vector instead, </span></span>
<span id="cb118-39"><a href="#cb118-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># which is easier to subset</span></span>
<span id="cb118-40"><a href="#cb118-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_crs</span>(temp) <span class="ot">&lt;-</span> <span class="dv">25833</span></span>
<span id="cb118-41"><a href="#cb118-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">toc</span>()</span>
<span id="cb118-42"><a href="#cb118-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-43"><a href="#cb118-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tic</span>(<span class="st">&quot;filter and st_apply&quot;</span>)</span>
<span id="cb118-44"><a href="#cb118-44" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> temp <span class="sc">%&gt;%</span></span>
<span id="cb118-45"><a href="#cb118-45" aria-hidden="true" tabindex="-1"></a>    <span class="co">#filter(time %within% myInterval) %&gt;%</span></span>
<span id="cb118-46"><a href="#cb118-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_apply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, mean, <span class="at">CLUSTER =</span> cl) <span class="sc">%&gt;%</span></span>
<span id="cb118-47"><a href="#cb118-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="fu">all_of</span>(lookup)) </span>
<span id="cb118-48"><a href="#cb118-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">toc</span>()</span>
<span id="cb118-49"><a href="#cb118-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb118-50"><a href="#cb118-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tic</span>(<span class="st">&quot;c()&quot;</span>)</span>
<span id="cb118-51"><a href="#cb118-51" aria-hidden="true" tabindex="-1"></a>  real_temp_summer <span class="ot">&lt;-</span> <span class="fu">c</span>(temp, real_temp_summer)</span>
<span id="cb118-52"><a href="#cb118-52" aria-hidden="true" tabindex="-1"></a>  <span class="co">#rm(temp)</span></span>
<span id="cb118-53"><a href="#cb118-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">toc</span>()</span>
<span id="cb118-54"><a href="#cb118-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb118-55"><a href="#cb118-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-56"><a href="#cb118-56" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>(<span class="st">&quot;Merge&quot;</span>)</span>
<span id="cb118-57"><a href="#cb118-57" aria-hidden="true" tabindex="-1"></a>real_temp_summer <span class="ot">&lt;-</span> real_temp_summer <span class="sc">%&gt;%</span></span>
<span id="cb118-58"><a href="#cb118-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(<span class="at">name =</span> <span class="st">&quot;Year&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb118-59"><a href="#cb118-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="st">&quot;climate_variable&quot;</span>)</span>
<span id="cb118-60"><a href="#cb118-60" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span>
<span id="cb118-61"><a href="#cb118-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-62"><a href="#cb118-62" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span></code></pre></div>
<p>This takes about 20 sec per file/year, or 22 min on total. That is not too bad. About 6000 rasters are read into memory. Here’s a test for the effect of splitting over more cores.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stars</span>(real_temp_summer, <span class="st">&quot;/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/aggregated_climate_time_series/real_temp_summer.tiff&quot;</span>)</span></code></pre></div>
<p>Note that GTiff automatically renames the third dimension <em>band</em> and also renames the attribute. I can rename them.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>summer_median_temp <span class="ot">&lt;-</span> real_temp_summer <span class="sc">%&gt;%</span> </span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_dimensions</span>(<span class="at">names =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;v_YEAR&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="st">&quot;temperature&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> summer_median_temp[,,,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">11</span>,<span class="dv">66</span>)], <span class="at">downsample =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;D&quot;</span>) <span class="sc">+</span>  </span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>v_YEAR)</span></code></pre></div>
<div class="figure">
<img src="medianSummerTemperature_files/figure-html/unnamed-chunk-13-1.png" alt="Showing three random slices of the year dimension." width="672" />
<p class="caption">
(#fig:unnamed-chunk-13)Showing three random slices of the year dimension.
</p>
</div>
</div>
<div id="step-2---calculate-reference-values" class="section level3" number="3.8.4">
<h3><span class="header-section-number">3.8.4</span> Step 2 - calculate reference values</h3>
<p>We need to first to define a reference period and then to subset our data <code>summer_median_temp</code>.</p>
<p>First we need to rename our dimension values and turn them back into dates.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>new_dims <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">substr</span>(<span class="fu">st_get_dimension_values</span>(summer_median_temp, <span class="st">&quot;v_YEAR&quot;</span>), <span class="dv">3</span>, <span class="dv">6</span>), <span class="st">&quot;-01-01&quot;</span>))</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>summer_median_temp_ref <span class="ot">&lt;-</span> summer_median_temp <span class="sc">%&gt;%</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_dimensions</span>(<span class="st">&quot;v_YEAR&quot;</span>, <span class="at">values =</span> new_dims)</span></code></pre></div>
<p>Then I can filter to leave only the reference period.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>summer_median_temp_ref <span class="ot">&lt;-</span> summer_median_temp_ref <span class="sc">%&gt;%</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(v_YEAR <span class="sc">%within%</span> <span class="fu">interval</span>(<span class="st">&quot;1961-01-01&quot;</span>, <span class="st">&quot;1990-12-31&quot;</span>))</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_get_dimension_values</span>(summer_median_temp_ref, <span class="st">&quot;v_YEAR&quot;</span>)</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;1990-01-01&quot; &quot;1989-01-01&quot; &quot;1988-01-01&quot; &quot;1987-01-01&quot;</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;1986-01-01&quot; &quot;1985-01-01&quot; &quot;1984-01-01&quot; &quot;1983-01-01&quot;</span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;1982-01-01&quot; &quot;1981-01-01&quot; &quot;1980-01-01&quot; &quot;1979-01-01&quot;</span></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [13] &quot;1978-01-01&quot; &quot;1977-01-01&quot; &quot;1976-01-01&quot; &quot;1975-01-01&quot;</span></span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [17] &quot;1974-01-01&quot; &quot;1973-01-01&quot; &quot;1972-01-01&quot; &quot;1971-01-01&quot;</span></span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [21] &quot;1970-01-01&quot; &quot;1969-01-01&quot; &quot;1968-01-01&quot; &quot;1967-01-01&quot;</span></span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [25] &quot;1966-01-01&quot; &quot;1965-01-01&quot; &quot;1964-01-01&quot; &quot;1963-01-01&quot;</span></span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [29] &quot;1962-01-01&quot; &quot;1961-01-01&quot;</span></span></code></pre></div>
<p>And then we calculate the median and sd like above</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>median_sd <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { <span class="fu">c</span>(<span class="at">median =</span> <span class="fu">median</span>(x), <span class="at">sd =</span> <span class="fu">sd</span>(x))}</span></code></pre></div>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(10L)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>summer_median_temp_ref <span class="ot">&lt;-</span> summer_median_temp_ref <span class="sc">%&gt;%</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_apply</span>(<span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>), </span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">FUN =</span>  median_sd,</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">CLUSTER =</span> cl)</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th>user</th>
<th>system</th>
<th>elapsed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>9.624</td>
<td>6.069</td>
<td>20.903</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stars</span>(summer_median_temp_ref, <span class="st">&quot;/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/aggregated_climate_time_series/summer_median_temp_ref.tiff&quot;</span>)</span></code></pre></div>
<p>Pivot and turn dimension into attributes, and rename attributes:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>summer_median_temp_ref_long <span class="ot">&lt;-</span> summer_median_temp_ref <span class="sc">%&gt;%</span> </span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(<span class="st">&quot;band&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">&quot;reference_upper&quot;</span>, <span class="st">&quot;sd&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(<span class="fu">st_downsample</span>(summer_median_temp_ref_long, <span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="st">&quot;reference_upper&quot;</span>)</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>,</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(<span class="fu">st_downsample</span>(summer_median_temp_ref_long, <span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="st">&quot;sd&quot;</span>,</span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">palette =</span> <span class="st">&quot;-viridis&quot;</span>)</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure">
<img src="medianSummerTemperature_files/figure-html/unnamed-chunk-21-1.png" alt="Showing the upper reference levels and the standard deviation from actual data of median summer temperatures." width="672" />
<p class="caption">
(#fig:unnamed-chunk-21)Showing the upper reference levels and the standard deviation from actual data of median summer temperatures.
</p>
</div>
<p>I need to combine the variables and the ref values in one data cube</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>y_var <span class="ot">&lt;-</span> summer_median_temp <span class="sc">%&gt;%</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(<span class="st">&quot;v_YEAR&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(summer_median_temp_ref_long)</span></code></pre></div>
</div>
<div id="step-3---normalise-variable" class="section level3" number="3.8.5">
<h3><span class="header-section-number">3.8.5</span> Step 3 - normalise variable</h3>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select the columns to normalise</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">names</span>(y_var)[<span class="sc">!</span><span class="fu">names</span>(y_var) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;reference_upper&quot;</span>, <span class="st">&quot;sd&quot;</span>) ]</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>cols_new <span class="ot">&lt;-</span> cols</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cols_new) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;v_&quot;</span>, <span class="st">&quot;i_&quot;</span>, cols)</span></code></pre></div>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The break point scaling is actually not needed here, since </span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="co"># having the lower ref value to be 5 sd implies that the threshold is</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 sd in a linear scaling.</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>y_var_norm <span class="ot">&lt;-</span> y_var <span class="sc">%&gt;%</span></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">reference_low =</span> reference_upper <span class="sc">-</span> <span class="dv">5</span><span class="sc">*</span>sd ) <span class="sc">%&gt;%</span></span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">reference_low2 =</span> reference_upper <span class="sc">+</span> <span class="dv">5</span><span class="sc">*</span>sd ) <span class="sc">%&gt;%</span></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">threshold_low =</span> reference_upper <span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>sd ) <span class="sc">%&gt;%</span></span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">threshold_high =</span> reference_upper <span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>sd ) <span class="sc">%&gt;%</span></span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(cols), <span class="sc">~</span> </span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">if_else</span>(.x <span class="sc">&lt;</span> reference_upper,</span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">if_else</span>(.x <span class="sc">&lt;</span> threshold_low, </span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>                                        (.x <span class="sc">-</span> reference_low) <span class="sc">/</span> (threshold_low <span class="sc">-</span> reference_low),</span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a>                                        (.x <span class="sc">-</span> threshold_low) <span class="sc">/</span> (reference_upper <span class="sc">-</span> threshold_low),</span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a>                                        ),</span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">if_else</span>(.x <span class="sc">&gt;</span> threshold_high, </span>
<span id="cb131-18"><a href="#cb131-18" aria-hidden="true" tabindex="-1"></a>                                        (reference_low2 <span class="sc">-</span> .x) <span class="sc">/</span> (reference_low2 <span class="sc">-</span> threshold_high),</span>
<span id="cb131-19"><a href="#cb131-19" aria-hidden="true" tabindex="-1"></a>                                        (threshold_high <span class="sc">-</span> .x) <span class="sc">/</span> (threshold_high <span class="sc">-</span> reference_upper),</span>
<span id="cb131-20"><a href="#cb131-20" aria-hidden="true" tabindex="-1"></a>                                        )</span>
<span id="cb131-21"><a href="#cb131-21" aria-hidden="true" tabindex="-1"></a>                ))) <span class="sc">%&gt;%</span></span>
<span id="cb131-22"><a href="#cb131-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(cols), <span class="sc">~</span> <span class="fu">if_else</span>(.x <span class="sc">&gt;</span> <span class="dv">1</span>, <span class="dv">1</span>, .x))) <span class="sc">%&gt;%</span></span>
<span id="cb131-23"><a href="#cb131-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(cols), <span class="sc">~</span> <span class="fu">if_else</span>(.x <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, .x))) <span class="sc">%&gt;%</span></span>
<span id="cb131-24"><a href="#cb131-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="fu">all_of</span>(cols_new)) <span class="sc">%&gt;%</span></span>
<span id="cb131-25"><a href="#cb131-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fu">select</span>(y_var, <span class="fu">all_of</span>(cols)))</span>
<span id="cb131-26"><a href="#cb131-26" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th>user</th>
<th>system</th>
<th>elapsed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>14.803</td>
<td>2.717</td>
<td>17.512</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(y_var_norm, <span class="st">&quot;/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/aggregated_climate_time_series/summer_median_temp_normalised.RData&quot;</span>)</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Tiff dont allow for multiple attributes:</span></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="co">#write_stars(y_var_norm, &quot;/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/aggregated_climate_time_series/summer_median_temp_normalised.tiff&quot;)</span></span></code></pre></div>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>lims <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">22</span>)</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> <span class="fu">st_downsample</span>(y_var_norm[<span class="st">&quot;v_1970&quot;</span>],<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;D&quot;</span>,</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> lims) <span class="sc">+</span>  </span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a>,</span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> <span class="fu">st_downsample</span>(y_var_norm[<span class="st">&quot;reference_upper&quot;</span>], <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb133-18"><a href="#cb133-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;D&quot;</span>,</span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> lims) <span class="sc">+</span>  </span>
<span id="cb133-20"><a href="#cb133-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb133-21"><a href="#cb133-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb133-22"><a href="#cb133-22" aria-hidden="true" tabindex="-1"></a>,</span>
<span id="cb133-23"><a href="#cb133-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb133-24"><a href="#cb133-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> <span class="fu">st_downsample</span>(y_var_norm[<span class="st">&quot;reference_low&quot;</span>], <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb133-25"><a href="#cb133-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb133-26"><a href="#cb133-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb133-27"><a href="#cb133-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;D&quot;</span>,</span>
<span id="cb133-28"><a href="#cb133-28" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> lims) <span class="sc">+</span>  </span>
<span id="cb133-29"><a href="#cb133-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb133-30"><a href="#cb133-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb133-31"><a href="#cb133-31" aria-hidden="true" tabindex="-1"></a>,</span>
<span id="cb133-32"><a href="#cb133-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-33"><a href="#cb133-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb133-34"><a href="#cb133-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> <span class="fu">st_downsample</span>(y_var_norm[<span class="st">&quot;reference_low2&quot;</span>], <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb133-35"><a href="#cb133-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb133-36"><a href="#cb133-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb133-37"><a href="#cb133-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;D&quot;</span>,</span>
<span id="cb133-38"><a href="#cb133-38" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> lims) <span class="sc">+</span>  </span>
<span id="cb133-39"><a href="#cb133-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb133-40"><a href="#cb133-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb133-41"><a href="#cb133-41" aria-hidden="true" tabindex="-1"></a>,</span>
<span id="cb133-42"><a href="#cb133-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-43"><a href="#cb133-43" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb133-44"><a href="#cb133-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> <span class="fu">st_downsample</span>(y_var_norm[<span class="st">&quot;i_1970&quot;</span>],<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb133-45"><a href="#cb133-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb133-46"><a href="#cb133-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb133-47"><a href="#cb133-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;A&quot;</span>,</span>
<span id="cb133-48"><a href="#cb133-48" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span>  </span>
<span id="cb133-49"><a href="#cb133-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb133-50"><a href="#cb133-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb133-51"><a href="#cb133-51" aria-hidden="true" tabindex="-1"></a>, <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">nrow=</span><span class="dv">3</span>, <span class="at">align =</span> <span class="st">&quot;hv&quot;</span></span>
<span id="cb133-52"><a href="#cb133-52" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure">
<img src="medianSummerTemperature_files/figure-html/unnamed-chunk-27-1.png" alt="Example showing median summer tempretur in 1970, the upper and lwoer reference temperture, i.e. median and 5 SD units of the temperature between  1961-1990, and finally, the scaled indicator values." width="672" />
<p class="caption">
(#fig:unnamed-chunk-27)Example showing median summer tempretur in 1970, the upper and lwoer reference temperture, i.e. median and 5 SD units of the temperature between 1961-1990, and finally, the scaled indicator values.
</p>
</div>
<p>The <em>real</em> indicator values should be means over 5 year periods. Calculating a running mean for all time steps is too time consuming. Therefore, the scaled, regional indicator values will be calculated for distinct time steps. The time series can perhaps still be presented with yearly resolution.</p>
</div>
<div id="step-4---mask-with-ecosystem-delineation-map" class="section level3" number="3.8.6">
<h3><span class="header-section-number">3.8.6</span> Step 4 - Mask with ecosystem delineation map</h3>
<p>This step we simply ignore for now. It should be relatively easy to do, when we have the maps.</p>
</div>
<div id="step-5---make-figures" class="section level3" number="3.8.7">
<h3><span class="header-section-number">3.8.7</span> Step 5 - Make figures</h3>
<p>To plot time series I first need to do a spatial aggregation.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>regional_means <span class="ot">&lt;-</span> <span class="fu">rast</span>(y_var_norm) <span class="sc">%&gt;%</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exact_extract</span>(reg, <span class="at">fun =</span> <span class="st">&#39;mean&#39;</span>, <span class="at">append_cols =</span> <span class="st">&quot;region&quot;</span>, <span class="at">progress=</span>T) <span class="sc">%&gt;%</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">&quot;region&quot;</span>, <span class="fu">names</span>(y_var_norm)))</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>user; system; elapsed: 7.603; 3.071; 10.697</p>
<p>I could also get the sd like this, if I wanted to base the indicator uncertainty on a measure of spatial variation:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>regional_sd <span class="ot">&lt;-</span> <span class="fu">rast</span>(y_var_norm) <span class="sc">%&gt;%</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exact_extract</span>(reg, <span class="at">fun =</span> <span class="st">&#39;stdev&#39;</span>, <span class="at">append_cols =</span> <span class="st">&quot;region&quot;</span>, <span class="at">progress=</span>T) <span class="sc">%&gt;%</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">&quot;region&quot;</span>, <span class="fu">names</span>(y_var_norm)))</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>user; system; elapsed: 7.420; 2.921; 10.355</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(regional_means, <span class="st">&quot;temp/regional_means.rds&quot;</span>)</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(regional_sd, <span class="st">&quot;temp/regional_sd.rds&quot;</span>)</span></code></pre></div>
<p>Reshape and plot</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>div <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;reference_upper&quot;</span>,</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;reference_low&quot;</span>,</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;reference_low2&quot;</span>,</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;threshold_low&quot;</span>,</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;threshold_high&quot;</span>,</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;sd&quot;</span>)</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> regional_means <span class="sc">%&gt;%</span></span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(region, div)</span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a>regional_means_long <span class="ot">&lt;-</span> regional_means <span class="sc">%&gt;%</span></span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">all_of</span>(div)) <span class="sc">%&gt;%</span></span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span>region) <span class="sc">%&gt;%</span></span>
<span id="cb137-16"><a href="#cb137-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="at">into=</span><span class="fu">c</span>(<span class="st">&quot;type&quot;</span>, <span class="st">&quot;year&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb137-17"><a href="#cb137-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="co">#id_cols = region,</span></span>
<span id="cb137-18"><a href="#cb137-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_from =</span> type)  <span class="sc">%&gt;%</span></span>
<span id="cb137-19"><a href="#cb137-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(temp, <span class="at">by=</span><span class="fu">join_by</span>(region)) <span class="sc">%&gt;%</span> </span>
<span id="cb137-20"><a href="#cb137-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> v<span class="sc">-</span>reference_upper) <span class="sc">%&gt;%</span></span>
<span id="cb137-21"><a href="#cb137-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">threshold_low_centered =</span> threshold_low<span class="sc">-</span>reference_upper) <span class="sc">%&gt;%</span></span>
<span id="cb137-22"><a href="#cb137-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">threshold_high_centered =</span> threshold_high<span class="sc">-</span>reference_upper)</span>
<span id="cb137-23"><a href="#cb137-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-24"><a href="#cb137-24" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding the spatial sd</span></span>
<span id="cb137-25"><a href="#cb137-25" aria-hidden="true" tabindex="-1"></a><span class="co">#(</span></span>
<span id="cb137-26"><a href="#cb137-26" aria-hidden="true" tabindex="-1"></a><span class="co">#regional_means_long &lt;- regional_sd %&gt;%</span></span>
<span id="cb137-27"><a href="#cb137-27" aria-hidden="true" tabindex="-1"></a><span class="co">#  select(!all_of(div)) %&gt;%</span></span>
<span id="cb137-28"><a href="#cb137-28" aria-hidden="true" tabindex="-1"></a><span class="co">#  pivot_longer(!region) %&gt;%</span></span>
<span id="cb137-29"><a href="#cb137-29" aria-hidden="true" tabindex="-1"></a><span class="co">#  separate(name, into=c(&quot;type&quot;, &quot;year&quot;)) %&gt;%</span></span>
<span id="cb137-30"><a href="#cb137-30" aria-hidden="true" tabindex="-1"></a><span class="co">#  pivot_wider(names_from = type) %&gt;%</span></span>
<span id="cb137-31"><a href="#cb137-31" aria-hidden="true" tabindex="-1"></a><span class="co">#  rename(i_sd = i,</span></span>
<span id="cb137-32"><a href="#cb137-32" aria-hidden="true" tabindex="-1"></a><span class="co">#         v_sd = v) %&gt;%</span></span>
<span id="cb137-33"><a href="#cb137-33" aria-hidden="true" tabindex="-1"></a><span class="co">#  left_join(regional_means_long, by=join_by(region, year))</span></span>
<span id="cb137-34"><a href="#cb137-34" aria-hidden="true" tabindex="-1"></a><span class="co">#)</span></span></code></pre></div>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>regOrder <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Østlandet&quot;</span>,<span class="st">&quot;Sørlandet&quot;</span>,<span class="st">&quot;Vestlandet&quot;</span>,<span class="st">&quot;Midt-Norge&quot;</span>,<span class="st">&quot;Nord-Norge&quot;</span>)</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>regional_means_long <span class="sc">%&gt;%</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">col =</span> <span class="fu">if_else</span>(diff<span class="sc">&gt;</span><span class="dv">0</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(year), </span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> diff, <span class="at">fill =</span> col))<span class="sc">+</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> threshold_low_centered),</span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">linetype=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> threshold_high_centered),</span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">linetype=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> <span class="dv">1961</span>, <span class="at">xend=</span><span class="dv">1990</span>,</span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">0</span>,</span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_hue</span>(<span class="at">l=</span><span class="dv">70</span>, <span class="at">c=</span><span class="dv">60</span>)<span class="sc">+</span></span>
<span id="cb138-16"><a href="#cb138-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb138-17"><a href="#cb138-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Sommertemperatur</span><span class="sc">\n</span><span class="st">avvik fra 1961-1990&quot;</span>)<span class="sc">+</span></span>
<span id="cb138-18"><a href="#cb138-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>)<span class="sc">+</span></span>
<span id="cb138-19"><a href="#cb138-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill=</span><span class="st">&quot;none&quot;</span>)<span class="sc">+</span></span>
<span id="cb138-20"><a href="#cb138-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( .<span class="sc">~</span> <span class="fu">factor</span>(region, <span class="at">levels =</span> regOrder),</span>
<span id="cb138-21"><a href="#cb138-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">ncol=</span><span class="dv">3</span>,</span>
<span id="cb138-22"><a href="#cb138-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="medianSummerTemperature_files/figure-html/summer-temp-time-series-1.png" alt="Times series for median summer temperature centered on the median value during the reference period. The reference period is indicated with a thick horizontal line. Dottet horisontal lines are 2 sd units for the reference period." width="672" />
<p class="caption">
(#fig:summer-temp-time-series)Times series for median summer temperature centered on the median value during the reference period. The reference period is indicated with a thick horizontal line. Dottet horisontal lines are 2 sd units for the reference period.
</p>
</div>
<p>Then we can take the mean and sd over the last 5 years and add to a spatial representation.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>i_aggregatedToPeriods <span class="ot">&lt;-</span> regional_means_long <span class="sc">%&gt;%</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year)) <span class="sc">%&gt;%</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">period =</span> <span class="fu">case_when</span>(</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">%between%</span> <span class="fu">c</span>(<span class="dv">2018</span>, <span class="dv">2022</span>) <span class="sc">~</span> <span class="st">&quot;2018-2022&quot;</span>,</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">%between%</span> <span class="fu">c</span>(<span class="dv">2013</span>, <span class="dv">2017</span>) <span class="sc">~</span> <span class="st">&quot;2013-2017&quot;</span>,</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">%between%</span> <span class="fu">c</span>(<span class="dv">2008</span>, <span class="dv">2012</span>) <span class="sc">~</span> <span class="st">&quot;2008-2012&quot;</span>,</span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">%between%</span> <span class="fu">c</span>(<span class="dv">2003</span>, <span class="dv">2007</span>) <span class="sc">~</span> <span class="st">&quot;2003-2007&quot;</span>,</span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="st">&quot;pre 2003&quot;</span></span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">period_rank =</span> <span class="fu">case_when</span>(</span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a>   period <span class="sc">==</span> <span class="st">&quot;2018-2022&quot;</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a>   period <span class="sc">==</span> <span class="st">&quot;2013-2017&quot;</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb139-14"><a href="#cb139-14" aria-hidden="true" tabindex="-1"></a>   period <span class="sc">==</span> <span class="st">&quot;2008-2012&quot;</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb139-15"><a href="#cb139-15" aria-hidden="true" tabindex="-1"></a>   period <span class="sc">==</span> <span class="st">&quot;2003-2007&quot;</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb139-16"><a href="#cb139-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="dv">1</span></span>
<span id="cb139-17"><a href="#cb139-17" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb139-18"><a href="#cb139-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, period, period_rank) <span class="sc">%&gt;%</span></span>
<span id="cb139-19"><a href="#cb139-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">indicator =</span> <span class="fu">mean</span>(i),</span>
<span id="cb139-20"><a href="#cb139-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd =</span> <span class="fu">sd</span>(i)</span>
<span id="cb139-21"><a href="#cb139-21" aria-hidden="true" tabindex="-1"></a>            <span class="co"># If I inluded a spatial measure for the uncertainty, here is how I would carry the errors:</span></span>
<span id="cb139-22"><a href="#cb139-22" aria-hidden="true" tabindex="-1"></a>            <span class="co">#spatial_sd = sqrt(sum(i_sd^2))/length(i_sd)</span></span>
<span id="cb139-23"><a href="#cb139-23" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb139-24"><a href="#cb139-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-25"><a href="#cb139-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `summarise()` has grouped output by &#39;region&#39;, &#39;period&#39;. You</span></span>
<span id="cb139-26"><a href="#cb139-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; can override using the `.groups` argument.</span></span>
<span id="cb139-27"><a href="#cb139-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 25 × 5</span></span>
<span id="cb139-28"><a href="#cb139-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   region, period [25]</span></span>
<span id="cb139-29"><a href="#cb139-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    region     period    period_rank indicator     sd</span></span>
<span id="cb139-30"><a href="#cb139-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb139-31"><a href="#cb139-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Midt-Norge 2003-2007           2     0.427 0.139 </span></span>
<span id="cb139-32"><a href="#cb139-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Midt-Norge 2008-2012           3     0.573 0.0992</span></span>
<span id="cb139-33"><a href="#cb139-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Midt-Norge 2013-2017           4     0.536 0.212 </span></span>
<span id="cb139-34"><a href="#cb139-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Midt-Norge 2018-2022           5     0.607 0.179 </span></span>
<span id="cb139-35"><a href="#cb139-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Midt-Norge pre 2003            1     0.642 0.182 </span></span>
<span id="cb139-36"><a href="#cb139-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Nord-Norge 2003-2007           2     0.460 0.149 </span></span>
<span id="cb139-37"><a href="#cb139-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Nord-Norge 2008-2012           3     0.675 0.0602</span></span>
<span id="cb139-38"><a href="#cb139-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Nord-Norge 2013-2017           4     0.641 0.127 </span></span>
<span id="cb139-39"><a href="#cb139-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Nord-Norge 2018-2022           5     0.625 0.110 </span></span>
<span id="cb139-40"><a href="#cb139-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Nord-Norge pre 2003            1     0.625 0.194 </span></span>
<span id="cb139-41"><a href="#cb139-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 15 more rows</span></span></code></pre></div>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">&lt;-</span> <span class="fu">unique</span>(i_aggregatedToPeriods<span class="sc">$</span>period[<span class="fu">order</span>(i_aggregatedToPeriods<span class="sc">$</span>period_rank)])</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>i_aggregatedToPeriods <span class="sc">%&gt;%</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> period_rank, </span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> indicator,</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour=</span>region))<span class="sc">+</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>indicator<span class="sc">-</span>sd, </span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax=</span>indicator<span class="sc">+</span>sd), </span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">width=</span>.<span class="dv">2</span>,</span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;indikatorverdi&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="medianSummerTemperature_files/figure-html/summer-temp-time-periods-1.png" alt="Scaled indicator values, aggregated over 5 year intervals. Errors represent temporal variation (standard errors) within regions and across 5 years." width="672" />
<p class="caption">
(#fig:summer-temp-time-periods)Scaled indicator values, aggregated over 5 year intervals. Errors represent temporal variation (standard errors) within regions and across 5 years.
</p>
</div>
<p>Finally, I can add these values to the sp object with the accounting areas.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>reg2 <span class="ot">&lt;-</span> reg <span class="sc">%&gt;%</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(i_aggregatedToPeriods[i_aggregatedToPeriods<span class="sc">$</span>period_rank<span class="sc">==</span><span class="dv">5</span>,], <span class="at">by=</span><span class="fu">join_by</span>(region))</span></code></pre></div>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>myCol <span class="ot">&lt;-</span> <span class="st">&quot;RdYlGn&quot;</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>myCol2 <span class="ot">&lt;-</span> <span class="st">&quot;-RdYlGn&quot;</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>tm_main <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(reg2)<span class="sc">+</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col=</span><span class="st">&quot;indicator&quot;</span>,</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">title=</span><span class="st">&quot;Indikator:</span><span class="sc">\n</span><span class="st">sommertemperatur&quot;</span>,</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> myCol,</span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">style=</span><span class="st">&quot;fixed&quot;</span>,</span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,.<span class="dv">2</span>)) </span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a>tm_inset <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(reg2)<span class="sc">+</span></span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col=</span><span class="st">&quot;sd&quot;</span>,</span>
<span id="cb142-13"><a href="#cb142-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">title=</span><span class="st">&quot;SD&quot;</span>,</span>
<span id="cb142-14"><a href="#cb142-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> myCol2,</span>
<span id="cb142-15"><a href="#cb142-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">style=</span><span class="st">&quot;cont&quot;</span>)<span class="sc">+</span></span>
<span id="cb142-16"><a href="#cb142-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.format =</span> <span class="fu">list</span>(<span class="at">digits=</span><span class="dv">2</span>))</span>
<span id="cb142-17"><a href="#cb142-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-18"><a href="#cb142-18" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(tm_main, </span>
<span id="cb142-19"><a href="#cb142-19" aria-hidden="true" tabindex="-1"></a>             tm_inset)</span></code></pre></div>
<div class="figure">
<img src="medianSummerTemperature_files/figure-html/wall-to-wall-summer-temp-indicator-1.png" alt="Summer tempreature indicator values for five accounting areas in Norway. SD is the spatial variation." width="672" />
<p class="caption">
(#fig:wall-to-wall-summer-temp-indicator)Summer tempreature indicator values for five accounting areas in Norway. SD is the spatial variation.
</p>
</div>
<!--chapter:end:medianSummerTemperature.Rmd-->
</div>
</div>
</div>
<div id="part-deprecated" class="section level1 unnumbered">
<h1 class="unnumbered">(PART*) DEPRECATED</h1>
</div>
<div id="areal-uten-død-eller-skadet-røsslyng-i-kystlynghei" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Areal uten død eller skadet røsslyng i kystlynghei</h1>
<p><br /></p>
<p><em>Author and date:</em>
Anders L. Kolstad</p>
<pre><code>#&gt; [1] &quot;2023-03-24&quot;</code></pre>
<p><br /></p>
<!-- Load all you dependencies here -->
<!-- Fill in which ecosystem the indicator belongs to, as well as the ecosystem characteristic it should be linked to. It's OK to use some Norwegian here -->
<table>
<colgroup>
<col width="27%" />
<col width="27%" />
<col width="44%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Ecosystem</th>
<th align="left">Økologisk.egenskap</th>
<th align="left">ECT.class</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Semi-naturlig mark</td>
<td align="left">Primærproduksjon</td>
<td align="left">Structual state characteristic</td>
</tr>
</tbody>
</table>
<!-- Don't remove these three html lines -->
<br />
<br />
<hr />
<!-- Document you work below. Try not to change  the headers too much. Data can be stored on NINA server. Since the book is rendered on the R Server this works fine, but note that directory paths are different on the server compared to you local machine. If it is not too big you may store under /data/ on this repository -->
<div id="introduction-3" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Introduction</h2>
<p>Here I quickly go through the ANO data set for the years 2019-2021 to investigate the frequeny of poins that fall within coastal heathlands (kystlynghei). This will decide whether we can use this data to inform an indicator about the proportion of dead <em>Calluna vulgaris</em> (røsslyng).</p>
</div>
<div id="analyses-3" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Analyses</h2>
<div id="ano-data" class="section level4" number="4.2.0.1">
<h4><span class="header-section-number">4.2.0.1</span> ANO data</h4>
<p>Data is downloaded from <a href="https://kartkatalog.miljodirektoratet.no/Dataset/Details/2054">here</a>.</p>
<p>Import and list terms:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>ano <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">&quot;/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/Naturovervaking_eksport.gdb&quot;</span>,</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">layer =</span> <span class="st">&quot;ANO_SurveyPoint&quot;</span>)</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Reading layer `ANO_SurveyPoint&#39; from data source </span></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   `/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/Naturovervaking_eksport.gdb&#39; </span></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   using driver `OpenFileGDB&#39;</span></span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 8974 features and 71 fields</span></span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: POINT</span></span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -51950 ymin: 6467050 xmax: 1094950 ymax: 7923950</span></span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Projected CRS: ETRS89 / UTM zone 33N</span></span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a><span class="co">#st_crs(ano)</span></span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ano)</span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;GlobalID&quot;                      </span></span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [2] &quot;registeringsdato&quot;              </span></span>
<span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [3] &quot;klokkeslett_start&quot;             </span></span>
<span id="cb144-16"><a href="#cb144-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [4] &quot;ano_flate_id&quot;                  </span></span>
<span id="cb144-17"><a href="#cb144-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;ano_punkt_id&quot;                  </span></span>
<span id="cb144-18"><a href="#cb144-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [6] &quot;ssb_id&quot;                        </span></span>
<span id="cb144-19"><a href="#cb144-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [7] &quot;program&quot;                       </span></span>
<span id="cb144-20"><a href="#cb144-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [8] &quot;instruks&quot;                      </span></span>
<span id="cb144-21"><a href="#cb144-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;aar&quot;                           </span></span>
<span id="cb144-22"><a href="#cb144-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [10] &quot;dataansvarlig_mdir&quot;            </span></span>
<span id="cb144-23"><a href="#cb144-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [11] &quot;dataeier&quot;                      </span></span>
<span id="cb144-24"><a href="#cb144-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [12] &quot;vaer&quot;                          </span></span>
<span id="cb144-25"><a href="#cb144-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [13] &quot;hovedoekosystem_punkt&quot;         </span></span>
<span id="cb144-26"><a href="#cb144-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [14] &quot;andel_hovedoekosystem_punkt&quot;   </span></span>
<span id="cb144-27"><a href="#cb144-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [15] &quot;utilgjengelig_punkt&quot;           </span></span>
<span id="cb144-28"><a href="#cb144-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [16] &quot;utilgjengelig_begrunnelse&quot;     </span></span>
<span id="cb144-29"><a href="#cb144-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [17] &quot;gps&quot;                           </span></span>
<span id="cb144-30"><a href="#cb144-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [18] &quot;noeyaktighet&quot;                  </span></span>
<span id="cb144-31"><a href="#cb144-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [19] &quot;kommentar_posisjon&quot;            </span></span>
<span id="cb144-32"><a href="#cb144-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [20] &quot;klokkeslett_karplanter_start&quot;  </span></span>
<span id="cb144-33"><a href="#cb144-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [21] &quot;art_alle_registrert&quot;           </span></span>
<span id="cb144-34"><a href="#cb144-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [22] &quot;karplanter_dekning&quot;            </span></span>
<span id="cb144-35"><a href="#cb144-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [23] &quot;klokkeslett_karplanter_slutt&quot;  </span></span>
<span id="cb144-36"><a href="#cb144-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [24] &quot;karplanter_feltsjikt&quot;          </span></span>
<span id="cb144-37"><a href="#cb144-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [25] &quot;moser_dekning&quot;                 </span></span>
<span id="cb144-38"><a href="#cb144-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [26] &quot;torvmoser_dekning&quot;             </span></span>
<span id="cb144-39"><a href="#cb144-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [27] &quot;lav_dekning&quot;                   </span></span>
<span id="cb144-40"><a href="#cb144-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [28] &quot;stroe_dekning&quot;                 </span></span>
<span id="cb144-41"><a href="#cb144-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [29] &quot;jord_grus_stein_berg_dekning&quot;  </span></span>
<span id="cb144-42"><a href="#cb144-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [30] &quot;stubber_kvister_dekning&quot;       </span></span>
<span id="cb144-43"><a href="#cb144-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [31] &quot;alger_fjell_dekning&quot;           </span></span>
<span id="cb144-44"><a href="#cb144-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [32] &quot;kommentar_ruteanalyse&quot;         </span></span>
<span id="cb144-45"><a href="#cb144-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [33] &quot;fastmerker&quot;                    </span></span>
<span id="cb144-46"><a href="#cb144-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [34] &quot;kommentar_fastmerker&quot;          </span></span>
<span id="cb144-47"><a href="#cb144-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [35] &quot;kartleggingsenhet_1m2&quot;         </span></span>
<span id="cb144-48"><a href="#cb144-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [36] &quot;hovedtype_1m2&quot;                 </span></span>
<span id="cb144-49"><a href="#cb144-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [37] &quot;ke_beskrivelse_1m2&quot;            </span></span>
<span id="cb144-50"><a href="#cb144-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [38] &quot;kartleggingsenhet_250m2&quot;       </span></span>
<span id="cb144-51"><a href="#cb144-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [39] &quot;hovedtype_250m2&quot;               </span></span>
<span id="cb144-52"><a href="#cb144-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [40] &quot;ke_beskrivelse_250m2&quot;          </span></span>
<span id="cb144-53"><a href="#cb144-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [41] &quot;andel_kartleggingsenhet_250m2&quot; </span></span>
<span id="cb144-54"><a href="#cb144-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [42] &quot;bv_7gr_gi&quot;                     </span></span>
<span id="cb144-55"><a href="#cb144-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [43] &quot;bv_7jb_ba&quot;                     </span></span>
<span id="cb144-56"><a href="#cb144-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [44] &quot;bv_7jb_bt&quot;                     </span></span>
<span id="cb144-57"><a href="#cb144-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [45] &quot;bv_7jb_si&quot;                     </span></span>
<span id="cb144-58"><a href="#cb144-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [46] &quot;bv_7tk&quot;                        </span></span>
<span id="cb144-59"><a href="#cb144-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [47] &quot;bv_7se&quot;                        </span></span>
<span id="cb144-60"><a href="#cb144-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [48] &quot;forekomst_ntyp&quot;                </span></span>
<span id="cb144-61"><a href="#cb144-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [49] &quot;ntyp&quot;                          </span></span>
<span id="cb144-62"><a href="#cb144-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [50] &quot;kommentar_naturtyperegistering&quot;</span></span>
<span id="cb144-63"><a href="#cb144-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [51] &quot;side_5_note&quot;                   </span></span>
<span id="cb144-64"><a href="#cb144-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [52] &quot;krypende_vier_dekning&quot;         </span></span>
<span id="cb144-65"><a href="#cb144-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [53] &quot;ikke_krypende_vier_dekning&quot;    </span></span>
<span id="cb144-66"><a href="#cb144-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [54] &quot;vedplanter_total_dekning&quot;      </span></span>
<span id="cb144-67"><a href="#cb144-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [55] &quot;busker_dekning&quot;                </span></span>
<span id="cb144-68"><a href="#cb144-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [56] &quot;tresjikt_dekning&quot;              </span></span>
<span id="cb144-69"><a href="#cb144-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [57] &quot;treslag_registrert&quot;            </span></span>
<span id="cb144-70"><a href="#cb144-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [58] &quot;roesslyng_dekning&quot;             </span></span>
<span id="cb144-71"><a href="#cb144-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [59] &quot;roesslyngblad&quot;                 </span></span>
<span id="cb144-72"><a href="#cb144-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [60] &quot;pa_dekning&quot;                    </span></span>
<span id="cb144-73"><a href="#cb144-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [61] &quot;pa_note&quot;                       </span></span>
<span id="cb144-74"><a href="#cb144-74" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [62] &quot;pa_registrert&quot;                 </span></span>
<span id="cb144-75"><a href="#cb144-75" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [63] &quot;fa_total_dekning&quot;              </span></span>
<span id="cb144-76"><a href="#cb144-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [64] &quot;fa_registrert&quot;                 </span></span>
<span id="cb144-77"><a href="#cb144-77" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [65] &quot;kommentar_250m2_flate&quot;         </span></span>
<span id="cb144-78"><a href="#cb144-78" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [66] &quot;klokkeslett_slutt&quot;             </span></span>
<span id="cb144-79"><a href="#cb144-79" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [67] &quot;vedlegg_url&quot;                   </span></span>
<span id="cb144-80"><a href="#cb144-80" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [68] &quot;creator&quot;                       </span></span>
<span id="cb144-81"><a href="#cb144-81" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [69] &quot;creationdate&quot;                  </span></span>
<span id="cb144-82"><a href="#cb144-82" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [70] &quot;editor&quot;                        </span></span>
<span id="cb144-83"><a href="#cb144-83" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [71] &quot;editdate&quot;                      </span></span>
<span id="cb144-84"><a href="#cb144-84" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [72] &quot;SHAPE&quot;</span></span></code></pre></div>
<p>Table of the number of sampling points per year:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(ano<span class="sc">$</span>aar)</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2019 2020 2021 </span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1111 3411 4452</span></span></code></pre></div>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">15</span>,<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(ano<span class="sc">$</span>hovedoekosystem_punkt), <span class="at">las=</span><span class="dv">2</span>)</span></code></pre></div>
<div class="figure">
<img src="rosslyng_files/figure-html/unnamed-chunk-6-1.png" alt="The distribution of ANO points that fall within different main ecosystems." width="672" />
<p class="caption">
(#fig:unnamed-chunk-6)The distribution of ANO points that fall within different main ecosystems.
</p>
</div>
<p>Sub-setting the data to only consider seni natural areas.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>snat <span class="ot">&lt;-</span> ano[ano<span class="sc">$</span>hovedoekosystem_punkt <span class="sc">==</span> <span class="st">&quot;semi_naturlig_mark&quot;</span>,]</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>snat2 <span class="ot">&lt;-</span> snat[<span class="sc">!</span><span class="fu">is.na</span>(snat<span class="sc">$</span>GlobalID),]</span></code></pre></div>
<p>230 points are semi-natural.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(snat<span class="sc">$</span>hovedtype_1m2)</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       Åpen jordvannsmyr              Boreal hei </span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                       4                     107 </span></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               Kaldkilde             Kystlynghei </span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                       1                      49 </span></span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             Nakent berg              Nedbørsmyr </span></span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                       2                       1 </span></span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       Semi-naturlig eng       Semi-naturlig myr </span></span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                      51                       6 </span></span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Semi-naturlig strandeng    Semi-naturlig våteng </span></span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                       1                       1 </span></span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               Skogsmark </span></span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                       4</span></span></code></pre></div>
<p>Only 49 1m2 samples are kystlynghei.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(ano<span class="sc">$</span>hovedtype_250m2)</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                      Åker </span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                        62 </span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                         Åpen flomfastmark </span></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                         1 </span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                      Åpen grunnlendt mark </span></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                        92 </span></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                         Åpen jordvannsmyr </span></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                       427 </span></span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                 Blokkmark </span></span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                       204 </span></span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                Boreal hei </span></span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                        94 </span></span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        Breforland og snøavsmeltingsområde </span></span>
<span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                        33 </span></span>
<span id="cb149-17"><a href="#cb149-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               Eng-liknende oppdyrket mark </span></span>
<span id="cb149-18"><a href="#cb149-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                        19 </span></span>
<span id="cb149-19"><a href="#cb149-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       Eng-liknende sterkt endret fastmark </span></span>
<span id="cb149-20"><a href="#cb149-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                         2 </span></span>
<span id="cb149-21"><a href="#cb149-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                Fjellgrashei og grastundra </span></span>
<span id="cb149-22"><a href="#cb149-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                        32 </span></span>
<span id="cb149-23"><a href="#cb149-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                 Fjellhei leside og tundra </span></span>
<span id="cb149-24"><a href="#cb149-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                       853 </span></span>
<span id="cb149-25"><a href="#cb149-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                             Flomskogsmark </span></span>
<span id="cb149-26"><a href="#cb149-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                         1 </span></span>
<span id="cb149-27"><a href="#cb149-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                          Grøftet torvmark </span></span>
<span id="cb149-28"><a href="#cb149-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                         6 </span></span>
<span id="cb149-29"><a href="#cb149-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                        Grotte og overheng </span></span>
<span id="cb149-30"><a href="#cb149-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                         1 </span></span>
<span id="cb149-31"><a href="#cb149-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               Hard sterkt endret fastmark </span></span>
<span id="cb149-32"><a href="#cb149-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                         2 </span></span>
<span id="cb149-33"><a href="#cb149-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                   Helofytt-ferskvannssump </span></span>
<span id="cb149-34"><a href="#cb149-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                         4 </span></span>
<span id="cb149-35"><a href="#cb149-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                       Historisk skredmark </span></span>
<span id="cb149-36"><a href="#cb149-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                         3 </span></span>
<span id="cb149-37"><a href="#cb149-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                         Isinnfrysingsmark </span></span>
<span id="cb149-38"><a href="#cb149-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                         2 </span></span>
<span id="cb149-39"><a href="#cb149-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                 Kaldkilde </span></span>
<span id="cb149-40"><a href="#cb149-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                         3 </span></span>
<span id="cb149-41"><a href="#cb149-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                               Kystlynghei </span></span>
<span id="cb149-42"><a href="#cb149-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                        26 </span></span>
<span id="cb149-43"><a href="#cb149-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                Løs sterkt endret fastmark </span></span>
<span id="cb149-44"><a href="#cb149-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                        43 </span></span>
<span id="cb149-45"><a href="#cb149-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                     Myr- og sumpskogsmark </span></span>
<span id="cb149-46"><a href="#cb149-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                        53 </span></span>
<span id="cb149-47"><a href="#cb149-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                               Nakent berg </span></span>
<span id="cb149-48"><a href="#cb149-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                       193 </span></span>
<span id="cb149-49"><a href="#cb149-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                Nedbørsmyr </span></span>
<span id="cb149-50"><a href="#cb149-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                        53 </span></span>
<span id="cb149-51"><a href="#cb149-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                       Oppdyrket varig eng </span></span>
<span id="cb149-52"><a href="#cb149-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                        45 </span></span>
<span id="cb149-53"><a href="#cb149-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                           Oppfrysingsmark </span></span>
<span id="cb149-54"><a href="#cb149-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                         3 </span></span>
<span id="cb149-55"><a href="#cb149-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                 Plener parker og liknende </span></span>
<span id="cb149-56"><a href="#cb149-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                        19 </span></span>
<span id="cb149-57"><a href="#cb149-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                     Rabbe </span></span>
<span id="cb149-58"><a href="#cb149-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                        83 </span></span>
<span id="cb149-59"><a href="#cb149-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                   Rasmark </span></span>
<span id="cb149-60"><a href="#cb149-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                        58 </span></span>
<span id="cb149-61"><a href="#cb149-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                        Rasmarkhei og -eng </span></span>
<span id="cb149-62"><a href="#cb149-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                         8 </span></span>
<span id="cb149-63"><a href="#cb149-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                         Semi-naturlig eng </span></span>
<span id="cb149-64"><a href="#cb149-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                        45 </span></span>
<span id="cb149-65"><a href="#cb149-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                         Semi-naturlig myr </span></span>
<span id="cb149-66"><a href="#cb149-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                        14 </span></span>
<span id="cb149-67"><a href="#cb149-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                      Semi-naturlig våteng </span></span>
<span id="cb149-68"><a href="#cb149-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                         2 </span></span>
<span id="cb149-69"><a href="#cb149-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                 Skogsmark </span></span>
<span id="cb149-70"><a href="#cb149-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                      1288 </span></span>
<span id="cb149-71"><a href="#cb149-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                   Snø- og isdekt fastmark </span></span>
<span id="cb149-72"><a href="#cb149-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                       105 </span></span>
<span id="cb149-73"><a href="#cb149-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                   Snøleie </span></span>
<span id="cb149-74"><a href="#cb149-74" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                       160 </span></span>
<span id="cb149-75"><a href="#cb149-75" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                Strandberg </span></span>
<span id="cb149-76"><a href="#cb149-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                         5 </span></span>
<span id="cb149-77"><a href="#cb149-77" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                 Strandeng </span></span>
<span id="cb149-78"><a href="#cb149-78" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                         2 </span></span>
<span id="cb149-79"><a href="#cb149-79" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                       Strandsumpskogsmark </span></span>
<span id="cb149-80"><a href="#cb149-80" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                         2 </span></span>
<span id="cb149-81"><a href="#cb149-81" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Tørrlagte våtmarks- og ferskvannssystemer </span></span>
<span id="cb149-82"><a href="#cb149-82" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                         7 </span></span>
<span id="cb149-83"><a href="#cb149-83" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                   Torvtak </span></span>
<span id="cb149-84"><a href="#cb149-84" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                         1 </span></span>
<span id="cb149-85"><a href="#cb149-85" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                              Treplantasje </span></span>
<span id="cb149-86"><a href="#cb149-86" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                        13 </span></span>
<span id="cb149-87"><a href="#cb149-87" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                Våtsnøleie og snøleiekilde </span></span>
<span id="cb149-88"><a href="#cb149-88" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                        13</span></span></code></pre></div>
<p>Only 26 of the 250m2 circles are kystlynghei. The variable of interest is called <em>Dekning av død/skadet røsslyng</em> and is only recorded on these 26 circles.</p>
</div>
</div>
<div id="conclusion" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Conclusion</h2>
<p>Because of the random allocation of sampling points, not enough points fall in coastal heathlands to allow us to create a trustworthy indicator for this nature type. With a few more years of data we might end up with about 100 points, which is borderline what we need in order to calculate condition values at a regional level with some level of precision.</p>
<!--chapter:end:rosslyng.Rmd-->
</div>
</div>
<div id="part-general-topics" class="section level1 unnumbered">
<h1 class="unnumbered">(PART*) GENERAL TOPICS</h1>
</div>
<div id="naturtype" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Nature types</h1>
<p><strong>On the application of the nature type data set</strong></p>
<p><em>Data exploration and an analyses of thematic coverage</em></p>
<p><br /></p>
<p>Author:</p>
<p>Anders L. Kolstad</p>
<p>March 2023</p>
<p><br /></p>
<p>Here I will investigate a specific data set, <a href="https://kartkatalog.geonorge.no/metadata/naturtyper-miljoedirektoratets-instruks/eb48dd19-03da-41e1-afd9-7ebc3079265c">Naturtyper - Miljødirektoratets instruks</a> and try to evaluate its usability for designing indicators for ecosystem condition. This involves assessing both the spatial and temporal representation, as well as conceptual alignment with the <a href="https://www.regjeringen.no/no/dokumenter/fagsystem-for-fastsetting-av-god-okologisk-tilstand/id2558481/">Norwegian system for ecosystem condition assessments</a>.</p>
<p>The precision in field mapping will not be assess in itself. We assume some, or even considerable, sampling error, but this is inherent to all field data.</p>
<p>The first part of this analysis is simply to get an overview of the data, making it ready for part 2 where we look at the thematic coverage of nature types and how the NiN variables are used.</p>
<div id="import-data-and-general-summary-statistics" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Import data and general summary statistics</h2>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="fu">substr</span>(<span class="fu">getwd</span>(), <span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a><span class="co"># local path</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="co">#path &lt;- &quot;data/R:/GeoSpatialData/Habitats_biotopes/Norway_Miljodirektoratet_Naturtyper_nin/Original/Natur_Naturtyper_NiN_norge_med_svalbard_25833.gdb&quot;</span></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a><span class="co"># temporary path </span></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a><span class="co">#path &lt;- &quot;/data/Egenutvikling/41001581_egenutvikling_anders_kolstad/data/Natur_Naturtyper_NiN_norge_med_svalbard_25833.g#db&quot;</span></span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a><span class="co"># server path pre 2022 data</span></span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a><span class="co">#path &lt;- &quot;/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/Natur_Naturtyper_NiN_norge_med_svalbard_25833.gdb&quot;</span></span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dir <span class="sc">==</span> <span class="st">&quot;C:&quot;</span>, </span>
<span id="cb150-11"><a href="#cb150-11" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;R:/GeoSpatialData/Habitats_biotopes/Norway_Miljodirektoratet_Naturtyper_nin/Original/Naturtyper_nin_0000_norge_25833_FILEGDB/Naturtyper_nin_0000_norge_25833_FILEGDB.gdb&quot;</span>,</span>
<span id="cb150-12"><a href="#cb150-12" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;/data/R/GeoSpatialData/Habitats_biotopes/Norway_Miljodirektoratet_Naturtyper_nin/Original/Naturtyper_nin_0000_norge_25833_FILEGDB/Naturtyper_nin_0000_norge_25833_FILEGDB.gdb&quot;</span>)</span>
<span id="cb150-13"><a href="#cb150-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-14"><a href="#cb150-14" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="at">dsn =</span> path)</span></code></pre></div>
<p>Fix non-valid polygons:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_make_valid</span>(dat)</span></code></pre></div>
<p>The data set has 117k polygons, each with 37 variables:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(dat)</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 117427     37</span></span></code></pre></div>
<p>It therefore takes a little minute to render a plot, but this is the code to do it:</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>nor <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">&quot;data/outlineOfNorway_EPSG25833.shp&quot;</span>)</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">&quot;view&quot;</span>)</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(dat) <span class="sc">+</span> </span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col=</span><span class="st">&quot;tilstand&quot;</span>)<span class="sc">+</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(nor)<span class="sc">+</span></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="dv">0</span>,<span class="at">border.col =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
</div>
<div id="area" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Area</h2>
<p>Calculating the area for each polygon/locality</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>area <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_area</span>(dat)</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dat<span class="sc">$</span>area)</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       20      700     2810    17153     8674 15794178</span></span></code></pre></div>
<p>The smallest polygons are 20 m2, and the biggest is 15.8 km2.</p>
<p>The largest polygon is a Kalkfattig og intermediær fjellhei, leside og tundra , and the smallest polygon is a Sørlig kaldkilde.</p>
<p>Sum of mapped area divided by Norwegian mainland area:</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Import outline of mainland Norway</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>nor <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">&quot;data/outlineOfNorway_EPSG25833.shp&quot;</span>)</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(dat<span class="sc">$</span>area)<span class="sc">/</span>sf<span class="sc">::</span><span class="fu">st_area</span>(nor)</span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.006184274 [1]</span></span></code></pre></div>
<p>About 0.6% of Norway has been mapped (note that a bigger area than this has been surveyed, but only a small fraction is delineated). It is therefore essential that these 0.5% are representative.</p>
</div>
<div id="temporal-trend" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Temporal trend</h2>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>kartleggingsår <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dat<span class="sc">$</span>kartleggingsår)</span></code></pre></div>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>area_year <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">tapply</span>(dat<span class="sc">$</span>area, dat<span class="sc">$</span>kartleggingsår, sum))</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(area_year) <span class="ot">&lt;-</span> <span class="st">&quot;area&quot;</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>area_year<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">row.names</span>(area_year)</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>area_year<span class="sc">$</span>area_km2 <span class="ot">&lt;-</span> area_year<span class="sc">$</span>area<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span></span></code></pre></div>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(area_year)<span class="sc">+</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> area_km2),</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="fl">1.2</span>)<span class="sc">+</span></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Total mapped area (km/2)&quot;</span>)</span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2</span></span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3.4.0.</span></span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Please use `linewidth` instead.</span></span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; This warning is displayed once every 8 hours.</span></span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Call `lifecycle::last_lifecycle_warnings()` to see where</span></span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this warning was generated.</span></span></code></pre></div>
<div class="figure">
<img src="naturtype_files/figure-html/unnamed-chunk-9-1.png" alt="Temproal trend in nature type mapping using Miljødirektoratets Instruks" width="672" />
<p class="caption">
(#fig:unnamed-chunk-9)Temproal trend in nature type mapping using Miljødirektoratets Instruks
</p>
</div>
<p>There are some differences in the field mapping instructions between the years. I will need to decide whether to include all years, or to perhaps exclude the first year.</p>
</div>
<div id="condition" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Condition</h2>
<p>A quick overview of the condition scores</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tilstand =</span>  <span class="fu">recode</span>(tilstand, </span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;sværtRedusert&quot;</span> <span class="ot">=</span> <span class="st">&quot;1 - Svært redusert&quot;</span>,</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;dårlig&quot;</span> <span class="ot">=</span> <span class="st">&quot;2 - Dårlig&quot;</span>,</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;moderat&quot;</span> <span class="ot">=</span> <span class="st">&quot;3 - Moderat&quot;</span>,</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;god&quot;</span> <span class="ot">=</span> <span class="st">&quot;4 - God&quot;</span>))</span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">tapply</span>(dat<span class="sc">$</span>area<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>, <span class="fu">factor</span>(dat<span class="sc">$</span>tilstand), sum))</span></code></pre></div>
<div class="figure">
<img src="naturtype_files/figure-html/unnamed-chunk-10-1.png" alt="The overal distribution of condition scores" width="672" />
<p class="caption">
(#fig:unnamed-chunk-10)The overal distribution of condition scores
</p>
</div>
<p>Most sites/polygons are in either good or moderately good condition. I’m not sure what the first class represents. It seems like some polygons don’t have a condition score. Looking at just the data set, and also the online <em>faktaark</em> for some of these localities, does not give the answer:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(dat[dat<span class="sc">$</span>tilstand<span class="sc">==</span><span class="st">&quot;&quot;</span>,])</span></code></pre></div>
<p>This figure show that these cases are not restricted to just one field season.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(dat<span class="sc">$</span>kartleggingsår[dat<span class="sc">$</span>tilstand<span class="sc">==</span><span class="st">&quot;&quot;</span>]), </span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab=</span><span class="st">&quot;Number of localities without condition scores&quot;</span>,</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab=</span><span class="st">&quot;Year&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="naturtype_files/figure-html/unnamed-chunk-12-1.png" alt="Temporal trend in localities without condition scores." width="672" />
<p class="caption">
(#fig:unnamed-chunk-12)Temporal trend in localities without condition scores.
</p>
</div>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">20</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(dat<span class="sc">$</span>hovedøkosystem[dat<span class="sc">$</span>tilstand<span class="sc">==</span><span class="st">&quot;&quot;</span>]),</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">horiz =</span> T, <span class="at">las=</span><span class="dv">2</span>,</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab=</span><span class="st">&quot;Number of localities without condition scores&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="naturtype_files/figure-html/unnamed-chunk-13-1.png" alt="Main ecosystems with localities missing condition scores." width="672" />
<p class="caption">
(#fig:unnamed-chunk-13)Main ecosystems with localities missing condition scores.
</p>
</div>
<p>These cases are restricted to two main ecosystems, and one class where the main ecosystem is not recorded. Looking at some of those cases it is clear that they are not relevant for our work here, I and I don’t know why they are in the data set to begin with.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">20</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(dat<span class="sc">$</span>naturtype[dat<span class="sc">$</span>tilstand<span class="sc">==</span><span class="st">&quot;&quot;</span>]),</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">horiz =</span> T, <span class="at">las=</span><span class="dv">2</span>,</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab=</span><span class="st">&quot;Number of localities without condition scores&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="naturtype_files/figure-html/unnamed-chunk-14-1.png" alt="Nature types with localities missing condition scores." width="672" />
<p class="caption">
(#fig:unnamed-chunk-14)Nature types with localities missing condition scores.
</p>
</div>
<p>There are only seven nature types (if you exclude those that are not mapped) that don’t have a condition score.</p>
<p><code>Snøleieblokkmark</code> and <code>rabbeblokkmark</code> do not have a protocol for assessing condition status. <code>Leirskredgrop</code>, <code>leirravine</code> and <code>grotte</code> were nature types in 2018 (not mapped in 2021), and was similarly not assessed for condition scores. <code>Isinnfrysingsmark</code> is assessed for condition now, but not in 2018. <code>Snøleieberg</code> is new in 2022 and is only mapped for area. We can therefore exclude these localities from our data set:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>dat_rm <span class="ot">&lt;-</span> dat</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat_rm[dat_rm<span class="sc">$</span>tilstand<span class="sc">!=</span><span class="st">&quot;&quot;</span>,]</span></code></pre></div>
<p>This resulted in the deletion of 370 rows, or 0.32 % of the data.</p>
</div>
<div id="mosaic-types" class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> Mosaic types</h2>
<p>The field mapping instruction include and option for delineating mosaic types. Let’s investigate these cases.</p>
<p>When an area displays a repeating pattern of mixed nature types that each are smaller than the minimum mapping unit MMU, these are grouped into as many overlapping polygons as there are unique nature types. Within the nature type polygons, these will have the same distribution of NiN-grunntyper (online you can see the percentage distribution, but our data set only has the presence/absence data) but be assigned different nature types (nature types is the Environmental agencies classification). The condition scoring can be unique to each overlapping nature type in the mosaic. But we don’t know the precise location of the NiN-grunntyper that are part of mosaic nature types.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(dat<span class="sc">$</span>mosaikk),</span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Mosaic&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Number of localities&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="naturtype_files/figure-html/unnamed-chunk-17-1.png" alt="The number of mosaic localities is relatively small." width="672" />
<p class="caption">
(#fig:unnamed-chunk-17)The number of mosaic localities is relatively small.
</p>
</div>
<p>Mosaic localities occur in many main ecosystems (and many nature types therein).</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix duplicated `hovedøkosystem`</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="co">#unique(dat$hovedøkosystem)</span></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>hovedøkosystem[dat<span class="sc">$</span>hovedøkosystem<span class="sc">==</span><span class="st">&quot;naturligÅpneOmråderILavlandet&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;naturligÅpneOmråderUnderSkoggrensa&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">20</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(dat<span class="sc">$</span>hovedøkosystem[dat<span class="sc">$</span>mosaikk<span class="sc">==</span><span class="st">&quot;ja&quot;</span>]),</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">horiz =</span> T, <span class="at">las=</span><span class="dv">2</span>,</span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab=</span><span class="st">&quot;Number of mosaic localities&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="naturtype_files/figure-html/unnamed-chunk-19-1.png" alt="Distribution of mosaic nature types across hovedøkosystem" width="672" />
<p class="caption">
(#fig:unnamed-chunk-19)Distribution of mosaic nature types across hovedøkosystem
</p>
</div>
<p>Some conclusion here could be that</p>
<ol style="list-style-type: decimal">
<li>Mosaic localities CANNOT be used to pin-point NiN grunntyper (e.g. for remote sensing purposes).</li>
<li>Mosaic localities CAN be used to extract condition scores for nature types, but these should not be tied to all the <em>NiN grunntype</em> listed in that polygon, because that will include some that belong to the other part(s) of the mosaic.</li>
</ol>
</div>
<div id="nin-types-across-main-ecosystems" class="section level2" number="5.6">
<h2><span class="header-section-number">5.6</span> NiN types across main ecosystems</h2>
<p>The NiN main types can be extracted from the column <code>ninKartleggingsenheter</code>. These are NiN mapping units recorded in the field. The NiN main type makes up the first part of this mapping unit code. The variable is oddly concatenated. Let’s tease it apart.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co">#dat$ninKartleggingsenheter  [1:10]</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="co"># remove NA prefix:</span></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>ninKartleggingsenheter2 <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;NA_&quot;</span>, dat<span class="sc">$</span>ninKartleggingsenheter, <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a><span class="co">#dat$ninKartleggingsenheter2[1:30]</span></span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>ninKartleggingsenheter2 <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(dat<span class="sc">$</span>ninKartleggingsenheter2, <span class="st">&quot;.[CE].[</span><span class="sc">\\</span><span class="st">d]{1,}&quot;</span>, <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a><span class="co">#dat$ninKartleggingsenheter2[1:30]</span></span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>ninKartleggingsenheter2 <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(dat<span class="sc">$</span>ninKartleggingsenheter2, <span class="st">&quot;-.&quot;</span>, <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>uni <span class="ot">&lt;-</span> <span class="cf">function</span>(x){<span class="fu">paste</span>(<span class="fu">unique</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(x, <span class="st">&quot;,&quot;</span>))), <span class="at">collapse =</span> <span class="st">&quot;,&quot;</span>)}</span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>ninKartleggingsenheter3 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(dat<span class="sc">$</span>ninKartleggingsenheter2, uni)</span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a>n_uni <span class="ot">&lt;-</span> <span class="cf">function</span>(x){<span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(x, <span class="st">&quot;,&quot;</span>))))}</span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>n_ninKartleggingsenheter <span class="ot">&lt;-</span> <span class="fu">lapply</span>(dat<span class="sc">$</span>ninKartleggingsenheter2, n_uni)</span>
<span id="cb168-13"><a href="#cb168-13" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>n_ninKartleggingsenheter <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dat<span class="sc">$</span>n_ninKartleggingsenheter) </span>
<span id="cb168-14"><a href="#cb168-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-15"><a href="#cb168-15" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb168-16"><a href="#cb168-16" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(dat<span class="sc">$</span>n_ninKartleggingsenheter),</span>
<span id="cb168-17"><a href="#cb168-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Number of NiN main types&quot;</span>,</span>
<span id="cb168-18"><a href="#cb168-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Number of localities&quot;</span>)</span>
<span id="cb168-19"><a href="#cb168-19" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(dat<span class="sc">$</span>n_ninKartleggingsenheter[dat<span class="sc">$</span>mosaikk<span class="sc">==</span><span class="st">&quot;nei&quot;</span>]),</span>
<span id="cb168-20"><a href="#cb168-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Number of NiN main types</span><span class="sc">\n</span><span class="st">(Mosaic localities excluded)&quot;</span>)</span>
<span id="cb168-21"><a href="#cb168-21" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(dat<span class="sc">$</span>n_ninKartleggingsenheter[dat<span class="sc">$</span>mosaikk<span class="sc">==</span><span class="st">&quot;ja&quot;</span>]),</span>
<span id="cb168-22"><a href="#cb168-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Number of NiN main types</span><span class="sc">\n</span><span class="st">(Mosaic localities only)&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="naturtype_files/figure-html/unnamed-chunk-20-1.png" alt="The number of NiN main types within one locality should normally be one, except for mosaic localities." width="672" />
<p class="caption">
(#fig:unnamed-chunk-20)The number of NiN main types within one locality should normally be one, except for mosaic localities.
</p>
</div>
<p>Mosaic localities (right pane) have a much higher likelihood of including multiple NiN main types, but it also occurs in non-mosaic localities (over 10 000 cases). Most, if not all, nature types are defined within a single NiN main type, so we need to see whats going on there.</p>
<p>First I need to melt the data frame in order to tally the number of NiN min types within each <code>hovedøkosystem</code>.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>dat_melt <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">separate_rows</span>(dat, ninKartleggingsenheter3)</span></code></pre></div>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat_melt[dat_melt<span class="sc">$</span>mosaikk<span class="sc">!=</span><span class="st">&quot;ja&quot;</span>,])<span class="sc">+</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> ninKartleggingsenheter3))<span class="sc">+</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="st">&quot;hovedøkosystem&quot;</span>,</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="naturtype_files/figure-html/unnamed-chunk-22-1.png" alt="Figure showing the number of localities for each NiN main type. One locality can have more than one NiN main type. Mosaic localities are excluded in this figure." width="672" />
<p class="caption">
(#fig:unnamed-chunk-22)Figure showing the number of localities for each NiN main type. One locality can have more than one NiN main type. Mosaic localities are excluded in this figure.
</p>
</div>
<p>This is a messy figure, but the point is, there is a lot of miss-match between NiN main types and <em>hovedøkosystem</em>. Taking one example: T2 (åpen grunnledt mark) is not found in mountains, but there is one case where this occurs. If I view that case</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(dat_melt[dat_melt<span class="sc">$</span>mosaikk<span class="sc">!=</span><span class="st">&quot;Ja&quot;</span> <span class="sc">&amp;</span> dat_melt<span class="sc">$</span>hovedøkosystem<span class="sc">==</span><span class="st">&quot;Fjell&quot;</span> <span class="sc">&amp;</span> dat_melt<span class="sc">$</span>ninKartleggingsenheter3<span class="sc">==</span><span class="st">&quot;T2&quot;</span>,])</span></code></pre></div>
<p>.. and find the online fact sheet for that locality, I see that it is actually NOT a mosaic. It is a nature type called <em>Kalkfattig og intermediær fjellhei, leside og tundra</em> which is defined as strictly T3, but the field surveyor has recorded lots of NiN mapping units (and hence, main NiN types) in addition. This is a mistake. Online I can see that the locality is 50% T3, but this information is not in the data set that we have available. Miljødirektoratet could consider adding this information to the downloadable dataset. The order of the NiN types in the <code>ninKartleggingsenheter</code> column is not reflecting the commonness of the types ether.</p>
<p>If there was a way to extract the defining NiN type from the <code>naturtype</code> column, that would be nice. Miljødirektoratet may consider adding this as well. If we exclude all localities that are not mosaics, but that have multiple NiN main types (no, we’re not going to do that, here at least), we first need to know if there are not any <code>naturtype</code> which allow for multiple NiN main types.</p>
<p>As this next figure show, these cases are not restricted to mapping year, and hence to any changes in the field protocol.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> dat[dat<span class="sc">$</span>n_ninKartleggingsenheter<span class="sc">&gt;</span><span class="dv">1</span> <span class="sc">&amp;</span> dat<span class="sc">$</span>mosaikk<span class="sc">!=</span><span class="st">&quot;ja&quot;</span>,]</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(temp<span class="sc">$</span>kartleggingsår), <span class="at">ylab=</span><span class="st">&quot;Number of localities with more than one NiN main type</span><span class="sc">\n</span><span class="st">(mosaic localitie excluded) &quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="naturtype_files/figure-html/unnamed-chunk-24-1.png" alt="Temporal trend in the recording of non-mosaic localities that are recorded as consisting of multiple NiN mapping units from different NiN main types." width="672" />
<p class="caption">
(#fig:unnamed-chunk-24)Temporal trend in the recording of non-mosaic localities that are recorded as consisting of multiple NiN mapping units from different NiN main types.
</p>
</div>
<p>Lets look at the most common nature types that are recorded this way.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>temp2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(temp<span class="sc">$</span>naturtype, temp<span class="sc">$</span>n_ninKartleggingsenheter))</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>temp2 <span class="ot">&lt;-</span> temp2[base<span class="sc">::</span><span class="fu">order</span>(temp2<span class="sc">$</span>Freq, <span class="at">decreasing =</span> T),][<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">20</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(temp2<span class="sc">$</span>Freq, <span class="at">names.arg =</span> temp2<span class="sc">$</span>Var1, <span class="at">las=</span><span class="dv">2</span>,</span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">horiz =</span> T, <span class="at">xlab =</span> <span class="st">&quot;Number of localities with &gt;1 NiN main type&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="naturtype_files/figure-html/multipleNiN-1.png" alt="The ten most common nature types and the number of localities with with multiple NiN main types" width="672" />
<p class="caption">
(#fig:multipleNiN)The ten most common nature types and the number of localities with with multiple NiN main types
</p>
</div>
<p>‘Hule eiker’ is a special case because these are recorded as points and not polygons, and they can be found in any NiN main type and any <em>hovedøkosystem</em>.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>  dat[dat<span class="sc">$</span>naturtype<span class="sc">==</span><span class="st">&quot;Hule eiker&quot;</span>,][<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="fu">c</span>(<span class="st">&quot;naturtype&quot;</span>, <span class="st">&quot;hovedøkosystem&quot;</span>, <span class="st">&quot;ninKartleggingsenheter&quot;</span>)])</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-b94022993666994c1dba" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b94022993666994c1dba">{"x":{"filter":"none","vertical":false,"data":[["30","35","108","109","110"],["Hule eiker","Hule eiker","Hule eiker","Hule eiker","Hule eiker"],["semi-naturligMark","skog","skog","skog","skog"],["NA_T4-C-2","NA_T37-C-2,NA_T35-C-1","NA_T4-C-6,NA_T44-C-1","NA_T4-C-10,NA_T44-C-1","NA_T4-C-6"],[{"type":"Polygon","coordinates":[[[293447.5702,6554104.6838],[293447.5382,6554103.7075],[293447.4425,6554102.7354],[293447.2833,6554101.7717],[293447.0615,6554100.8204],[293446.778,6554099.8857],[293446.4339,6554098.9715],[293446.0308,6554098.0817],[293445.5703,6554097.2203],[293445.0545,6554096.3908],[293444.4855,6554095.5968],[293443.8659,6554094.8417],[293443.1981,6554094.1288],[293442.4852,6554093.461],[293441.7301,6554092.8414],[293440.9361,6554092.2724],[293440.1066,6554091.7566],[293439.2452,6554091.2961],[293438.3554,6554090.893],[293437.4413,6554090.5489],[293436.5065,6554090.2654],[293435.5552,6554090.0436],[293434.5915,6554089.8845],[293433.6194,6554089.7887],[293432.6431,6554089.7567],[293431.6668,6554089.7887],[293430.6947,6554089.8845],[293429.731,6554090.0436],[293428.7797,6554090.2654],[293427.845,6554090.5489],[293426.9308,6554090.893],[293426.041,6554091.2961],[293425.1796,6554091.7566],[293424.3501,6554092.2724],[293423.5561,6554092.8414],[293422.801,6554093.461],[293422.0881,6554094.1288],[293421.4204,6554094.8417],[293420.8007,6554095.5968],[293420.2317,6554096.3908],[293419.7159,6554097.2203],[293419.2554,6554098.0817],[293418.8523,6554098.9715],[293418.5082,6554099.8857],[293418.2247,6554100.8204],[293418.0029,6554101.7717],[293417.8438,6554102.7354],[293417.748,6554103.7075],[293417.7161,6554104.6838],[293417.748,6554105.6601],[293417.8438,6554106.6322],[293418.0029,6554107.5959],[293418.2247,6554108.5472],[293418.5082,6554109.4819],[293418.8523,6554110.3961],[293419.2554,6554111.2859],[293419.7159,6554112.1473],[293420.2317,6554112.9768],[293420.8007,6554113.7708],[293421.4204,6554114.5259],[293422.0881,6554115.2388],[293422.801,6554115.9066],[293423.5561,6554116.5262],[293424.3501,6554117.0952],[293425.1796,6554117.611],[293426.041,6554118.0715],[293426.9308,6554118.4746],[293427.845,6554118.8187],[293428.7797,6554119.1022],[293429.731,6554119.324],[293430.6947,6554119.4832],[293431.6668,6554119.5789],[293432.6431,6554119.6109],[293433.6194,6554119.5789],[293434.5915,6554119.4832],[293435.5552,6554119.324],[293436.5065,6554119.1022],[293437.4413,6554118.8187],[293438.3554,6554118.4746],[293439.2452,6554118.0715],[293440.1066,6554117.611],[293440.9361,6554117.0952],[293441.7301,6554116.5262],[293442.4852,6554115.9066],[293443.1981,6554115.2388],[293443.8659,6554114.5259],[293443.9651,6554114.405],[293444.0363,6554114.329],[293444.6559,6554113.5739],[293445.2249,6554112.7799],[293445.7407,6554111.9504],[293446.2012,6554111.089],[293446.3077,6554110.8539],[293446.2244,6554110.8585],[293446.4339,6554110.3961],[293446.778,6554109.4819],[293447.0615,6554108.5472],[293447.2833,6554107.5959],[293447.4425,6554106.6322],[293447.5382,6554105.6601],[293447.5702,6554104.6838]]]},{"type":"Polygon","coordinates":[[[54460.4755999995,6457415.3689],[54460.4436999997,6457414.3926],[54460.3479000004,6457413.4205],[54460.1887999997,6457412.4568],[54459.9670000002,6457411.5055],[54459.6835000003,6457410.5707],[54459.3393999999,6457409.6566],[54458.9362000003,6457408.7668],[54458.4758000001,6457407.9054],[54457.96,6457407.0759],[54457.3909999998,6457406.2819],[54456.7713000001,6457405.5268],[54456.1036,6457404.8139],[54455.3907000003,6457404.1461],[54454.6355999997,6457403.5265],[54453.8415999999,6457402.9575],[54453.0120999999,6457402.4417],[54452.1506000003,6457401.9812],[54451.2609000001,6457401.5781],[54450.3466999996,6457401.234],[54449.4119999995,6457400.9505],[54448.4606999997,6457400.7287],[54447.4968999997,6457400.5695],[54446.5248999996,6457400.4738],[54445.5486000003,6457400.4418],[54444.5723000001,6457400.4738],[54443.6002000002,6457400.5695],[54442.6365,6457400.7287],[54441.6852000002,6457400.9505],[54440.7504000003,6457401.234],[54439.8361999998,6457401.5781],[54438.9464999996,6457401.9812],[54438.0850999998,6457402.4417],[54437.2555999998,6457402.9575],[54436.4616,6457403.5265],[54435.7065000003,6457404.1461],[54434.9935999997,6457404.8139],[54434.3257999998,6457405.5268],[54433.7061000001,6457406.2819],[54433.1371999998,6457407.0759],[54432.6213999996,6457407.9054],[54432.1608999996,6457408.7668],[54431.7577999998,6457409.6566],[54431.4137000004,6457410.5707],[54431.1301999995,6457411.5055],[54430.9083000002,6457412.4568],[54430.7492000004,6457413.4205],[54430.6535,6457414.3926],[54430.6215000004,6457415.3689],[54430.6535,6457416.3452],[54430.7492000004,6457417.3173],[54430.9083000002,6457418.281],[54431.1301999995,6457419.2323],[54431.4137000004,6457420.167],[54431.7577999998,6457421.0812],[54432.1608999996,6457421.971],[54432.6213999996,6457422.8324],[54433.1371999998,6457423.6619],[54433.7061000001,6457424.4559],[54434.3257999998,6457425.211],[54434.9935999997,6457425.9239],[54435.7065000003,6457426.5916],[54436.4616,6457427.2113],[54437.2555999998,6457427.7803],[54438.0850999998,6457428.2961],[54438.9464999996,6457428.7566],[54439.8361999998,6457429.1597],[54440.7504000003,6457429.5038],[54441.6852000002,6457429.7873],[54442.6365,6457430.0091],[54443.6002000002,6457430.1682],[54444.5723000001,6457430.264],[54445.5486000003,6457430.2959],[54446.5248999996,6457430.264],[54447.4968999997,6457430.1682],[54448.4606999997,6457430.0091],[54449.4119999995,6457429.7873],[54450.3466999996,6457429.5038],[54451.2609000001,6457429.1597],[54452.1506000003,6457428.7566],[54453.0120999999,6457428.2961],[54453.8415999999,6457427.7803],[54454.6355999997,6457427.2113],[54455.3907000003,6457426.5916],[54456.1036,6457425.9239],[54456.7713000001,6457425.211],[54457.3909999998,6457424.4559],[54457.96,6457423.6619],[54458.4758000001,6457422.8324],[54458.9362000003,6457421.971],[54459.3393999999,6457421.0812],[54459.6835000003,6457420.167],[54459.9670000002,6457419.2323],[54460.1887999997,6457418.281],[54460.3479000004,6457417.3173],[54460.4436999997,6457416.3452],[54460.4755999995,6457415.3689]]]},{"type":"Polygon","coordinates":[[[279113.4302,6564090.2734],[279113.3982,6564089.2971],[279113.3025,6564088.3251],[279113.1434,6564087.3613],[279112.9216,6564086.41],[279112.638,6564085.4753],[279112.294,6564084.5611],[279111.8908,6564083.6714],[279111.4304,6564082.8099],[279110.9145,6564081.9804],[279110.3456,6564081.1864],[279109.7259,6564080.4313],[279109.0582,6564079.7184],[279108.3452,6564079.0507],[279107.5902,6564078.431],[279106.7962,6564077.862],[279105.9667,6564077.3462],[279105.1052,6564076.8858],[279104.2155,6564076.4826],[279103.3013,6564076.1385],[279102.3666,6564075.855],[279101.4153,6564075.6332],[279100.4515,6564075.4741],[279099.4794,6564075.3783],[279098.5032,6564075.3464],[279097.5269,6564075.3783],[279096.5548,6564075.4741],[279095.591,6564075.6332],[279094.6397,6564075.855],[279093.705,6564076.1385],[279092.7908,6564076.4826],[279091.9011,6564076.8858],[279091.0396,6564077.3462],[279090.2101,6564077.862],[279089.4161,6564078.431],[279088.6611,6564079.0507],[279087.9481,6564079.7184],[279087.2804,6564080.4313],[279086.6607,6564081.1864],[279086.0918,6564081.9804],[279085.5759,6564082.8099],[279085.1155,6564083.6714],[279084.7124,6564084.5611],[279084.3683,6564085.4753],[279084.0847,6564086.41],[279083.8629,6564087.3613],[279083.7038,6564088.3251],[279083.6081,6564089.2971],[279083.5761,6564090.2734],[279083.6081,6564091.2497],[279083.7038,6564092.2218],[279083.8629,6564093.1855],[279084.0847,6564094.1368],[279084.3683,6564095.0716],[279084.7124,6564095.9858],[279085.1155,6564096.8755],[279085.5759,6564097.7369],[279086.0918,6564098.5664],[279086.6607,6564099.3604],[279087.2804,6564100.1155],[279087.9481,6564100.8284],[279088.6611,6564101.4962],[279089.4161,6564102.1158],[279090.2101,6564102.6848],[279091.0396,6564103.2006],[279091.9011,6564103.6611],[279092.7908,6564104.0642],[279093.705,6564104.4083],[279094.6397,6564104.6918],[279095.591,6564104.9137],[279096.5548,6564105.0728],[279097.5269,6564105.1685],[279098.5032,6564105.2005],[279099.4794,6564105.1685],[279100.4515,6564105.0728],[279101.4153,6564104.9137],[279102.3666,6564104.6918],[279103.3013,6564104.4083],[279104.2155,6564104.0642],[279105.1052,6564103.6611],[279105.9667,6564103.2006],[279106.7962,6564102.6848],[279107.5902,6564102.1158],[279108.3452,6564101.4962],[279109.0582,6564100.8284],[279109.7259,6564100.1155],[279110.3456,6564099.3604],[279110.9145,6564098.5664],[279111.4304,6564097.7369],[279111.8908,6564096.8755],[279112.294,6564095.9858],[279112.638,6564095.0716],[279112.9216,6564094.1368],[279113.1434,6564093.1855],[279113.3025,6564092.2218],[279113.3982,6564091.2497],[279113.4302,6564090.2734]]]},{"type":"Polygon","coordinates":[[[279073.1685,6564122.7994],[279073.1365,6564121.8231],[279073.0408,6564120.851],[279072.8816,6564119.8873],[279072.6598,6564118.936],[279072.3763,6564118.0013],[279072.0322,6564117.0871],[279071.6291,6564116.1973],[279071.1686,6564115.3359],[279070.6528,6564114.5064],[279070.0838,6564113.7124],[279069.4642,6564112.9573],[279068.7964,6564112.2444],[279068.0835,6564111.5766],[279067.3284,6564110.957],[279066.5344,6564110.388],[279065.7049,6564109.8722],[279064.8435,6564109.4117],[279063.9537,6564109.0086],[279063.0396,6564108.6645],[279062.1048,6564108.381],[279061.1535,6564108.1592],[279060.1898,6564108],[279059.2177,6564107.9043],[279058.2414,6564107.8723],[279057.2651,6564107.9043],[279056.293,6564108],[279055.3293,6564108.1592],[279054.378,6564108.381],[279053.4433,6564108.6645],[279052.5291,6564109.0086],[279051.6393,6564109.4117],[279050.7779,6564109.8722],[279049.9484,6564110.388],[279049.1544,6564110.957],[279048.3993,6564111.5766],[279047.6864,6564112.2444],[279047.0187,6564112.9573],[279046.399,6564113.7124],[279045.83,6564114.5064],[279045.3142,6564115.3359],[279044.8537,6564116.1973],[279044.4506,6564117.0871],[279044.1065,6564118.0013],[279043.823,6564118.936],[279043.6012,6564119.8873],[279043.4421,6564120.851],[279043.3463,6564121.8231],[279043.3144,6564122.7994],[279043.3463,6564123.7757],[279043.4421,6564124.7478],[279043.6012,6564125.7115],[279043.823,6564126.6628],[279044.1065,6564127.5975],[279044.4506,6564128.5117],[279044.8537,6564129.4015],[279045.3142,6564130.2629],[279045.83,6564131.0924],[279046.399,6564131.8864],[279047.0187,6564132.6415],[279047.6864,6564133.3544],[279048.3993,6564134.0221],[279049.1544,6564134.6418],[279049.9484,6564135.2108],[279050.7779,6564135.7266],[279051.6393,6564136.1871],[279052.5291,6564136.5902],[279053.4433,6564136.9343],[279054.378,6564137.2178],[279055.3293,6564137.4396],[279056.293,6564137.5987],[279057.2651,6564137.6945],[279058.2414,6564137.7264],[279059.2177,6564137.6945],[279060.1898,6564137.5987],[279061.1535,6564137.4396],[279062.1048,6564137.2178],[279063.0396,6564136.9343],[279063.9537,6564136.5902],[279064.8435,6564136.1871],[279065.7049,6564135.7266],[279066.5344,6564135.2108],[279067.3284,6564134.6418],[279068.0835,6564134.0221],[279068.7964,6564133.3544],[279069.4642,6564132.6415],[279070.0838,6564131.8864],[279070.6528,6564131.0924],[279071.1686,6564130.2629],[279071.6291,6564129.4015],[279072.0322,6564128.5117],[279072.3763,6564127.5975],[279072.6598,6564126.6628],[279072.8816,6564125.7115],[279073.0408,6564124.7478],[279073.1365,6564123.7757],[279073.1685,6564122.7994]]]},{"type":"Polygon","coordinates":[[[282601.5632,6566337.7197],[282601.5313,6566336.7434],[282601.4355,6566335.7713],[282601.2764,6566334.8076],[282601.0546,6566333.8563],[282600.7711,6566332.9215],[282600.427,6566332.0073],[282600.0238,6566331.1176],[282599.5634,6566330.2562],[282599.0476,6566329.4267],[282598.4786,6566328.6327],[282597.8589,6566327.8776],[282597.1912,6566327.1647],[282596.4783,6566326.4969],[282595.7232,6566325.8773],[282594.9292,6566325.3083],[282594.0997,6566324.7925],[282593.2382,6566324.332],[282592.3485,6566323.9289],[282591.4343,6566323.5848],[282590.4996,6566323.3013],[282589.5483,6566323.0794],[282588.5845,6566322.9203],[282587.6125,6566322.8246],[282586.6362,6566322.7926],[282585.6599,6566322.8246],[282584.6878,6566322.9203],[282583.7241,6566323.0794],[282582.7728,6566323.3013],[282581.838,6566323.5848],[282580.9238,6566323.9289],[282580.0341,6566324.332],[282579.1726,6566324.7925],[282578.3431,6566325.3083],[282577.5492,6566325.8773],[282576.7941,6566326.4969],[282576.0812,6566327.1647],[282575.4134,6566327.8776],[282574.7937,6566328.6327],[282574.2248,6566329.4267],[282573.709,6566330.2562],[282573.2485,6566331.1176],[282572.8454,6566332.0073],[282572.5013,6566332.9215],[282572.2177,6566333.8563],[282571.9959,6566334.8076],[282571.8368,6566335.7713],[282571.7411,6566336.7434],[282571.7091,6566337.7197],[282571.7411,6566338.696],[282571.8368,6566339.6681],[282571.9959,6566340.6318],[282572.2177,6566341.5831],[282572.5013,6566342.5178],[282572.8454,6566343.432],[282573.2485,6566344.3217],[282573.709,6566345.1832],[282574.2248,6566346.0127],[282574.7937,6566346.8067],[282575.4134,6566347.5618],[282576.0812,6566348.2747],[282576.7941,6566348.9424],[282577.5492,6566349.5621],[282578.3431,6566350.1311],[282579.1726,6566350.6469],[282580.0341,6566351.1073],[282580.9238,6566351.5105],[282581.838,6566351.8546],[282582.7728,6566352.1381],[282583.7241,6566352.3599],[282584.6878,6566352.519],[282585.6599,6566352.6148],[282586.6362,6566352.6467],[282587.6125,6566352.6148],[282588.5845,6566352.519],[282589.5483,6566352.3599],[282590.4996,6566352.1381],[282591.4343,6566351.8546],[282592.3485,6566351.5105],[282593.2382,6566351.1073],[282594.0997,6566350.6469],[282594.9292,6566350.1311],[282595.7232,6566349.5621],[282596.4783,6566348.9424],[282597.1912,6566348.2747],[282597.8589,6566347.5618],[282598.4786,6566346.8067],[282599.0476,6566346.0127],[282599.5634,6566345.1832],[282600.0238,6566344.3217],[282600.427,6566343.432],[282600.7711,6566342.5178],[282601.0546,6566341.5831],[282601.2764,6566340.6318],[282601.4355,6566339.6681],[282601.5313,6566338.696],[282601.5632,6566337.7197]]]}]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>naturtype<\/th>\n      <th>hovedøkosystem<\/th>\n      <th>ninKartleggingsenheter<\/th>\n      <th>SHAPE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><em>Kystlynghei</em> often occurs as a mosaic, but figure @ref(fig:multipleNiN) has excluded the mosaic localities, and then <em>kystlynghei</em> is strictly defined to T34.
The same is true for <em>naturbeitemark</em> which is restricted to T32.
Maybe these localities should all have been recorded as mosaic localities. In any case, we cannot automatically extract the main NiN type from these rows now.</p>
<p>The remaining option is to manually assign the defining NiN main type to each nature type. This data is not included in the data set, and would need to be sourced from the mapping protocols for all the different field seasons.</p>
<p>For a deeper analyses into the causes for localities being mapped to NiN main types outside the definition of the nature type, see <a href="#appendix-1">Appendix 1</a>.</p>
</div>
<div id="assigning-nin-main-types-to-nature-types" class="section level2" number="5.7">
<h2><span class="header-section-number">5.7</span> Assigning NiN main types to Nature types</h2>
<p>The NiN main types need to be added manually to the nature types, as the field recorded data is error prone, and the defining NiN units for each nature type is not included in the data set.</p>
<p>I will start by excluding all but the three target ecosystems.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>target <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;semi-naturligMark&quot;</span>,</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;våtmark&quot;</span>,</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;naturligÅpneOmråderUnderSkoggrensa&quot;</span>)</span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat[dat<span class="sc">$</span>hovedøkosystem <span class="sc">%in%</span> target,]</span></code></pre></div>
<p>I will also exclude <code>Hule eiker</code>, as this nature type is not easy to tie to a single main ecosystem. <em>In some other scenarios, one might wish to keep hule eiker depending on the main ecosystem that it was recorded to in the field.</em></p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat[dat<span class="sc">$</span>naturtype <span class="sc">!=</span> <span class="st">&quot;Hule eiker&quot;</span>,]</span></code></pre></div>
<p>Get the unique nature types</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>ntyp <span class="ot">&lt;-</span> <span class="fu">unique</span>(dat<span class="sc">$</span>naturtype)</span></code></pre></div>
<p>Extract the year when these were mapped</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ntyp)){</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>years[i] <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>kartleggingsår[dat<span class="sc">$</span>naturtype <span class="sc">==</span> ntyp[i]])), <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>)</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Extract the associated ecosystem</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>eco <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ntyp)){</span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>eco[i] <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>hovedøkosystem[dat<span class="sc">$</span>naturtype <span class="sc">==</span> ntyp[i]]), <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>)</span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Combine into one data frame</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>ntypDF <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Nature_type&quot;</span> <span class="ot">=</span> ntyp,</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Year&quot;</span>        <span class="ot">=</span> years,</span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Ecosystem&quot;</span>   <span class="ot">=</span> eco</span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>We have 69 nature types to consider.</p>
<p>Some of the wetland types can actually be excluded because of the way we limited this ecosystem to mean <em>open</em> wetland:</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>excl_nt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Kalkrik myr- og sumpskogsmark&quot;</span>,</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>             <span class="co">#&quot;Flommyr, myrkant og myrskogsmark&quot;,  # Only V9 is relevant. This type also includes V2 and V8</span></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Gammel fattig sumpskog&quot;</span>,</span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Rik gransumpskog&quot;</span>,</span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Grankildeskog&quot;</span>,</span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Rik svartorsumpskog&quot;</span>,</span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Rik gråorsumpskog&quot;</span>,</span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Rik svartorstrandskog&quot;</span>,</span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Saltpåvirket svartorstrandskog&quot;</span>,</span>
<span id="cb181-10"><a href="#cb181-10" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Kilde-edellauvskog&quot;</span>,</span>
<span id="cb181-11"><a href="#cb181-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Saltpåvirket strand- og sumpskogsmark&quot;</span>,</span>
<span id="cb181-12"><a href="#cb181-12" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Svak kilde og kildeskogsmark&quot;</span>,</span>
<span id="cb181-13"><a href="#cb181-13" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Rik vierstrandskog&quot;</span>,</span>
<span id="cb181-14"><a href="#cb181-14" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Varmekjær kildelauvskog&quot;</span></span>
<span id="cb181-15"><a href="#cb181-15" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb181-16"><a href="#cb181-16" aria-hidden="true" tabindex="-1"></a>ntypDF<span class="sc">$</span>Nature_type <span class="ot">&lt;-</span> <span class="fu">trimws</span>(ntypDF<span class="sc">$</span>Nature_type)</span>
<span id="cb181-17"><a href="#cb181-17" aria-hidden="true" tabindex="-1"></a>ntypDF <span class="ot">&lt;-</span> ntypDF[<span class="sc">!</span>ntypDF<span class="sc">$</span>Nature_type <span class="sc">%in%</span> excl_nt,]</span></code></pre></div>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(ntypDF)</span></code></pre></div>
<div class="figure">
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-004e9fdc0203d6e545c8" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-004e9fdc0203d6e545c8">{"x":{"filter":"none","vertical":false,"data":[["1","3","4","5","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","27","28","30","31","32","33","36","37","38","39","40","41","43","44","46","47","49","50","52","53","55","56","57","58","59","60","61","63","64","65","66","68","69"],["Flommyr, myrkant og myrskogsmark","Slåttemyr","Hagemark","Naturbeitemark","Semi-naturlig eng","Eng-aktig sterkt endret fastmark","Sørlig kaldkilde","Åpen flomfastmark","Høgereligende og nordlig nedbørsmyr","Øyblandingsmyr","Strandeng","Nakent tørkeutsatt kalkberg","Kystlynghei","Sørlig slåttemyr","Konsentrisk høymyr","Boreal hei","Semi-naturlig våteng","Slåttemark","Sanddynemark","Semi-naturlig strandeng","Kalkrik åpen jordvannsmyr i boreonemoral til nordboreal sone","Åpen myrflate i boreonemoral til nordboreal sone","Kaldkilde under skoggrensa","Sentrisk høgmyr","Rik åpen jordvannsmyr i mellomboreal sone","Sørlig nedbørsmyr","Atlantisk høymyr","Terrengdekkende myr","Åpen grunnlendt kalkrik mark i boreonemoral sone","Rik åpen sørlig jordvannsmyr","Aktiv skredmark","Semi-naturlig myr","Kystnedbørsmyr","Silt og leirskred","Eksentrisk høymyr","Øvre sandstrand uten pionervegetasjon","Kalkrik helofyttsump","Fuglefjell-eng og fugletopp","Isinnfrysingsmark","Sørlig strandeng","Åpen grunnlendt kalkrik mark i sørboreal sone","Sørlig etablert sanddynemark","Rik åpen jordvannsmyr i nordboreal og lavalpin sone","Rik åpen jordvannsmyr i nordboreal og lavalpin sone","Fossepåvirket berg","Fosse-eng","Svært tørkeutsatt sørlig kalkberg","Lauveng","Kanthøymyr","Platåhøymyr","Rik åpen sørlig jordvannsmyr","Palsmyr","Nakent tørkeutsatt kalkberg","Tørt kalkrikt berg i kontinentale områder","Åpen myrflate i lavalpin sone","Fosseberg"],["2018","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018","2018","2018","2018","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2018","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018","2019, 2020, 2021","2018, 2019, 2020, 2021, 2022","2018","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2022","2019, 2020, 2021, 2022","2019, 2020, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2018","2021, 2022","2018","2019","2018","2021, 2022"],["våtmark","våtmark","semi-naturligMark","semi-naturligMark","semi-naturligMark","semi-naturligMark","våtmark","naturligÅpneOmråderUnderSkoggrensa","våtmark","våtmark","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","semi-naturligMark","våtmark","våtmark","semi-naturligMark","våtmark","semi-naturligMark","naturligÅpneOmråderUnderSkoggrensa","semi-naturligMark","våtmark","våtmark","våtmark","våtmark","våtmark","våtmark","våtmark","våtmark","naturligÅpneOmråderUnderSkoggrensa","våtmark","naturligÅpneOmråderUnderSkoggrensa","våtmark","våtmark","naturligÅpneOmråderUnderSkoggrensa","våtmark","naturligÅpneOmråderUnderSkoggrensa","våtmark","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","våtmark","våtmark","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","semi-naturligMark","våtmark","våtmark","våtmark","våtmark","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","våtmark","naturligÅpneOmråderUnderSkoggrensa"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Nature_type<\/th>\n      <th>Year<\/th>\n      <th>Ecosystem<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
(#fig:unnamed-chunk-32)List of nature types showing the years when that nature type was mapped.
</p>
</div>
<p>I will also now exclude nature types that were only mapped in 2018 and/or 2019 and not after that. These nature types will not only not get more data in the future, but also they were mapped in a time when the methodology was quite unstable.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>ntypDF2 <span class="ot">&lt;-</span> ntypDF[ntypDF<span class="sc">$</span>Year <span class="sc">!=</span> <span class="st">&quot;2018&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>                  ntypDF<span class="sc">$</span>Year <span class="sc">!=</span> <span class="st">&quot;2019&quot;</span> <span class="sc">&amp;</span> </span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>                  ntypDF<span class="sc">$</span>Year <span class="sc">!=</span> <span class="st">&quot;2018, 2019&quot;</span><span class="co"># no types were mappend in 2018 &amp; 2019 only</span></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>                  ,]</span></code></pre></div>
<p>This removed 12 nature types.</p>
<p>Next I want to add the NiN main types. I need to look at the definition of each nature type and get the NiN code from there. I could also extract the NiN sub types (grunntyper), but it would become too messy. Therefor I will create a second column with a textual/categorical description of the degree of thematic coverage.</p>
<p>I will look at the definitions of the nature type in the first and last year when that type was mapped, but not for the years in between.</p>
<div id="add-nin-main-type-and-degree-of-representativity" class="section level3" number="5.7.1">
<h3><span class="header-section-number">5.7.1</span> Add NiN main type and degree of representativity</h3>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remove trailing white spaces</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>Nature_type <span class="ot">&lt;-</span> <span class="fu">trimws</span>(ntypDF2<span class="sc">$</span>Nature_type)</span></code></pre></div>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Aktiv skredmark&quot;</span>                                    ] <span class="ot">&lt;-</span> <span class="st">&quot;T17 | all (if including sub-types)&quot;</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Åpen flomfastmark&quot;</span>                                  ] <span class="ot">&lt;-</span> <span class="st">&quot;T18 | all&quot;</span></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Åpen grunnlendt kalkrik mark i boreonemoral sone&quot;</span>   ] <span class="ot">&lt;-</span> <span class="st">&quot;T2  | calcareous&quot;</span></span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Åpen grunnlendt kalkrik mark i sørboreal sone&quot;</span>      ] <span class="ot">&lt;-</span> <span class="st">&quot;T2  | calcareous&quot;</span></span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Atlantisk høymyr&quot;</span>                                   ] <span class="ot">&lt;-</span> <span class="st">&quot;V3  | all (if including sub-types)&quot;</span> <span class="co"># can also include smaller areas of V1</span></span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Boreal hei&quot;</span>                                         ] <span class="ot">&lt;-</span> <span class="st">&quot;T31 | all&quot;</span></span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Eksentrisk høymyr&quot;</span>                                  ] <span class="ot">&lt;-</span> <span class="st">&quot;V3  | all (if including sub-types)&quot;</span> <span class="co"># can also include smaller areas of V1</span></span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Eng-aktig sterkt endret fastmark&quot;</span>                   ] <span class="ot">&lt;-</span> <span class="st">&quot;T41 | all&quot;</span></span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Fosse-eng&quot;</span>                                          ] <span class="ot">&lt;-</span> <span class="st">&quot;T15 | all&quot;</span></span>
<span id="cb185-10"><a href="#cb185-10" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Fosseberg&quot;</span>                                          ] <span class="ot">&lt;-</span> <span class="st">&quot;T1  | extra wet&quot;</span></span>
<span id="cb185-11"><a href="#cb185-11" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Fossepåvirket berg&quot;</span>                                 ] <span class="ot">&lt;-</span> <span class="st">&quot;T1  | extra wet&quot;</span></span>
<span id="cb185-12"><a href="#cb185-12" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Fuglefjell-eng og fugletopp&quot;</span>                        ] <span class="ot">&lt;-</span> <span class="st">&quot;T8  | all&quot;</span></span>
<span id="cb185-13"><a href="#cb185-13" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Hagemark&quot;</span>                                           ] <span class="ot">&lt;-</span> <span class="st">&quot;T32 | all (if including sub-types)&quot;</span></span>
<span id="cb185-14"><a href="#cb185-14" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Høgereligende og nordlig nedbørsmyr&quot;</span>                ] <span class="ot">&lt;-</span> <span class="st">&quot;V3  | all (if including sub-types)&quot;</span> <span class="co"># torvmarksformene are excluded</span></span>
<span id="cb185-15"><a href="#cb185-15" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Isinnfrysingsmark&quot;</span>                                  ] <span class="ot">&lt;-</span> <span class="st">&quot;T20 | all&quot;</span></span>
<span id="cb185-16"><a href="#cb185-16" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Kalkrik helofyttsump&quot;</span>                               ] <span class="ot">&lt;-</span> <span class="st">&quot;L4 | calcareous&quot;</span></span>
<span id="cb185-17"><a href="#cb185-17" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Kanthøymyr&quot;</span>                                         ] <span class="ot">&lt;-</span> <span class="st">&quot;V3  | all (if including sub-types)&quot;</span> <span class="co"># can also include smaller areas of V1</span></span>
<span id="cb185-18"><a href="#cb185-18" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Konsentrisk høymyr&quot;</span>                                 ] <span class="ot">&lt;-</span> <span class="st">&quot;V3  | all (if including sub-types)&quot;</span> <span class="co"># can also include smaller areas of V1</span></span>
<span id="cb185-19"><a href="#cb185-19" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Kystlynghei&quot;</span>                                        ] <span class="ot">&lt;-</span> <span class="st">&quot;T34 | all&quot;</span></span>
<span id="cb185-20"><a href="#cb185-20" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Lauveng&quot;</span>                                            ] <span class="ot">&lt;-</span> <span class="st">&quot;T32 | all (if including sub-types)&quot;</span></span>
<span id="cb185-21"><a href="#cb185-21" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Nakent tørkeutsatt kalkberg&quot;</span>                        ] <span class="ot">&lt;-</span> <span class="st">&quot;T1  | calcareous and dry&quot;</span></span>
<span id="cb185-22"><a href="#cb185-22" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Naturbeitemark&quot;</span>                                     ] <span class="ot">&lt;-</span> <span class="st">&quot;T32 | all (if including sub-types)&quot;</span></span>
<span id="cb185-23"><a href="#cb185-23" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Øvre sandstrand uten pionervegetasjon&quot;</span>              ] <span class="ot">&lt;-</span> <span class="st">&quot;T29 | sandy and vegetated&quot;</span></span>
<span id="cb185-24"><a href="#cb185-24" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Øyblandingsmyr&quot;</span>                                     ] <span class="ot">&lt;-</span> <span class="st">&quot;V1  | partial&quot;</span> <span class="co"># also includes V3</span></span>
<span id="cb185-25"><a href="#cb185-25" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Palsmyr&quot;</span>                                            ] <span class="ot">&lt;-</span> <span class="st">&quot;V3  | all (if including sub-types)&quot;</span></span>
<span id="cb185-26"><a href="#cb185-26" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Platåhøymyr&quot;</span>                                        ] <span class="ot">&lt;-</span> <span class="st">&quot;V3  | all (if including sub-types)&quot;</span> <span class="co"># can also include smaller areas of V1</span></span>
<span id="cb185-27"><a href="#cb185-27" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Rik åpen jordvannsmyr i mellomboreal sone&quot;</span>          ] <span class="ot">&lt;-</span> <span class="st">&quot;V1  | calcareous&quot;</span></span>
<span id="cb185-28"><a href="#cb185-28" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Rik åpen jordvannsmyr i nordboreal og lavalpin sone&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;V1  | calcareous&quot;</span></span>
<span id="cb185-29"><a href="#cb185-29" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Rik åpen sørlig jordvannsmyr&quot;</span>                       ] <span class="ot">&lt;-</span> <span class="st">&quot;V1  | calcareous&quot;</span></span>
<span id="cb185-30"><a href="#cb185-30" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Sanddynemark&quot;</span>                                       ] <span class="ot">&lt;-</span> <span class="st">&quot;T21 | all (if including sub-types)&quot;</span></span>
<span id="cb185-31"><a href="#cb185-31" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Semi-naturlig eng&quot;</span>                                  ] <span class="ot">&lt;-</span> <span class="st">&quot;T32 | all (if including sub-types)&quot;</span></span>
<span id="cb185-32"><a href="#cb185-32" aria-hidden="true" tabindex="-1"></a><span class="co"># This might be called Kulturmarkseng in the 2018 protocol, but Semi-naturlig eng in the data set. </span></span>
<span id="cb185-33"><a href="#cb185-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Kulturmarkseng also includes V10</span></span>
<span id="cb185-34"><a href="#cb185-34" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Semi-naturlig myr&quot;</span>                                  ] <span class="ot">&lt;-</span> <span class="st">&quot;V9  | all (if including sub-types)&quot;</span></span>
<span id="cb185-35"><a href="#cb185-35" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Semi-naturlig strandeng&quot;</span>                            ] <span class="ot">&lt;-</span> <span class="st">&quot;T33 | all (-2018)&quot;</span> <span class="co"># could perhaps be used in 2018, but it&#39;s defined awkwardly</span></span>
<span id="cb185-36"><a href="#cb185-36" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Semi-naturlig våteng&quot;</span>                               ] <span class="ot">&lt;-</span> <span class="st">&quot;V10 | all (-2018)&quot;</span></span>
<span id="cb185-37"><a href="#cb185-37" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Silt og leirskred&quot;</span>                                  ] <span class="ot">&lt;-</span> <span class="st">&quot;T17 | all (if including sub-types)&quot;</span></span>
<span id="cb185-38"><a href="#cb185-38" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Slåttemark&quot;</span>                                         ] <span class="ot">&lt;-</span> <span class="st">&quot;T32 | all (if including sub-types)&quot;</span></span>
<span id="cb185-39"><a href="#cb185-39" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Slåttemyr&quot;</span>                                          ] <span class="ot">&lt;-</span> <span class="st">&quot;V9  | all (if including sub-types)&quot;</span></span>
<span id="cb185-40"><a href="#cb185-40" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Sørlig etablert sanddynemark&quot;</span>                       ] <span class="ot">&lt;-</span> <span class="st">&quot;T21 | all (if including sub-types)&quot;</span></span>
<span id="cb185-41"><a href="#cb185-41" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Sørlig kaldkilde&quot;</span>                                   ] <span class="ot">&lt;-</span> <span class="st">&quot;V4  | southern&quot;</span></span>
<span id="cb185-42"><a href="#cb185-42" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Sørlig nedbørsmyr&quot;</span>                                  ] <span class="ot">&lt;-</span> <span class="st">&quot;V3  | all (if including sub-types)&quot;</span></span>
<span id="cb185-43"><a href="#cb185-43" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Sørlig slåttemyr&quot;</span>                                   ] <span class="ot">&lt;-</span> <span class="st">&quot;V9  | all (if including sub-types)&quot;</span></span>
<span id="cb185-44"><a href="#cb185-44" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Strandeng&quot;</span>                                          ] <span class="ot">&lt;-</span> <span class="st">&quot;T12 | all (-2018)&quot;</span></span>
<span id="cb185-45"><a href="#cb185-45" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Svært tørkeutsatt sørlig kalkberg&quot;</span>                  ] <span class="ot">&lt;-</span> <span class="st">&quot;T1  | calcareous and dry&quot;</span></span>
<span id="cb185-46"><a href="#cb185-46" aria-hidden="true" tabindex="-1"></a>ntypDF2<span class="sc">$</span>hovedgruppe[ntypDF2<span class="sc">$</span>Nature_type <span class="sc">==</span> <span class="st">&quot;Terrengdekkende myr&quot;</span>                                ] <span class="ot">&lt;-</span> <span class="st">&quot;V3  | all (if including sub-types)&quot;</span></span></code></pre></div>
<p>Split this new column in two.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>ntypDF2 <span class="ot">&lt;-</span> ntypDF2 <span class="sc">%&gt;%</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">separate</span>(<span class="at">col =</span> hovedgruppe,</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;NiN_mainType&quot;</span>, <span class="st">&quot;NiN_mainTypeCoverage&quot;</span>),</span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>                  <span class="co">#sep = &quot;|&quot;,</span></span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">remove=</span>T,</span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">extra =</span> <span class="st">&quot;merge&quot;</span></span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a>              )</span></code></pre></div>
</div>
</div>
<div id="add-nin-variables" class="section level2" number="5.8">
<h2><span class="header-section-number">5.8</span> Add NiN variables</h2>
<p>Preparing the data:</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Exclude non-relevant forest wetland types</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>dat2 <span class="ot">&lt;-</span> dat[<span class="sc">!</span>dat<span class="sc">$</span>naturtype <span class="sc">%in%</span> excl_nt,]</span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Melt data</span></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>dat2L <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">separate_rows</span>(dat2, ninBeskrivelsesvariable, <span class="at">sep=</span><span class="st">&quot;,&quot;</span>)</span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the code and the value into separate columns</span></span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a>dat2L <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">separate</span>(dat2L, </span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">col =</span> ninBeskrivelsesvariable,</span>
<span id="cb187-10"><a href="#cb187-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;NiN_variable_code&quot;</span>, <span class="st">&quot;NiN_variable_value&quot;</span>),</span>
<span id="cb187-11"><a href="#cb187-11" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb187-12"><a href="#cb187-12" aria-hidden="true" tabindex="-1"></a>                              <span class="at">remove=</span>F</span>
<span id="cb187-13"><a href="#cb187-13" aria-hidden="true" tabindex="-1"></a>                              )</span>
<span id="cb187-14"><a href="#cb187-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: Expected 2 pieces. Missing pieces filled with `NA` in 1</span></span>
<span id="cb187-15"><a href="#cb187-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; rows [189800].</span></span>
<span id="cb187-16"><a href="#cb187-16" aria-hidden="true" tabindex="-1"></a><span class="co"># One NA produced here, but I check it, and it&#39;s fine.</span></span>
<span id="cb187-17"><a href="#cb187-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-18"><a href="#cb187-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert values to numeric. This causes some NA&#39;s which I will go through below</span></span>
<span id="cb187-19"><a href="#cb187-19" aria-hidden="true" tabindex="-1"></a>dat2L<span class="sc">$</span>NiN_variable_value <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dat2L<span class="sc">$</span>NiN_variable_value)</span>
<span id="cb187-20"><a href="#cb187-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: NAs introduced by coercion</span></span></code></pre></div>
<p>Here are all the NiN variable codes:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">sort</span>(dat2L<span class="sc">$</span>NiN_variable_code))</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;1AG-A-0&quot;   &quot;1AG-A-E&quot;   &quot;1AG-A-G&quot;   &quot;1AG-B&quot;    </span></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;1AG-C&quot;     &quot;1AR-A-E&quot;   &quot;1AR-C-L&quot;   &quot;3TO-BØ&quot;   </span></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;3TO-HA&quot;    &quot;3TO-HE&quot;    &quot;3TO-HK&quot;    &quot;3TO-HN&quot;   </span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [13] &quot;3TO-HP&quot;    &quot;3TO-PA&quot;    &quot;3TO-TE&quot;    &quot;4DL-S-0&quot;  </span></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [17] &quot;4DL-SS-0&quot;  &quot;4TG-BL&quot;    &quot;4TG-EL&quot;    &quot;4TG-GF&quot;   </span></span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [21] &quot;4TL-BS&quot;    &quot;4TL-HE&quot;    &quot;4TL-HL&quot;    &quot;4TL-RB&quot;   </span></span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [25] &quot;4TL-SB&quot;    &quot;4TS-TS&quot;    &quot;5AB-0&quot;     &quot;5AB-DO-TT&quot;</span></span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [29] &quot;5BY-0&quot;     &quot;6SE&quot;       &quot;6SO&quot;       &quot;7FA&quot;      </span></span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [33] &quot;7GR-GI&quot;    &quot;7JB-BA&quot;    &quot;7JB-BT&quot;    &quot;7JB-GJ&quot;   </span></span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [37] &quot;7JB-HT-SL&quot; &quot;7JB-HT-ST&quot; &quot;7JB-KU-BY&quot; &quot;7JB-KU-DE&quot;</span></span>
<span id="cb188-12"><a href="#cb188-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [41] &quot;7JB-KU-MO&quot; &quot;7JB-KU-PI&quot; &quot;7RA-BH&quot;    &quot;7RA-SJ&quot;   </span></span>
<span id="cb188-13"><a href="#cb188-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [45] &quot;7SD-0&quot;     &quot;7SD-NS&quot;    &quot;7SE&quot;       &quot;7SN-BE&quot;   </span></span>
<span id="cb188-14"><a href="#cb188-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [49] &quot;7TK&quot;       &quot;7VR-RE&quot;    &quot;7VR-RI&quot;    &quot;LKMKI&quot;    </span></span>
<span id="cb188-15"><a href="#cb188-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [53] &quot;LKMSP&quot;     &quot;PRAK&quot;      &quot;PRAM&quot;      &quot;PRH&quot;      </span></span>
<span id="cb188-16"><a href="#cb188-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [57] &quot;PRHA&quot;      &quot;PRHT&quot;      &quot;PRKA&quot;      &quot;PRKU&quot;     </span></span>
<span id="cb188-17"><a href="#cb188-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [61] &quot;PRMY&quot;      &quot;PRRL-CR&quot;   &quot;PRRL-DD&quot;   &quot;PRRL-EN&quot;  </span></span>
<span id="cb188-18"><a href="#cb188-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [65] &quot;PRRL-NT&quot;   &quot;PRRL-VU&quot;   &quot;PRSE-KA&quot;   &quot;PRSE-PA&quot;  </span></span>
<span id="cb188-19"><a href="#cb188-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [69] &quot;PRSE-SH&quot;   &quot;PRSL&quot;      &quot;PRTK&quot;      &quot;PRTO&quot;     </span></span>
<span id="cb188-20"><a href="#cb188-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [73] &quot;PRVS&quot;</span></span></code></pre></div>
<p>Converting NiN_variable_value to numeric also introduced NA’s for these categories:</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">unique</span>(dat2L<span class="sc">$</span>NiN_variable_code[<span class="fu">is.na</span>(dat2L<span class="sc">$</span>NiN_variable_value)]))</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;4DL-S-0&quot;   &quot;4DL-SS-0&quot;  &quot;4TL-HL&quot;    &quot;5AB-0&quot;    </span></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;5BY-0&quot;     &quot;7FA&quot;       &quot;7GR-GI&quot;    &quot;7JB-BA&quot;   </span></span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;7JB-BT&quot;    &quot;7JB-GJ&quot;    &quot;7JB-KU-BY&quot; &quot;7JB-KU-DE&quot;</span></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [13] &quot;7JB-KU-MO&quot; &quot;7JB-KU-PI&quot; &quot;7RA-SJ&quot;    &quot;7SD-0&quot;    </span></span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [17] &quot;7SD-NS&quot;    &quot;7SE&quot;       &quot;7SN-BE&quot;    &quot;7TK&quot;      </span></span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [21] &quot;7VR-RE&quot;    &quot;7VR-RI&quot;    &quot;LKMKI&quot;     &quot;LKMSP&quot;    </span></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [25] &quot;PRH&quot;       &quot;PRVS&quot;</span></span></code></pre></div>
<p>When I now go through the variable codes separately I will also judge if these NA’s are real, or if they for example should be coded as zeros or something. I will exclude variables that are part of the biodiversity assessment of the localities, since these are not assessed for localities that have a very poor condition (this bias is not possible to correct).</p>
<div id="ag-a-sjiktdekningsvariabler" class="section level3" number="5.8.1">
<h3><span class="header-section-number">5.8.1</span> 1AG-A (sjiktdekningsvariabler)</h3>
<p>These are different variables describing the cover in different vegetation strata and/or species</p>
<ul>
<li>1AG-A-0 = Total tre canopy cover</li>
<li>1AG-B = Total shrub cover</li>
<li>1AG-C = Total field layer cover</li>
<li>1AG-A-E = ‘Overstandere’</li>
<li>1AG-A-G = ‘gjenveksttrær’</li>
</ul>
</div>
<div id="ar-c-l-andel-vedvekster-i-fletsjiktet" class="section level3" number="5.8.2">
<h3><span class="header-section-number">5.8.2</span> 1AR-C-L (Andel vedvekster i fletsjiktet)</h3>
<p>A condition variable in some mire nature types</p>
</div>
<div id="to-torvmarksformer" class="section level3" number="5.8.3">
<h3><span class="header-section-number">5.8.3</span> 3TO (Torvmarksformer)</h3>
<p>These are defining variables, and not part of the condition assessment.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>exclude <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;3TO-BØ&quot;</span>,</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;3TO-HA&quot;</span>,</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;3TO-HE&quot;</span>,</span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;3TO-HK&quot;</span>,</span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;3TO-HN&quot;</span>,</span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;3TO-HP&quot;</span>,</span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;3TO-PA&quot;</span>,</span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;3TO-TE&quot;</span>)</span></code></pre></div>
</div>
<div id="dl-coarse-dead-wood" class="section level3" number="5.8.4">
<h3><span class="header-section-number">5.8.4</span> 4DL (Coarse dead wood)</h3>
<p>4DL-SS-0 and 4DL-S-0 has to do with the total amount of coarse woody debris/logs. It was only recorded for one nature type in 2018, and then as a a <em>biodiversity variable</em>, and not a state variable.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>exclude <span class="ot">&lt;-</span> <span class="fu">c</span>(exclude,</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;4DL-SS-0&quot;</span>,</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;4DL-S-0&quot;</span>)</span></code></pre></div>
</div>
<div id="tg-old-trees" class="section level3" number="5.8.5">
<h3><span class="header-section-number">5.8.5</span> 4TG (old trees)</h3>
<p>These three variables are used as <em>biodiversity variables</em> in 2018.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>exclude <span class="ot">&lt;-</span> <span class="fu">c</span>(exclude,</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;4TG-BL&quot;</span>,</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;4TG-EL&quot;</span>,</span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;4TG-GF&quot;</span>)</span></code></pre></div>
</div>
<div id="tl-trees-with-fire-scars" class="section level3" number="5.8.6">
<h3><span class="header-section-number">5.8.6</span> 4TL (trees with fire scars)</h3>
<p>These five variables are used together with 4TG as <em>biodiversity variables</em> in 2018.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>exclude <span class="ot">&lt;-</span> <span class="fu">c</span>(exclude,</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;4TL-BS&quot;</span>,</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;4TL-HE&quot;</span>,</span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;4TL-HL&quot;</span>,</span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;4TL-RB&quot;</span>,</span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;4TL-SB&quot;</span>)</span></code></pre></div>
</div>
<div id="ab-and-5by-arealbruksklasser-og-byggningstyper" class="section level3" number="5.8.7">
<h3><span class="header-section-number">5.8.7</span> 5AB and 5BY (arealbruksklasser og byggningstyper)</h3>
<p>These area land use types and building types, respectively, and the values are not numeric, but categorical, and represents presence or absence of these land uses or objects. These are not suited for automatically determining ecosystem condition as this is done subjectively in the field.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>exclude <span class="ot">&lt;-</span> <span class="fu">c</span>(exclude,</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;5AB-0&quot;</span>,</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;5AB-DO-TT&quot;</span>,</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;5BY-0&quot;</span></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a>             )</span></code></pre></div>
</div>
<div id="se-and-6so-bioclimatical-sections-and-sones" class="section level3" number="5.8.8">
<h3><span class="header-section-number">5.8.8</span> 6SE and 6SO (Bioclimatical sections and sones)</h3>
<p>Not relevant here as condition variables.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>exclude <span class="ot">&lt;-</span> <span class="fu">c</span>(exclude,</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;6SE&quot;</span>,</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;6SO&quot;</span>)</span></code></pre></div>
</div>
<div id="fa-fremmedartsinnslag" class="section level3" number="5.8.9">
<h3><span class="header-section-number">5.8.9</span> 7FA (fremmedartsinnslag)</h3>
<p>Should not have been allowed the value X, so Ok to keep these as NA.</p>
</div>
<div id="gr-gi" class="section level3" number="5.8.10">
<h3><span class="header-section-number">5.8.10</span> 7GR-GI</h3>
<p>7GR-GI (grøftingsintensitet) should not have the value X either, so OK to exclude these NA’s. But we keep the variable, even though its clearly a pressure indicator, we might want to use it as a surrogate for mire hydrology.</p>
</div>
<div id="jb-ba-aktuell-bruksintensitet" class="section level3" number="5.8.11">
<h3><span class="header-section-number">5.8.11</span> 7JB-BA (Aktuell bruksintensitet)</h3>
<p>A common condition/pressure variable in semi-natural nature types.</p>
<p>Overview of cases where the value is set as <em>X</em>.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> dat2L[dat2L<span class="sc">$</span>ninBeskrivelsesvariable <span class="sc">==</span> <span class="st">&quot;7JB-BA_X&quot;</span>,]</span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(temp<span class="sc">$</span>kartleggingsår, temp<span class="sc">$</span>naturtype)</span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       </span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        Eng-aktig sterkt endret fastmark Hagemark</span></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2018                                0        0</span></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2020                                1        0</span></span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2021                                0        1</span></span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       </span></span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        Semi-naturlig eng Semi-naturlig strandeng Slåttemark</span></span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2018                 0                       0          0</span></span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2020                 0                       0          0</span></span>
<span id="cb196-12"><a href="#cb196-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2021                 1                       1          1</span></span>
<span id="cb196-13"><a href="#cb196-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       </span></span>
<span id="cb196-14"><a href="#cb196-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        Strandeng</span></span>
<span id="cb196-15"><a href="#cb196-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2018        27</span></span>
<span id="cb196-16"><a href="#cb196-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2020         0</span></span>
<span id="cb196-17"><a href="#cb196-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2021         0</span></span></code></pre></div>
<p>These are just a few cases, mostly from 2018. OK to treat as NA.</p>
</div>
<div id="jb-bt-beitetrykk" class="section level3" number="5.8.12">
<h3><span class="header-section-number">5.8.12</span> 7JB-BT (Beitetrykk)</h3>
<p>Similar variable to the above.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> dat2L[dat2L<span class="sc">$</span>ninBeskrivelsesvariable <span class="sc">==</span> <span class="st">&quot;7JB-BT_X&quot;</span>,]</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(temp<span class="sc">$</span>kartleggingsår, temp<span class="sc">$</span>naturtype)</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       </span></span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        Åpen flomfastmark Kystlynghei Sanddynemark</span></span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2019                 3           0            0</span></span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2020                 1           1            2</span></span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2021                 3           0            0</span></span></code></pre></div>
<p>OK to treat X’s as NA’s.</p>
</div>
<div id="jb-gj-gjødsling" class="section level3" number="5.8.13">
<h3><span class="header-section-number">5.8.13</span> 7JB-GJ (Gjødsling)</h3>
<p>Similar variable to the two above.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> dat2L[dat2L<span class="sc">$</span>ninBeskrivelsesvariable <span class="sc">==</span> <span class="st">&quot;7JB-BT_X&quot;</span>,]</span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(temp<span class="sc">$</span>kartleggingsår, temp<span class="sc">$</span>naturtype)</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       </span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        Åpen flomfastmark Kystlynghei Sanddynemark</span></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2019                 3           0            0</span></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2020                 1           1            2</span></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2021                 3           0            0</span></span></code></pre></div>
<p>OK to treat as X’s NA’s.</p>
<p>This variable is used as a condition indicator, but it is perhaps strictly speaking a pressure indicator. Secondly, many semi-natural areas were fertilized, also in the reference condition. The people that made the meadows would probably not agree that a productive field/meadow has poor condition. This condition variable is therefor more directly tuned towards the maintenance of biodiversity.</p>
</div>
<div id="jb-ht-høsting-av-tresjiktet" class="section level3" number="5.8.14">
<h3><span class="header-section-number">5.8.14</span> 7JB-HT (Høsting av tresjiktet)</h3>
<p>Used for <em>Lauveng</em> in 2019 and 2020.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> dat2L[dat2L<span class="sc">$</span>NiN_variable_code <span class="sc">==</span> <span class="st">&quot;7JB-HT-ST&quot;</span> <span class="sc">|</span> </span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>               dat2L<span class="sc">$</span>NiN_variable_code <span class="sc">==</span> <span class="st">&quot;7JB-HT-SL&quot;</span> ,]</span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(temp<span class="sc">$</span>kartleggingsår, temp<span class="sc">$</span>naturtype)</span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       </span></span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        Lauveng</span></span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2019      14</span></span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2020       8</span></span>
<span id="cb199-8"><a href="#cb199-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2022       2</span></span></code></pre></div>
<p>This is so marginal that I will exclude these already now.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>exclude <span class="ot">&lt;-</span> <span class="fu">c</span>(exclude,</span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;7JB-HT-SL&quot;</span>,</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;7JB-HT-ST&quot;</span>)</span></code></pre></div>
</div>
<div id="jb-ku-kystlyngheias-utviklingsfaser" class="section level3" number="5.8.15">
<h3><span class="header-section-number">5.8.15</span> 7JB-KU (Kystlyngheias utviklingsfaser)</h3>
<ul>
<li>BY = byggefase</li>
<li>DE = degenereringsfase</li>
<li>MO = moden fase</li>
<li>PI = pionerfase</li>
</ul>
<p>This variable is used as in the <em>biodiversity assessment</em>, and can therefore not be used in the condition assessment because localities with <em>very poor</em> conditions have not been mapped/assessed.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>exclude <span class="ot">&lt;-</span> <span class="fu">c</span>(exclude, </span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;7JB-KU-BY&quot;</span>, </span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;7JB-KU-DE&quot;</span>, </span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;7JB-KU-MO&quot;</span>, </span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;7JB-KU-PI&quot;</span>)</span></code></pre></div>
<p>I will nonetheless explore this variable a bit more since this variable has been suggested previously as a condition variable.
NiN defines the possible values for these as numeric between 0 and 4 (shifted to become 1-5 in the data set), but there are 998 cases where it has been given then value <em>X</em>.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> dat2L[dat2L<span class="sc">$</span>ninBeskrivelsesvariable <span class="sc">==</span> <span class="st">&quot;7JB-KU-BY_X&quot;</span> <span class="sc">|</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>                     dat2L<span class="sc">$</span>ninBeskrivelsesvariable <span class="sc">==</span> <span class="st">&quot;7JB-KU-DE_X&quot;</span> <span class="sc">|</span></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>                dat2L<span class="sc">$</span>ninBeskrivelsesvariable <span class="sc">==</span> <span class="st">&quot;7JB-KU-MO_X&quot;</span> <span class="sc">|</span></span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>                     dat2L<span class="sc">$</span>ninBeskrivelsesvariable <span class="sc">==</span> <span class="st">&quot;7JB-KU-PI_X&quot;</span>,]</span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(temp<span class="sc">$</span>kartleggingsår, temp<span class="sc">$</span>naturtype)</span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       </span></span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        Kystlynghei</span></span>
<span id="cb202-8"><a href="#cb202-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2018         510</span></span>
<span id="cb202-9"><a href="#cb202-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2019         132</span></span>
<span id="cb202-10"><a href="#cb202-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2020          21</span></span>
<span id="cb202-11"><a href="#cb202-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2021         326</span></span>
<span id="cb202-12"><a href="#cb202-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2022           7</span></span></code></pre></div>
<p>The reason could be that this variable is used in the biodiversity assessment, which is not performed if the condition is <em>very poor</em>, but the following table shows that the localities where this variable has been given the value X is spread across all condition scores:</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(temp<span class="sc">$</span>tilstand)</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 - Svært redusert         2 - Dårlig        3 - Moderat </span></span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                  9                181                733 </span></span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;            4 - God </span></span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                 73</span></span></code></pre></div>
<p>We can also make a note that a big proportion of the total number of localities of <em>Kystlynghei</em> had very poor (svært redusert) condition, and therefore this variable 7JB-KU was not recorded in a large proportion of the localities.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>KU <span class="ot">&lt;-</span> dat2[dat2<span class="sc">$</span>naturtype<span class="sc">==</span><span class="st">&quot;Kystlynghei&quot;</span>,]</span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(KU<span class="sc">$</span>tilstand))</span></code></pre></div>
<div class="figure">
<img src="naturtype_files/figure-html/unnamed-chunk-54-1.png" alt="The distribution of condition scores for Kystlynghei." width="672" />
<p class="caption">
(#fig:unnamed-chunk-54)The distribution of condition scores for Kystlynghei.
</p>
</div>
<p>The percentage of localities with very poor condition is 0%.</p>
<p>Each <em>kystlynghei</em> locality should have values for all four parameters (7BA-BY/DE/MO/PI), but if we look at some cases in more detail, to understand why some of these values have been set as X (probably means they were left blank), for example like this:</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co">#View(dat2L[dat2L$NiN_variable_code == &quot;7JB-KU-BY&quot; &amp; is.na(dat2L$NiN_variable_value),])</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="co">#View(dat2L[dat2L$identifikasjon_lokalid ==&quot;NINFP1810002975&quot;,]) # None of the 7JB-KU variables have values</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a><span class="co">#View(dat2L[dat2L$identifikasjon_lokalid ==&quot;NINFP2110057689&quot;,]) # Two of the 7JB-KU variables have values</span></span></code></pre></div>
<p>… we can see that sometimes &lt;4 but &gt;0 of the variables/phases has been given a score, but sometimes none have. This makes it problematic to set these NA’s to be zeros.</p>
<p>For this variable to be used in as an indicator for Ecological Condition in the future, the variable needs to be assessed for all localities, and the field protocol and/or field app needs to be revised to that it is not possible to record blank or NA values.</p>
</div>
<div id="ra-bh-and-7ra-sj-rask-suksesjon-i-boreal-hei-og-i-i-semi-naturlig-og-sterkt-endret-jordbruksmark-inkludert-våteng" class="section level3" number="5.8.16">
<h3><span class="header-section-number">5.8.16</span> 7RA-BH and 7RA-SJ (rask suksesjon i boreal hei og i i semi-naturlig og sterkt endret jordbruksmark inkludert våteng)</h3>
<p>Condition variables.
There are some very few cases where 7RA-SJ has the value X. It should be numeric 1-4, so the value X is a mistake here I think. We can exclude these (i.e. allow them to be NA’s).</p>
</div>
<div id="sd-0-and-7sd--ns-natur--og-normalskogsdynamikk" class="section level3" number="5.8.17">
<h3><span class="header-section-number">5.8.17</span> 7SD-0 and 7SD- NS (Natur- og normalskogsdynamikk)</h3>
<p>7SD-NS and 7SD-0 was also only used for only one nature type (which is not forest), and then only for wooded localities of <em>Flommyr, myrkant og myrskogsmark</em>. <em>X</em> therefore means <em>not relevant</em>, and we can also exclude the parameters from the dataset all together.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>exclude <span class="ot">&lt;-</span> <span class="fu">c</span>(exclude, </span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;7SD-0&quot;</span>,     </span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;7SD-NS&quot;</span>)</span></code></pre></div>
</div>
<div id="tk-and-7se-kjørespor-slitasje" class="section level3" number="5.8.18">
<h3><span class="header-section-number">5.8.18</span> 7TK and 7SE (kjørespor &amp; slitasje)</h3>
<p>7TK (kjørespor) and 7SE (slitasje) are not allowed the value X, but it happened on some rare occasions (24) anyhow. It’s fine to treat these as NA’s.</p>
</div>
<div id="vr-ri-reguleringsintensitet" class="section level3" number="5.8.19">
<h3><span class="header-section-number">5.8.19</span> 7VR-RI (Reguleringsintensitet)</h3>
<p>This variable is defined as numeric between 1-5. There are, however, quite a few cases where it is X.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> dat2L[dat2L<span class="sc">$</span>ninBeskrivelsesvariable <span class="sc">==</span> <span class="st">&quot;7VR-RI_X&quot;</span>,]</span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(temp<span class="sc">$</span>kartleggingsår, temp<span class="sc">$</span>naturtype)</span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       </span></span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        Åpen flomfastmark</span></span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2019                96</span></span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2020                 1</span></span>
<span id="cb207-7"><a href="#cb207-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2021                11</span></span>
<span id="cb207-8"><a href="#cb207-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2022                 1</span></span></code></pre></div>
<p>I cannot explain these, but in any case, this variable is not a good indicator for condition as it rather represents a pressure/driver. So OK to treat as NA’s.</p>
<p><em>LKMs</em><br />
LKM’s (lokal kompleks miljøvariabel) are not relevant to us here.</p>
</div>
<div id="lkmki" class="section level3" number="5.8.20">
<h3><span class="header-section-number">5.8.20</span> LKMKI</h3>
<pre><code>+ Kalk (lime)
+ Exclude</code></pre>
</div>
<div id="lkmsp" class="section level3" number="5.8.21">
<h3><span class="header-section-number">5.8.21</span> LKMSP</h3>
<pre><code>+ Slåttemarkspreg
+ Exclude</code></pre>
<p><em>MdirPR-variables</em>
These are Miljødirektoratets own variables (usually variations on existing NiN-variables)</p>
</div>
<div id="prak" class="section level3" number="5.8.22">
<h3><span class="header-section-number">5.8.22</span> PRAK</h3>
<pre><code>+ Antall NiN-kartleggingsenheter
+ Used in the biodiversity assessment
+ Exclude</code></pre>
</div>
<div id="pram" class="section level3" number="5.8.23">
<h3><span class="header-section-number">5.8.23</span> PRAM</h3>
<pre><code>+ Menneskeskapte objekter
+ Related to 5BY and 5AB
+ Exclude (see 5BY and 5AB)</code></pre>
</div>
<div id="prh" class="section level3" number="5.8.24">
<h3><span class="header-section-number">5.8.24</span> PRH</h3>
<pre><code>+ This is perhaps a mistake and should be PRHA or PRHT
+ Exclude</code></pre>
</div>
<div id="prha" class="section level3" number="5.8.25">
<h3><span class="header-section-number">5.8.25</span> PRHA</h3>
<pre><code>+ Habitat spesifikke arter
+ Used in the biodiversity assessment
+ Exclude</code></pre>
</div>
<div id="prht" class="section level3" number="5.8.26">
<h3><span class="header-section-number">5.8.26</span> PRHT</h3>
<pre><code>+ Høsting av tresjiktet</code></pre>
</div>
<div id="prka" class="section level3" number="5.8.27">
<h3><span class="header-section-number">5.8.27</span> PRKA</h3>
<pre><code>+ Kalkindikatorer
+ Used in the biodiversity assessment
+ Exclude</code></pre>
</div>
<div id="prku" class="section level3" number="5.8.28">
<h3><span class="header-section-number">5.8.28</span> PRKU</h3>
<pre><code>+ Kystlyngheias utviklingsfaser
+ Related to 7JB-KU
+ Used in the biodiversity assessment
+ Exclude</code></pre>
</div>
<div id="prmy" class="section level3" number="5.8.29">
<h3><span class="header-section-number">5.8.29</span> PRMY</h3>
<pre><code>+ Myrstruktur
+ Used in the biodiversity assessment
+ Exclude</code></pre>
</div>
<div id="prrl-crddenntvu" class="section level3" number="5.8.30">
<h3><span class="header-section-number">5.8.30</span> PRRL-CR/DD/EN/NT/VU</h3>
<pre><code>+ Red list categories
+ Used in the biodiversity assessment
+ Exclude</code></pre>
</div>
<div id="prse-ka" class="section level3" number="5.8.31">
<h3><span class="header-section-number">5.8.31</span> PRSE-KA</h3>
<pre><code>+ Strukturer, elementer og torvmarksformer (in 2018)
+ See PRSE-PA</code></pre>
</div>
<div id="prse-pa" class="section level3" number="5.8.32">
<h3><span class="header-section-number">5.8.32</span> PRSE-PA</h3>
<pre><code>+ Strukturer, elementer og torvmarksformer
+ Used in the biodiversity assessment
+ Exclude</code></pre>
</div>
<div id="prse-sh" class="section level3" number="5.8.33">
<h3><span class="header-section-number">5.8.33</span> PRSE-SH</h3>
<pre><code>+ Strukturer, elementer og torvmarksformer (in 2018)
+ See PRSE-PA</code></pre>
</div>
<div id="prsl" class="section level3" number="5.8.34">
<h3><span class="header-section-number">5.8.34</span> PRSL</h3>
<pre><code>+ Slitasje
+ Related to 7SE</code></pre>
</div>
<div id="prtk" class="section level3" number="5.8.35">
<h3><span class="header-section-number">5.8.35</span> PRTK</h3>
<pre><code>+ Spor av tunge kjøretøyer
+ Related to 7TK</code></pre>
</div>
<div id="prto" class="section level3" number="5.8.36">
<h3><span class="header-section-number">5.8.36</span> PRTO</h3>
<pre><code>+ Torvuttak
+ Strictly speaking a pressure variable</code></pre>
</div>
<div id="prvs" class="section level3" number="5.8.37">
<h3><span class="header-section-number">5.8.37</span> PRVS</h3>
<pre><code>+ Variasjon i vannsprutintensitet
+ Used in the biodiversity assessment
+ Exclude</code></pre>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>exclude <span class="ot">&lt;-</span> <span class="fu">c</span>(exclude,</span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;LKMKI&quot;</span>,     </span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;LKMSP&quot;</span>,</span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;PRAK&quot;</span>,</span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;PRAM&quot;</span>,</span>
<span id="cb226-6"><a href="#cb226-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;PRH&quot;</span>,</span>
<span id="cb226-7"><a href="#cb226-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;PRHA&quot;</span>,</span>
<span id="cb226-8"><a href="#cb226-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;PRKA&quot;</span>,</span>
<span id="cb226-9"><a href="#cb226-9" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;PRKU&quot;</span>,</span>
<span id="cb226-10"><a href="#cb226-10" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;PRMY&quot;</span>,</span>
<span id="cb226-11"><a href="#cb226-11" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;PRRL-DD&quot;</span>,   <span class="st">&quot;PRRL-VU&quot;</span>,   <span class="st">&quot;PRRL-NT&quot;</span>,   <span class="st">&quot;PRRL-EN&quot;</span>,   <span class="st">&quot;PRRL-CR&quot;</span>,  </span>
<span id="cb226-12"><a href="#cb226-12" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;PRSE-KA&quot;</span>,</span>
<span id="cb226-13"><a href="#cb226-13" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;PRSE-PA&quot;</span>,</span>
<span id="cb226-14"><a href="#cb226-14" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;PRSE-SH&quot;</span>,</span>
<span id="cb226-15"><a href="#cb226-15" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;PRVS&quot;</span></span>
<span id="cb226-16"><a href="#cb226-16" aria-hidden="true" tabindex="-1"></a>          )</span></code></pre></div>
</div>
</div>
<div id="subset" class="section level2" number="5.9">
<h2><span class="header-section-number">5.9</span> Subset</h2>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclude NAs</span></span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>dat2L2 <span class="ot">&lt;-</span> dat2L[<span class="sc">!</span><span class="fu">is.na</span>(dat2L<span class="sc">$</span>NiN_variable_value),]</span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclude selected NiN variables </span></span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a>dat2L2 <span class="ot">&lt;-</span> dat2L2[<span class="sc">!</span>dat2L2<span class="sc">$</span>NiN_variable_code <span class="sc">%in%</span> exclude,]</span></code></pre></div>
<p>Now we are now down to 24 possible condition variables.</p>
<p><code>dat2L2</code> includes only the three target ecosystems. Hule eiker are excluded. Mosaics are included. Several non-relevant NiN variables are excluded (forested wetlands). The localities are duplicated in as many rows as there are NiN variables for that locality.</p>
</div>
<div id="combine-naturetypes-nin-variables-and-nin-main-types" class="section level2" number="5.10">
<h2><span class="header-section-number">5.10</span> Combine Naturetypes, NiN variables and NiN main types</h2>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>ntyp_vars <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(dat2L2<span class="sc">$</span>naturtype, dat2L2<span class="sc">$</span>NiN_variable_code))</span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ntyp_vars) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Nature_type&quot;</span>, <span class="st">&quot;NiN_variable_code&quot;</span>, <span class="st">&quot;NiN_variable_count&quot;</span>)</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>ntyp_vars <span class="ot">&lt;-</span> ntyp_vars[ntyp_vars<span class="sc">$</span>NiN_variable_count <span class="sc">&gt;</span><span class="dv">0</span>,]</span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ntyp_vars)</span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                          Nature_type</span></span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3   Åpen grunnlendt kalkrik mark i boreonemoral sone</span></span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 16                                          Hagemark</span></span>
<span id="cb228-8"><a href="#cb228-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 29                                    Naturbeitemark</span></span>
<span id="cb228-9"><a href="#cb228-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 73                                          Hagemark</span></span>
<span id="cb228-10"><a href="#cb228-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 83                                           Lauveng</span></span>
<span id="cb228-11"><a href="#cb228-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 156                                Semi-naturlig myr</span></span>
<span id="cb228-12"><a href="#cb228-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     NiN_variable_code NiN_variable_count</span></span>
<span id="cb228-13"><a href="#cb228-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3             1AG-A-0                 41</span></span>
<span id="cb228-14"><a href="#cb228-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 16            1AG-A-0                348</span></span>
<span id="cb228-15"><a href="#cb228-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 29            1AG-A-0                  1</span></span>
<span id="cb228-16"><a href="#cb228-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 73            1AG-A-E               1706</span></span>
<span id="cb228-17"><a href="#cb228-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 83            1AG-A-E                 12</span></span>
<span id="cb228-18"><a href="#cb228-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 156           1AG-A-G                792</span></span></code></pre></div>
<p>Add a column for the total number of localities for each nature type and get the percentage of localities where each NiN main type has been recorded.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co">#options(scipen=999) # suppress exp notation</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>count <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(dat2<span class="sc">$</span>naturtype))</span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(count) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Nature_type&quot;</span>, <span class="st">&quot;totalLocations&quot;</span>)</span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a>ntyp_vars<span class="sc">$</span>totalLocations <span class="ot">&lt;-</span> count<span class="sc">$</span>totalLocations[<span class="fu">match</span>(ntyp_vars<span class="sc">$</span>Nature_type, count<span class="sc">$</span>Nature_type)]</span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a>ntyp_vars<span class="sc">$</span>percentageUse <span class="ot">&lt;-</span> <span class="fu">round</span>((ntyp_vars<span class="sc">$</span>NiN_variable_count<span class="sc">/</span>ntyp_vars<span class="sc">$</span>totalLocations)<span class="sc">*</span><span class="dv">100</span>, <span class="dv">1</span>)</span></code></pre></div>
<p>Cast to get NiN codes as columns</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="co"># should switch to pivot_wider</span></span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>ntyp_vars_wide <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">dcast</span>(<span class="fu">setDT</span>(ntyp_vars),</span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>                                    Nature_type<span class="sc">~</span>NiN_variable_code,</span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">value.var =</span> <span class="st">&quot;percentageUse&quot;</span>)</span></code></pre></div>
<p>This data set contains the nature types that were only mapped in 2018 or 2019, and which we removed from ntypDF2. Let’s exclude these nature types now</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>ntyp_vars_wide <span class="ot">&lt;-</span> ntyp_vars_wide[ntyp_vars_wide<span class="sc">$</span>Nature_type <span class="sc">%in%</span> ntypDF2<span class="sc">$</span>Nature_type]</span></code></pre></div>
<p>Combine data sets</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>ntyp_fill <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ntypDF2, ntyp_vars_wide[,<span class="sc">-</span><span class="dv">1</span>][<span class="fu">match</span>(ntypDF2<span class="sc">$</span>Nature_type, ntyp_vars_wide<span class="sc">$</span>Nature_type)])</span></code></pre></div>
<div id="add-number-of-location-and-total-area-mapped" class="section level3" number="5.10.1">
<h3><span class="header-section-number">5.10.1</span> Add number of location and total area mapped</h3>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>dat2<span class="sc">$</span>km2 <span class="ot">&lt;-</span> units<span class="sc">::</span><span class="fu">drop_units</span>(dat2<span class="sc">$</span>area<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>)</span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>num <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(dat2) <span class="sc">%&gt;%</span></span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(naturtype)<span class="sc">%&gt;%</span></span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">km2 =</span> <span class="fu">sum</span>(km2),</span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">numberOfLocalities =</span> <span class="fu">n</span>())</span>
<span id="cb233-7"><a href="#cb233-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-8"><a href="#cb233-8" aria-hidden="true" tabindex="-1"></a>ntyp_fill <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ntyp_fill, num[,<span class="sc">-</span><span class="dv">1</span>][<span class="fu">match</span>(ntyp_fill<span class="sc">$</span>Nature_type, num<span class="sc">$</span>naturtype),])</span></code></pre></div>
</div>
</div>
<div id="plots" class="section level2" number="5.11">
<h2><span class="header-section-number">5.11</span> Plots</h2>
<div id="the-total-mapped-area" class="section level3" number="5.11.1">
<h3><span class="header-section-number">5.11.1</span> The total mapped area</h3>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>mySize <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a>gg_area <span class="ot">&lt;-</span> ntyp_fill <span class="sc">%&gt;%</span></span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(km2) <span class="sc">%&gt;%</span></span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Nature_type=</span><span class="fu">factor</span>(Nature_type, <span class="at">levels=</span>Nature_type)) <span class="sc">%&gt;%</span>   <span class="co"># This trick update the factor levels</span></span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x =</span> Nature_type,</span>
<span id="cb234-7"><a href="#cb234-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> km2)) <span class="sc">+</span></span>
<span id="cb234-8"><a href="#cb234-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_segment</span>( <span class="fu">aes</span>(<span class="at">xend=</span>Nature_type, <span class="at">yend=</span><span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb234-9"><a href="#cb234-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>( <span class="at">size=</span><span class="dv">4</span>, <span class="fu">aes</span>(<span class="at">group =</span> Ecosystem,</span>
<span id="cb234-10"><a href="#cb234-10" aria-hidden="true" tabindex="-1"></a>                                <span class="at">colour=</span> Ecosystem)) <span class="sc">+</span></span>
<span id="cb234-11"><a href="#cb234-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb234-12"><a href="#cb234-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_bw</span>(<span class="at">base_size =</span> mySize) <span class="sc">+</span></span>
<span id="cb234-13"><a href="#cb234-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>)<span class="sc">+</span></span>
<span id="cb234-14"><a href="#cb234-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ylab</span>(<span class="fu">expression</span>(km<span class="sc">^</span><span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb234-15"><a href="#cb234-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb234-16"><a href="#cb234-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span>  <span class="fu">unit</span>(.<span class="dv">05</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb234-17"><a href="#cb234-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb234-18"><a href="#cb234-18" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb234-19"><a href="#cb234-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-20"><a href="#cb234-20" aria-hidden="true" tabindex="-1"></a>gg_locs <span class="ot">&lt;-</span> ntyp_fill <span class="sc">%&gt;%</span></span>
<span id="cb234-21"><a href="#cb234-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(km2) <span class="sc">%&gt;%</span></span>
<span id="cb234-22"><a href="#cb234-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Nature_type=</span><span class="fu">factor</span>(Nature_type, <span class="at">levels=</span>Nature_type)) <span class="sc">%&gt;%</span>    <span class="co"># also sorted after km2</span></span>
<span id="cb234-23"><a href="#cb234-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x =</span> Nature_type,</span>
<span id="cb234-24"><a href="#cb234-24" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> numberOfLocalities)) <span class="sc">+</span></span>
<span id="cb234-25"><a href="#cb234-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_segment</span>( <span class="fu">aes</span>(<span class="at">xend=</span>Nature_type, <span class="at">yend=</span><span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb234-26"><a href="#cb234-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>( <span class="at">size=</span><span class="dv">4</span>, <span class="fu">aes</span>(<span class="at">group =</span> Ecosystem,</span>
<span id="cb234-27"><a href="#cb234-27" aria-hidden="true" tabindex="-1"></a>                                <span class="at">colour=</span> Ecosystem)) <span class="sc">+</span></span>
<span id="cb234-28"><a href="#cb234-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb234-29"><a href="#cb234-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_bw</span>(<span class="at">base_size =</span> mySize) <span class="sc">+</span></span>
<span id="cb234-30"><a href="#cb234-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>)<span class="sc">+</span></span>
<span id="cb234-31"><a href="#cb234-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ylab</span>(<span class="st">&quot;Number of localities&quot;</span>)<span class="sc">+</span></span>
<span id="cb234-32"><a href="#cb234-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb234-33"><a href="#cb234-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb234-34"><a href="#cb234-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-35"><a href="#cb234-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-36"><a href="#cb234-36" aria-hidden="true" tabindex="-1"></a>egg<span class="sc">::</span><span class="fu">ggarrange</span>(gg_area, gg_locs, </span>
<span id="cb234-37"><a href="#cb234-37" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure">
<img src="naturtype_files/figure-html/unnamed-chunk-66-1.png" alt="The total mapped area for nature types associated with three selected main ecosystems" width="672" />
<p class="caption">
(#fig:unnamed-chunk-66)The total mapped area for nature types associated with three selected main ecosystems
</p>
</div>
</div>
<div id="area-of-localities-per-nin-main-type" class="section level3" number="5.11.2">
<h3><span class="header-section-number">5.11.2</span> Area of localities per NiN main type</h3>
<p>First I will add the NiN main types that are not covered by any nature types.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>open <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T1&quot;</span>,</span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T2&quot;</span>,</span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T6&quot;</span>,</span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T8&quot;</span>,</span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T11&quot;</span>,</span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T12&quot;</span>,</span>
<span id="cb235-8"><a href="#cb235-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T13&quot;</span>,</span>
<span id="cb235-9"><a href="#cb235-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T15&quot;</span>,</span>
<span id="cb235-10"><a href="#cb235-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T16&quot;</span>,</span>
<span id="cb235-11"><a href="#cb235-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T17&quot;</span>,</span>
<span id="cb235-12"><a href="#cb235-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T18&quot;</span>,</span>
<span id="cb235-13"><a href="#cb235-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T20&quot;</span>,</span>
<span id="cb235-14"><a href="#cb235-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T21&quot;</span>,</span>
<span id="cb235-15"><a href="#cb235-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T23&quot;</span>,</span>
<span id="cb235-16"><a href="#cb235-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T24&quot;</span>,</span>
<span id="cb235-17"><a href="#cb235-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T25&quot;</span>,</span>
<span id="cb235-18"><a href="#cb235-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T26&quot;</span>,</span>
<span id="cb235-19"><a href="#cb235-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T27&quot;</span>,</span>
<span id="cb235-20"><a href="#cb235-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T29&quot;</span></span>
<span id="cb235-21"><a href="#cb235-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb235-22"><a href="#cb235-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-23"><a href="#cb235-23" aria-hidden="true" tabindex="-1"></a>semi <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb235-24"><a href="#cb235-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T31&quot;</span>,</span>
<span id="cb235-25"><a href="#cb235-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T32&quot;</span>,</span>
<span id="cb235-26"><a href="#cb235-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T33&quot;</span>,</span>
<span id="cb235-27"><a href="#cb235-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T34&quot;</span>,</span>
<span id="cb235-28"><a href="#cb235-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T40&quot;</span>,  <span class="co"># are these included</span></span>
<span id="cb235-29"><a href="#cb235-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;T41&quot;</span>   <span class="co"># are these included</span></span>
<span id="cb235-30"><a href="#cb235-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb235-31"><a href="#cb235-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-32"><a href="#cb235-32" aria-hidden="true" tabindex="-1"></a>wetland <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb235-33"><a href="#cb235-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;V1&quot;</span>,</span>
<span id="cb235-34"><a href="#cb235-34" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;V3&quot;</span>,</span>
<span id="cb235-35"><a href="#cb235-35" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;V4&quot;</span>,</span>
<span id="cb235-36"><a href="#cb235-36" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;V6&quot;</span>,</span>
<span id="cb235-37"><a href="#cb235-37" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;V9&quot;</span>,</span>
<span id="cb235-38"><a href="#cb235-38" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;V10&quot;</span>,</span>
<span id="cb235-39"><a href="#cb235-39" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;L4&quot;</span>    <span class="co"># this will probably not be part of the assessments</span></span>
<span id="cb235-40"><a href="#cb235-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb235-41"><a href="#cb235-41" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Adding these non-mapped open types</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>open[<span class="sc">!</span>open <span class="sc">%in%</span> ntyp_fill<span class="sc">$</span>NiN_mainType]</span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;T6&quot;  &quot;T11&quot; &quot;T13&quot; &quot;T16&quot; &quot;T23&quot; &quot;T24&quot; &quot;T25&quot; &quot;T26&quot; &quot;T27&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a>ntyp_fill2 <span class="ot">&lt;-</span> ntyp_fill <span class="sc">%&gt;%</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">NiN_mainType =</span> <span class="st">&quot;T6&quot;</span>,  <span class="at">Ecosystem =</span> <span class="st">&quot;naturligÅpneOmråderUnderSkoggrensa&quot;</span>, <span class="at">NiN_mainTypeCoverage =</span> <span class="st">&quot;Not mapped&quot;</span>, <span class="at">km2 =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">NiN_mainType =</span> <span class="st">&quot;T11&quot;</span>, <span class="at">Ecosystem =</span> <span class="st">&quot;naturligÅpneOmråderUnderSkoggrensa&quot;</span>, <span class="at">NiN_mainTypeCoverage =</span> <span class="st">&quot;Not mapped&quot;</span>, <span class="at">km2 =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">NiN_mainType =</span> <span class="st">&quot;T13&quot;</span>, <span class="at">Ecosystem =</span> <span class="st">&quot;naturligÅpneOmråderUnderSkoggrensa&quot;</span>, <span class="at">NiN_mainTypeCoverage =</span> <span class="st">&quot;Not mapped&quot;</span>, <span class="at">km2 =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">NiN_mainType =</span> <span class="st">&quot;T16&quot;</span>, <span class="at">Ecosystem =</span> <span class="st">&quot;naturligÅpneOmråderUnderSkoggrensa&quot;</span>, <span class="at">NiN_mainTypeCoverage =</span> <span class="st">&quot;Not mapped&quot;</span>, <span class="at">km2 =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-6"><a href="#cb237-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">NiN_mainType =</span> <span class="st">&quot;T23&quot;</span>, <span class="at">Ecosystem =</span> <span class="st">&quot;naturligÅpneOmråderUnderSkoggrensa&quot;</span>, <span class="at">NiN_mainTypeCoverage =</span> <span class="st">&quot;Not mapped&quot;</span>, <span class="at">km2 =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-7"><a href="#cb237-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">NiN_mainType =</span> <span class="st">&quot;T24&quot;</span>, <span class="at">Ecosystem =</span> <span class="st">&quot;naturligÅpneOmråderUnderSkoggrensa&quot;</span>, <span class="at">NiN_mainTypeCoverage =</span> <span class="st">&quot;Not mapped&quot;</span>, <span class="at">km2 =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-8"><a href="#cb237-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">NiN_mainType =</span> <span class="st">&quot;T25&quot;</span>, <span class="at">Ecosystem =</span> <span class="st">&quot;naturligÅpneOmråderUnderSkoggrensa&quot;</span>, <span class="at">NiN_mainTypeCoverage =</span> <span class="st">&quot;Not mapped&quot;</span>, <span class="at">km2 =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-9"><a href="#cb237-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">NiN_mainType =</span> <span class="st">&quot;T26&quot;</span>, <span class="at">Ecosystem =</span> <span class="st">&quot;naturligÅpneOmråderUnderSkoggrensa&quot;</span>, <span class="at">NiN_mainTypeCoverage =</span> <span class="st">&quot;Not mapped&quot;</span>, <span class="at">km2 =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-10"><a href="#cb237-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">NiN_mainType =</span> <span class="st">&quot;T27&quot;</span>, <span class="at">Ecosystem =</span> <span class="st">&quot;naturligÅpneOmråderUnderSkoggrensa&quot;</span>, <span class="at">NiN_mainTypeCoverage =</span> <span class="st">&quot;Not mapped&quot;</span>, <span class="at">km2 =</span> <span class="dv">0</span>) </span></code></pre></div>
<p>Adding the non-mapped semi-natural types</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a>semi[<span class="sc">!</span>semi <span class="sc">%in%</span> ntyp_fill<span class="sc">$</span>NiN_mainType]</span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;T40&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a>ntyp_fill2 <span class="ot">&lt;-</span> ntyp_fill2 <span class="sc">%&gt;%</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">NiN_mainType =</span> <span class="st">&quot;T40&quot;</span>, <span class="at">Ecosystem =</span> <span class="st">&quot;semi-naturligMark&quot;</span>, <span class="at">NiN_mainTypeCoverage =</span> <span class="st">&quot;Not mapped&quot;</span>, <span class="at">km2 =</span> <span class="dv">0</span>)</span></code></pre></div>
<p>Adding the non-mapped wetland types</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a>wetland[<span class="sc">!</span>wetland <span class="sc">%in%</span> ntyp_fill<span class="sc">$</span>NiN_mainType]</span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;V6&quot;</span></span></code></pre></div>
<p>V6 is <em>Våtsnøleie</em>, and my guess is that it <em>is</em> mapped, but grouped with the alpine ecosystem. I’ll therefore not add it in here, but mention it in the figure caption below.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a>mySize <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>ntyp_fill2 <span class="sc">%&gt;%</span></span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># combining two classes to get a better colour palette</span></span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NiN_mainTypeCoverage =</span> </span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">replace</span>(NiN_mainTypeCoverage, NiN_mainTypeCoverage <span class="sc">==</span> <span class="st">&quot;southern&quot;</span>, <span class="st">&quot;partial&quot;</span>),</span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">NiN_mainTypeCoverage =</span> </span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">replace</span>(NiN_mainTypeCoverage, NiN_mainTypeCoverage <span class="sc">==</span> <span class="st">&quot;calcareous and dry&quot;</span>, <span class="st">&quot;calcareous&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb241-8"><a href="#cb241-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb241-9"><a href="#cb241-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(NiN_mainType, NiN_mainTypeCoverage) <span class="sc">%&gt;%</span></span>
<span id="cb241-10"><a href="#cb241-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">km2 =</span> <span class="fu">sum</span>(km2)) <span class="sc">%&gt;%</span></span>
<span id="cb241-11"><a href="#cb241-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>()<span class="sc">%&gt;%</span></span>
<span id="cb241-12"><a href="#cb241-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Ecosystem,</span>
<span id="cb241-13"><a href="#cb241-13" aria-hidden="true" tabindex="-1"></a>         NiN_mainType,</span>
<span id="cb241-14"><a href="#cb241-14" aria-hidden="true" tabindex="-1"></a>         NiN_mainTypeCoverage,</span>
<span id="cb241-15"><a href="#cb241-15" aria-hidden="true" tabindex="-1"></a>         km2)<span class="sc">%&gt;%</span></span>
<span id="cb241-16"><a href="#cb241-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb241-17"><a href="#cb241-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NiN_mainType =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(NiN_mainType, km2)) <span class="sc">%&gt;%</span></span>
<span id="cb241-18"><a href="#cb241-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> NiN_mainType,</span>
<span id="cb241-19"><a href="#cb241-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> km2,</span>
<span id="cb241-20"><a href="#cb241-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> NiN_mainTypeCoverage))<span class="sc">+</span></span>
<span id="cb241-21"><a href="#cb241-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb241-22"><a href="#cb241-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="st">&quot;grey40&quot;</span>,</span>
<span id="cb241-23"><a href="#cb241-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">position =</span> <span class="st">&quot;stack&quot;</span>)<span class="sc">+</span></span>
<span id="cb241-24"><a href="#cb241-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> mySize)<span class="sc">+</span></span>
<span id="cb241-25"><a href="#cb241-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb241-26"><a href="#cb241-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;NiN main type&quot;</span>,</span>
<span id="cb241-27"><a href="#cb241-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(km<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb241-28"><a href="#cb241-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Spatial coverage&quot;</span>)<span class="sc">+</span></span>
<span id="cb241-29"><a href="#cb241-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>)<span class="sc">+</span></span>
<span id="cb241-30"><a href="#cb241-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Ecosystem),</span>
<span id="cb241-31"><a href="#cb241-31" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb241-32"><a href="#cb241-32" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">label_wrap_gen</span>(<span class="at">width=</span><span class="dv">25</span>))</span></code></pre></div>
<div class="figure">
<img src="naturtype_files/figure-html/unnamed-chunk-73-1.png" alt="The areas mapped for each NiN main type, and the degree of spatial representativity (or coverage) of the mapping units (nature types). V6 Våtsnøleie og snøleiekilde is not included." width="672" />
<p class="caption">
(#fig:unnamed-chunk-73)The areas mapped for each NiN main type, and the degree of spatial representativity (or coverage) of the mapping units (nature types). V6 Våtsnøleie og snøleiekilde is not included.
</p>
</div>
</div>
<div id="number-of-localities-per-nin-main-type" class="section level3" number="5.11.3">
<h3><span class="header-section-number">5.11.3</span> Number of localities per NiN main type</h3>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a>mySize <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>ntyp_fill2 <span class="sc">%&gt;%</span></span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># combining two classes to get a better colour palette</span></span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NiN_mainTypeCoverage =</span> </span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">replace</span>(NiN_mainTypeCoverage, NiN_mainTypeCoverage <span class="sc">==</span> <span class="st">&quot;southern&quot;</span>, <span class="st">&quot;partial&quot;</span>),</span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">NiN_mainTypeCoverage =</span> </span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">replace</span>(NiN_mainTypeCoverage, NiN_mainTypeCoverage <span class="sc">==</span> <span class="st">&quot;calcareous and dry&quot;</span>, <span class="st">&quot;calcareous&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb242-8"><a href="#cb242-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb242-9"><a href="#cb242-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(NiN_mainType, NiN_mainTypeCoverage) <span class="sc">%&gt;%</span></span>
<span id="cb242-10"><a href="#cb242-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">count =</span> <span class="fu">sum</span>(numberOfLocalities)) <span class="sc">%&gt;%</span></span>
<span id="cb242-11"><a href="#cb242-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>()<span class="sc">%&gt;%</span></span>
<span id="cb242-12"><a href="#cb242-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Ecosystem,</span>
<span id="cb242-13"><a href="#cb242-13" aria-hidden="true" tabindex="-1"></a>         NiN_mainType,</span>
<span id="cb242-14"><a href="#cb242-14" aria-hidden="true" tabindex="-1"></a>         NiN_mainTypeCoverage,</span>
<span id="cb242-15"><a href="#cb242-15" aria-hidden="true" tabindex="-1"></a>         count)<span class="sc">%&gt;%</span></span>
<span id="cb242-16"><a href="#cb242-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb242-17"><a href="#cb242-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">count =</span> <span class="fu">replace_na</span>(count, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb242-18"><a href="#cb242-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NiN_mainType =</span> <span class="fu">fct_reorder</span>(NiN_mainType, count)) <span class="sc">%&gt;%</span></span>
<span id="cb242-19"><a href="#cb242-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> NiN_mainType,</span>
<span id="cb242-20"><a href="#cb242-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> count,</span>
<span id="cb242-21"><a href="#cb242-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> NiN_mainTypeCoverage))<span class="sc">+</span></span>
<span id="cb242-22"><a href="#cb242-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb242-23"><a href="#cb242-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="st">&quot;grey40&quot;</span>,</span>
<span id="cb242-24"><a href="#cb242-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">position =</span> <span class="st">&quot;stack&quot;</span>)<span class="sc">+</span></span>
<span id="cb242-25"><a href="#cb242-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> mySize)<span class="sc">+</span></span>
<span id="cb242-26"><a href="#cb242-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb242-27"><a href="#cb242-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;NiN main type&quot;</span>,</span>
<span id="cb242-28"><a href="#cb242-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of localities&quot;</span>,</span>
<span id="cb242-29"><a href="#cb242-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Spatial coverage&quot;</span>)<span class="sc">+</span></span>
<span id="cb242-30"><a href="#cb242-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>)<span class="sc">+</span></span>
<span id="cb242-31"><a href="#cb242-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Ecosystem),</span>
<span id="cb242-32"><a href="#cb242-32" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb242-33"><a href="#cb242-33" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">label_wrap_gen</span>(<span class="at">width=</span><span class="dv">25</span>))</span></code></pre></div>
<div class="figure">
<img src="naturtype_files/figure-html/unnamed-chunk-74-1.png" alt="The number of localities mapped for each NiN main type, and the degree of spatial representativity (or coverage) of the mapping units (nature types). V6 Våtsnøleie og snøleiekilde is not included. NiN main types are arranged rougly by decreasing order, except for types that are not mapped at all, which are arranged on top." width="672" />
<p class="caption">
(#fig:unnamed-chunk-74)The number of localities mapped for each NiN main type, and the degree of spatial representativity (or coverage) of the mapping units (nature types). V6 Våtsnøleie og snøleiekilde is not included. NiN main types are arranged rougly by decreasing order, except for types that are not mapped at all, which are arranged on top.
</p>
</div>
<p>From the figure above I take that <em>Naturlig åpne områder</em> is very poorly represented in general as there are many NiN main types that are completely missing from the data set. The three most common types by area, however, have complete thematic coverage (if excluding the year 2018 and including all sub-types). I will need to investigate especially if there are some NiN variables for the nature types mapping T18 Åpen flomfastmark, T12 Strandeng and T21 Sanddynemark which we can use.</p>
<p>For <em>Semi-naturlig mark</em> we have quite good thematic coverage for the three main types (by area). The other three types probably makes up a considerably smaller area, but note that T33 has some coverage, and is classes as <em>all (-2018)</em>. Of the three main ecosystems, semi-naturlig mark dominates clearly in terms of area and in terms of number of localities.</p>
<p>For <em>Våtmark</em> we have good thematic coverage for V3 nedbørsmyr and <em>V9 semi-naturlig myr</em>, but for <em>V1 åpen jordvassmyr</em> only calcareous localities are mapped and assessed. A question is then whether, for a given NiN variable, that calcareous localities can be representative for all mires (poor and rich) or if this will introduce too much bias in one way or another. Another important bias for this main ecosystem is related to the lower size limit for mapping units (MMU), which is quite big for V3. We need to think about whether small bogs are more or less prone to different pressures compared to big bogs.</p>
</div>
<div id="commonness-of-nin-variables" class="section level3" number="5.11.4">
<h3><span class="header-section-number">5.11.4</span> Commonness of NiN variables</h3>
<p>I want to see how common the different NiN variables are, and if we can use this to select core variables <span class="math inline">\(_kjernevariabler_\)</span>.</p>
<p>First I will get the total area mapped per main ecosystem</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>areaSum <span class="ot">&lt;-</span> ntyp_fill2 <span class="sc">%&gt;%</span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Ecosystem) <span class="sc">%&gt;%</span></span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">km2 =</span> <span class="fu">sum</span>(km2)) <span class="sc">%&gt;%</span></span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">add_column</span>(<span class="at">.before=</span><span class="dv">1</span>,</span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">NiN_code =</span> <span class="fu">rep</span>(<span class="st">&quot;Combined&quot;</span>, <span class="dv">3</span>))</span></code></pre></div>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a>ntyp_fill2 <span class="sc">%&gt;%</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">unique</span>(ntyp_vars<span class="sc">$</span>NiN_variable_code)) <span class="sc">%&gt;%</span></span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(value) <span class="sc">%&gt;%</span></span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">NiN_code =</span> name,</span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">useFrequency =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(useFrequency <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb244-7"><a href="#cb244-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(NiN_code, Ecosystem, NiN_mainType) <span class="sc">%&gt;%</span>  <span class="co"># NiN main type could be replaced with Nature_type</span></span>
<span id="cb244-8"><a href="#cb244-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">km2 =</span> <span class="fu">sum</span>(km2)) <span class="sc">%&gt;%</span></span>
<span id="cb244-9"><a href="#cb244-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb244-10"><a href="#cb244-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create a truncated fill variable </span></span>
<span id="cb244-11"><a href="#cb244-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Ecosystem) <span class="sc">%&gt;%</span></span>
<span id="cb244-12"><a href="#cb244-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">myFill =</span> <span class="fu">fct_lump</span>(NiN_mainType, <span class="dv">3</span>, <span class="at">w =</span> km2)) <span class="sc">%&gt;%</span></span>
<span id="cb244-13"><a href="#cb244-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb244-14"><a href="#cb244-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># qick fix to sort variable across facets (dont work after adding &#39;Nature_type&#39; in the first group_by)</span></span>
<span id="cb244-15"><a href="#cb244-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(lab = paste(NiN_code, substr(Ecosystem, start = 1, stop = 1), sep = &quot; &quot;)) %&gt;%</span></span>
<span id="cb244-16"><a href="#cb244-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ungroup()%&gt;%</span></span>
<span id="cb244-17"><a href="#cb244-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(lab = forcats::fct_reorder(lab, km2)) %&gt;%</span></span>
<span id="cb244-18"><a href="#cb244-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb244-19"><a href="#cb244-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb244-20"><a href="#cb244-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb244-21"><a href="#cb244-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> NiN_code,</span>
<span id="cb244-22"><a href="#cb244-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">y =</span> km2,</span>
<span id="cb244-23"><a href="#cb244-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> myFill</span>
<span id="cb244-24"><a href="#cb244-24" aria-hidden="true" tabindex="-1"></a>                ))<span class="sc">+</span></span>
<span id="cb244-25"><a href="#cb244-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb244-26"><a href="#cb244-26" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour =</span> <span class="st">&quot;grey40&quot;</span>,</span>
<span id="cb244-27"><a href="#cb244-27" aria-hidden="true" tabindex="-1"></a>           <span class="co">#fill = &quot;grey80&quot;,</span></span>
<span id="cb244-28"><a href="#cb244-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">position =</span> <span class="st">&quot;stack&quot;</span>)<span class="sc">+</span></span>
<span id="cb244-29"><a href="#cb244-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">data =</span> areaSum,</span>
<span id="cb244-30"><a href="#cb244-30" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">yintercept =</span> km2),</span>
<span id="cb244-31"><a href="#cb244-31" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb244-32"><a href="#cb244-32" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb244-33"><a href="#cb244-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Ecosystem),</span>
<span id="cb244-34"><a href="#cb244-34" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb244-35"><a href="#cb244-35" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">label_wrap_gen</span>(<span class="at">width=</span><span class="dv">25</span>))<span class="sc">+</span></span>
<span id="cb244-36"><a href="#cb244-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb244-37"><a href="#cb244-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(km<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb244-38"><a href="#cb244-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;&quot;</span>)<span class="sc">+</span></span>
<span id="cb244-39"><a href="#cb244-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb244-40"><a href="#cb244-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>)<span class="sc">+</span></span>
<span id="cb244-41"><a href="#cb244-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> mySize)</span>
<span id="cb244-42"><a href="#cb244-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `summarise()` has grouped output by &#39;NiN_code&#39;,</span></span>
<span id="cb244-43"><a href="#cb244-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &#39;Ecosystem&#39;. You can override using the `.groups` argument.</span></span>
<span id="cb244-44"><a href="#cb244-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in RColorBrewer::brewer.pal(n, pal): n too large, allowed maximum for palette Set1 is 9</span></span>
<span id="cb244-45"><a href="#cb244-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Returning the palette you asked for with that many colors</span></span></code></pre></div>
<div class="figure">
<img src="naturtype_files/figure-html/unnamed-chunk-76-1.png" alt="Barplot showing the proportion area for which each NiN variable is recorded. The total mapped area for each main ecosystem (the facets) is shown as a dashed red line. The three most dominant NiN main types for each ecosystem is given a uniqe colour, and all the remaining are grouped as 'other'." width="672" />
<p class="caption">
(#fig:unnamed-chunk-76)Barplot showing the proportion area for which each NiN variable is recorded. The total mapped area for each main ecosystem (the facets) is shown as a dashed red line. The three most dominant NiN main types for each ecosystem is given a uniqe colour, and all the remaining are grouped as ‘other’.
</p>
</div>
<p>This figure, in combination with the above, points to he most obvious NiN variable candidates.</p>
<p>7SE and 7TK are good candidates for <em>Naturlig åpne områder</em>. 7JA-BT is probably more appropriately classed as a pressure indicator. Same with 7VR-RI with is recorded for all T18 localities.</p>
<p>The same two variables (7SE and 7TK) are the best candidates also for <em>Semi-natural areas</em>. 7JB-BT is a pressure variable (<em>beitetrykk</em>). 7RA-SJ/BH are related to <em>gjengoing</em> which will be covered by another indicator informed from remote sensing (LiDAR), and we therefor don’t need to describe this with a field-based indicator as well.</p>
<p>For <em>Våtmark</em>, 7GR-Gi is the most common variables, but this is a pressure variable (<em>grøfting</em>). But, perhaps it could be used as a surrogate indicator. I think this is justifiable, especially since the relationship between the pressure (grøfting) and the condition (hydrology) is so well known. 7SE+PRSL and 7TK+PRTK are other good candidates. PRTO is only relevant for V3, but covers a relatively large area. It is, however,, more like a pressure indicator.</p>
</div>
</div>
<div id="tables" class="section level2" number="5.12">
<h2><span class="header-section-number">5.12</span> Tables</h2>
<p>Here are some output tables with the numbers underlying the above figures.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(ntyp_fill2,</span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a>              <span class="co">#extensions = &quot;FixedColumns&quot;,</span></span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">scrollX =</span> T,</span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">scrollY=</span>T,</span>
<span id="cb245-6"><a href="#cb245-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">10</span>))</span></code></pre></div>
<div class="figure">
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-d95bc31c4057dbb72f6b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d95bc31c4057dbb72f6b">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54"],["Slåttemyr","Hagemark","Naturbeitemark","Semi-naturlig eng","Eng-aktig sterkt endret fastmark","Sørlig kaldkilde","Åpen flomfastmark","Høgereligende og nordlig nedbørsmyr","Øyblandingsmyr","Strandeng","Nakent tørkeutsatt kalkberg","Kystlynghei","Sørlig slåttemyr","Konsentrisk høymyr","Boreal hei","Semi-naturlig våteng","Slåttemark","Sanddynemark","Semi-naturlig strandeng","Rik åpen jordvannsmyr i mellomboreal sone","Sørlig nedbørsmyr","Atlantisk høymyr","Terrengdekkende myr","Åpen grunnlendt kalkrik mark i boreonemoral sone","Rik åpen sørlig jordvannsmyr","Aktiv skredmark","Semi-naturlig myr","Silt og leirskred","Eksentrisk høymyr","Øvre sandstrand uten pionervegetasjon","Kalkrik helofyttsump","Fuglefjell-eng og fugletopp","Isinnfrysingsmark","Åpen grunnlendt kalkrik mark i sørboreal sone","Sørlig etablert sanddynemark","Rik åpen jordvannsmyr i nordboreal og lavalpin sone","Fossepåvirket berg","Fosse-eng","Svært tørkeutsatt sørlig kalkberg","Lauveng","Kanthøymyr","Platåhøymyr","Palsmyr","Fosseberg",null,null,null,null,null,null,null,null,null,null],["2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2018, 2019, 2020, 2021, 2022","2019, 2020, 2021","2018, 2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2019, 2020, 2022","2019, 2020, 2021, 2022","2019, 2020, 2022","2019, 2020, 2021, 2022","2019, 2020, 2021, 2022","2021, 2022","2021, 2022",null,null,null,null,null,null,null,null,null,null],["våtmark","semi-naturligMark","semi-naturligMark","semi-naturligMark","semi-naturligMark","våtmark","naturligÅpneOmråderUnderSkoggrensa","våtmark","våtmark","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","semi-naturligMark","våtmark","våtmark","semi-naturligMark","våtmark","semi-naturligMark","naturligÅpneOmråderUnderSkoggrensa","semi-naturligMark","våtmark","våtmark","våtmark","våtmark","naturligÅpneOmråderUnderSkoggrensa","våtmark","naturligÅpneOmråderUnderSkoggrensa","våtmark","naturligÅpneOmråderUnderSkoggrensa","våtmark","naturligÅpneOmråderUnderSkoggrensa","våtmark","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","våtmark","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","semi-naturligMark","våtmark","våtmark","våtmark","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","semi-naturligMark"],["V9","T32","T32","T32","T41","V4","T18","V3","V1","T12","T1","T34","V9","V3","T31","V10","T32","T21","T33","V1","V3","V3","V3","T2","V1","T17","V9","T17","V3","T29","L4","T8","T20","T2","T21","V1","T1","T15","T1","T32","V3","V3","V3","T1","T6","T11","T13","T16","T23","T24","T25","T26","T27","T40"],["all (if including sub-types)","all (if including sub-types)","all (if including sub-types)","all (if including sub-types)","all","southern","all","all (if including sub-types)","partial","all (-2018)","calcareous and dry","all","all (if including sub-types)","all (if including sub-types)","all","all (-2018)","all (if including sub-types)","all (if including sub-types)","all (-2018)","calcareous","all (if including sub-types)","all (if including sub-types)","all (if including sub-types)","calcareous","calcareous","all (if including sub-types)","all (if including sub-types)","all (if including sub-types)","all (if including sub-types)","sandy and vegetated","calcareous","all","all","calcareous","all (if including sub-types)","calcareous","extra wet","all","calcareous and dry","all (if including sub-types)","all (if including sub-types)","all (if including sub-types)","all (if including sub-types)","extra wet","Not mapped","Not mapped","Not mapped","Not mapped","Not mapped","Not mapped","Not mapped","Not mapped","Not mapped","Not mapped"],[null,16.9,0,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,8.7,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,82.9,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,100,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[100,null,null,null,null,null,null,null,null,null,null,null,100,null,null,null,null,null,null,null,null,null,null,null,null,null,100,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[100,null,null,null,null,null,null,null,null,null,null,null,100,null,null,null,null,null,null,null,null,null,null,99.6,null,null,100,null,null,null,100,null,null,100,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,16.9,0,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[57.6,null,null,null,null,null,null,null,null,null,null,null,39.6,null,null,null,null,null,null,null,null,null,null,null,null,null,44.4,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[5.5,99.9,99.9,99.9,100,null,70.7,null,null,99.9,100,99.9,null,null,100,99.8,99.8,100,99.1,100,null,null,null,99.8,100,null,null,null,null,100,100,null,null,100,100,100,null,null,100,100,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[99.6,null,null,null,null,98.5,null,99.8,100,null,null,null,100,100,null,null,null,null,null,100,100,100,100,null,100,null,100,null,100,null,100,null,null,null,null,null,null,null,null,null,100,100,100,null,null,null,null,null,null,null,null,null,null,null],[null,100,100,99.9,99.9,null,null,null,null,1.9,null,null,null,null,null,100,99.9,null,98.9,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,100,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,88.2,null,null,null,null,100,null,null,100,null,null,99.2,null,null,null,null,null,null,null,null,null,null,null,100,null,100,null,null,100,null,null,100,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,99.8,99.7,99.4,99.4,null,null,null,null,null,null,null,null,null,null,99.7,98.8,99.2,null,null,null,null,null,null,null,null,null,null,null,100,null,null,null,null,100,null,null,null,null,100,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,0,null,null,100,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,99.9,100,99.9,99.4,null,null,null,null,1.4,null,100,null,null,null,100,99.9,null,98.8,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,100,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[5.5,null,null,null,99.6,9.1,88.4,99.8,100,99.9,100,41.5,null,100,23.6,null,null,100,13.6,100,100,100,100,99.6,100,null,null,null,100,100,null,100,93.3,100,100,100,100,100,100,null,100,100,100,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[99.9,null,null,null,null,null,88.3,null,null,99.9,100,58,100,null,76.3,null,null,100,null,null,null,null,null,99.6,100,100,100,100,null,100,100,null,93.3,100,100,100,null,100,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,93.8,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,100,100,null,null,null,null,null,100,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,100,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[94.5,null,null,null,null,90.9,null,null,null,null,null,null,100,null,null,null,null,null,85.6,null,null,null,null,null,null,null,100,null,null,null,100,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,99.8,100,null,null,null,null,100,null,null,null,null,null,100,100,100,100,null,null,null,null,null,100,null,null,null,null,null,null,null,null,null,null,null,100,100,100,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,99.8,null,null,null,null,null,100,null,null,null,null,null,null,100,100,100,null,null,null,null,null,100,null,null,null,null,null,null,null,null,null,null,null,100,100,null,null,null,null,null,null,null,null,null,null,null,null],[10.8599681769678,17.2892756436555,125.395454959427,29.5273133834903,1.30060426791085,0.054693214794524,11.2210640471648,17.0161039645494,4.47342889033033,5.31240419413453,0.153160113321643,530.333666293998,0.859130020342248,0.409299904933389,368.076228072285,5.70309815289171,8.08730162096645,2.12492117847008,3.74860715696163,9.30242158937103,15.8891449971379,3.71004777569769,21.1853317928982,0.711262375853877,0.232630287231787,0.429869567548852,8.82716234570841,0.0281316995894742,5.54454125198943,0.173325803167218,2.12141082941421,0.256328309129139,0.0229694300823598,0.156271240033641,0.391864908667946,0.00540369751175468,0.0691880614123939,0.00615737757466229,0.105362181789421,0.0291096401727506,0.396661041366587,3.97834096015764,1.31405172299685,0.00941745752789786,0,0,0,0,0,0,0,0,0,0],[750,2057,11548,4051,684,132,1777,518,213,1812,50,8110,134,13,6719,1134,1869,364,1092,1169,953,92,451,469,60,172,792,49,117,25,302,21,15,124,73,3,32,5,91,12,32,88,39,14,null,null,null,null,null,null,null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Nature_type<\/th>\n      <th>Year<\/th>\n      <th>Ecosystem<\/th>\n      <th>NiN_mainType<\/th>\n      <th>NiN_mainTypeCoverage<\/th>\n      <th>1AG-A-0<\/th>\n      <th>1AG-A-E<\/th>\n      <th>1AG-A-G<\/th>\n      <th>1AG-B<\/th>\n      <th>1AG-C<\/th>\n      <th>1AR-A-E<\/th>\n      <th>1AR-C-L<\/th>\n      <th>4TS-TS<\/th>\n      <th>7FA<\/th>\n      <th>7GR-GI<\/th>\n      <th>7JB-BA<\/th>\n      <th>7JB-BT<\/th>\n      <th>7JB-GJ<\/th>\n      <th>7RA-BH<\/th>\n      <th>7RA-SJ<\/th>\n      <th>7SE<\/th>\n      <th>7SN-BE<\/th>\n      <th>7TK<\/th>\n      <th>7VR-RE<\/th>\n      <th>7VR-RI<\/th>\n      <th>PRHT<\/th>\n      <th>PRSL<\/th>\n      <th>PRTK<\/th>\n      <th>PRTO<\/th>\n      <th>km2<\/th>\n      <th>numberOfLocalities<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"scrollY":true,"pageLength":10,"columnDefs":[{"className":"dt-right","targets":[6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
(#fig:unnamed-chunk-77)List of 45 nature types additionam data, including the proportion of localities for which there is data for each of the NiN variables.
</p>
</div>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>  ntyp_fill2 <span class="sc">%&gt;%</span></span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">unique</span>(ntyp_vars<span class="sc">$</span>NiN_variable_code)) <span class="sc">%&gt;%</span></span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(value) <span class="sc">%&gt;%</span></span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">NiN_code =</span> name,</span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">useFrequency =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(useFrequency <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(NiN_code, Ecosystem, NiN_mainType) <span class="sc">%&gt;%</span>  <span class="co"># NiN main type could be replaced with Nature_type</span></span>
<span id="cb246-9"><a href="#cb246-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">km2 =</span> <span class="fu">sum</span>(km2)),</span>
<span id="cb246-10"><a href="#cb246-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb246-11"><a href="#cb246-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">scrollX =</span> T,</span>
<span id="cb246-12"><a href="#cb246-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">scrollY=</span>T,</span>
<span id="cb246-13"><a href="#cb246-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">10</span>))</span>
<span id="cb246-14"><a href="#cb246-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `summarise()` has grouped output by &#39;NiN_code&#39;,</span></span>
<span id="cb246-15"><a href="#cb246-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &#39;Ecosystem&#39;. You can override using the `.groups` argument.</span></span></code></pre></div>
<div class="figure">
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-5014a842f06a923436b0" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5014a842f06a923436b0">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95"],["1AG-A-0","1AG-A-0","1AG-A-E","1AG-A-G","1AG-B","1AG-B","1AG-B","1AG-C","1AR-C-L","7FA","7FA","7FA","7FA","7FA","7FA","7FA","7FA","7FA","7FA","7FA","7FA","7FA","7FA","7FA","7GR-GI","7GR-GI","7GR-GI","7GR-GI","7GR-GI","7JB-BA","7JB-BA","7JB-BA","7JB-BA","7JB-BA","7JB-BT","7JB-BT","7JB-BT","7JB-BT","7JB-BT","7JB-BT","7JB-BT","7JB-GJ","7JB-GJ","7JB-GJ","7JB-GJ","7JB-GJ","7RA-BH","7RA-SJ","7RA-SJ","7RA-SJ","7RA-SJ","7RA-SJ","7RA-SJ","7SE","7SE","7SE","7SE","7SE","7SE","7SE","7SE","7SE","7SE","7SE","7SE","7SE","7SE","7SE","7SE","7SE","7TK","7TK","7TK","7TK","7TK","7TK","7TK","7TK","7TK","7TK","7TK","7TK","7TK","7TK","7VR-RI","7VR-RI","7VR-RI","PRHT","PRSL","PRSL","PRSL","PRSL","PRTK","PRTK","PRTO"],["naturligÅpneOmråderUnderSkoggrensa","semi-naturligMark","semi-naturligMark","våtmark","naturligÅpneOmråderUnderSkoggrensa","våtmark","våtmark","semi-naturligMark","våtmark","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","semi-naturligMark","semi-naturligMark","semi-naturligMark","semi-naturligMark","semi-naturligMark","våtmark","våtmark","våtmark","våtmark","våtmark","våtmark","våtmark","våtmark","våtmark","naturligÅpneOmråderUnderSkoggrensa","semi-naturligMark","semi-naturligMark","semi-naturligMark","våtmark","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","semi-naturligMark","semi-naturligMark","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","semi-naturligMark","semi-naturligMark","våtmark","semi-naturligMark","naturligÅpneOmråderUnderSkoggrensa","semi-naturligMark","semi-naturligMark","semi-naturligMark","semi-naturligMark","våtmark","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","semi-naturligMark","semi-naturligMark","semi-naturligMark","semi-naturligMark","våtmark","våtmark","våtmark","våtmark","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","semi-naturligMark","semi-naturligMark","våtmark","våtmark","våtmark","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","naturligÅpneOmråderUnderSkoggrensa","semi-naturligMark","semi-naturligMark","våtmark","våtmark","våtmark","våtmark","våtmark","våtmark"],["T2","T32","T32","V9","T2","L4","V9","T32","V9","T1","T12","T18","T2","T21","T29","T31","T32","T33","T34","T41","L4","V1","V10","V9","L4","V1","V3","V4","V9","T12","T32","T33","T41","V10","T15","T18","T21","T29","T8","T31","T34","T21","T29","T32","T41","V10","T31","T12","T32","T33","T34","T41","V10","T1","T12","T15","T18","T2","T20","T21","T29","T8","T31","T33","T34","T41","V1","V3","V4","V9","T1","T12","T15","T17","T18","T2","T20","T21","T29","T31","T34","L4","V1","V9","T1","T15","T18","T32","T33","L4","V4","V9","V1","V3","V3"],[0.711262375853877,17.2892756436555,17.3183852838282,20.5462605430184,0.867533615887518,2.12141082941421,20.5462605430184,17.2892756436555,20.5462605430184,0.258522295111064,5.31240419413453,11.2210640471648,0.867533615887518,2.51678608713803,0.173325803167218,368.076228072285,180.328455247712,3.74860715696163,530.333666293998,1.30060426791085,2.12141082941421,9.54045557411458,5.70309815289171,10.8599681769678,2.12141082941421,14.0084807669331,69.4435234117271,0.054693214794524,20.5462605430184,5.31240419413453,180.328455247712,3.74860715696163,1.30060426791085,5.70309815289171,0.00615737757466229,11.2210640471648,2.51678608713803,0.173325803167218,0.256328309129139,368.076228072285,530.333666293998,2.51678608713803,0.173325803167218,180.328455247712,1.30060426791085,5.70309815289171,368.076228072285,5.31240419413453,180.328455247712,3.74860715696163,530.333666293998,1.30060426791085,5.70309815289171,0.327710356523457,5.31240419413453,0.00615737757466229,11.2210640471648,0.867533615887518,0.0229694300823598,2.51678608713803,0.173325803167218,0.256328309129139,368.076228072285,3.74860715696163,530.333666293998,1.30060426791085,14.0138844644449,69.4435234117271,0.054693214794524,10.8599681769678,0.153160113321643,5.31240419413453,0.00615737757466229,0.458001267138326,11.2210640471648,0.867533615887518,0.0229694300823598,2.51678608713803,0.173325803167218,368.076228072285,530.333666293998,2.12141082941421,0.238033984743542,20.5462605430184,0.0786055189402917,0.00615737757466229,11.2210640471648,0.0291096401727506,3.74860715696163,2.12141082941421,0.054693214794524,20.5462605430184,13.7758504797014,69.4435234117271,68.1294716887303]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>NiN_code<\/th>\n      <th>Ecosystem<\/th>\n      <th>NiN_mainType<\/th>\n      <th>km2<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"scrollY":true,"pageLength":10,"columnDefs":[{"className":"dt-right","targets":4},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
(#fig:unnamed-chunk-78)List of unique combinatios of NiN variable codes and naturetypes with the summed area for which we have this data.
</p>
</div>
</div>
<div id="exp-natureType-summary" class="section level2" number="5.13">
<h2><span class="header-section-number">5.13</span> Export data</h2>
<p>Exporting the table with the summary statistics and other information that I compiled for each nature type in the three main ecosystems. This can be merged with the main data set in order to subset according to a specific research question.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(ntyp_fill2, <span class="st">&quot;data/naturetypes/natureType_summary.rds&quot;</span>)</span></code></pre></div>
<p>Note also that the main data set still contains some localities where there is a mis-match between the nature type definition and the NiN mapping uits recorded in the field. Each researcher should decide to include or exclude these.</p>
<p>The main data set also includes mosaic localities, that are less suitable to use as ground truth data for remote sensing methods.</p>
</div>
<div id="appendix-1" class="section level2" number="5.14">
<h2><span class="header-section-number">5.14</span> Appendix 1</h2>
<p>Here is a deeper look into the causes for why some localities are recorded with seemingly erroneous NiN mapping units (and hence NiN main types)</p>
<p>Lets have a look at how the NiN main types (recorded in the field) cover the different <em>hovedøkosystem</em> when we exclude <em>Hule eiker</em> and all localities that have more than one NiN main type.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a>dat_red <span class="ot">&lt;-</span> dat_melt[dat_melt<span class="sc">$</span>n_ninKartleggingsenheter<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> </span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>                      dat_melt<span class="sc">$</span>naturtype <span class="sc">!=</span> <span class="st">&quot;Hule eiker&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>                      dat_melt<span class="sc">$</span>mosaikk <span class="sc">==</span> <span class="st">&quot;nei&quot;</span>,]</span></code></pre></div>
<p>Let’s focus in on our three targeted ecosystems.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a>dat_red_tally <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">aggregate</span>(<span class="at">data =</span> dat_red,</span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a>                                  area<span class="sc">~</span>hovedøkosystem<span class="sc">+</span>ninKartleggingsenheter3, <span class="at">FUN =</span> length)</span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(dat_red_tally)[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">&quot;count&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat_red_tally[dat_red_tally<span class="sc">$</span>hovedøkosystem <span class="sc">%in%</span> target,],</span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> ninKartleggingsenheter3,</span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> count))<span class="sc">+</span></span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill=</span><span class="st">&quot;grey&quot;</span>,</span>
<span id="cb250-6"><a href="#cb250-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb250-7"><a href="#cb250-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb250-8"><a href="#cb250-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb250-9"><a href="#cb250-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb250-10"><a href="#cb250-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Number of localities&quot;</span>,</span>
<span id="cb250-11"><a href="#cb250-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;NiN main types&quot;</span>)<span class="sc">+</span></span>
<span id="cb250-12"><a href="#cb250-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">position =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb250-13"><a href="#cb250-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult=</span><span class="fu">c</span>(.<span class="dv">0</span>,.<span class="dv">3</span>)))<span class="sc">+</span></span>
<span id="cb250-14"><a href="#cb250-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>count), <span class="at">hjust=</span><span class="sc">-</span><span class="fl">0.25</span>)<span class="sc">+</span></span>
<span id="cb250-15"><a href="#cb250-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="st">&quot;hovedøkosystem&quot;</span>,</span>
<span id="cb250-16"><a href="#cb250-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>,</span>
<span id="cb250-17"><a href="#cb250-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">3</span>)</span></code></pre></div>
<div class="figure">
<img src="naturtype_files/figure-html/unnamed-chunk-82-1.png" alt="Number of localities for each combination of main ecosystem and NiN main type" width="672" />
<p class="caption">
(#fig:unnamed-chunk-82)Number of localities for each combination of main ecosystem and NiN main type
</p>
</div>
<p>Still some weird cases which I will look at in turn below, trying to understand how they came to be recorded in this way.</p>
<div id="naturligåpneområderunderskoggrensa" class="section level4" number="5.14.0.1">
<h4><span class="header-section-number">5.14.0.1</span> naturligÅpneOmråderUnderSkoggrensa</h4>
<p>Listing the NiN main types recorded for nature types belonging to <em>naturligÅpneOmråderUnderSkoggrensa</em>, but which clearly don’t belong there:</p>
<ul>
<li>V10 (semi-naturlig våteng)
<ul>
<li>One case of Åpen flomfastmark wrongly associated with V10 whan it should be T18.</li>
</ul></li>
<li>T33 (Semi naturlig strandeng)
<ul>
<li>These are cases where either the <code>naturtype</code> should have been <code>semi-naturlig strandeng</code> (and hence the hovedøkosystem would be Semi-nat), or the <code>naturtype</code> is correctly recorded as <code>Strandeng</code> but then the NiN type should be <code>T12</code>.</li>
</ul></li>
<li>T32 (Semi-naturlig eng)
<ul>
<li>Obvious error</li>
</ul></li>
<li>T30 (Flomskogsmark)
<ul>
<li>Obvious error</li>
</ul></li>
</ul>
<p>Listing the remaining NiN main types:
* T8 (fulglefjelleng og fugltopp)
* T6 (Standberg)
* T29 (Grus og steindominert strand og strandlinje)
* T21 (Sanddynemark)
* T20 (Isinnfrysingsmark)
* T2 (Åpen grunlendt mark)
* T18 (Åpne flomfastmark)
* T17 (Aktiv skredmark)
* T15 (Fosse-eng)
* T13 (Rasmark)
* T12 (Strandeng)
* T1 (Nakent berg)</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%!in%</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">Negate</span>(<span class="st">`</span><span class="at">%in%</span><span class="st">`</span>)</span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>dat_red2 <span class="ot">&lt;-</span> dat_red[</span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>  dat_red<span class="sc">$</span>hovedøkosystem<span class="sc">!=</span><span class="st">&quot;naturligÅpneOmråderUnderSkoggrensa&quot;</span> <span class="sc">|</span></span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a>  dat_red<span class="sc">$</span>hovedøkosystem<span class="sc">==</span><span class="st">&quot;naturligÅpneOmråderUnderSkoggrensa&quot;</span> <span class="sc">&amp;</span> </span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a>    dat_red<span class="sc">$</span>ninKartleggingsenheter3 <span class="sc">%!in%</span> <span class="fu">c</span>(<span class="st">&quot;T30&quot;</span>, <span class="st">&quot;T32&quot;</span>, <span class="st">&quot;T33&quot;</span>, <span class="st">&quot;V10&quot;</span>),]</span></code></pre></div>
<p>This resulted in deleting 20m localities.</p>
</div>
<div id="semi-naturlig-mark" class="section level4" number="5.14.0.2">
<h4><span class="header-section-number">5.14.0.2</span> Semi-naturlig mark</h4>
<p>Listing the NiN main types recorded for nature types belonging to <em>Semi-naturlig mark</em>, but which clearly don’t belong there:</p>
<ul>
<li>V9 (Semi-naturlig myr)
<ul>
<li>Kystlynghei recorded as mire</li>
</ul></li>
<li>T4 (Fastmarksskogsmark)
<ul>
<li>These should all be T32 (naturbeitemark, lauveng, hagemark, +++)</li>
</ul></li>
<li>T35 (Sterkt endret fastmark med løsmassedekke)
<ul>
<li>Wrong NiN type given to eng-aktig sterkt endret fastmark (it should be T40)</li>
</ul></li>
<li>T3 (Fjellhei, leside og tundra)
<ul>
<li>Boreal hei (should’ve been T31)</li>
</ul></li>
<li>T12 (Strandeng)
<ul>
<li>Should probably have been T33</li>
</ul></li>
<li>T1 (Nakent berg)
<ul>
<li>Obvious mistake</li>
</ul></li>
</ul>
<p>Listing the remaining NiN-main types:
* V10 (semi-nat våteng)
* T41 (Oppdyrket mark med preg av semi-naturlig eng)
* T40 (Sterkt endret fastmark med preg av semi-naturlig eng)
* T31-34</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>dat_red3 <span class="ot">&lt;-</span> dat_red2[</span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a>  dat_red2<span class="sc">$</span>hovedøkosystem<span class="sc">!=</span><span class="st">&quot;semi-naturligMark&quot;</span> <span class="sc">|</span></span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a>  dat_red2<span class="sc">$</span>hovedøkosystem<span class="sc">==</span><span class="st">&quot;semi-naturligMark&quot;</span> <span class="sc">&amp;</span> dat_red2<span class="sc">$</span>ninKartleggingsenheter3 <span class="sc">%!in%</span> <span class="fu">c</span>(<span class="st">&quot;V9&quot;</span>, <span class="st">&quot;T4&quot;</span>, <span class="st">&quot;T35&quot;</span>, <span class="st">&quot;T3&quot;</span>, <span class="st">&quot;T12&quot;</span>, <span class="st">&quot;T1&quot;</span>),]</span></code></pre></div>
<p>This resulted in the deletion of 87 localities.</p>
</div>
<div id="våtmark" class="section level4" number="5.14.0.3">
<h4><span class="header-section-number">5.14.0.3</span> Våtmark</h4>
<p>Listing the NiN main types recorded for nature types belonging to <em>Våtmark</em>, but which clearly don’t belong there.</p>
<p>Våtmark doesn’t distinguish between semi-natural and natural, so all V-types are correct, except the strongly modified V11-V13.</p>
<ul>
<li>V11 (Torvtak)
<ul>
<li>Obvious mistake</li>
</ul></li>
<li>V12 (Grøftet åpne torvmark)
<ul>
<li>Obvious mistake</li>
</ul></li>
<li>V13 (Ny våtmark)
<ul>
<li>Obvious mistake</li>
</ul></li>
<li>T4 (skog)
<ul>
<li>some that should’ve been T2 and some other strange things</li>
</ul></li>
<li>T30-T32
<ul>
<li>Someone switching the semi-natural and natural equivalents</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>dat_red4 <span class="ot">&lt;-</span> dat_red3[</span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>  dat_red3<span class="sc">$</span>hovedøkosystem<span class="sc">!=</span><span class="st">&quot;våtmark&quot;</span> <span class="sc">|</span></span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>  dat_red3<span class="sc">$</span>hovedøkosystem<span class="sc">==</span><span class="st">&quot;våtmark&quot;</span> <span class="sc">&amp;</span> dat_red3<span class="sc">$</span>ninKartleggingsenheter3 <span class="sc">%!in%</span> <span class="fu">c</span>(<span class="st">&quot;T4&quot;</span>, <span class="st">&quot;T30&quot;</span>, <span class="st">&quot;T31&quot;</span>, <span class="st">&quot;T32&quot;</span>, <span class="st">&quot;V11&quot;</span>, <span class="st">&quot;V12&quot;</span>, <span class="st">&quot;V13&quot;</span>),]</span></code></pre></div>
<p>This resulted in the deletion of 33 localities.</p>
<p>In total 140 localities, or 0.2% of localities, have a field-recorded NiN main that don’t match the definition of the nature type. I see this as a symptom of a bigger problem with data validation.</p>
<!--chapter:end:naturtype.Rmd-->
</div>
</div>
</div>
<div id="scaling-functions" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Scaling functions</h1>
<p>Author. Anders L. Kolstad</p>
<p>Date: 2023-03-24</p>
<p><strong>Superseeded :</strong> <em>The functionality explained here is moved over to the <a href="https://github.com/NINAnor/eaTools">eaTools</a> package. Please see the documentation there for updated examples.</em></p>
<p>Indicator for ecological condition may be scaled against a reference value to become normalised and hence comparable. In SEEA EA, un-scaled or raw indicators are not called indicators at all, but simply referred to as variables, and I will use this distinction here. Scaling variables against reference conditions can be done in many ways. Here are some examples, for inspiration.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span></code></pre></div>
<p>Define plotting aesthetics</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a>low <span class="ot">&lt;-</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a>high <span class="ot">&lt;-</span> <span class="st">&quot;green&quot;</span></span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a>ridge <span class="ot">&lt;-</span> <span class="fu">geom_density_ridges_gradient</span>(<span class="at">scale =</span> <span class="dv">3</span>, <span class="at">size =</span> .<span class="dv">3</span>)</span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a>myColour <span class="ot">&lt;-</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a>mySize <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb255-6"><a href="#cb255-6" aria-hidden="true" tabindex="-1"></a>myAlpha <span class="ot">&lt;-</span> .<span class="dv">7</span></span>
<span id="cb255-7"><a href="#cb255-7" aria-hidden="true" tabindex="-1"></a>myShape <span class="ot">&lt;-</span> <span class="dv">21</span></span></code></pre></div>
<p>Create random raw data for two variables</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">variable1 =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="dv">10</span>, <span class="dv">4</span>), </span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">variable2 =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="dv">30</span>, <span class="dv">3</span>))</span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">melt</span>(<span class="fu">setDT</span>(dat))</span>
<span id="cb256-5"><a href="#cb256-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in melt.data.table(setDT(dat)): id.vars and</span></span>
<span id="cb256-6"><a href="#cb256-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; measure.vars are internally guessed when both are &#39;NULL&#39;.</span></span>
<span id="cb256-7"><a href="#cb256-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; All non-numeric/integer/logical type columns are considered</span></span>
<span id="cb256-8"><a href="#cb256-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; id.vars, which in this case are columns []. Consider</span></span>
<span id="cb256-9"><a href="#cb256-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; providing at least one of &#39;id&#39; or &#39;measure&#39; vars in future.</span></span>
<span id="cb256-10"><a href="#cb256-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-11"><a href="#cb256-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(temp,</span>
<span id="cb256-12"><a href="#cb256-12" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> value,</span>
<span id="cb256-13"><a href="#cb256-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> variable,</span>
<span id="cb256-14"><a href="#cb256-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="fu">stat</span>(x)))<span class="sc">+</span></span>
<span id="cb256-15"><a href="#cb256-15" aria-hidden="true" tabindex="-1"></a>  ridge<span class="sc">+</span></span>
<span id="cb256-16"><a href="#cb256-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> low, <span class="at">high =</span> high)</span>
<span id="cb256-17"><a href="#cb256-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: `stat(x)` was deprecated in ggplot2 3.4.0.</span></span>
<span id="cb256-18"><a href="#cb256-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Please use `after_stat(x)` instead.</span></span>
<span id="cb256-19"><a href="#cb256-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; This warning is displayed once every 8 hours.</span></span>
<span id="cb256-20"><a href="#cb256-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Call `lifecycle::last_lifecycle_warnings()` to see where</span></span>
<span id="cb256-21"><a href="#cb256-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this warning was generated.</span></span>
<span id="cb256-22"><a href="#cb256-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Picking joint bandwidth of 1.22</span></span></code></pre></div>
<p><img src="scalingFunctions_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Lets say that the reference condition for <code>variable1</code> to equal 16, and for variable 2 its 35</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>referenceHigh1 <span class="ot">&lt;-</span> <span class="dv">16</span></span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>referenceHigh2 <span class="ot">&lt;-</span> <span class="dv">35</span></span></code></pre></div>
<div id="linear-with-a-natural-zero" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Linear, with a natural zero</h2>
<p>We can scale our variable linearly, saying that all values above 12 represents ‘perfect’ condition. We also assume that the value zero is the worst possible condition for this variable. To do this we divide by the reference value, and truncate values above it.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>indicator1 <span class="ot">&lt;-</span> dat<span class="sc">$</span>variable1<span class="sc">/</span>dat<span class="sc">$</span>referenceHigh1</span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>indicator1[dat<span class="sc">$</span>indicator1<span class="sc">&gt;</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>indicator2 <span class="ot">&lt;-</span> dat<span class="sc">$</span>variable2<span class="sc">/</span>dat<span class="sc">$</span>referenceHigh2</span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>indicator2[dat<span class="sc">$</span>indicator2<span class="sc">&gt;</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span></code></pre></div>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">melt</span>(<span class="fu">setDT</span>(dat),</span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">measure.vars =</span> <span class="fu">c</span>(<span class="st">&quot;indicator1&quot;</span>, <span class="st">&quot;indicator2&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat)<span class="sc">+</span></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> variable1, <span class="at">y =</span> indicator1, <span class="at">fill =</span> indicator1),</span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> myColour,</span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">size   =</span> mySize,</span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha  =</span> myAlpha,</span>
<span id="cb260-7"><a href="#cb260-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape  =</span> myShape)<span class="sc">+</span></span>
<span id="cb260-8"><a href="#cb260-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> dat<span class="sc">$</span>referenceHigh1[<span class="dv">1</span>],</span>
<span id="cb260-9"><a href="#cb260-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb260-10"><a href="#cb260-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb260-11"><a href="#cb260-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb260-12"><a href="#cb260-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> variable2, <span class="at">y =</span> indicator2, <span class="at">fill =</span> indicator2),</span>
<span id="cb260-13"><a href="#cb260-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> myColour,</span>
<span id="cb260-14"><a href="#cb260-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">size   =</span> mySize,</span>
<span id="cb260-15"><a href="#cb260-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha  =</span> myAlpha,</span>
<span id="cb260-16"><a href="#cb260-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape  =</span> myShape)<span class="sc">+</span></span>
<span id="cb260-17"><a href="#cb260-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> dat<span class="sc">$</span>referenceHigh2,</span>
<span id="cb260-18"><a href="#cb260-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb260-19"><a href="#cb260-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb260-20"><a href="#cb260-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Indicator values&quot;</span>)<span class="sc">+</span></span>
<span id="cb260-21"><a href="#cb260-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Variable values&quot;</span>)<span class="sc">+</span></span>
<span id="cb260-22"><a href="#cb260-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb260-23"><a href="#cb260-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="st">&quot;Indicator values&quot;</span>, <span class="at">low =</span> low, <span class="at">high =</span> high)</span>
<span id="cb260-24"><a href="#cb260-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2</span></span>
<span id="cb260-25"><a href="#cb260-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3.4.0.</span></span>
<span id="cb260-26"><a href="#cb260-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Please use `linewidth` instead.</span></span>
<span id="cb260-27"><a href="#cb260-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; This warning is displayed once every 8 hours.</span></span>
<span id="cb260-28"><a href="#cb260-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Call `lifecycle::last_lifecycle_warnings()` to see where</span></span>
<span id="cb260-29"><a href="#cb260-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; this warning was generated.</span></span></code></pre></div>
<p><img src="scalingFunctions_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>To reverse what is good and what is bad condition: change the sign and add one.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat)<span class="sc">+</span></span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> variable1, <span class="at">y =</span> indicator1<span class="sc">*</span>(<span class="sc">-</span><span class="dv">1</span>)<span class="sc">+</span><span class="dv">1</span>, <span class="at">fill =</span> indicator1<span class="sc">*</span>(<span class="sc">-</span><span class="dv">1</span>)<span class="sc">+</span><span class="dv">1</span>),</span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> myColour,</span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">size   =</span> mySize,</span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha  =</span> myAlpha,</span>
<span id="cb261-7"><a href="#cb261-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape  =</span> myShape)<span class="sc">+</span></span>
<span id="cb261-8"><a href="#cb261-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> dat<span class="sc">$</span>referenceHigh1[<span class="dv">1</span>],</span>
<span id="cb261-9"><a href="#cb261-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb261-10"><a href="#cb261-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb261-11"><a href="#cb261-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb261-12"><a href="#cb261-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Indicator values&quot;</span>)<span class="sc">+</span></span>
<span id="cb261-13"><a href="#cb261-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Variable values&quot;</span>)<span class="sc">+</span></span>
<span id="cb261-14"><a href="#cb261-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb261-15"><a href="#cb261-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="st">&quot;Indicator values&quot;</span>, <span class="at">low =</span> low, <span class="at">high =</span> high)</span></code></pre></div>
<p><img src="scalingFunctions_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>The two indicators become more comparable now that they are normalised. At least this is true around the reference value. But perhaps a variable value around 25 for <code>variable2</code> is actually quite bad. In the above example I have assumed that the value zero is the worst possible value, but that may not always be the case.</p>
</div>
<div id="linear-with-defined-lower-limit" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Linear, with defined lower limit</h2>
<p>We can also say that the worst possible condition for these variables is not zero, but for example say that it is 5 for <code>variable1</code> and 28 for <code>variable2</code>.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>referenceLow1 <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>referenceLow2 <span class="ot">&lt;-</span> <span class="dv">28</span></span></code></pre></div>
<p>We can then normalise the data between these two reference values.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>indicator1_LowHigh <span class="ot">&lt;-</span> (dat<span class="sc">$</span>variable1<span class="sc">-</span>dat<span class="sc">$</span>referenceLow1)<span class="sc">/</span>(dat<span class="sc">$</span>referenceHigh1 <span class="sc">-</span> dat<span class="sc">$</span>referenceLow1)</span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>indicator1_LowHigh[dat<span class="sc">$</span>indicator1_LowHigh <span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>indicator1_LowHigh[dat<span class="sc">$</span>indicator1_LowHigh <span class="sc">&gt;</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>indicator2_LowHigh <span class="ot">&lt;-</span> (dat<span class="sc">$</span>variable2<span class="sc">-</span>dat<span class="sc">$</span>referenceLow2)<span class="sc">/</span>(dat<span class="sc">$</span>referenceHigh2 <span class="sc">-</span> dat<span class="sc">$</span>referenceLow2)</span>
<span id="cb263-6"><a href="#cb263-6" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>indicator2_LowHigh[dat<span class="sc">$</span>indicator2_LowHigh <span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb263-7"><a href="#cb263-7" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>indicator2_LowHigh[dat<span class="sc">$</span>indicator2_LowHigh <span class="sc">&gt;</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span></code></pre></div>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat)<span class="sc">+</span></span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> variable1, <span class="at">y =</span> indicator1_LowHigh, <span class="at">fill =</span> indicator1_LowHigh),</span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> myColour,</span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">size   =</span> mySize,</span>
<span id="cb264-6"><a href="#cb264-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha  =</span> myAlpha,</span>
<span id="cb264-7"><a href="#cb264-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape  =</span> myShape)<span class="sc">+</span></span>
<span id="cb264-8"><a href="#cb264-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">16</span>,</span>
<span id="cb264-9"><a href="#cb264-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb264-10"><a href="#cb264-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb264-11"><a href="#cb264-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">5</span>,</span>
<span id="cb264-12"><a href="#cb264-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb264-13"><a href="#cb264-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb264-14"><a href="#cb264-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb264-15"><a href="#cb264-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> variable2, <span class="at">y =</span> indicator2_LowHigh, <span class="at">fill =</span> indicator2_LowHigh),</span>
<span id="cb264-16"><a href="#cb264-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> myColour,</span>
<span id="cb264-17"><a href="#cb264-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">size   =</span> mySize,</span>
<span id="cb264-18"><a href="#cb264-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha  =</span> myAlpha,</span>
<span id="cb264-19"><a href="#cb264-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape  =</span> myShape)<span class="sc">+</span></span>
<span id="cb264-20"><a href="#cb264-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">35</span>,</span>
<span id="cb264-21"><a href="#cb264-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb264-22"><a href="#cb264-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb264-23"><a href="#cb264-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">28</span>,</span>
<span id="cb264-24"><a href="#cb264-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb264-25"><a href="#cb264-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb264-26"><a href="#cb264-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Indicator values&quot;</span>)<span class="sc">+</span></span>
<span id="cb264-27"><a href="#cb264-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Variable values&quot;</span>)<span class="sc">+</span></span>
<span id="cb264-28"><a href="#cb264-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb264-29"><a href="#cb264-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="st">&quot;Indicator values&quot;</span>, <span class="at">low =</span> low, <span class="at">high =</span> high)</span></code></pre></div>
<p><img src="scalingFunctions_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
<div id="break-point-scaling" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Break point scaling</h2>
<p>We can also define a threshold for good ecological condition. Lets for example say that for <code>variable1</code>, ecosystem function really declines when the variable shows values below 9.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>thr1 <span class="ot">&lt;-</span> <span class="dv">9</span></span></code></pre></div>
<p>Then we can normalise again, using what I refer to as break point normalisation. For the maths, see <a href="https://stats.stackexchange.com/questions/281162/scale-a-number-between-a-range">here</a>.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>indicator1_breakPoint <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>variable1 <span class="sc">&lt;</span> dat<span class="sc">$</span>thr1,</span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a>    ((dat<span class="sc">$</span>variable1<span class="sc">-</span>dat<span class="sc">$</span>referenceLow1)<span class="sc">/</span>(dat<span class="sc">$</span>thr1 <span class="sc">-</span> dat<span class="sc">$</span>referenceLow1))<span class="sc">*</span>(<span class="fl">0.6</span><span class="dv">-0</span>)<span class="sc">+</span><span class="dv">0</span>,</span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a>    ((dat<span class="sc">$</span>variable1<span class="sc">-</span>dat<span class="sc">$</span>thr1)<span class="sc">/</span>(dat<span class="sc">$</span>referenceHigh1 <span class="sc">-</span> dat<span class="sc">$</span>thr1))<span class="sc">*</span>(<span class="dv">1</span><span class="fl">-0.6</span>)<span class="sc">+</span><span class="fl">0.6</span></span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-7"><a href="#cb266-7" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>indicator1_breakPoint[dat<span class="sc">$</span>indicator1_breakPoint<span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb266-8"><a href="#cb266-8" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>indicator1_breakPoint[dat<span class="sc">$</span>indicator1_breakPoint<span class="sc">&gt;</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span></code></pre></div>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat)<span class="sc">+</span></span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> variable1, <span class="at">y =</span> indicator1_breakPoint, <span class="at">fill =</span> indicator1_breakPoint),</span>
<span id="cb267-4"><a href="#cb267-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> myColour,</span>
<span id="cb267-5"><a href="#cb267-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">size   =</span> mySize,</span>
<span id="cb267-6"><a href="#cb267-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha  =</span> myAlpha,</span>
<span id="cb267-7"><a href="#cb267-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape  =</span> myShape)<span class="sc">+</span></span>
<span id="cb267-8"><a href="#cb267-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> dat<span class="sc">$</span>referenceHigh1[<span class="dv">1</span>],</span>
<span id="cb267-9"><a href="#cb267-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb267-10"><a href="#cb267-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb267-11"><a href="#cb267-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> dat<span class="sc">$</span>referenceLow1,</span>
<span id="cb267-12"><a href="#cb267-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb267-13"><a href="#cb267-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb267-14"><a href="#cb267-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> thr1, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> thr1, <span class="at">yend =</span> <span class="fl">0.6</span>),</span>
<span id="cb267-15"><a href="#cb267-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype=</span><span class="st">&quot;solid&quot;</span>,</span>
<span id="cb267-16"><a href="#cb267-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">size=</span><span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb267-17"><a href="#cb267-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fl">0.6</span>, <span class="at">xend =</span> thr1, <span class="at">yend =</span> <span class="fl">0.6</span>),</span>
<span id="cb267-18"><a href="#cb267-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype=</span><span class="st">&quot;solid&quot;</span>,</span>
<span id="cb267-19"><a href="#cb267-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">size=</span><span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb267-20"><a href="#cb267-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb267-21"><a href="#cb267-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Indicator values&quot;</span>)<span class="sc">+</span></span>
<span id="cb267-22"><a href="#cb267-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Variable values&quot;</span>)<span class="sc">+</span></span>
<span id="cb267-23"><a href="#cb267-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb267-24"><a href="#cb267-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="st">&quot;Indicator values&quot;</span>, <span class="at">low =</span> low, <span class="at">high =</span> high)</span></code></pre></div>
<p><img src="scalingFunctions_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>The solid lines point to the indicator value where the variable equals the threshold value.</p>
</div>
<div id="two-sided-indicator" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> Two-sided indicator</h2>
<p>An indicator may have an optimum value somewhere in the middle of its range, rather than a max or min value. You can then define a two-sided indicator. Lets say that <code>variable2</code> is optimal when its at a level of 30, and values either lower or high are both bad.</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>referenceMid2 <span class="ot">&lt;-</span> <span class="dv">30</span></span></code></pre></div>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>indicator2_twoSided <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>variable2<span class="sc">&lt;</span>dat<span class="sc">$</span>referenceMid2,</span>
<span id="cb269-3"><a href="#cb269-3" aria-hidden="true" tabindex="-1"></a>    (dat<span class="sc">$</span>variable2<span class="sc">-</span>dat<span class="sc">$</span>referenceLow2)<span class="sc">/</span>(dat<span class="sc">$</span>referenceMid2<span class="sc">-</span>dat<span class="sc">$</span>referenceLow2),</span>
<span id="cb269-4"><a href="#cb269-4" aria-hidden="true" tabindex="-1"></a>    ((dat<span class="sc">$</span>variable2<span class="sc">-</span>dat<span class="sc">$</span>referenceMid2)<span class="sc">/</span>(dat<span class="sc">$</span>referenceHigh2<span class="sc">-</span>dat<span class="sc">$</span>referenceMid2))<span class="sc">*</span>(<span class="sc">-</span><span class="dv">1</span>)<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb269-5"><a href="#cb269-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb269-6"><a href="#cb269-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-7"><a href="#cb269-7" aria-hidden="true" tabindex="-1"></a><span class="co"># truncating</span></span>
<span id="cb269-8"><a href="#cb269-8" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>indicator2_twoSided[dat<span class="sc">$</span>indicator2_twoSided<span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb269-9"><a href="#cb269-9" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>indicator2_twoSided[dat<span class="sc">$</span>indicator2_twoSided<span class="sc">&gt;</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span></code></pre></div>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat)<span class="sc">+</span></span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> variable2, <span class="at">y =</span> indicator2_twoSided, <span class="at">fill =</span> indicator2_twoSided),</span>
<span id="cb270-4"><a href="#cb270-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> myColour,</span>
<span id="cb270-5"><a href="#cb270-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">size   =</span> mySize,</span>
<span id="cb270-6"><a href="#cb270-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha  =</span> myAlpha,</span>
<span id="cb270-7"><a href="#cb270-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape  =</span> myShape)<span class="sc">+</span></span>
<span id="cb270-8"><a href="#cb270-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> dat<span class="sc">$</span>referenceMid2[<span class="dv">1</span>],</span>
<span id="cb270-9"><a href="#cb270-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb270-10"><a href="#cb270-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb270-11"><a href="#cb270-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> dat<span class="sc">$</span>referenceLow2[<span class="dv">1</span>],</span>
<span id="cb270-12"><a href="#cb270-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb270-13"><a href="#cb270-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb270-14"><a href="#cb270-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> dat<span class="sc">$</span>referenceHigh2[<span class="dv">1</span>],</span>
<span id="cb270-15"><a href="#cb270-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb270-16"><a href="#cb270-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb270-17"><a href="#cb270-17" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb270-18"><a href="#cb270-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Indicator values&quot;</span>)<span class="sc">+</span></span>
<span id="cb270-19"><a href="#cb270-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Variable values&quot;</span>)<span class="sc">+</span></span>
<span id="cb270-20"><a href="#cb270-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb270-21"><a href="#cb270-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="st">&quot;Indicator values&quot;</span>, <span class="at">low =</span> low, <span class="at">high =</span> high)</span></code></pre></div>
<p><img src="scalingFunctions_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
</div>
<div id="sigmoid-transformation" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> Sigmoid transformation</h2>
<p>There are many other, non-linear ways to normalise an indicator. The correct choice for scaling function varies between indicators and depends on the nature of the indicator and what it represents, but also on the uncertainty around the reference values. Personally, I think the sigmoid function often makes a lot a sense. It is less sensitive to changes around the min and max reference values. A slight deviation from the reference condition should perhaps not often not be described as a true reduction in condition. This is true for example when reference communities (ecosystems defined as having, or representing, good condition) themselves show variation in the variable values, yet the reference value is fixed. A linear scaling will in these cases lead to what is referred to as underestimation biaz (making thing look worse than they really are).</p>
<p>The equation for the sigmoid transformation that I use here comes from <a href="https://www.sciencedirect.com/science/article/pii/S1470160X21000066">Oliver at al. (2021)</a>; Eq. 1, Supplemetary Information S2.</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>indicator1_sigmoid <span class="ot">&lt;-</span> <span class="fl">100.68</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span><span class="dv">5</span><span class="sc">*</span>(dat<span class="sc">$</span>indicator1_LowHigh)<span class="sc">^</span><span class="fl">2.5</span>))<span class="sc">/</span><span class="dv">100</span></span></code></pre></div>
<p>Finding the transformed indicator value when the variable equals the threshold</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>sigmoid_thr <span class="ot">&lt;-</span> <span class="fl">100.68</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span><span class="dv">5</span><span class="sc">*</span>((dat<span class="sc">$</span>thr1[<span class="dv">1</span>]<span class="sc">-</span>dat<span class="sc">$</span>referenceLow1[<span class="dv">1</span>])<span class="sc">/</span>(dat<span class="sc">$</span>referenceHigh1[<span class="dv">1</span>]<span class="sc">-</span>dat<span class="sc">$</span>referenceLow1[<span class="dv">1</span>]))<span class="sc">^</span><span class="fl">2.5</span>))<span class="sc">/</span><span class="dv">100</span></span></code></pre></div>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat)<span class="sc">+</span></span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> variable1, <span class="at">y =</span> indicator1_sigmoid, <span class="at">fill =</span> indicator1_sigmoid),</span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> myColour,</span>
<span id="cb273-5"><a href="#cb273-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">size   =</span> mySize,</span>
<span id="cb273-6"><a href="#cb273-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha  =</span> myAlpha,</span>
<span id="cb273-7"><a href="#cb273-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape  =</span> myShape)<span class="sc">+</span></span>
<span id="cb273-8"><a href="#cb273-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb273-9"><a href="#cb273-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> dat<span class="sc">$</span>referenceLow1[<span class="dv">1</span>],</span>
<span id="cb273-10"><a href="#cb273-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb273-11"><a href="#cb273-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb273-12"><a href="#cb273-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> dat<span class="sc">$</span>referenceHigh1[<span class="dv">1</span>],</span>
<span id="cb273-13"><a href="#cb273-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb273-14"><a href="#cb273-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb273-15"><a href="#cb273-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb273-16"><a href="#cb273-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> thr1, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> thr1, <span class="at">yend =</span> sigmoid_thr),</span>
<span id="cb273-17"><a href="#cb273-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype=</span><span class="st">&quot;solid&quot;</span>,</span>
<span id="cb273-18"><a href="#cb273-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb273-19"><a href="#cb273-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> sigmoid_thr, <span class="at">xend =</span> thr1, <span class="at">yend =</span> sigmoid_thr),</span>
<span id="cb273-20"><a href="#cb273-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype=</span><span class="st">&quot;solid&quot;</span>,</span>
<span id="cb273-21"><a href="#cb273-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb273-22"><a href="#cb273-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb273-23"><a href="#cb273-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb273-24"><a href="#cb273-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Indicator values&quot;</span>)<span class="sc">+</span></span>
<span id="cb273-25"><a href="#cb273-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Variable values&quot;</span>)<span class="sc">+</span></span>
<span id="cb273-26"><a href="#cb273-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb273-27"><a href="#cb273-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="st">&quot;Indicator values&quot;</span>, <span class="at">low =</span> low, <span class="at">high =</span> high)</span></code></pre></div>
<p><img src="scalingFunctions_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>The solid helperlines point to the indicator value where the variable value equals the threshold. Later we will shift the values so that the indicator value becomes 0.6 at this point.</p>
<p>Also plotted against the linearly normalised indicator values:</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat)<span class="sc">+</span></span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> indicator1_LowHigh, <span class="at">y =</span> indicator1_sigmoid, <span class="at">fill =</span> indicator1_sigmoid),</span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> myColour,</span>
<span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">size   =</span> mySize,</span>
<span id="cb274-6"><a href="#cb274-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha  =</span> myAlpha,</span>
<span id="cb274-7"><a href="#cb274-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape  =</span> myShape)<span class="sc">+</span></span>
<span id="cb274-8"><a href="#cb274-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb274-9"><a href="#cb274-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.6</span>,</span>
<span id="cb274-10"><a href="#cb274-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb274-11"><a href="#cb274-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb274-12"><a href="#cb274-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.6</span>,</span>
<span id="cb274-13"><a href="#cb274-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb274-14"><a href="#cb274-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb274-15"><a href="#cb274-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb274-16"><a href="#cb274-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Sigmoid-transformed</span><span class="sc">\n</span><span class="st">Indicator values&quot;</span>)<span class="sc">+</span></span>
<span id="cb274-17"><a href="#cb274-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Linear indicatior values&quot;</span>)<span class="sc">+</span></span>
<span id="cb274-18"><a href="#cb274-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb274-19"><a href="#cb274-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="st">&quot;Indicator values&quot;</span>, <span class="at">low =</span> low, <span class="at">high =</span> high)</span></code></pre></div>
<p><img src="scalingFunctions_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>The dotted helper lines selve as visual guides to judge how different a scaled indicator value of 0.6 is for the two approaches.</p>
<div id="accounting-for-the-threshold-value" class="section level3" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> Accounting for the threshold value</h3>
<p>We can account for the threshold for good ecological condition when applying sigmoid transformation like this</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>indicator1_sigmoid_thr <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>variable1<span class="sc">&lt;</span>dat<span class="sc">$</span>thr1,</span>
<span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a>    ((dat<span class="sc">$</span>indicator1_sigmoid<span class="dv">-0</span>)<span class="sc">/</span>(sigmoid_thr<span class="dv">-0</span>))<span class="sc">*</span>(<span class="fl">0.6</span><span class="dv">-0</span>)<span class="sc">+</span><span class="dv">0</span>,</span>
<span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a>    ((dat<span class="sc">$</span>indicator1_sigmoid<span class="sc">-</span>sigmoid_thr)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>sigmoid_thr))<span class="sc">*</span>(<span class="dv">1</span><span class="fl">-0.6</span>)<span class="sc">+</span><span class="fl">0.6</span></span>
<span id="cb275-5"><a href="#cb275-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb275-6"><a href="#cb275-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat)<span class="sc">+</span></span>
<span id="cb275-7"><a href="#cb275-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb275-8"><a href="#cb275-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> variable1, <span class="at">y =</span> indicator1_sigmoid),</span>
<span id="cb275-9"><a href="#cb275-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill   =</span> <span class="st">&quot;grey&quot;</span>, </span>
<span id="cb275-10"><a href="#cb275-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> myColour,</span>
<span id="cb275-11"><a href="#cb275-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">size   =</span> <span class="dv">5</span>,</span>
<span id="cb275-12"><a href="#cb275-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha  =</span> myAlpha,</span>
<span id="cb275-13"><a href="#cb275-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape  =</span> myShape)<span class="sc">+</span></span>
<span id="cb275-14"><a href="#cb275-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb275-15"><a href="#cb275-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb275-16"><a href="#cb275-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> variable1, <span class="at">y =</span> indicator1_sigmoid_thr, <span class="at">fill =</span> indicator1_sigmoid_thr),</span>
<span id="cb275-17"><a href="#cb275-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> myColour,</span>
<span id="cb275-18"><a href="#cb275-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">size   =</span> mySize,</span>
<span id="cb275-19"><a href="#cb275-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha  =</span> myAlpha,</span>
<span id="cb275-20"><a href="#cb275-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape  =</span> myShape)<span class="sc">+</span></span>
<span id="cb275-21"><a href="#cb275-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb275-22"><a href="#cb275-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> dat<span class="sc">$</span>referenceLow1[<span class="dv">1</span>],</span>
<span id="cb275-23"><a href="#cb275-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb275-24"><a href="#cb275-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb275-25"><a href="#cb275-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> dat<span class="sc">$</span>referenceHigh1[<span class="dv">1</span>],</span>
<span id="cb275-26"><a href="#cb275-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb275-27"><a href="#cb275-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb275-28"><a href="#cb275-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb275-29"><a href="#cb275-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> sigmoid_thr, <span class="at">xend =</span> thr1, <span class="at">yend =</span> sigmoid_thr),</span>
<span id="cb275-30"><a href="#cb275-30" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype=</span><span class="st">&quot;solid&quot;</span>,</span>
<span id="cb275-31"><a href="#cb275-31" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb275-32"><a href="#cb275-32" aria-hidden="true" tabindex="-1"></a>               <span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb275-33"><a href="#cb275-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb275-34"><a href="#cb275-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> thr1, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> thr1, <span class="at">yend =</span> <span class="fl">0.6</span>),</span>
<span id="cb275-35"><a href="#cb275-35" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype=</span><span class="st">&quot;solid&quot;</span>,</span>
<span id="cb275-36"><a href="#cb275-36" aria-hidden="true" tabindex="-1"></a>               <span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb275-37"><a href="#cb275-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fl">0.6</span>, <span class="at">xend =</span> thr1, <span class="at">yend =</span> <span class="fl">0.6</span>),</span>
<span id="cb275-38"><a href="#cb275-38" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype=</span><span class="st">&quot;solid&quot;</span>,</span>
<span id="cb275-39"><a href="#cb275-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb275-40"><a href="#cb275-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb275-41"><a href="#cb275-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb275-42"><a href="#cb275-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Indicator values&quot;</span>)<span class="sc">+</span></span>
<span id="cb275-43"><a href="#cb275-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Variable values&quot;</span>)<span class="sc">+</span></span>
<span id="cb275-44"><a href="#cb275-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb275-45"><a href="#cb275-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="st">&quot;Indicator values&quot;</span>, <span class="at">low =</span> low, <span class="at">high =</span> high)</span></code></pre></div>
<p><img src="scalingFunctions_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>The grey circles and horizonal line correspons to the sigmoid transformation without any adjustment for the threshold value.</p>
</div>
</div>
<div id="exponential-functoins" class="section level2" number="6.6">
<h2><span class="header-section-number">6.6</span> Exponential functoins</h2>
<p>Here are two examples of exponential transformation that can also be used:</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>indicator1_expConvex <span class="ot">&lt;-</span> dat<span class="sc">$</span>indicator1_LowHigh<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>indicator1_expConcave <span class="ot">&lt;-</span> dat<span class="sc">$</span>indicator1_LowHigh<span class="sc">^</span><span class="dv">2</span></span></code></pre></div>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat)<span class="sc">+</span></span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> variable1, <span class="at">y =</span> indicator1_expConvex, <span class="at">fill =</span> indicator1_expConvex),</span>
<span id="cb277-5"><a href="#cb277-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> myColour,</span>
<span id="cb277-6"><a href="#cb277-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">size   =</span> mySize,</span>
<span id="cb277-7"><a href="#cb277-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha  =</span> myAlpha,</span>
<span id="cb277-8"><a href="#cb277-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape  =</span> myShape)<span class="sc">+</span></span>
<span id="cb277-9"><a href="#cb277-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb277-10"><a href="#cb277-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> variable1, <span class="at">y =</span> indicator1_expConcave, <span class="at">fill =</span> indicator1_expConcave),</span>
<span id="cb277-11"><a href="#cb277-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> myColour,</span>
<span id="cb277-12"><a href="#cb277-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">size   =</span> mySize,</span>
<span id="cb277-13"><a href="#cb277-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha  =</span> myAlpha,</span>
<span id="cb277-14"><a href="#cb277-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape  =</span> myShape)<span class="sc">+</span></span>
<span id="cb277-15"><a href="#cb277-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb277-16"><a href="#cb277-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> dat<span class="sc">$</span>referenceLow1[<span class="dv">1</span>],</span>
<span id="cb277-17"><a href="#cb277-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb277-18"><a href="#cb277-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb277-19"><a href="#cb277-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> dat<span class="sc">$</span>referenceHigh1[<span class="dv">1</span>],</span>
<span id="cb277-20"><a href="#cb277-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb277-21"><a href="#cb277-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb277-22"><a href="#cb277-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Indicator values&quot;</span>)<span class="sc">+</span></span>
<span id="cb277-23"><a href="#cb277-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Variable values&quot;</span>)<span class="sc">+</span></span>
<span id="cb277-24"><a href="#cb277-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb277-25"><a href="#cb277-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="st">&quot;Indicator values&quot;</span>, <span class="at">low =</span> low, <span class="at">high =</span> high)</span></code></pre></div>
<p><img src="scalingFunctions_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<!--chapter:end:scalingFunctions.Rmd-->
</div>
</div>
<div id="homogeneous-impact-areas" class="section level1" number="7">
<h1><span class="header-section-number">7</span> Homogeneous Impact Areas</h1>
<p><br /></p>
<p><em>Author and date:</em></p>
<p>Anders Kolstad</p>
<p><br /></p>
<!-- Load all your dependencies here -->
<div id="introduction-4" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Introduction</h2>
<p>This chapter documents the creation of a wall-to-wall map of homogeneous impact areas in Norway.
The map is produced by binning values in the infrastructure index into four discrete categories.
It is likely to be a good predictor for some indicators, such as <em>slitasje</em> and the presence of <em>alien species</em>.</p>
</div>
<div id="about-the-underlying-data-3" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> About the underlying data</h2>
<p>The infrastructure index is explained <a href="https://brage.nina.no/nina-xmlui/handle/11250/2983607">here</a>.
It is a wall-to-wall raster over Norway with 100 m resolution.
Each pixel is given a value along a continuous gradient from 0 to around 15.4, representing the frequency of surrounding cells within 500 m with human infrastructure (houses, roads, ect).</p>
<div id="representativity-in-time-and-space-3" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Representativity in time and space</h3>
<p>The infrastructure index is calculated with data that have slightly different dates, but can be said to represent year 2015.
The data covers all of mainland Norway.</p>
</div>
<div id="references-3" class="section level3" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> References</h3>
<p>Bakkestuen, V., Dervo, B.K., Bærum, K.M. og Erikstad, L. 2022.
Prediksjonsmodellering av naturtyper i ferskvann.
NINA Rapport 2079.
Norsk institutt for naturforskning.</p>
</div>
</div>
<div id="analyses-4" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Analyses</h2>
<div id="import-data" class="section level3" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Import data</h3>
<p>The path must be conditional:</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="fu">substr</span>(<span class="fu">getwd</span>(), <span class="dv">1</span>,<span class="dv">2</span>)</span></code></pre></div>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dir <span class="sc">==</span> <span class="st">&quot;C:&quot;</span>, </span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;R:/GeoSpatialData/Utility_governmentalServices/Norway_Infrastructure_Index/Original/Infrastrukturindeks_UTM33/infra_tiff.tif&quot;</span>,</span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;/data/R/GeoSpatialData/Utility_governmentalServices/Norway_Infrastructure_Index/Original/Infrastrukturindeks_UTM33/infra_tiff.tif&quot;</span>)</span></code></pre></div>
<p>Import a stars proxy (no data imported yet)</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>infra <span class="ot">&lt;-</span> stars<span class="sc">::</span><span class="fu">read_stars</span>(path)</span></code></pre></div>
<p>Print the coordinate reference system:</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(infra)<span class="sc">$</span>input</span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;WGS_1984_UTM_Zone_33N&quot;</span></span></code></pre></div>
</div>
<div id="trondheim-example" class="section level3" number="7.3.2">
<h3><span class="header-section-number">7.3.2</span> Trondheim example</h3>
<p>It’s easier to see what’s happening if we zoom in a bit.
Lets get a boundary box around Trondheim.</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>myBB <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">c</span>(<span class="at">xmin=</span><span class="fl">260520.12</span>, <span class="at">xmax =</span> <span class="fl">278587.56</span>,</span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">ymin =</span> <span class="fl">7032142.5</span>, <span class="at">ymax =</span> <span class="fl">7045245.27</span>),</span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">crs =</span> <span class="fu">st_crs</span>(infra))</span></code></pre></div>
<p>Cropping the raster to the bbox</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a>infra_trd <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_crop</span>(infra, myBB)</span></code></pre></div>
<div id="get-osm-highways" class="section level4" number="7.3.2.1">
<h4><span class="header-section-number">7.3.2.1</span> Get OSM highways</h4>
<p>Lets download some base maps to help validate and contextualize the infrastructure index.</p>
<p>Transform to lat long due to osm requirements</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>infra_trd_ll <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(infra_trd, <span class="dv">4326</span>)</span></code></pre></div>
<p>Get the boundary box of the cropped raster</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a>myBB_ll <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(infra_trd_ll)</span></code></pre></div>
<p>Download highways using the above bbox.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a>hw <span class="ot">&lt;-</span> </span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a>  osmplotr<span class="sc">::</span><span class="fu">extract_osm_objects</span>(</span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">bbox =</span> myBB_ll,</span>
<span id="cb286-4"><a href="#cb286-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">key =</span> <span class="st">&quot;highway&quot;</span>,</span>
<span id="cb286-5"><a href="#cb286-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sf =</span> T)</span></code></pre></div>
<p>Transforming highway data back into utm, although not strictly necessary.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>hw_utm <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(hw, sf<span class="sc">::</span><span class="fu">st_crs</span>(infra_trd)) </span></code></pre></div>
<p>This object contains too many roads (about 30k).
I’ll take out the unnamed roads.</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a>hw_utm <span class="ot">&lt;-</span> hw_utm[<span class="sc">!</span><span class="fu">is.na</span>(hw_utm<span class="sc">$</span>name),]</span></code></pre></div>
</div>
<div id="discretize" class="section level4" number="7.3.2.2">
<h4><span class="header-section-number">7.3.2.2</span> Discretize</h4>
<p>Here I define a simplified categorical typology for the infrastructure index using four classes.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(infra_trd) <span class="ot">&lt;-</span> <span class="st">&quot;infrastructureIndex&quot;</span></span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a>infra_trd_reclassed <span class="ot">&lt;-</span>  infra_trd <span class="sc">%&gt;%</span></span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">infrastructureIndex =</span> <span class="fu">case_when</span>(</span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a>    infrastructureIndex <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb289-5"><a href="#cb289-5" aria-hidden="true" tabindex="-1"></a>    infrastructureIndex <span class="sc">&lt;</span> <span class="dv">6</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb289-6"><a href="#cb289-6" aria-hidden="true" tabindex="-1"></a>    infrastructureIndex <span class="sc">&lt;</span> <span class="dv">12</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb289-7"><a href="#cb289-7" aria-hidden="true" tabindex="-1"></a>    infrastructureIndex <span class="sc">&gt;=</span> <span class="dv">12</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb289-8"><a href="#cb289-8" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div>
<p>Lets plot these two maps side by side</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a>map_trd_reclassed <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(infra_trd_reclassed)<span class="sc">+</span></span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">title=</span><span class="st">&quot;Infrastructure Index&quot;</span>,</span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a>            <span class="co">#palette = &quot;viridis&quot;,</span></span>
<span id="cb290-4"><a href="#cb290-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">style=</span><span class="st">&quot;cat&quot;</span>)<span class="sc">+</span></span>
<span id="cb290-5"><a href="#cb290-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> T)<span class="sc">+</span></span>
<span id="cb290-6"><a href="#cb290-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hw_utm)<span class="sc">+</span></span>
<span id="cb290-7"><a href="#cb290-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">&quot;white&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a>map_trd <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(infra_trd)<span class="sc">+</span></span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">title=</span><span class="st">&quot;Infrastructure Index&quot;</span>,</span>
<span id="cb291-3"><a href="#cb291-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">style=</span><span class="st">&quot;cont&quot;</span>,</span>
<span id="cb291-4"><a href="#cb291-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">palette =</span> <span class="st">&quot;viridis&quot;</span>)<span class="sc">+</span></span>
<span id="cb291-5"><a href="#cb291-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> T)<span class="sc">+</span></span>
<span id="cb291-6"><a href="#cb291-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hw_utm)<span class="sc">+</span></span>
<span id="cb291-7"><a href="#cb291-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">&quot;white&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(map_trd,</span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>             map_trd_reclassed,</span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; stars_proxy object shown at 181 by 132 cells.</span></span>
<span id="cb292-5"><a href="#cb292-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; stars_proxy object shown at 181 by 132 cells.</span></span></code></pre></div>
<div class="figure">
<img src="homogeneous_impact_areas_files/figure-html/unnamed-chunk-17-1.png" alt="Infrastructure index over Trondheim, comparing the continous scale with the ordinal four-step scale. Major roads are in white." width="672" />
<p class="caption">
(#fig:unnamed-chunk-17)Infrastructure index over Trondheim, comparing the continous scale with the ordinal four-step scale. Major roads are in white.
</p>
</div>
<p>I tweaked the thresholds for the bins so that the categories match my knowledge about the land use intensity in Trondheim, for example that most of the forest next to Trondheim (to the left in the map) was in the second lowest class.
This looks pretty good to me.
It depicts a gradient in human presence from high within the built zone, to <em>no to very low</em> in the forests and mountains to the west.
Note that there is still considerable human activity also there in the form of outdoor recreation and even forestry.</p>
</div>
<div id="aggregate" class="section level4" number="7.3.2.3">
<h4><span class="header-section-number">7.3.2.3</span> Aggregate</h4>
<p>The resolution in this map is more than we need, and the size of the data implies that the next step, the vectorization, would take too long.
We therefore aggregate, or reduce the resolution.</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a>dim <span class="ot">&lt;-</span> <span class="fu">st_dimensions</span>(infra)</span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;Resolution is&quot;</span>, dim<span class="sc">$</span>x<span class="sc">$</span>delta, <span class="st">&quot;by&quot;</span>, dim<span class="sc">$</span>x<span class="sc">$</span>delta, <span class="st">&quot;meters&quot;</span>)</span>
<span id="cb293-3"><a href="#cb293-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Resolution is 100 by 100 meters&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a>infra_trd_reclassed_agg <span class="ot">&lt;-</span> <span class="fu">st_warp</span>(infra_trd_reclassed, <span class="at">cellsize =</span> <span class="fu">c</span>(<span class="dv">1000</span>, <span class="dv">1000</span>), </span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">crs =</span> <span class="fu">st_crs</span>(infra_trd_reclassed), </span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">use_gdal =</span> <span class="cn">TRUE</span>,</span>
<span id="cb294-4"><a href="#cb294-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">method =</span> <span class="st">&quot;average&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a>dim <span class="ot">&lt;-</span> <span class="fu">st_dimensions</span>(infra_trd_reclassed_agg)</span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;Resolution is&quot;</span>, dim<span class="sc">$</span>x<span class="sc">$</span>delta, <span class="st">&quot;by&quot;</span>, dim<span class="sc">$</span>x<span class="sc">$</span>delta, <span class="st">&quot;meters&quot;</span>)</span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Resolution is 1000 by 1000 meters&quot;</span></span></code></pre></div>
<p>Each cell is now the average of the aggregated cells, and hence the value is continuous again.
Let’s make it discrete.</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(infra_trd_reclassed_agg) <span class="ot">&lt;-</span> <span class="st">&quot;infrastructureIndex&quot;</span></span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a>infra_trd_reclassed_agg <span class="ot">&lt;-</span>  infra_trd_reclassed_agg <span class="sc">%&gt;%</span></span>
<span id="cb296-3"><a href="#cb296-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">infrastructureIndex =</span> <span class="fu">case_when</span>(</span>
<span id="cb296-4"><a href="#cb296-4" aria-hidden="true" tabindex="-1"></a>    infrastructureIndex <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb296-5"><a href="#cb296-5" aria-hidden="true" tabindex="-1"></a>    infrastructureIndex <span class="sc">&lt;</span> <span class="dv">6</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb296-6"><a href="#cb296-6" aria-hidden="true" tabindex="-1"></a>    infrastructureIndex <span class="sc">&lt;</span> <span class="dv">12</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb296-7"><a href="#cb296-7" aria-hidden="true" tabindex="-1"></a>    infrastructureIndex <span class="sc">&gt;=</span> <span class="dv">12</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb296-8"><a href="#cb296-8" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(infra_trd_reclassed_agg)<span class="sc">+</span></span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">title=</span><span class="st">&quot;Infrastructure Index&quot;</span>,</span>
<span id="cb297-3"><a href="#cb297-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">style=</span><span class="st">&quot;cat&quot;</span>)<span class="sc">+</span></span>
<span id="cb297-4"><a href="#cb297-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> T)<span class="sc">+</span></span>
<span id="cb297-5"><a href="#cb297-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hw_utm)<span class="sc">+</span></span>
<span id="cb297-6"><a href="#cb297-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">&quot;white&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="homogeneous_impact_areas_files/figure-html/unnamed-chunk-22-1.png" alt="Infrastrcture index over Trondheim on a four-step discrete scale, aggregated to 1x1 km resolution using the mean function." width="672" />
<p class="caption">
(#fig:unnamed-chunk-22)Infrastrcture index over Trondheim on a four-step discrete scale, aggregated to 1x1 km resolution using the mean function.
</p>
</div>
<p>This resolution is more than good enough for our purpose here.
I see that the map extends a bit into the fjord. We want to cut away these areas. We can use a map of the outline of Norway to do this.</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a>outline <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;data/outlineOfNorway_EPSG25833.shp&quot;</span>)</span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Reading layer `outlineOfNorway_EPSG25833&#39; from data source </span></span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   `/data/scratch/Matt_bookdown__debug/ecosystemCondition/data/outlineOfNorway_EPSG25833.shp&#39; </span></span>
<span id="cb298-4"><a href="#cb298-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   using driver `ESRI Shapefile&#39;</span></span>
<span id="cb298-5"><a href="#cb298-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 1 feature and 2 fields</span></span>
<span id="cb298-6"><a href="#cb298-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb298-7"><a href="#cb298-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb298-8"><a href="#cb298-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -113472.7 ymin: 6448359 xmax: 1114618 ymax: 7939917</span></span>
<span id="cb298-9"><a href="#cb298-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Projected CRS: ETRS89 / UTM zone 33N</span></span></code></pre></div>
<p>The CRS needs to be identical</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a>infra_trd_reclassed_agg <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(infra_trd_reclassed_agg, <span class="dv">25833</span>)</span></code></pre></div>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a>infra_trd_reclassed_agg_terrestrial <span class="ot">&lt;-</span> <span class="fu">st_crop</span>(infra_trd_reclassed_agg, outline)</span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in st_crop.stars(infra_trd_reclassed_agg, outline):</span></span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; crop only crops regular grids</span></span></code></pre></div>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(infra_trd_reclassed_agg_terrestrial)<span class="sc">+</span></span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">title=</span><span class="st">&quot;Infrastructure Index&quot;</span>,</span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">style=</span><span class="st">&quot;cat&quot;</span>)<span class="sc">+</span></span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> T)<span class="sc">+</span></span>
<span id="cb301-5"><a href="#cb301-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hw_utm)<span class="sc">+</span></span>
<span id="cb301-6"><a href="#cb301-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">&quot;white&quot;</span>)<span class="sc">+</span></span>
<span id="cb301-7"><a href="#cb301-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(outline)<span class="sc">+</span></span>
<span id="cb301-8"><a href="#cb301-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">lwd =</span><span class="dv">2</span>,</span>
<span id="cb301-9"><a href="#cb301-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="homogeneous_impact_areas_files/figure-html/unnamed-chunk-26-1.png" alt="Infrastrcture index over Trondheim on a four-step discrete scale, aggregated to 1x1 km resolution using the mean function." width="672" />
<p class="caption">
(#fig:unnamed-chunk-26)Infrastrcture index over Trondheim on a four-step discrete scale, aggregated to 1x1 km resolution using the mean function.
</p>
</div>
<p>I have treated the raster cells as points when cropping, so that cells where the center of the cell is outside the terrestrial delineation are removed. I think this makes the most sense for unbiased area statistics, but some coastal indicator data could also be excluded because of this. The errors would be smaller with a finer resolution raster, but computation time is a problem.</p>
</div>
</div>
<div id="aggregate-the-entire-map-to-1x1-km" class="section level3" number="7.3.3">
<h3><span class="header-section-number">7.3.3</span> Aggregate the entire map to 1x1 km</h3>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="co"># runtime about 30 sec</span></span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a>infra_agg <span class="ot">&lt;-</span> <span class="fu">st_warp</span>(infra, <span class="at">cellsize =</span> <span class="fu">c</span>(<span class="dv">1000</span>, <span class="dv">1000</span>), </span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">crs =</span> <span class="fu">st_crs</span>(infra), </span>
<span id="cb302-4"><a href="#cb302-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">use_gdal =</span> <span class="cn">TRUE</span>,</span>
<span id="cb302-5"><a href="#cb302-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">method =</span> <span class="st">&quot;average&quot;</span>)</span>
<span id="cb302-6"><a href="#cb302-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The CRS needs to be identical for st_crop</span></span>
<span id="cb302-7"><a href="#cb302-7" aria-hidden="true" tabindex="-1"></a>infra_agg <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(infra_agg, <span class="dv">25833</span>)</span></code></pre></div>
</div>
<div id="cut-out-marine-areas" class="section level3" number="7.3.4">
<h3><span class="header-section-number">7.3.4</span> Cut out marine areas</h3>
<p>I see that the map extends a bit into the fjord. We want to cut away these areas. We can use a map of the outline of Norway to do this.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a>infra_agg_terrestrial <span class="ot">&lt;-</span> <span class="fu">st_crop</span>(infra_agg, outline)</span>
<span id="cb303-2"><a href="#cb303-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(infra_agg_terrestrial, <span class="st">&quot;P:/41201785_okologisk_tilstand_2022_2023/data/cache/infra_agg_terrestrial.rds&quot;</span>)</span></code></pre></div>
</div>
<div id="discretize-the-entire-map" class="section level3" number="7.3.5">
<h3><span class="header-section-number">7.3.5</span> Discretize the entire map</h3>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(infra_agg_terrestrial) <span class="ot">&lt;-</span> <span class="st">&quot;infrastructureIndex&quot;</span></span>
<span id="cb304-2"><a href="#cb304-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-3"><a href="#cb304-3" aria-hidden="true" tabindex="-1"></a>infra_agg_discrete <span class="ot">&lt;-</span> infra_agg_terrestrial <span class="sc">%&gt;%</span></span>
<span id="cb304-4"><a href="#cb304-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">infrastructureIndex =</span> <span class="fu">case_when</span>(</span>
<span id="cb304-5"><a href="#cb304-5" aria-hidden="true" tabindex="-1"></a>    infrastructureIndex <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb304-6"><a href="#cb304-6" aria-hidden="true" tabindex="-1"></a>    infrastructureIndex <span class="sc">&lt;</span> <span class="dv">6</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb304-7"><a href="#cb304-7" aria-hidden="true" tabindex="-1"></a>    infrastructureIndex <span class="sc">&lt;</span> <span class="dv">12</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb304-8"><a href="#cb304-8" aria-hidden="true" tabindex="-1"></a>    infrastructureIndex <span class="sc">&gt;=</span> <span class="dv">12</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb304-9"><a href="#cb304-9" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div>
</div>
<div id="vectorize" class="section level3" number="7.3.6">
<h3><span class="header-section-number">7.3.6</span> Vectorize</h3>
<p>This step might seem rather stupid.
We want to vectorize a rather large raster.
This makes it a quite big data object.
The reason is that there is no really good way to burn polygon data on to raster grid cells after the disuse of the <code>{raster}</code> package.
It was not straight forward then either.
But calculating intersections between polygons is very fast and easy.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a>infra_agg_discrete_vect <span class="ot">&lt;-</span> </span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true" tabindex="-1"></a>  eaTools<span class="sc">::</span><span class="fu">ea_homogeneous_area</span>(infra_agg_discrete, </span>
<span id="cb305-3"><a href="#cb305-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">groups =</span> infrastructureIndex)</span>
<span id="cb305-4"><a href="#cb305-4" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dir <span class="sc">==</span> <span class="st">&quot;C:&quot;</span>, </span>
<span id="cb305-5"><a href="#cb305-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;P:/41201785_okologisk_tilstand_2022_2023/data/cache/&quot;</span>,</span>
<span id="cb305-6"><a href="#cb305-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/cache/&quot;</span>)</span>
<span id="cb305-7"><a href="#cb305-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-8"><a href="#cb305-8" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(infra_agg_discrete_vect, <span class="fu">paste0</span>(path, <span class="st">&quot;infra_agg_discrete_vect.rds&quot;</span>))</span></code></pre></div>
<p>Let’s plot this now.
First, lets crop it to reduce computation time.</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a>myBB <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">c</span>(<span class="at">xmin=</span><span class="fl">260520.12</span>, <span class="at">xmax =</span> <span class="fl">278587.56</span>,</span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">ymin =</span> <span class="fl">7032142.5</span>, <span class="at">ymax =</span> <span class="fl">7045245.27</span>),</span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">crs =</span> <span class="fu">st_crs</span>(infra_agg_discrete_vect))</span>
<span id="cb306-4"><a href="#cb306-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-5"><a href="#cb306-5" aria-hidden="true" tabindex="-1"></a>infra_agg_discrete_vect_trd <span class="ot">&lt;-</span> <span class="fu">st_crop</span>(infra_agg_discrete_vect, myBB)</span>
<span id="cb306-6"><a href="#cb306-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: attribute variables are assumed to be spatially</span></span>
<span id="cb306-7"><a href="#cb306-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; constant throughout all geometries</span></span></code></pre></div>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(infra_agg_discrete_vect_trd)<span class="sc">+</span></span>
<span id="cb307-2"><a href="#cb307-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col=</span><span class="st">&quot;infrastructureIndex&quot;</span>,</span>
<span id="cb307-3"><a href="#cb307-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">style =</span> <span class="st">&quot;cat&quot;</span>)<span class="sc">+</span></span>
<span id="cb307-4"><a href="#cb307-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> T)<span class="sc">+</span></span>
<span id="cb307-5"><a href="#cb307-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hw_utm)<span class="sc">+</span></span>
<span id="cb307-6"><a href="#cb307-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">&quot;white&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="homogeneous_impact_areas_files/figure-html/test-2-1.png" alt="A vectorized version of the Infrastructure index over Trondheim on a four-step discrete scale." width="672" />
<p class="caption">
(#fig:test-2)A vectorized version of the Infrastructure index over Trondheim on a four-step discrete scale.
</p>
</div>
<p>As can be seen in the figure above, <code>st_warp</code> merges grid cells that have the same value, and the vectorized raster doesn’t end up being that big in the end.</p>
</div>
</div>
<div id="check-national-distribution" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Check national distribution</h2>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a>regions <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">&quot;data/regions.shp&quot;</span>, <span class="at">options =</span> <span class="st">&quot;ENCODING=UTF8&quot;</span>)</span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(regions<span class="sc">$</span>region)</span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Nord-Norge&quot; &quot;Midt-Norge&quot; &quot;Østlandet&quot;  &quot;Vestlandet&quot;</span></span>
<span id="cb308-4"><a href="#cb308-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5] &quot;Sørlandet&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(infra_agg_discrete_vect) <span class="sc">==</span> <span class="fu">st_crs</span>(regions)</span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Since the two layers are completely overlapping, we can get the intersections</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a>infra_stats <span class="ot">&lt;-</span> eaTools<span class="sc">::</span><span class="fu">ea_homogeneous_area</span>(infra_agg_discrete_vect,</span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true" tabindex="-1"></a>                             regions,</span>
<span id="cb310-3"><a href="#cb310-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">keep1 =</span> <span class="st">&quot;infrastructureIndex&quot;</span>,</span>
<span id="cb310-4"><a href="#cb310-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">keep2 =</span> <span class="st">&quot;region&quot;</span>)</span>
<span id="cb310-5"><a href="#cb310-5" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(infra_stats, <span class="st">&quot;P:/41201785_okologisk_tilstand_2022_2023/data/cache/infra_stats.rds&quot;</span>)</span></code></pre></div>
<p>Let’s calculate the areas of these polygons and compare the HIF in the five regions.</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a>infra_stats<span class="sc">$</span>area_km2 <span class="ot">&lt;-</span> units<span class="sc">::</span><span class="fu">drop_units</span>(sf<span class="sc">::</span><span class="fu">st_area</span>(infra_stats))</span>
<span id="cb311-2"><a href="#cb311-2" aria-hidden="true" tabindex="-1"></a>infra_stats<span class="sc">$</span>area_km2 <span class="ot">&lt;-</span> infra_stats<span class="sc">$</span>area_km2<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb311-3"><a href="#cb311-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-4"><a href="#cb311-4" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(infra_stats) <span class="sc">%&gt;%</span></span>
<span id="cb311-5"><a href="#cb311-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, infrastructureIndex) <span class="sc">%&gt;%</span></span>
<span id="cb311-6"><a href="#cb311-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">area_km2 =</span> <span class="fu">mean</span>(area_km2))</span>
<span id="cb311-7"><a href="#cb311-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `summarise()` has grouped output by &#39;region&#39;. You can</span></span>
<span id="cb311-8"><a href="#cb311-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; override using the `.groups` argument.</span></span>
<span id="cb311-9"><a href="#cb311-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-10"><a href="#cb311-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(</span>
<span id="cb311-11"><a href="#cb311-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(temp, <span class="fu">aes</span>(<span class="at">x =</span> region, <span class="at">y =</span> area_km2, <span class="at">fill =</span> <span class="fu">factor</span>(infrastructureIndex)))<span class="sc">+</span></span>
<span id="cb311-12"><a href="#cb311-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb311-13"><a href="#cb311-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">&quot;none&quot;</span>)<span class="sc">+</span></span>
<span id="cb311-14"><a href="#cb311-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb311-15"><a href="#cb311-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>)</span>
<span id="cb311-16"><a href="#cb311-16" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb311-17"><a href="#cb311-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(temp, <span class="fu">aes</span>(<span class="at">x =</span> region, <span class="at">y =</span> area_km2, <span class="at">fill =</span> <span class="fu">factor</span>(infrastructureIndex)))<span class="sc">+</span></span>
<span id="cb311-18"><a href="#cb311-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;fill&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb311-19"><a href="#cb311-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="st">&quot;HIF&quot;</span>))<span class="sc">+</span></span>
<span id="cb311-20"><a href="#cb311-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb311-21"><a href="#cb311-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Fraction of total area&quot;</span>)<span class="sc">+</span></span>
<span id="cb311-22"><a href="#cb311-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>)</span>
<span id="cb311-23"><a href="#cb311-23" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure">
<img src="homogeneous_impact_areas_files/figure-html/HIF-region-1.png" alt="Stacked barplot showing the distribution of human impact factor across five regions in Norway." width="672" />
<p class="caption">
(#fig:HIF-region)Stacked barplot showing the distribution of human impact factor across five regions in Norway.
</p>
</div>
<p>This distribution looks reasonable. The relative proportions are similar in the five regions, but <em>Østlandet</em> and <em>Sørlandet</em> have more infrastructure in general.</p>
<p>Here are the numbers behind the figure above.</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a>temp<span class="sc">$</span>area_km2 <span class="ot">&lt;-</span> <span class="fu">round</span>(temp<span class="sc">$</span>area_km2,<span class="dv">0</span>)</span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(temp)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-91b5ede345b426016b17" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-91b5ede345b426016b17">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],["Midt-Norge","Midt-Norge","Midt-Norge","Midt-Norge","Nord-Norge","Nord-Norge","Nord-Norge","Nord-Norge","Sørlandet","Sørlandet","Sørlandet","Sørlandet","Vestlandet","Vestlandet","Vestlandet","Vestlandet","Østlandet","Østlandet","Østlandet","Østlandet"],[0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3,0,1,2,3],[31390,8661,4604,2005,63009,5979,2417,1504,15199,24127,5731,3257,30533,6988,3683,2258,17242,22154,9760,3295]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>region<\/th>\n      <th>infrastructureIndex<\/th>\n      <th>area_km2<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="export" class="section level2" number="7.5">
<h2><span class="header-section-number">7.5</span> Export</h2>
<p>I will write this data to the NINA P server.</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(infra_agg_discrete_vect, <span class="st">&quot;P:/41201785_okologisk_tilstand_2022_2023/data/infrastrukturindeks/homogeneous_impact_areas.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a>HIA_returned <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;P:/41201785_okologisk_tilstand_2022_2023/data/infrastrukturindeks/homogeneous_impact_areas.rds&quot;</span>)</span></code></pre></div>
<!--chapter:end:homogeneous_impact_areas.Rmd-->
</div>
</div>
<div id="master-grid" class="section level1" number="8">
<h1><span class="header-section-number">8</span> Master grid</h1>
<p><br /></p>
<p><em>Author:</em></p>
<p>Anders L. Kolstad</p>
<p>March 2023</p>
<p><br /></p>
<!-- Load all you dependencies here -->
<div id="introduction-5" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Introduction</h2>
<p>This chapter describes the making of a master raster grid for all of mainland Norway. This grid is used to align all ecosystem and indicator maps so that it becomes possible to do easy resamping, masking and aggregating.</p>
<p><em>To do</em> : I plan to add examples how to use this master grid on real data.</p>
</div>
<div id="about-the-underlying-data-4" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> About the underlying data</h2>
<p>I will use the <a href="https://kartkatalog.geonorge.no/metadata/statistisk-rutenett-5000m/32ac0653-d95c-446c-8558-bf9b79f4934e">statistical grid from Norway (5x5km)</a> and resample this to a higher resolution of 50 x 50 meters.</p>
</div>
<div id="analyses-5" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> Analyses</h2>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up conditional file paths</span></span>
<span id="cb315-2"><a href="#cb315-2" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="fu">substr</span>(<span class="fu">getwd</span>(), <span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb315-3"><a href="#cb315-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb315-4"><a href="#cb315-4" aria-hidden="true" tabindex="-1"></a>pData <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dir <span class="sc">==</span> <span class="st">&quot;C:&quot;</span>, </span>
<span id="cb315-5"><a href="#cb315-5" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;P:/41201785_okologisk_tilstand_2022_2023/data/&quot;</span>,</span>
<span id="cb315-6"><a href="#cb315-6" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/&quot;</span>)</span></code></pre></div>
<p>Import data</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="co">#st_layers(paste0(pData, &quot;Basisdata_0000_Norge_25833_StatistiskRutenett5km_FGDB.gdb&quot;))</span></span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true" tabindex="-1"></a>grid_5km <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="fu">paste0</span>(pData, <span class="st">&quot;Basisdata_0000_Norge_25833_StatistiskRutenett5km_FGDB.gdb&quot;</span>)) </span></code></pre></div>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">&quot;view&quot;</span>)</span>
<span id="cb317-2"><a href="#cb317-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(grid_5km<span class="sc">$</span>SHAPE)<span class="sc">+</span></span>
<span id="cb317-3"><a href="#cb317-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>()</span></code></pre></div>
<p><img src="images/masterGrid_screenShot.PNG" width="800" /></p>
<p>Confirming CRS is EPSG25833:</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(grid_5km)</span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Coordinate Reference System:</span></span>
<span id="cb318-3"><a href="#cb318-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   User input: ETRS89 / UTM zone 33N </span></span>
<span id="cb318-4"><a href="#cb318-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   wkt:</span></span>
<span id="cb318-5"><a href="#cb318-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; PROJCRS[&quot;ETRS89 / UTM zone 33N&quot;,</span></span>
<span id="cb318-6"><a href="#cb318-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     BASEGEOGCRS[&quot;ETRS89&quot;,</span></span>
<span id="cb318-7"><a href="#cb318-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         ENSEMBLE[&quot;European Terrestrial Reference System 1989 ensemble&quot;,</span></span>
<span id="cb318-8"><a href="#cb318-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             MEMBER[&quot;European Terrestrial Reference Frame 1989&quot;],</span></span>
<span id="cb318-9"><a href="#cb318-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             MEMBER[&quot;European Terrestrial Reference Frame 1990&quot;],</span></span>
<span id="cb318-10"><a href="#cb318-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             MEMBER[&quot;European Terrestrial Reference Frame 1991&quot;],</span></span>
<span id="cb318-11"><a href="#cb318-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             MEMBER[&quot;European Terrestrial Reference Frame 1992&quot;],</span></span>
<span id="cb318-12"><a href="#cb318-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             MEMBER[&quot;European Terrestrial Reference Frame 1993&quot;],</span></span>
<span id="cb318-13"><a href="#cb318-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             MEMBER[&quot;European Terrestrial Reference Frame 1994&quot;],</span></span>
<span id="cb318-14"><a href="#cb318-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             MEMBER[&quot;European Terrestrial Reference Frame 1996&quot;],</span></span>
<span id="cb318-15"><a href="#cb318-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             MEMBER[&quot;European Terrestrial Reference Frame 1997&quot;],</span></span>
<span id="cb318-16"><a href="#cb318-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             MEMBER[&quot;European Terrestrial Reference Frame 2000&quot;],</span></span>
<span id="cb318-17"><a href="#cb318-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             MEMBER[&quot;European Terrestrial Reference Frame 2005&quot;],</span></span>
<span id="cb318-18"><a href="#cb318-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             MEMBER[&quot;European Terrestrial Reference Frame 2014&quot;],</span></span>
<span id="cb318-19"><a href="#cb318-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ELLIPSOID[&quot;GRS 1980&quot;,6378137,298.257222101,</span></span>
<span id="cb318-20"><a href="#cb318-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                 LENGTHUNIT[&quot;metre&quot;,1]],</span></span>
<span id="cb318-21"><a href="#cb318-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ENSEMBLEACCURACY[0.1]],</span></span>
<span id="cb318-22"><a href="#cb318-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         PRIMEM[&quot;Greenwich&quot;,0,</span></span>
<span id="cb318-23"><a href="#cb318-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],</span></span>
<span id="cb318-24"><a href="#cb318-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         ID[&quot;EPSG&quot;,4258]],</span></span>
<span id="cb318-25"><a href="#cb318-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     CONVERSION[&quot;UTM zone 33N&quot;,</span></span>
<span id="cb318-26"><a href="#cb318-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         METHOD[&quot;Transverse Mercator&quot;,</span></span>
<span id="cb318-27"><a href="#cb318-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,9807]],</span></span>
<span id="cb318-28"><a href="#cb318-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         PARAMETER[&quot;Latitude of natural origin&quot;,0,</span></span>
<span id="cb318-29"><a href="#cb318-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],</span></span>
<span id="cb318-30"><a href="#cb318-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,8801]],</span></span>
<span id="cb318-31"><a href="#cb318-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         PARAMETER[&quot;Longitude of natural origin&quot;,15,</span></span>
<span id="cb318-32"><a href="#cb318-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],</span></span>
<span id="cb318-33"><a href="#cb318-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,8802]],</span></span>
<span id="cb318-34"><a href="#cb318-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         PARAMETER[&quot;Scale factor at natural origin&quot;,0.9996,</span></span>
<span id="cb318-35"><a href="#cb318-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             SCALEUNIT[&quot;unity&quot;,1],</span></span>
<span id="cb318-36"><a href="#cb318-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,8805]],</span></span>
<span id="cb318-37"><a href="#cb318-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         PARAMETER[&quot;False easting&quot;,500000,</span></span>
<span id="cb318-38"><a href="#cb318-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             LENGTHUNIT[&quot;metre&quot;,1],</span></span>
<span id="cb318-39"><a href="#cb318-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,8806]],</span></span>
<span id="cb318-40"><a href="#cb318-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         PARAMETER[&quot;False northing&quot;,0,</span></span>
<span id="cb318-41"><a href="#cb318-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             LENGTHUNIT[&quot;metre&quot;,1],</span></span>
<span id="cb318-42"><a href="#cb318-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,8807]]],</span></span>
<span id="cb318-43"><a href="#cb318-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     CS[Cartesian,2],</span></span>
<span id="cb318-44"><a href="#cb318-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         AXIS[&quot;(E)&quot;,east,</span></span>
<span id="cb318-45"><a href="#cb318-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ORDER[1],</span></span>
<span id="cb318-46"><a href="#cb318-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             LENGTHUNIT[&quot;metre&quot;,1]],</span></span>
<span id="cb318-47"><a href="#cb318-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         AXIS[&quot;(N)&quot;,north,</span></span>
<span id="cb318-48"><a href="#cb318-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ORDER[2],</span></span>
<span id="cb318-49"><a href="#cb318-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             LENGTHUNIT[&quot;metre&quot;,1]],</span></span>
<span id="cb318-50"><a href="#cb318-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     USAGE[</span></span>
<span id="cb318-51"><a href="#cb318-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         SCOPE[&quot;Engineering survey, topographic mapping.&quot;],</span></span>
<span id="cb318-52"><a href="#cb318-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         AREA[&quot;Europe between 12°E and 18°E: Austria; Denmark - offshore and offshore; Germany - onshore and offshore; Norway including Svalbard - onshore and offshore.&quot;],</span></span>
<span id="cb318-53"><a href="#cb318-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         BBOX[46.4,12,84.42,18]],</span></span>
<span id="cb318-54"><a href="#cb318-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     ID[&quot;EPSG&quot;,25833]]</span></span></code></pre></div>
<div id="make-grid" class="section level3" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> Make grid</h3>
<p>Use the bbox and split into 50 x 50 meter cells</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a>(masterGrid_50m <span class="ot">&lt;-</span> <span class="fu">st_as_stars</span>(<span class="fu">st_bbox</span>(grid_5km), <span class="at">dx =</span> <span class="dv">50</span>, <span class="at">dy =</span> <span class="dv">50</span>))</span>
<span id="cb319-2"><a href="#cb319-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; stars object with 2 dimensions and 1 attribute</span></span>
<span id="cb319-3"><a href="#cb319-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; attribute(s), summary of first 1e+05 cells:</span></span>
<span id="cb319-4"><a href="#cb319-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span id="cb319-5"><a href="#cb319-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; values     0       0      0    0       0    0</span></span>
<span id="cb319-6"><a href="#cb319-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; dimension(s):</span></span>
<span id="cb319-7"><a href="#cb319-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   from    to  offset delta                refsys x/y</span></span>
<span id="cb319-8"><a href="#cb319-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; x    1 24500  -1e+05    50 ETRS89 / UTM zone 33N [x]</span></span>
<span id="cb319-9"><a href="#cb319-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; y    1 30800 7965000   -50 ETRS89 / UTM zone 33N [y]</span></span></code></pre></div>
<p>This file is 6GB.</p>
<p>Number of cells, in millions, is:</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">nrow</span>(masterGrid_50m)<span class="sc">*</span><span class="fu">ncol</span>(masterGrid_50m))<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span></span>
<span id="cb320-2"><a href="#cb320-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     x </span></span>
<span id="cb320-3"><a href="#cb320-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 754.6</span></span></code></pre></div>
<p>So, quite a lot. For the area accounts we might consider using 10x10m.</p>
</div>
<div id="eksport-file-final-product" class="section level3" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> Eksport file (final product)</h3>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a>stars<span class="sc">::</span><span class="fu">write_stars</span>(masterGrid_50m, <span class="fu">paste0</span>(pData, <span class="st">&quot;masterGrid_50m.tiff&quot;</span>))</span></code></pre></div>
</div>
<div id="test-import" class="section level3" number="8.3.3">
<h3><span class="header-section-number">8.3.3</span> Test import</h3>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> stars<span class="sc">::</span><span class="fu">read_stars</span>(<span class="fu">paste0</span>(pData, <span class="st">&quot;masterGrid_50m.tiff&quot;</span>))</span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_dimensions</span>(temp)</span>
<span id="cb322-3"><a href="#cb322-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   from    to  offset delta                refsys point x/y</span></span>
<span id="cb322-4"><a href="#cb322-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; x    1 24500  -1e+05    50 ETRS89 / UTM zone 33N FALSE [x]</span></span>
<span id="cb322-5"><a href="#cb322-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; y    1 30800 7965000   -50 ETRS89 / UTM zone 33N FALSE [y]</span></span></code></pre></div>
<!--chapter:end:master_grid.Rmd-->
</div>
</div>
</div>
<div id="climate-indicators-explained" class="section level1" number="9">
<h1><span class="header-section-number">9</span> Climate indicators explained</h1>
<p><br /></p>
<p><em>Author and date:</em></p>
<p>Anders L. Kolstad</p>
<p>March 2023</p>
<p><br /></p>
<!-- Load all you dependencies here -->
<table>
<thead>
<tr class="header">
<th align="left">Ecosystem</th>
<th align="left">Økologisk.egenskap</th>
<th align="left">ECT.class</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">All</td>
<td align="left">Abiotiske egenskaper</td>
<td align="left">Physical state characteristics</td>
</tr>
</tbody>
</table>
<p><br /> <br /></p>
<hr />
<div id="introduction-6" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Introduction</h2>
<p>This chapters describes the development of a workflow for generating or preparing indicators based on interpolated climate data from <a href="https://senorge.no/">SeNorge</a>. I describe the process using dummy data and also discuss alternate approaches and dead ends that occured in the development process. For a succinct workflow example for a specific indicator, see <a href="#median-summer-temp">Median summer temperature</a>.</p>
</div>
<div id="about-the-underlying-data-5" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> About the underlying data</h2>
<p>The data is in a raster format and extends back to 1957 in the form of multiple interpolated climate variables. The spatial resolution is 1 x 1 km.</p>
<div id="representativity-in-time-and-space-4" class="section level3" number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> Representativity in time and space</h3>
<p>The data includes the last normal period (1961-1990) which defines the reference condition for climate variables. Therefore the temporal resolution is very good. Also considering the daily resolution of the data.</p>
<p>Spatially, a 1x1 km resolution is sufficient for most climate variables, esp. in homogeneous terrain, but this needs to be evaluation for each variable and scenario specifically.</p>
</div>
<div id="original-units-3" class="section level3" number="9.2.2">
<h3><span class="header-section-number">9.2.2</span> Original units</h3>
<p>Varied. Specified below for each parameter.</p>
</div>
<div id="temporal-coverage-3" class="section level3" number="9.2.3">
<h3><span class="header-section-number">9.2.3</span> Temporal coverage</h3>
<p>1957 - present</p>
</div>
<div id="additional-comments-about-the-data-set-1" class="section level3" number="9.2.4">
<h3><span class="header-section-number">9.2.4</span> Additional comments about the data set</h3>
<p>The data format has recently changed from .BIL to .nc (netcdf) and now a single file contains all the rasters for one year (365 days), and sometimes for multiple variables also.</p>
</div>
</div>
<div id="ecosystem-characteristic-3" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> Ecosystem characteristic</h2>
<div id="norwegian-standard-2" class="section level3" number="9.3.1">
<h3><span class="header-section-number">9.3.1</span> Norwegian standard</h3>
<p>These variables typically will fall under the <em>abiotiske egenskaper</em> class.</p>
</div>
<div id="seea-ea-1" class="section level3" number="9.3.2">
<h3><span class="header-section-number">9.3.2</span> SEEA EA</h3>
<p>In SEEA EA, these variables will typically fall under A1 - Physical state characteristics.</p>
</div>
</div>
<div id="collinearities-with-other-indicators-3" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> Collinearities with other indicators</h2>
<p>Climate variables are most likely to be correlated with each other (e.g. temperature and snow). Also, some climate variables are better classed as pressure indicators, and these might have a causal association with several condition indicators.</p>
</div>
<div id="reference-condition-and-values-2" class="section level2" number="9.5">
<h2><span class="header-section-number">9.5</span> Reference condition and values</h2>
<div id="reference-condition-2" class="section level3" number="9.5.1">
<h3><span class="header-section-number">9.5.1</span> Reference condition</h3>
<p>The reference condition for climate variables is defined as the normal period 1961-1990.</p>
</div>
<div id="reference-values-thresholds-for-defining-good-ecological-condition-minimum-andor-maximum-values-3" class="section level3" number="9.5.2">
<h3><span class="header-section-number">9.5.2</span> Reference values, thresholds for defining <em>good ecological condition</em>, minimum and/or maximum values</h3>
<ul>
<li><p>Un-scaled indicator value = median value over 5 year periods (5 years being a pragmatic choice. It is long enough to smooth out a lot of inter-annual variation, and it’s long enough to enable estimating errors)</p></li>
<li><p>Upper reference level (best possible condition) = median value from the reference period</p></li>
<li><p>Thresholds for good ecosystem condition = 2 standard deviation units away from the upper reference level for the climate variable during the reference period.</p></li>
<li><p>Lower reference values (two-directional) = 5 standard deviation units for the climate variable during the reference period (implies linear scaling).</p></li>
</ul>
<p>The choice to use 2 SD units as the threshold values is a subjective choice in many ways, and not founded in any empirical or known relationship between the indicators and ecosystem integrity. The value comes from the common practice of calling something <em>extreme weather</em> when it is outside 2 SD units of the current running average. So, if the indicator value today is &lt;0.6 it implies that the mean for that variable over the last year would have been referred to as <em>extreme</em> if it had occurred between 1961 and 1990. This is I think a conservative threshold, since one would/could call it <em>extreme</em> if only one year is outside the 2SD range, and having the mean of 5 years being outside this range is <em>really</em> extreme.</p>
</div>
</div>
<div id="uncertainties-3" class="section level2" number="9.6">
<h2><span class="header-section-number">9.6</span> Uncertainties</h2>
<p>For the indicator map (1 x 1 km raster) there is no uncertainty associated with the indicator values. For aggregated indicator values (e.g. for regions), the uncertainty in the indicator value is calculated from the spatial variation in the indicator values via bootstrapping. This might, however, be changed later to the temporal variation between the five years of each period.</p>
</div>
<div id="references-4" class="section level2" number="9.7">
<h2><span class="header-section-number">9.7</span> References</h2>
<p><a href="https://senorge.no/" class="uri">https://senorge.no/</a></p>
<p><em>rr and tm are being download from:</em> <a href="https://thredds.met.no/thredds/catalog/senorge/seNorge_2018/Archive/catalog.html" class="uri">https://thredds.met.no/thredds/catalog/senorge/seNorge_2018/Archive/catalog.html</a></p>
<div id="additional-resources-1" class="section level3" number="9.7.1">
<h3><span class="header-section-number">9.7.1</span> Additional resources</h3>
<p><a href="https://r-spatial.github.io/stars/">Stars package</a></p>
<p><a href="https://tmieno2.github.io/R-as-GIS-for-Economists/stars-basics.html">R as a GIS for economists</a> chapter 7</p>
<p><hl/></p>
</div>
</div>
<div id="analyses-6" class="section level2" number="9.8">
<h2><span class="header-section-number">9.8</span> Analyses</h2>
<div id="data-set-1" class="section level3" number="9.8.1">
<h3><span class="header-section-number">9.8.1</span> Data set</h3>
<p>The data is downloaded to a local NINA server, and updated regularly.</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dir <span class="sc">==</span> <span class="st">&quot;C:&quot;</span>, </span>
<span id="cb323-2"><a href="#cb323-2" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;R:/GeoSpatialData/Meteorology/Norway_SeNorge2018_v22.09/Original&quot;</span>,</span>
<span id="cb323-3"><a href="#cb323-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;/data/R/GeoSpatialData/Meteorology/Norway_SeNorge2018_v22.09/Original&quot;</span>)</span></code></pre></div>
<p>This folder contains folder for the different parameters</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a>(files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(path))</span>
<span id="cb324-2"><a href="#cb324-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;age&quot;        &quot;fsw&quot;        &quot;gwb_eva&quot;    &quot;gwb_gwtcl&quot; </span></span>
<span id="cb324-3"><a href="#cb324-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;gwb_q&quot;      &quot;gwb_sssdev&quot; &quot;gwb_sssrel&quot; &quot;lwc&quot;       </span></span>
<span id="cb324-4"><a href="#cb324-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;qsw&quot;        &quot;rr_tm&quot;      &quot;sd&quot;         &quot;sdfsw&quot;     </span></span>
<span id="cb324-5"><a href="#cb324-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [13] &quot;swe&quot;</span></span></code></pre></div>
<p>This table explains them in more detail</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a>senorgelayers <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">&quot;data/senorgelayers.txt&quot;</span>, </span>
<span id="cb325-2"><a href="#cb325-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">delim =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">escape_double =</span> <span class="cn">FALSE</span>, </span>
<span id="cb325-3"><a href="#cb325-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">trim_ws =</span> <span class="cn">TRUE</span>)</span>
<span id="cb325-4"><a href="#cb325-4" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(senorgelayers)</span></code></pre></div>
<div class="figure">
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-0031da50b6e66f4f7b8f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0031da50b6e66f4f7b8f">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16"],["sdfsw","fsw","sd","age","swe","#swepr","#swepr","qsw","lwc","gwb_q","gwb_eva","gwb_gwtcl","gwb_sssdev","gwb_sssrel","tm","rr"],["16","8","16","8","16","no longer included","16","8","8","16","8","8","16","16","16","16"],[65535,255,65535,255,65535,null,65535,255,255,65535,255,255,32767,65535,65535,65535],[65534,254,null,254,null,null,null,254,254,null,null,null,null,null,null,null],["fresh snow depth","fresh snow","snow depth","snow age","snow water equivalent",null,"snow water equivalent percentage","snow melt","free water content in snow","runoff","evapotranspiration","ground water condition","water capacity of the soil","current water saturation of the soil","temperature","precipitation"],["mm","mm (water equivalent)","mm","number of days since last snowfall","1/10 mm (water equivalent)",null,"1/10 %","mm (water equivalent)","1/10 % free water in the snow layer","1/10 mm","1/10 mm","24h percentile of the normal period","mm in relation to maximum value of the normal period","% of the maximum value of the normal period","celsius","mm"],["Nysnødybde","Nysnø","Snødybde","Snøens alder","Snømengde",null,"Prosentandel swe","Snøsmelting","Snøtilstand","Avrenning","Fordamping","Grunnvannstilstand","Jordas vannkapasitet","Vannmetting i jord","Temperatur","Nedbør"],["Verdier i fil i 16bit integer verdier som angir mm snødybde.","Verdier angir mm vannekvivalent.","Verdier angir mm snødybde.","Verdiene angir antall dager siden siste snøfall.","Verdiene angir 1/10mm vannekvivalent. Altså en verdi på 102 er 10.2 mm vann.",null,"Veldig uklar beskrivelse gitt av NVE. Må sjekkes!","Verdiene angir mm vannekvivalent.","Verdien angir i prosent hvor mye fritt vann det er i snøpakka. Oppgitt i 1/10 %. En verdi på 45 er altså 4.5%.","Angir avrenning i 1/10mm vann. En verdi på 34 er altså 3.4 mm.","Angir fordampning i 1/10 mm vann.","Verdien angir hvilken døgnpercentilene i normalperioden som verdien tilhører. Verdiene er her 5, 25, 50, 75 og 95.","Verdien angir lagerkapasiteten (i mm) i forhold til maxverdien registrert i 30 årsperioden (1981-2010). Negativ verdi betyr altså at dagens vannlager verdi er over maxverdien.","Dagens vannlager verdi i prosent av den samme maksimale verdien som brukes i gwb_ssdev. En verdi over 100 angir altså at maksverdien er overskredet.","Verdien angir grader i Celsius (re-skalert fra tiendels Kelvin, der en verdi på 2811 er (2811-2731)/10 = 8.0 C.","Verdien angir nedbør i mm (re-skalert fra tiendels mm)."],["gt_Meteorology_Norway_seNorge_FreshSnowDepth_days","gt_Meteorology_Norway_seNorge_FreshSnow_days","gt_Meteorology_Norway_seNorge_SnowDepth_days","gt_Meteorology_Norway_seNorge_SnowAge_days","gt_Meteorology_Norway_seNorge_SnowAmount_days",null,"gt_Meteorology_Norway_seNorge_SnowAmountPercentage_days","gt_Meteorology_Norway_seNorge_SnowMelt_days","gt_Meteorology_Norway_seNorge_SnowFreeWaterContent_days","gt_Meteorology_Norway_seNorge_Runoff_days","gt_Meteorology_Norway_seNorge_Evapotranspiration_days","gt_Meteorology_Norway_seNorge_GroundWaterCondition_days","gt_Meteorology_Norway_seNorge_WaterCapacitySoil_days","gt_Meteorology_Norway_seNorge_WaterSaturationSoil_days","gt_Meteorology_Norway_seNorge_Temperature_days","gt_Meteorology_Norway_seNorge_Precipitation_days"],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,"celsius","precipitation_daily"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>abbrev<\/th>\n      <th>bit<\/th>\n      <th>nodata<\/th>\n      <th>bare_ground<\/th>\n      <th>name<\/th>\n      <th>unit<\/th>\n      <th>navn<\/th>\n      <th>beskrivelse<\/th>\n      <th>grass_mapset<\/th>\n      <th>color_table<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
(#fig:unnamed-chunk-5)Table explaining the available climate parameters in the data set.
</p>
</div>
<p>Here is the content of one of these folders (first 10 entries)</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a>(files_tm <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="fu">paste0</span>(path, <span class="st">&quot;/rr_tm&quot;</span>)))[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb326-2"><a href="#cb326-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;seNorge2018_1957.nc&quot; &quot;seNorge2018_1958.nc&quot;</span></span>
<span id="cb326-3"><a href="#cb326-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [3] &quot;seNorge2018_1959.nc&quot; &quot;seNorge2018_1960.nc&quot;</span></span>
<span id="cb326-4"><a href="#cb326-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;seNorge2018_1961.nc&quot; &quot;seNorge2018_1962.nc&quot;</span></span>
<span id="cb326-5"><a href="#cb326-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [7] &quot;seNorge2018_1963.nc&quot; &quot;seNorge2018_1964.nc&quot;</span></span>
<span id="cb326-6"><a href="#cb326-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;seNorge2018_1965.nc&quot; &quot;seNorge2018_1966.nc&quot;</span></span></code></pre></div>
<p>There are 67 files, i.e. 67 years of data, one file per year.</p>
<p>Importing (proxy) file:</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a>tg_1957 <span class="ot">&lt;-</span> stars<span class="sc">::</span><span class="fu">read_ncdf</span>(<span class="fu">paste0</span>(path, <span class="st">&quot;/rr_tm/seNorge2018_1957.nc&quot;</span>),</span>
<span id="cb327-2"><a href="#cb327-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">var=</span><span class="st">&quot;tg&quot;</span>)</span>
<span id="cb327-3"><a href="#cb327-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Large netcdf source found, returning proxy object.</span></span></code></pre></div>
<p>I know the CRS, so setting it manually. Although I cannot rule out 32633, I don’t think it matters.</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(tg_1957) <span class="ot">&lt;-</span> <span class="dv">25833</span></span></code></pre></div>
<p>The data has three dimension</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(tg_1957)</span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    X    Y time </span></span>
<span id="cb329-3"><a href="#cb329-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1195 1550  365</span></span></code></pre></div>
<p>Initially the data had four attributes, but I subsettet to only include <em>tg</em>.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(tg_1957)</span>
<span id="cb330-2"><a href="#cb330-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;tg&quot;</span></span></code></pre></div>
<p><code>tg_1957</code> is a stars proxy object and <a href="https://r-spatial.github.io/stars/articles/stars8.html">most commands</a> will not initiate any change until later, typically I write to file and all the lazy operations are done in squeal. Therefore, I will prepare a test data set, which is smaller and which I can import to memory. Then I can perform the operations on that data set and we can see the results.</p>
<div id="dummy-data" class="section level4" number="9.8.1.1">
<h4><span class="header-section-number">9.8.1.1</span> Dummy data</h4>
<p>This test data is included in the {stars} package</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a>tif <span class="ot">=</span> <span class="fu">system.file</span>(<span class="st">&quot;tif/L7_ETMs.tif&quot;</span>, <span class="at">package =</span> <span class="st">&quot;stars&quot;</span>)</span>
<span id="cb331-2"><a href="#cb331-2" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">&quot;1970-05-31&quot;</span>)</span>
<span id="cb331-3"><a href="#cb331-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">read_stars</span>(<span class="fu">c</span>(tif, tif, tif, tif), <span class="at">along =</span> </span>
<span id="cb331-4"><a href="#cb331-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="at">time =</span> <span class="fu">c</span>(t1, t1<span class="sc">+</span><span class="dv">1</span>, t1<span class="sc">+</span><span class="dv">50</span>, t1<span class="sc">+</span><span class="dv">100</span>)), </span>
<span id="cb331-5"><a href="#cb331-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">RasterIO =</span> <span class="fu">list</span>(<span class="at">nXOff =</span> <span class="fu">c</span>(<span class="dv">1</span>), </span>
<span id="cb331-6"><a href="#cb331-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">nYOff =</span> <span class="fu">c</span>(<span class="dv">1</span>), </span>
<span id="cb331-7"><a href="#cb331-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">nXSize =</span> <span class="dv">50</span>, </span>
<span id="cb331-8"><a href="#cb331-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">nYSize =</span> <span class="dv">50</span>, </span>
<span id="cb331-9"><a href="#cb331-9" aria-hidden="true" tabindex="-1"></a>                               <span class="at">bands =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)))</span></code></pre></div>
<p>A single attribute</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(x)</span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;L7_ETMs.tif&quot;</span></span></code></pre></div>
<p>I can rename it like this</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">setNames</span>(x, <span class="st">&quot;Attribute_A&quot;</span>)</span></code></pre></div>
<p>And I can add another dummy attribute.</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span></span>
<span id="cb334-2"><a href="#cb334-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">&quot;Attribute_B&quot;</span> <span class="ot">=</span> Attribute_A<span class="sc">/</span><span class="dv">2</span>)</span></code></pre></div>
<p>The dummy data also has four dimensions</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(x)</span>
<span id="cb335-2"><a href="#cb335-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    x    y band time </span></span>
<span id="cb335-3"><a href="#cb335-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   50   50    6    4</span></span></code></pre></div>
<p>X and y area the coordinates. Band is an integer:</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_get_dimension_values</span>(x, <span class="st">&quot;band&quot;</span>)</span>
<span id="cb336-2"><a href="#cb336-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1 2 3 4 5 6</span></span></code></pre></div>
<p>I will remove the <em>band</em> dimension.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span> <span class="fu">filter</span>(band<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">adrop</span>()</span></code></pre></div>
<p>Time is four dates covering four months in 1970:</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a>(oldTime <span class="ot">&lt;-</span> <span class="fu">st_get_dimension_values</span>(x, <span class="st">&quot;time&quot;</span>))</span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;1970-05-31&quot; &quot;1970-06-01&quot; &quot;1970-07-20&quot; &quot;1970-09-08&quot;</span></span></code></pre></div>
<p>I’ll add some extra seasonal variation between to the mix</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>Attribute_A[,,<span class="dv">2</span>] <span class="ot">&lt;-</span> x<span class="sc">$</span>Attribute_A[,,<span class="dv">1</span>]<span class="sc">*</span><span class="fl">1.2</span></span>
<span id="cb339-2"><a href="#cb339-2" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>Attribute_A[,,<span class="dv">3</span>] <span class="ot">&lt;-</span> x<span class="sc">$</span>Attribute_A[,,<span class="dv">1</span>]<span class="sc">*</span><span class="fl">1.4</span></span>
<span id="cb339-3"><a href="#cb339-3" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>Attribute_A[,,<span class="dv">4</span>] <span class="ot">&lt;-</span> x<span class="sc">$</span>Attribute_A[,,<span class="dv">1</span>]<span class="sc">*</span><span class="fl">1.1</span></span></code></pre></div>
<p>Now I create another four copies of this data, adding some random noise and a continuous decreasing trend.</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to add random noise</span></span>
<span id="cb340-2"><a href="#cb340-2" aria-hidden="true" tabindex="-1"></a>myRandom <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x<span class="sc">*</span><span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">1</span>,.<span class="dv">05</span>)</span></code></pre></div>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> x</span>
<span id="cb341-2"><a href="#cb341-2" aria-hidden="true" tabindex="-1"></a>y2 <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span> <span class="fu">st_apply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, myRandom) <span class="sc">%&gt;%</span> <span class="fu">st_set_dimensions</span>(<span class="st">&quot;time&quot;</span>, <span class="at">values =</span> oldTime <span class="sc">%m+%</span> <span class="fu">years</span>(<span class="sc">-</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Attribute_A =</span> Attribute_A<span class="sc">*</span><span class="fl">0.95</span>)</span>
<span id="cb341-3"><a href="#cb341-3" aria-hidden="true" tabindex="-1"></a>y3 <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span> <span class="fu">st_apply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, myRandom) <span class="sc">%&gt;%</span> <span class="fu">st_set_dimensions</span>(<span class="st">&quot;time&quot;</span>, <span class="at">values =</span> oldTime <span class="sc">%m+%</span> <span class="fu">years</span>(<span class="sc">-</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Attribute_A =</span> Attribute_A<span class="sc">*</span><span class="fl">0.90</span>)</span>
<span id="cb341-4"><a href="#cb341-4" aria-hidden="true" tabindex="-1"></a>y4 <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span> <span class="fu">st_apply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, myRandom) <span class="sc">%&gt;%</span> <span class="fu">st_set_dimensions</span>(<span class="st">&quot;time&quot;</span>, <span class="at">values =</span> oldTime <span class="sc">%m+%</span> <span class="fu">years</span>(<span class="sc">-</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Attribute_A =</span> Attribute_A<span class="sc">*</span><span class="fl">0.85</span>)</span>
<span id="cb341-5"><a href="#cb341-5" aria-hidden="true" tabindex="-1"></a>y5 <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span> <span class="fu">st_apply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, myRandom) <span class="sc">%&gt;%</span> <span class="fu">st_set_dimensions</span>(<span class="st">&quot;time&quot;</span>, <span class="at">values =</span> oldTime <span class="sc">%m+%</span> <span class="fu">years</span>(<span class="sc">-</span><span class="dv">4</span>)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Attribute_A =</span> Attribute_A<span class="sc">*</span><span class="fl">0.80</span>)</span></code></pre></div>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We combine the data into one cube for plotting:</span></span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">c</span>(y1, y2, y3, y4, y5) </span>
<span id="cb342-3"><a href="#cb342-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-4"><a href="#cb342-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb342-5"><a href="#cb342-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> temp) <span class="sc">+</span></span>
<span id="cb342-6"><a href="#cb342-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb342-7"><a href="#cb342-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb342-8"><a href="#cb342-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;D&quot;</span>) <span class="sc">+</span>  </span>
<span id="cb342-9"><a href="#cb342-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb342-10"><a href="#cb342-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb342-11"><a href="#cb342-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>time, <span class="at">ncol=</span><span class="dv">4</span>)</span></code></pre></div>
<p><img src="climate_indicators_explained_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>Saving these to file.</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="st">&quot;P:/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/dummy_data&quot;</span></span>
<span id="cb343-2"><a href="#cb343-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(y1, <span class="fu">paste0</span>(path, <span class="st">&quot;/y1.rds&quot;</span>))</span>
<span id="cb343-3"><a href="#cb343-3" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(y2, <span class="fu">paste0</span>(path, <span class="st">&quot;/y2.rds&quot;</span>))</span>
<span id="cb343-4"><a href="#cb343-4" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(y3, <span class="fu">paste0</span>(path, <span class="st">&quot;/y3.rds&quot;</span>))</span>
<span id="cb343-5"><a href="#cb343-5" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(y4, <span class="fu">paste0</span>(path, <span class="st">&quot;/y4.rds&quot;</span>))</span>
<span id="cb343-6"><a href="#cb343-6" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(y5, <span class="fu">paste0</span>(path, <span class="st">&quot;/y5.rds&quot;</span>))</span></code></pre></div>
<div id="dummy-regions-and-et-map" class="section level5" number="9.8.1.1.1">
<h5><span class="header-section-number">9.8.1.1.1</span> Dummy regions and ET map</h5>
<p>Here is some dummy data for accounting areas (regions) and ecosystem occurrences as well, in case I need them later.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a>dummy_aa <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span></span>
<span id="cb344-2"><a href="#cb344-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time <span class="sc">==</span> oldTime[<span class="dv">1</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb344-3"><a href="#cb344-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adrop</span>() <span class="sc">%&gt;%</span></span>
<span id="cb344-4"><a href="#cb344-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">accountingAreas =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">each=</span><span class="fu">length</span>(Attribute_A)<span class="sc">/</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb344-5"><a href="#cb344-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(accountingAreas)</span>
<span id="cb344-6"><a href="#cb344-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-7"><a href="#cb344-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(dummy_aa) <span class="sc">+</span></span>
<span id="cb344-8"><a href="#cb344-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">style=</span><span class="st">&quot;cat&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="climate_indicators_explained_files/figure-html/unnamed-chunk-24-1.png" alt="Showing the example account area delineation (raster format)" width="672" />
<p class="caption">
(#fig:unnamed-chunk-24)Showing the example account area delineation (raster format)
</p>
</div>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a>dummy_et <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span></span>
<span id="cb345-2"><a href="#cb345-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time <span class="sc">==</span> oldTime[<span class="dv">1</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb345-3"><a href="#cb345-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adrop</span>() <span class="sc">%&gt;%</span></span>
<span id="cb345-4"><a href="#cb345-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ecosystemType =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="cn">NA</span>), <span class="at">length.out =</span> <span class="fu">length</span>(Attribute_A))) <span class="sc">%&gt;%</span></span>
<span id="cb345-5"><a href="#cb345-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ecosystemType)</span>
<span id="cb345-6"><a href="#cb345-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-7"><a href="#cb345-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(dummy_et) <span class="sc">+</span></span>
<span id="cb345-8"><a href="#cb345-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">style=</span><span class="st">&quot;cat&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="climate_indicators_explained_files/figure-html/unnamed-chunk-25-1.png" alt="Showing the example Ecosystem type delineation data." width="672" />
<p class="caption">
(#fig:unnamed-chunk-25)Showing the example Ecosystem type delineation data.
</p>
</div>
</div>
</div>
<div id="regions-2" class="section level4" number="9.8.1.2">
<h4><span class="header-section-number">9.8.1.2</span> Regions</h4>
<p>Importing a shape file with the regional delineation.</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a>reg <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">&quot;data/regions.shp&quot;</span>, <span class="at">options =</span> <span class="st">&quot;ENCODING=UTF8&quot;</span>)</span>
<span id="cb346-2"><a href="#cb346-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; options:        ENCODING=UTF8 </span></span>
<span id="cb346-3"><a href="#cb346-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Reading layer `regions&#39; from data source </span></span>
<span id="cb346-4"><a href="#cb346-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   `/data/scratch/Matt_bookdown__debug/ecosystemCondition/data/regions.shp&#39; </span></span>
<span id="cb346-5"><a href="#cb346-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   using driver `ESRI Shapefile&#39;</span></span>
<span id="cb346-6"><a href="#cb346-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 5 features and 2 fields</span></span>
<span id="cb346-7"><a href="#cb346-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span id="cb346-8"><a href="#cb346-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb346-9"><a href="#cb346-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -99551.21 ymin: 6426048 xmax: 1121941 ymax: 7962744</span></span>
<span id="cb346-10"><a href="#cb346-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Projected CRS: ETRS89 / UTM zone 33N</span></span>
<span id="cb346-11"><a href="#cb346-11" aria-hidden="true" tabindex="-1"></a><span class="co">#st_crs(reg)</span></span></code></pre></div>
<p>Outline of Norway</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="#cb347-1" aria-hidden="true" tabindex="-1"></a>nor <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">&quot;data/outlineOfNorway_EPSG25833.shp&quot;</span>)</span>
<span id="cb347-2"><a href="#cb347-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Reading layer `outlineOfNorway_EPSG25833&#39; from data source </span></span>
<span id="cb347-3"><a href="#cb347-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   `/data/scratch/Matt_bookdown__debug/ecosystemCondition/data/outlineOfNorway_EPSG25833.shp&#39; </span></span>
<span id="cb347-4"><a href="#cb347-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   using driver `ESRI Shapefile&#39;</span></span>
<span id="cb347-5"><a href="#cb347-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 1 feature and 2 fields</span></span>
<span id="cb347-6"><a href="#cb347-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb347-7"><a href="#cb347-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb347-8"><a href="#cb347-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -113472.7 ymin: 6448359 xmax: 1114618 ymax: 7939917</span></span>
<span id="cb347-9"><a href="#cb347-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Projected CRS: ETRS89 / UTM zone 33N</span></span></code></pre></div>
<p>Remove marine areas from regions</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a>reg <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(reg, nor)</span>
<span id="cb348-2"><a href="#cb348-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: attribute variables are assumed to be spatially</span></span>
<span id="cb348-3"><a href="#cb348-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; constant throughout all geometries</span></span></code></pre></div>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(reg) <span class="sc">+</span></span>
<span id="cb349-2"><a href="#cb349-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col=</span><span class="st">&quot;region&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="climate_indicators_explained_files/figure-html/unnamed-chunk-29-1.png" alt="Five accounting areas (regions) in Norway." width="672" />
<p class="caption">
(#fig:unnamed-chunk-29)Five accounting areas (regions) in Norway.
</p>
</div>
</div>
<div id="ecosystem-map-2" class="section level4" number="9.8.1.3">
<h4><span class="header-section-number">9.8.1.3</span> Ecosystem map</h4>
<p>Coming soon ….</p>
<p>The climate indicators need to be masked with ecosystem type maps. This step is part of this chapter.</p>
</div>
</div>
<div id="conceptual-workflow-1" class="section level3" number="9.8.2">
<h3><span class="header-section-number">9.8.2</span> Conceptual workflow</h3>
<p>The general, the conceptual workflow is like this:</p>
<ol style="list-style-type: decimal">
<li><p>Collate variable data series</p>
<ul>
<li><p>Import .nc files (loop though year 1961-1990) and subset to the correct attribute</p></li>
<li><p>Filter data by dates (optional) (<code>dplyr::filter</code>). <em>This means reading all 365 rasters into memory, and it is much quicker to filter out the correct rasters in the importing step above (see examples later in this chapter)</em></p></li>
<li><p>Aggregate across time within a year (<code>stars::st_apply</code>). <em>This is the most time consuming operation in the workflow.</em></p></li>
<li><p>Join all data into one data cube (<code>stars:c</code>)</p></li>
</ul></li>
<li><p>Calculate reference values</p>
<ul>
<li><p>Aggregate (<code>st_apply)</code> across reference years (<code>dplyr::filter</code>) to get median and sd values</p></li>
<li><p>Join with existing data cube (<code>stars:c</code>)</p></li>
</ul></li>
<li><p>Calculate indicator values</p>
<ul>
<li>Normalize climate variable at the individual grid cell level using the three reference values (<code>mutate(across()))</code></li>
</ul></li>
<li><p>Mask by ecosystem type (<em>This could also be done in step one, but it doesn’t speed things up to set some cells to NA</em>)</p></li>
<li><p>Aggregate in space (to accounting areas) (<em>zonal statistics</em>)</p>
<ul>
<li><p>Aggregate across 5 year time steps to smooth out random inter-annual variation and leave climate signal</p></li>
<li><p>Intersect with accounting area polygons <code>exactextrar::exact_extract</code> and get mean/median and (spatial) sd. (<em>Alternatively, get temporal sd at the grid cell level in the step above.</em>)</p></li>
</ul></li>
<li><p>Make trend figure and spatially aggregated maps,</p></li>
</ol>
</div>
<div id="collate-variable-data-series" class="section level3" number="9.8.3">
<h3><span class="header-section-number">9.8.3</span> Collate variable data series</h3>
<p>I include a for loop for importing the .nc files at the end.</p>
</div>
<div id="filter-data-by-dates" class="section level3" number="9.8.4">
<h3><span class="header-section-number">9.8.4</span> Filter data by dates</h3>
<p>Say we want to calculate the mean summer temperature. We then want to exclude the data for the times that is not withing our definition of summer.</p>
<p>Let’s try it on the dummy data. Remember this data had four time steps.</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_get_dimension_values</span>(x, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb350-2"><a href="#cb350-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;1970-05-31&quot; &quot;1970-06-01&quot; &quot;1970-07-20&quot; &quot;1970-09-08&quot;</span></span></code></pre></div>
<p>Our real data has 365 time steps for each year.</p>
<p>First I define my start and end dates. I want to keep only the summer data, defined as jun - aug.</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a>start_month <span class="ot">&lt;-</span>  <span class="st">&quot;06&quot;</span></span>
<span id="cb351-2"><a href="#cb351-2" aria-hidden="true" tabindex="-1"></a>end_month <span class="ot">&lt;-</span> <span class="st">&quot;08&quot;</span></span></code></pre></div>
<p>Then for each iteration I need to get the year as well</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true" tabindex="-1"></a>(year_temp <span class="ot">&lt;-</span> <span class="fu">year</span>(<span class="fu">st_get_dimension_values</span>(x, <span class="st">&quot;time&quot;</span>)[<span class="dv">1</span>]))</span>
<span id="cb352-2"><a href="#cb352-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1970</span></span></code></pre></div>
<p>Then I can create a time interval object</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> <span class="fu">ym</span>(<span class="fu">paste</span>(year_temp, start_month, <span class="at">sep=</span><span class="st">&quot;-&quot;</span>))</span>
<span id="cb353-2"><a href="#cb353-2" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span>  <span class="fu">ym</span>(<span class="fu">paste</span>(year_temp, end_month, <span class="at">sep=</span><span class="st">&quot;-&quot;</span>))</span>
<span id="cb353-3"><a href="#cb353-3" aria-hidden="true" tabindex="-1"></a>(myInterval <span class="ot">&lt;-</span> <span class="fu">interval</span>(start, end))</span>
<span id="cb353-4"><a href="#cb353-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1970-06-01 UTC--1970-08-01 UTC</span></span></code></pre></div>
<p>Then I filter</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a>x_aug <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span></span>
<span id="cb354-2"><a href="#cb354-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Attribute_A) <span class="sc">%&gt;%</span></span>
<span id="cb354-3"><a href="#cb354-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adrop</span>() <span class="sc">%&gt;%</span></span>
<span id="cb354-4"><a href="#cb354-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time <span class="sc">%within%</span> myInterval)</span>
<span id="cb354-5"><a href="#cb354-5" aria-hidden="true" tabindex="-1"></a><span class="fu">st_get_dimension_values</span>(x_aug, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb354-6"><a href="#cb354-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;1970-06-01&quot; &quot;1970-07-20&quot;</span></span></code></pre></div>
<p><em>Later I discover that `dplyr::filter` work after reading the whole object to file, and therefor it is too slow for our use. I therefore filter data a different way further down.</em></p>
</div>
<div id="aggregate-across-time-within-a-year" class="section level3" number="9.8.5">
<h3><span class="header-section-number">9.8.5</span> Aggregate across time within a year</h3>
<p>For this example I want to calculate the mean temperature over the summer. I therefore need to aggregate over time. Many climate indicators will need this functionality. There are two ways, either using <code>st_apply</code> or using <code>aggregate</code>.</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a>temp_names <span class="ot">&lt;-</span> <span class="fu">year</span>(<span class="fu">st_get_dimension_values</span>(x_aug, <span class="st">&quot;time&quot;</span>)[<span class="dv">1</span>])</span>
<span id="cb355-2"><a href="#cb355-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-3"><a href="#cb355-3" aria-hidden="true" tabindex="-1"></a>microOut <span class="ot">&lt;-</span> <span class="fu">microbenchmark</span>(</span>
<span id="cb355-4"><a href="#cb355-4" aria-hidden="true" tabindex="-1"></a><span class="at">st_apply =</span>  x_aug <span class="sc">%&gt;%</span></span>
<span id="cb355-5"><a href="#cb355-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_apply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, mean) <span class="sc">%&gt;%</span></span>
<span id="cb355-6"><a href="#cb355-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">paste0</span>(<span class="st">&quot;v_&quot;</span>,temp_names)),</span>
<span id="cb355-7"><a href="#cb355-7" aria-hidden="true" tabindex="-1"></a><span class="at">aggregate =</span> x_aug <span class="sc">%&gt;%</span></span>
<span id="cb355-8"><a href="#cb355-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aggregate</span>(<span class="at">by =</span> <span class="st">&quot;year&quot;</span>, mean),</span>
<span id="cb355-9"><a href="#cb355-9" aria-hidden="true" tabindex="-1"></a><span class="at">times=</span><span class="dv">30</span></span>
<span id="cb355-10"><a href="#cb355-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>The time dimension is now gone as we have aggregated across it.</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(microOut)</span>
<span id="cb356-2"><a href="#cb356-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Coordinate system already present. Adding new coordinate</span></span>
<span id="cb356-3"><a href="#cb356-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; system, which will replace the existing one.</span></span></code></pre></div>
<div class="figure">
<img src="climate_indicators_explained_files/figure-html/unnamed-chunk-36-1.png" alt="Comparing computation tome for two spatial aggregation functions." width="672" />
<p class="caption">
(#fig:unnamed-chunk-36)Comparing computation tome for two spatial aggregation functions.
</p>
</div>
<p><code>st_apply</code> is slightly faster, but <code>aggregate</code> has the advantage of that it retains the time dimension, whereas for <code>st_apply</code> I need to set the attribute name to be the year. I will try to use <code>st_apply</code>.</p>
<p>But let me see if I can save time by masking to ET before doing this operation.</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="#cb357-1" aria-hidden="true" tabindex="-1"></a>x_masked <span class="ot">&lt;-</span> x_aug</span>
<span id="cb357-2"><a href="#cb357-2" aria-hidden="true" tabindex="-1"></a>x_masked[<span class="fu">is.na</span>(dummy_et)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb357-3"><a href="#cb357-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x_masked[,,,<span class="dv">1</span>])</span></code></pre></div>
<div class="figure">
<img src="climate_indicators_explained_files/figure-html/unnamed-chunk-37-1.png" alt="Demonstrating the effect of maskig the dummy data using a perfectly aligne raster ET map." width="672" />
<p class="caption">
(#fig:unnamed-chunk-37)Demonstrating the effect of maskig the dummy data using a perfectly aligne raster ET map.
</p>
</div>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(</span>
<span id="cb358-2"><a href="#cb358-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">microbenchmark</span>(</span>
<span id="cb358-3"><a href="#cb358-3" aria-hidden="true" tabindex="-1"></a><span class="at">No_masking =</span>  x_aug <span class="sc">%&gt;%</span></span>
<span id="cb358-4"><a href="#cb358-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_apply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, mean) <span class="sc">%&gt;%</span></span>
<span id="cb358-5"><a href="#cb358-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">paste0</span>(<span class="st">&quot;v_&quot;</span>,temp_names)),</span>
<span id="cb358-6"><a href="#cb358-6" aria-hidden="true" tabindex="-1"></a><span class="at">Masking =</span>  x_masked <span class="sc">%&gt;%</span></span>
<span id="cb358-7"><a href="#cb358-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_apply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, mean) <span class="sc">%&gt;%</span></span>
<span id="cb358-8"><a href="#cb358-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">paste0</span>(<span class="st">&quot;v_&quot;</span>,temp_names))</span>
<span id="cb358-9"><a href="#cb358-9" aria-hidden="true" tabindex="-1"></a> ), <span class="at">times=</span><span class="dv">30</span></span>
<span id="cb358-10"><a href="#cb358-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb358-11"><a href="#cb358-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Coordinate system already present. Adding new coordinate</span></span>
<span id="cb358-12"><a href="#cb358-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; system, which will replace the existing one.</span></span></code></pre></div>
<div class="figure">
<img src="climate_indicators_explained_files/figure-html/withMasking-1.png" alt="Comparing computation time before and after masking of raster data. There is no performance increase by masking before aggregating." width="672" />
<p class="caption">
(#fig:withMasking)Comparing computation time before and after masking of raster data. There is no performance increase by masking before aggregating.
</p>
</div>
<p>Since there is no increase in performance from masking, as we see in Fig. @ref(fig: withMasking) then it basically means we it is slower to mask beforehand, since the masking was not past of the benchmark assessment.</p>
<p>So, this is my solution:</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="co"># setNames dont work on stars proxy obejct, so I use rename instead</span></span>
<span id="cb359-2"><a href="#cb359-2" aria-hidden="true" tabindex="-1"></a>lookup <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="st">&quot;mean&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;v_&quot;</span>, temp_names))</span>
<span id="cb359-3"><a href="#cb359-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-4"><a href="#cb359-4" aria-hidden="true" tabindex="-1"></a>x_summerMean <span class="ot">&lt;-</span>   x_aug <span class="sc">%&gt;%</span></span>
<span id="cb359-5"><a href="#cb359-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_apply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, mean) <span class="sc">%&gt;%</span></span>
<span id="cb359-6"><a href="#cb359-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="fu">all_of</span>(lookup))</span></code></pre></div>
<p>The <em>v_</em> follows the naming convention we have developed for ourselves.</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(</span>
<span id="cb360-2"><a href="#cb360-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb360-3"><a href="#cb360-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> x_aug) <span class="sc">+</span></span>
<span id="cb360-4"><a href="#cb360-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb360-5"><a href="#cb360-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>time) <span class="sc">+</span></span>
<span id="cb360-6"><a href="#cb360-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb360-7"><a href="#cb360-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;D&quot;</span>) <span class="sc">+</span>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb360-8"><a href="#cb360-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)),  </span>
<span id="cb360-9"><a href="#cb360-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb360-10"><a href="#cb360-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb360-11"><a href="#cb360-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb360-12"><a href="#cb360-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> x_summerMean) <span class="sc">+</span></span>
<span id="cb360-13"><a href="#cb360-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb360-14"><a href="#cb360-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#facet_wrap(~time) +</span></span>
<span id="cb360-15"><a href="#cb360-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb360-16"><a href="#cb360-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;D&quot;</span>) <span class="sc">+</span></span>
<span id="cb360-17"><a href="#cb360-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb360-18"><a href="#cb360-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb360-19"><a href="#cb360-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure">
<img src="climate_indicators_explained_files/figure-html/unnamed-chunk-39-1.png" alt="Plotting the dummy data showing Attribute_A for the two dates as small maps, and a larger map showing the mean for year 2018" width="672" />
<p class="caption">
(#fig:unnamed-chunk-39)Plotting the dummy data showing Attribute_A for the two dates as small maps, and a larger map showing the mean for year 2018
</p>
</div>
<p>Here’s the whole first step of the conceptual workflow in action, on the dummy data.</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb361-2"><a href="#cb361-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting up the parameters</span></span>
<span id="cb361-3"><a href="#cb361-3" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="fu">substr</span>(<span class="fu">getwd</span>(), <span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb361-4"><a href="#cb361-4" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dir <span class="sc">==</span> <span class="st">&quot;C:&quot;</span>,</span>
<span id="cb361-5"><a href="#cb361-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;P:/&quot;</span>, </span>
<span id="cb361-6"><a href="#cb361-6" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;/data/P-Prosjekter2/&quot;</span>)</span>
<span id="cb361-7"><a href="#cb361-7" aria-hidden="true" tabindex="-1"></a>path2 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(path, </span>
<span id="cb361-8"><a href="#cb361-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;41201785_okologisk_tilstand_2022_2023/data/climate_indicators/dummy_data&quot;</span>)</span>
<span id="cb361-9"><a href="#cb361-9" aria-hidden="true" tabindex="-1"></a>start_month <span class="ot">&lt;-</span>  <span class="st">&quot;06&quot;</span></span>
<span id="cb361-10"><a href="#cb361-10" aria-hidden="true" tabindex="-1"></a>end_month <span class="ot">&lt;-</span> <span class="st">&quot;08&quot;</span></span>
<span id="cb361-11"><a href="#cb361-11" aria-hidden="true" tabindex="-1"></a>myFiles <span class="ot">&lt;-</span> <span class="fu">list.files</span>(path2, <span class="at">pattern=</span><span class="st">&quot;.rds&quot;</span>, <span class="at">full.names =</span> T)</span>
<span id="cb361-12"><a href="#cb361-12" aria-hidden="true" tabindex="-1"></a>summerTemp_fullSeries <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb361-13"><a href="#cb361-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb361-14"><a href="#cb361-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Looping though the files in the directory</span></span>
<span id="cb361-15"><a href="#cb361-15" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb361-16"><a href="#cb361-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(myFiles)){</span>
<span id="cb361-17"><a href="#cb361-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb361-18"><a href="#cb361-18" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(myFiles[i]) <span class="sc">%&gt;%</span></span>
<span id="cb361-19"><a href="#cb361-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Attribute_A)</span>
<span id="cb361-20"><a href="#cb361-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb361-21"><a href="#cb361-21" aria-hidden="true" tabindex="-1"></a>  year_temp <span class="ot">&lt;-</span> <span class="fu">year</span>(<span class="fu">st_get_dimension_values</span>(temp, <span class="st">&quot;time&quot;</span>)[<span class="dv">1</span>])</span>
<span id="cb361-22"><a href="#cb361-22" aria-hidden="true" tabindex="-1"></a>  start <span class="ot">&lt;-</span> <span class="fu">ym</span>(<span class="fu">paste</span>(year_temp, start_month, <span class="at">sep=</span><span class="st">&quot;-&quot;</span>))</span>
<span id="cb361-23"><a href="#cb361-23" aria-hidden="true" tabindex="-1"></a>  end <span class="ot">&lt;-</span>  <span class="fu">ym</span>(<span class="fu">paste</span>(year_temp, end_month, <span class="at">sep=</span><span class="st">&quot;-&quot;</span>))</span>
<span id="cb361-24"><a href="#cb361-24" aria-hidden="true" tabindex="-1"></a>  myInterval <span class="ot">&lt;-</span> <span class="fu">interval</span>(start, end)</span>
<span id="cb361-25"><a href="#cb361-25" aria-hidden="true" tabindex="-1"></a>  lookup <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="st">&quot;mean&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;v_&quot;</span>, year_temp))</span>
<span id="cb361-26"><a href="#cb361-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb361-27"><a href="#cb361-27" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> temp <span class="sc">%&gt;%</span></span>
<span id="cb361-28"><a href="#cb361-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(time <span class="sc">%within%</span> myInterval) <span class="sc">%&gt;%</span></span>
<span id="cb361-29"><a href="#cb361-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_apply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, mean) <span class="sc">%&gt;%</span></span>
<span id="cb361-30"><a href="#cb361-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="fu">all_of</span>(lookup))</span>
<span id="cb361-31"><a href="#cb361-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb361-32"><a href="#cb361-32" aria-hidden="true" tabindex="-1"></a>  summerTemp_fullSeries <span class="ot">&lt;-</span> <span class="fu">c</span>(temp, summerTemp_fullSeries)</span>
<span id="cb361-33"><a href="#cb361-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(temp) <span class="co"># same computation time with and without this function, but more tidy this way</span></span>
<span id="cb361-34"><a href="#cb361-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb361-35"><a href="#cb361-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb361-36"><a href="#cb361-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb361-37"><a href="#cb361-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Turn the attributes into a dimension and rename the new attribute</span></span>
<span id="cb361-38"><a href="#cb361-38" aria-hidden="true" tabindex="-1"></a>summerTemp_fullSeries <span class="ot">&lt;-</span> summerTemp_fullSeries <span class="sc">%&gt;%</span></span>
<span id="cb361-39"><a href="#cb361-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(<span class="at">name=</span><span class="st">&quot;Year&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb361-40"><a href="#cb361-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="st">&quot;Attribute_A&quot;</span>)</span>
<span id="cb361-41"><a href="#cb361-41" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb361-42"><a href="#cb361-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    user  system elapsed </span></span>
<span id="cb361-43"><a href="#cb361-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   0.127   0.000   0.133</span></span></code></pre></div>
<p>And this is the result.</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb362-2"><a href="#cb362-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> summerTemp_fullSeries) <span class="sc">+</span></span>
<span id="cb362-3"><a href="#cb362-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb362-4"><a href="#cb362-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb362-5"><a href="#cb362-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;D&quot;</span>) <span class="sc">+</span>  </span>
<span id="cb362-6"><a href="#cb362-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb362-7"><a href="#cb362-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb362-8"><a href="#cb362-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Year)</span></code></pre></div>
<div class="figure">
<img src="climate_indicators_explained_files/figure-html/unnamed-chunk-41-1.png" alt="Temporal aggregation on the dummy data set." width="672" />
<p class="caption">
(#fig:unnamed-chunk-41)Temporal aggregation on the dummy data set.
</p>
</div>
<p>Now let’s try it on the real data.</p>
<p><em>I initially tried to read stars proxy object and add steps to the call_list and execute these with <code>st_as_stars</code>, but this still returned proxy objects. Therefore I read the whole file in without proxy. To save time I can subset based on Julian dates.</em></p>
<p>I will use <a href="https://tmieno2.github.io/R-as-GIS-for-Economists/EE.html">parallelization</a> to speed things up.</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> path <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dir <span class="sc">==</span> <span class="st">&quot;C:&quot;</span>, </span>
<span id="cb363-2"><a href="#cb363-2" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;R:/&quot;</span>,</span>
<span id="cb363-3"><a href="#cb363-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;/data/R/&quot;</span>)</span>
<span id="cb363-4"><a href="#cb363-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb363-5"><a href="#cb363-5" aria-hidden="true" tabindex="-1"></a>path2 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(path, <span class="st">&quot;GeoSpatialData/Meteorology/Norway_SeNorge2018_v22.09/Original/rr_tm/&quot;</span>)</span>
<span id="cb363-6"><a href="#cb363-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-7"><a href="#cb363-7" aria-hidden="true" tabindex="-1"></a>myFiles <span class="ot">&lt;-</span> <span class="fu">list.files</span>(path2, <span class="at">pattern=</span><span class="st">&quot;.nc$&quot;</span>,<span class="at">full.names =</span> T)</span>
<span id="cb363-8"><a href="#cb363-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The last file (the last year) is incomplete and don&#39;t include all julian dates that we select below, so I will not include it:</span></span>
<span id="cb363-9"><a href="#cb363-9" aria-hidden="true" tabindex="-1"></a>myFiles <span class="ot">&lt;-</span> myFiles[<span class="sc">-</span><span class="fu">length</span>(myFiles)]</span>
<span id="cb363-10"><a href="#cb363-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-11"><a href="#cb363-11" aria-hidden="true" tabindex="-1"></a>real_temp_summer <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb363-12"><a href="#cb363-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-13"><a href="#cb363-13" aria-hidden="true" tabindex="-1"></a><span class="co"># set up parallel cluster using 10 cores</span></span>
<span id="cb363-14"><a href="#cb363-14" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(10L)</span>
<span id="cb363-15"><a href="#cb363-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-16"><a href="#cb363-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Get julian days after defining months</span></span>
<span id="cb363-17"><a href="#cb363-17" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> stars<span class="sc">::</span><span class="fu">read_ncdf</span>(<span class="fu">paste</span>(myFiles[<span class="dv">1</span>]), <span class="at">var=</span><span class="st">&quot;tg&quot;</span>)</span>
<span id="cb363-18"><a href="#cb363-18" aria-hidden="true" tabindex="-1"></a>start_month_num <span class="ot">&lt;-</span>  <span class="dv">6</span></span>
<span id="cb363-19"><a href="#cb363-19" aria-hidden="true" tabindex="-1"></a>end_month_num <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb363-20"><a href="#cb363-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-21"><a href="#cb363-21" aria-hidden="true" tabindex="-1"></a>julian_start <span class="ot">&lt;-</span> <span class="fu">yday</span>(<span class="fu">st_get_dimension_values</span>(temp, <span class="st">&quot;time&quot;</span>)[<span class="dv">1</span>] <span class="sc">%m+%</span></span>
<span id="cb363-22"><a href="#cb363-22" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">months</span>(<span class="sc">+</span>start_month_num))</span>
<span id="cb363-23"><a href="#cb363-23" aria-hidden="true" tabindex="-1"></a>julian_end <span class="ot">&lt;-</span> <span class="fu">yday</span>(<span class="fu">st_get_dimension_values</span>(temp, <span class="st">&quot;time&quot;</span>)[<span class="dv">1</span>] <span class="sc">%m+%</span></span>
<span id="cb363-24"><a href="#cb363-24" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">months</span>(<span class="sc">+</span>end_month_num))</span>
<span id="cb363-25"><a href="#cb363-25" aria-hidden="true" tabindex="-1"></a>step <span class="ot">&lt;-</span> julian_end<span class="sc">-</span>julian_start</span>
<span id="cb363-26"><a href="#cb363-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-27"><a href="#cb363-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-28"><a href="#cb363-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-29"><a href="#cb363-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(myFiles)){</span>
<span id="cb363-30"><a href="#cb363-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb363-31"><a href="#cb363-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tic</span>(<span class="st">&quot;init&quot;</span>)</span>
<span id="cb363-32"><a href="#cb363-32" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> stars<span class="sc">::</span><span class="fu">read_ncdf</span>(<span class="fu">paste</span>(myFiles[i]), <span class="at">var=</span><span class="st">&quot;tg&quot;</span>, <span class="at">proxy=</span>F,</span>
<span id="cb363-33"><a href="#cb363-33" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ncsub =</span> <span class="fu">cbind</span>(<span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, julian_start), </span>
<span id="cb363-34"><a href="#cb363-34" aria-hidden="true" tabindex="-1"></a>                              <span class="at">count =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, step)))</span>
<span id="cb363-35"><a href="#cb363-35" aria-hidden="true" tabindex="-1"></a>  year_temp <span class="ot">&lt;-</span> <span class="fu">year</span>(<span class="fu">st_get_dimension_values</span>(temp, <span class="st">&quot;time&quot;</span>)[<span class="dv">1</span>])</span>
<span id="cb363-36"><a href="#cb363-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(year_temp)</span>
<span id="cb363-37"><a href="#cb363-37" aria-hidden="true" tabindex="-1"></a>  lookup <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="st">&quot;mean&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;v_&quot;</span>, year_temp)) </span>
<span id="cb363-38"><a href="#cb363-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Perhaps leave out the v_ to get a numeric vector instead, </span></span>
<span id="cb363-39"><a href="#cb363-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># which is easier to subset</span></span>
<span id="cb363-40"><a href="#cb363-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_crs</span>(temp) <span class="ot">&lt;-</span> <span class="dv">25833</span></span>
<span id="cb363-41"><a href="#cb363-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">toc</span>()</span>
<span id="cb363-42"><a href="#cb363-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-43"><a href="#cb363-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tic</span>(<span class="st">&quot;filter and st_apply&quot;</span>)</span>
<span id="cb363-44"><a href="#cb363-44" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> temp <span class="sc">%&gt;%</span></span>
<span id="cb363-45"><a href="#cb363-45" aria-hidden="true" tabindex="-1"></a>    <span class="co">#filter(time %within% myInterval) %&gt;%</span></span>
<span id="cb363-46"><a href="#cb363-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_apply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, mean, <span class="at">CLUSTER =</span> cl) <span class="sc">%&gt;%</span></span>
<span id="cb363-47"><a href="#cb363-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="fu">all_of</span>(lookup)) </span>
<span id="cb363-48"><a href="#cb363-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">toc</span>()</span>
<span id="cb363-49"><a href="#cb363-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb363-50"><a href="#cb363-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tic</span>(<span class="st">&quot;c()&quot;</span>)</span>
<span id="cb363-51"><a href="#cb363-51" aria-hidden="true" tabindex="-1"></a>  real_temp_summer <span class="ot">&lt;-</span> <span class="fu">c</span>(temp, real_temp_summer)</span>
<span id="cb363-52"><a href="#cb363-52" aria-hidden="true" tabindex="-1"></a>  <span class="co">#rm(temp)</span></span>
<span id="cb363-53"><a href="#cb363-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">toc</span>()</span>
<span id="cb363-54"><a href="#cb363-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb363-55"><a href="#cb363-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-56"><a href="#cb363-56" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>(<span class="st">&quot;Merge&quot;</span>)</span>
<span id="cb363-57"><a href="#cb363-57" aria-hidden="true" tabindex="-1"></a>real_temp_summer <span class="ot">&lt;-</span> real_temp_summer <span class="sc">%&gt;%</span></span>
<span id="cb363-58"><a href="#cb363-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(<span class="at">name =</span> <span class="st">&quot;Year&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb363-59"><a href="#cb363-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="st">&quot;climate_variable&quot;</span>)</span>
<span id="cb363-60"><a href="#cb363-60" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span>
<span id="cb363-61"><a href="#cb363-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-62"><a href="#cb363-62" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span></code></pre></div>
<p>This takes about 20 sec per file/year, or 22 min on total. That is not too bad. About 6000 raster are read into memory. Here’s a test for the effect of splitting over more cores.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="#cb364-1" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(2L)</span>
<span id="cb364-2"><a href="#cb364-2" aria-hidden="true" tabindex="-1"></a>cl2 <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(6L)</span>
<span id="cb364-3"><a href="#cb364-3" aria-hidden="true" tabindex="-1"></a>cl3 <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(10L)</span>
<span id="cb364-4"><a href="#cb364-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-5"><a href="#cb364-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-6"><a href="#cb364-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>(<span class="st">&quot;No cluster&quot;</span>)</span>
<span id="cb364-7"><a href="#cb364-7" aria-hidden="true" tabindex="-1"></a>temp <span class="sc">%&gt;%</span></span>
<span id="cb364-8"><a href="#cb364-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">#filter(time %within% myInterval) %&gt;%</span></span>
<span id="cb364-9"><a href="#cb364-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_apply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, mean) <span class="sc">%&gt;%</span></span>
<span id="cb364-10"><a href="#cb364-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="fu">all_of</span>(lookup)) </span>
<span id="cb364-11"><a href="#cb364-11" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span>
<span id="cb364-12"><a href="#cb364-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-13"><a href="#cb364-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>(<span class="st">&quot;Two clusters&quot;</span>)</span>
<span id="cb364-14"><a href="#cb364-14" aria-hidden="true" tabindex="-1"></a>temp <span class="sc">%&gt;%</span></span>
<span id="cb364-15"><a href="#cb364-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">#filter(time %within% myInterval) %&gt;%</span></span>
<span id="cb364-16"><a href="#cb364-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_apply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, mean, <span class="at">CLUSTER =</span> cl) <span class="sc">%&gt;%</span></span>
<span id="cb364-17"><a href="#cb364-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="fu">all_of</span>(lookup)) </span>
<span id="cb364-18"><a href="#cb364-18" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span>
<span id="cb364-19"><a href="#cb364-19" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span>
<span id="cb364-20"><a href="#cb364-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-21"><a href="#cb364-21" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>(<span class="st">&quot;Six clusters&quot;</span>)</span>
<span id="cb364-22"><a href="#cb364-22" aria-hidden="true" tabindex="-1"></a>temp <span class="sc">%&gt;%</span></span>
<span id="cb364-23"><a href="#cb364-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">#filter(time %within% myInterval) %&gt;%</span></span>
<span id="cb364-24"><a href="#cb364-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_apply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, mean, <span class="at">CLUSTER =</span> cl2) <span class="sc">%&gt;%</span></span>
<span id="cb364-25"><a href="#cb364-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="fu">all_of</span>(lookup)) </span>
<span id="cb364-26"><a href="#cb364-26" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(cl2)</span>
<span id="cb364-27"><a href="#cb364-27" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span>
<span id="cb364-28"><a href="#cb364-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-29"><a href="#cb364-29" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>(<span class="st">&quot;Ten clusters&quot;</span>)</span>
<span id="cb364-30"><a href="#cb364-30" aria-hidden="true" tabindex="-1"></a>temp <span class="sc">%&gt;%</span></span>
<span id="cb364-31"><a href="#cb364-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">#filter(time %within% myInterval) %&gt;%</span></span>
<span id="cb364-32"><a href="#cb364-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_apply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, mean, <span class="at">CLUSTER =</span> cl3) <span class="sc">%&gt;%</span></span>
<span id="cb364-33"><a href="#cb364-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="fu">all_of</span>(lookup)) </span>
<span id="cb364-34"><a href="#cb364-34" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(cl3)</span>
<span id="cb364-35"><a href="#cb364-35" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span>
<span id="cb364-36"><a href="#cb364-36" aria-hidden="true" tabindex="-1"></a>  </span></code></pre></div>
<ul>
<li><p>No cluster: 21.401 sec elapsed</p></li>
<li><p>Two clusters: 21.546 sec elapsed</p></li>
<li><p>Six clusters: 14.548 sec elapsed</p></li>
<li><p>Ten clusters: 15.29 sec elapsed</p></li>
<li><p>Ten clusters (second run): 13.617 sec elapsed</p></li>
</ul>
<p>The RStudio server has 48 cores. More parallel cores is probably on average faster. The NINA guidelines is to use max 10 cores, and to remember to close parallel cluster when done.</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="#cb365-1" aria-hidden="true" tabindex="-1"></a><span class="co">#saveRDS(real_temp_summer, &quot;/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/aggregated_climate_time_series/real_temp_summer.rds&quot;)</span></span>
<span id="cb365-2"><a href="#cb365-2" aria-hidden="true" tabindex="-1"></a><span class="co">#write_stars(real_temp_summer, &quot;/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/aggregated_climate_time_series/real_temp_summer.tiff&quot;)</span></span></code></pre></div>
<p>These files are about 500 MB, but the tiff file reads in a lot quicker then the rds file, so from now on I’ll just export as tiff. <em>(This could perhaps have been solved with a <code>gc()</code>. Later I tried saving as RData with no speed issues problems, but then I had a problem with RData files seemingly becoming corrupted over time - stars objects saved as RData files would not bind together using <code>c.stars()</code> with other matching stars object and I think this could be related to a time stamp in the RData format. So, stick to tiff).</em></p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a>summer_median_temp <span class="ot">&lt;-</span> <span class="fu">read_stars</span>(<span class="fu">paste0</span>(pData, <span class="st">&quot;climate_indicators/aggregated_climate_time_series/real_temp_summer.tiff&quot;</span>),</span>
<span id="cb366-2"><a href="#cb366-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">proxy=</span>F)</span></code></pre></div>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(summer_median_temp)</span>
<span id="cb367-2"><a href="#cb367-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;real_temp_summer.tiff&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(summer_median_temp)</span>
<span id="cb368-2"><a href="#cb368-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    x    y band </span></span>
<span id="cb368-3"><a href="#cb368-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1195 1550   66</span></span></code></pre></div>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_get_dimension_values</span>(summer_median_temp, <span class="st">&quot;Year&quot;</span>)</span>
<span id="cb369-2"><a href="#cb369-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>Note that GTiff automatically renames the third dimension <em>band</em> and also renames the attribute.</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_get_dimension_values</span>(summer_median_temp, <span class="st">&quot;band&quot;</span>)</span>
<span id="cb370-2"><a href="#cb370-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;v_2022&quot; &quot;v_2021&quot; &quot;v_2020&quot; &quot;v_2019&quot; &quot;v_2018&quot; &quot;v_2017&quot;</span></span>
<span id="cb370-3"><a href="#cb370-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [7] &quot;v_2016&quot; &quot;v_2015&quot; &quot;v_2014&quot; &quot;v_2013&quot; &quot;v_2012&quot; &quot;v_2011&quot;</span></span>
<span id="cb370-4"><a href="#cb370-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [13] &quot;v_2010&quot; &quot;v_2009&quot; &quot;v_2008&quot; &quot;v_2007&quot; &quot;v_2006&quot; &quot;v_2005&quot;</span></span>
<span id="cb370-5"><a href="#cb370-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [19] &quot;v_2004&quot; &quot;v_2003&quot; &quot;v_2002&quot; &quot;v_2001&quot; &quot;v_2000&quot; &quot;v_1999&quot;</span></span>
<span id="cb370-6"><a href="#cb370-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [25] &quot;v_1998&quot; &quot;v_1997&quot; &quot;v_1996&quot; &quot;v_1995&quot; &quot;v_1994&quot; &quot;v_1993&quot;</span></span>
<span id="cb370-7"><a href="#cb370-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [31] &quot;v_1992&quot; &quot;v_1991&quot; &quot;v_1990&quot; &quot;v_1989&quot; &quot;v_1988&quot; &quot;v_1987&quot;</span></span>
<span id="cb370-8"><a href="#cb370-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [37] &quot;v_1986&quot; &quot;v_1985&quot; &quot;v_1984&quot; &quot;v_1983&quot; &quot;v_1982&quot; &quot;v_1981&quot;</span></span>
<span id="cb370-9"><a href="#cb370-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [43] &quot;v_1980&quot; &quot;v_1979&quot; &quot;v_1978&quot; &quot;v_1977&quot; &quot;v_1976&quot; &quot;v_1975&quot;</span></span>
<span id="cb370-10"><a href="#cb370-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [49] &quot;v_1974&quot; &quot;v_1973&quot; &quot;v_1972&quot; &quot;v_1971&quot; &quot;v_1970&quot; &quot;v_1969&quot;</span></span>
<span id="cb370-11"><a href="#cb370-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [55] &quot;v_1968&quot; &quot;v_1967&quot; &quot;v_1966&quot; &quot;v_1965&quot; &quot;v_1964&quot; &quot;v_1963&quot;</span></span>
<span id="cb370-12"><a href="#cb370-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [61] &quot;v_1962&quot; &quot;v_1961&quot; &quot;v_1960&quot; &quot;v_1959&quot; &quot;v_1958&quot; &quot;v_1957&quot;</span></span></code></pre></div>
<p>I can rename them.</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="#cb371-1" aria-hidden="true" tabindex="-1"></a>summer_median_temp <span class="ot">&lt;-</span> summer_median_temp <span class="sc">%&gt;%</span> </span>
<span id="cb371-2"><a href="#cb371-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_dimensions</span>(<span class="at">names =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;v_YEAR&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb371-3"><a href="#cb371-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="st">&quot;temperature&quot;</span>)</span>
<span id="cb371-4"><a href="#cb371-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(summer_median_temp)</span>
<span id="cb371-5"><a href="#cb371-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      x      y v_YEAR </span></span>
<span id="cb371-6"><a href="#cb371-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   1195   1550     66</span></span></code></pre></div>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="#cb372-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb372-2"><a href="#cb372-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> summer_median_temp[,,,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">11</span>,<span class="dv">22</span>)], <span class="at">downsample =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb372-3"><a href="#cb372-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb372-4"><a href="#cb372-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb372-5"><a href="#cb372-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;D&quot;</span>) <span class="sc">+</span>  </span>
<span id="cb372-6"><a href="#cb372-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb372-7"><a href="#cb372-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb372-8"><a href="#cb372-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>v_YEAR)</span></code></pre></div>
<div class="figure">
<img src="climate_indicators_explained_files/figure-html/unnamed-chunk-51-1.png" alt="Showing three random slices of the year dimension." width="672" />
<p class="caption">
(#fig:unnamed-chunk-51)Showing three random slices of the year dimension.
</p>
</div>
</div>
<div id="calculate-reference-values" class="section level3" number="9.8.6">
<h3><span class="header-section-number">9.8.6</span> Calculate reference values</h3>
<div id="aggregate-across-reference-years" class="section level4" number="9.8.6.1">
<h4><span class="header-section-number">9.8.6.1</span> Aggregate across reference years</h4>
<p>We need to first to define a reference period and then to subset our data <code>summer_median_temp</code>. We can practice on the dummy data <code>y</code>.</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="#cb373-1" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="fu">substr</span>(<span class="fu">getwd</span>(), <span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb373-2"><a href="#cb373-2" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dir <span class="sc">==</span> <span class="st">&quot;C:&quot;</span>,</span>
<span id="cb373-3"><a href="#cb373-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;P:/&quot;</span>, </span>
<span id="cb373-4"><a href="#cb373-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;/data/P-Prosjekter2/&quot;</span>)</span>
<span id="cb373-5"><a href="#cb373-5" aria-hidden="true" tabindex="-1"></a>path2 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(path, </span>
<span id="cb373-6"><a href="#cb373-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;41201785_okologisk_tilstand_2022_2023/data/climate_indicators/dummy_data&quot;</span>)</span>
<span id="cb373-7"><a href="#cb373-7" aria-hidden="true" tabindex="-1"></a>myFiles <span class="ot">&lt;-</span> <span class="fu">list.files</span>(path2, <span class="at">pattern=</span><span class="st">&quot;.rds&quot;</span>, <span class="at">full.names =</span> T)</span>
<span id="cb373-8"><a href="#cb373-8" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb373-9"><a href="#cb373-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb373-10"><a href="#cb373-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Looping though the files in the directory</span></span>
<span id="cb373-11"><a href="#cb373-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(myFiles)){</span>
<span id="cb373-12"><a href="#cb373-12" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(myFiles[i])</span>
<span id="cb373-13"><a href="#cb373-13" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">c</span>(temp, y)</span>
<span id="cb373-14"><a href="#cb373-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_get_dimension_values</span>(y, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb374-2"><a href="#cb374-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;1966-05-31&quot; &quot;1966-06-01&quot; &quot;1966-07-20&quot; &quot;1966-09-08&quot;</span></span>
<span id="cb374-3"><a href="#cb374-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;1967-05-31&quot; &quot;1967-06-01&quot; &quot;1967-07-20&quot; &quot;1967-09-08&quot;</span></span>
<span id="cb374-4"><a href="#cb374-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;1968-05-31&quot; &quot;1968-06-01&quot; &quot;1968-07-20&quot; &quot;1968-09-08&quot;</span></span>
<span id="cb374-5"><a href="#cb374-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [13] &quot;1969-05-31&quot; &quot;1969-06-01&quot; &quot;1969-07-20&quot; &quot;1969-09-08&quot;</span></span>
<span id="cb374-6"><a href="#cb374-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [17] &quot;1970-05-31&quot; &quot;1970-06-01&quot; &quot;1970-07-20&quot; &quot;1970-09-08&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="#cb375-1" aria-hidden="true" tabindex="-1"></a>y_filtered <span class="ot">&lt;-</span> y <span class="sc">%&gt;%</span></span>
<span id="cb375-2"><a href="#cb375-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Attribute_A) <span class="sc">%&gt;%</span></span>
<span id="cb375-3"><a href="#cb375-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time <span class="sc">%within%</span> <span class="fu">interval</span>(<span class="st">&quot;1961-01-01&quot;</span>, <span class="st">&quot;1990-12-31&quot;</span>))</span></code></pre></div>
<p>Now we aggregate across years, again using st_apply.</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="#cb376-1" aria-hidden="true" tabindex="-1"></a>median_sd <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { <span class="fu">c</span>(<span class="at">median =</span> <span class="fu">median</span>(x), <span class="at">sd =</span> <span class="fu">sd</span>(x))}</span></code></pre></div>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="#cb377-1" aria-hidden="true" tabindex="-1"></a>y_ref <span class="ot">&lt;-</span> y_filtered <span class="sc">%&gt;%</span></span>
<span id="cb377-2"><a href="#cb377-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_apply</span>(<span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>), <span class="at">FUN =</span>  median_sd)</span></code></pre></div>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="#cb378-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(y_ref)</span>
<span id="cb378-2"><a href="#cb378-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; median_sd         x         y </span></span>
<span id="cb378-3"><a href="#cb378-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         2        50        50</span></span></code></pre></div>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_get_dimension_values</span>(y_ref, <span class="st">&quot;median_sd&quot;</span>)</span>
<span id="cb379-2"><a href="#cb379-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;median&quot; &quot;sd&quot;</span></span></code></pre></div>
<p>It’s perhaps easier if median and sd are unique attributes, rather than levels of a dimension.</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="#cb380-1" aria-hidden="true" tabindex="-1"></a>y_ref <span class="ot">&lt;-</span> y_ref <span class="sc">%&gt;%</span> <span class="fu">split</span>(<span class="st">&quot;median_sd&quot;</span>)</span></code></pre></div>
<p>The attribute name <em>mean</em> we can change this to something more meaningful.</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="#cb381-1" aria-hidden="true" tabindex="-1"></a>y_ref <span class="ot">&lt;-</span> <span class="fu">setNames</span>(y_ref, <span class="fu">c</span>(<span class="st">&quot;reference_upper&quot;</span>, <span class="st">&quot;sd&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="#cb382-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(</span>
<span id="cb382-2"><a href="#cb382-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(y_ref)<span class="sc">+</span></span>
<span id="cb382-3"><a href="#cb382-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="st">&quot;reference_upper&quot;</span>)</span>
<span id="cb382-4"><a href="#cb382-4" aria-hidden="true" tabindex="-1"></a>,</span>
<span id="cb382-5"><a href="#cb382-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(y_ref)<span class="sc">+</span></span>
<span id="cb382-6"><a href="#cb382-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="st">&quot;sd&quot;</span>,</span>
<span id="cb382-7"><a href="#cb382-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">palette =</span> <span class="st">&quot;-viridis&quot;</span>)</span>
<span id="cb382-8"><a href="#cb382-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure">
<img src="climate_indicators_explained_files/figure-html/unnamed-chunk-61-1.png" alt="Showing the upper reference levels and the standard deviation from the dummy data set." width="672" />
<p class="caption">
(#fig:unnamed-chunk-61)Showing the upper reference levels and the standard deviation from the dummy data set.
</p>
</div>
<p>Let’s transfer this over to the real data. First we need to rename our dimension values and turn them back into dates.</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="#cb383-1" aria-hidden="true" tabindex="-1"></a>new_dims <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(</span>
<span id="cb383-2"><a href="#cb383-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">substr</span>(<span class="fu">st_get_dimension_values</span>(summer_median_temp, <span class="st">&quot;v_YEAR&quot;</span>), <span class="dv">3</span>, <span class="dv">6</span>), <span class="st">&quot;-01-01&quot;</span>))</span>
<span id="cb383-3"><a href="#cb383-3" aria-hidden="true" tabindex="-1"></a>summer_median_temp_ref <span class="ot">&lt;-</span> summer_median_temp <span class="sc">%&gt;%</span></span>
<span id="cb383-4"><a href="#cb383-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_dimensions</span>(<span class="st">&quot;v_YEAR&quot;</span>, <span class="at">values =</span> new_dims)</span></code></pre></div>
<p>Then I can filter to leave only the reference period.</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="#cb384-1" aria-hidden="true" tabindex="-1"></a>summer_median_temp_ref <span class="ot">&lt;-</span> summer_median_temp_ref <span class="sc">%&gt;%</span></span>
<span id="cb384-2"><a href="#cb384-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(v_YEAR <span class="sc">%within%</span> <span class="fu">interval</span>(<span class="st">&quot;1961-01-01&quot;</span>, <span class="st">&quot;1990-12-31&quot;</span>))</span>
<span id="cb384-3"><a href="#cb384-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_get_dimension_values</span>(summer_median_temp_ref, <span class="st">&quot;v_YEAR&quot;</span>)</span>
<span id="cb384-4"><a href="#cb384-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;1990-01-01&quot; &quot;1989-01-01&quot; &quot;1988-01-01&quot; &quot;1987-01-01&quot;</span></span>
<span id="cb384-5"><a href="#cb384-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;1986-01-01&quot; &quot;1985-01-01&quot; &quot;1984-01-01&quot; &quot;1983-01-01&quot;</span></span>
<span id="cb384-6"><a href="#cb384-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;1982-01-01&quot; &quot;1981-01-01&quot; &quot;1980-01-01&quot; &quot;1979-01-01&quot;</span></span>
<span id="cb384-7"><a href="#cb384-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [13] &quot;1978-01-01&quot; &quot;1977-01-01&quot; &quot;1976-01-01&quot; &quot;1975-01-01&quot;</span></span>
<span id="cb384-8"><a href="#cb384-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [17] &quot;1974-01-01&quot; &quot;1973-01-01&quot; &quot;1972-01-01&quot; &quot;1971-01-01&quot;</span></span>
<span id="cb384-9"><a href="#cb384-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [21] &quot;1970-01-01&quot; &quot;1969-01-01&quot; &quot;1968-01-01&quot; &quot;1967-01-01&quot;</span></span>
<span id="cb384-10"><a href="#cb384-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [25] &quot;1966-01-01&quot; &quot;1965-01-01&quot; &quot;1964-01-01&quot; &quot;1963-01-01&quot;</span></span>
<span id="cb384-11"><a href="#cb384-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [29] &quot;1962-01-01&quot; &quot;1961-01-01&quot;</span></span></code></pre></div>
<p>And then we calculate the median and sd like above</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="#cb385-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb385-2"><a href="#cb385-2" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(10L)</span>
<span id="cb385-3"><a href="#cb385-3" aria-hidden="true" tabindex="-1"></a>summer_median_temp_ref <span class="ot">&lt;-</span> summer_median_temp_ref <span class="sc">%&gt;%</span></span>
<span id="cb385-4"><a href="#cb385-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_apply</span>(<span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>), </span>
<span id="cb385-5"><a href="#cb385-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">FUN =</span>  median_sd,</span>
<span id="cb385-6"><a href="#cb385-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">CLUSTER =</span> cl)</span>
<span id="cb385-7"><a href="#cb385-7" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span>
<span id="cb385-8"><a href="#cb385-8" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th>user</th>
<th>system</th>
<th>elapsed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>9.624</td>
<td>6.069</td>
<td>20.903</td>
</tr>
</tbody>
</table>
<p>This is also something I can export.</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that write_stars can only export a single attribute, but we have put the &#39;attributes&#39; as dimensions, and these will be read in as &#39;band&#39; when importing tiff.</span></span>
<span id="cb386-2"><a href="#cb386-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_stars</span>(summer_median_temp_ref, <span class="st">&quot;/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/aggregated_climate_time_series/summer_median_temp_ref.tiff&quot;</span>)</span>
<span id="cb386-3"><a href="#cb386-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-4"><a href="#cb386-4" aria-hidden="true" tabindex="-1"></a><span class="co"># I initially saved as RData, like this, but ran into problems later when trying to bind stars objects using c.stars(). It appears RData becomes corrutpt in a sense, over time, perhaps due to some time stamp. If I recreated the object in the global environment and saved as RDatam I could read it in and work with it, but the next day it would not work again.</span></span>
<span id="cb386-5"><a href="#cb386-5" aria-hidden="true" tabindex="-1"></a><span class="co">#saveRDS(summer_median_temp_ref, &quot;/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/aggregated_climate_time_series/summer_median_temp_ref.RData&quot;)</span></span></code></pre></div>
<p>Pivot and turn dimension into attributes:</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="#cb387-1" aria-hidden="true" tabindex="-1"></a>summer_median_temp_ref_long <span class="ot">&lt;-</span> summer_median_temp_ref <span class="sc">%&gt;%</span> <span class="fu">split</span>(<span class="st">&quot;band&quot;</span>)</span></code></pre></div>
<p>The attribute name is <em>mean</em>. We can change this to something more meaningful.</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a>summer_median_temp_ref_long <span class="ot">&lt;-</span> <span class="fu">setNames</span>(summer_median_temp_ref_long, <span class="fu">c</span>(<span class="st">&quot;reference_upper&quot;</span>, <span class="st">&quot;sd&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="#cb389-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(</span>
<span id="cb389-2"><a href="#cb389-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(<span class="fu">st_downsample</span>(summer_median_temp_ref_long, <span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb389-3"><a href="#cb389-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="st">&quot;reference_upper&quot;</span>)</span>
<span id="cb389-4"><a href="#cb389-4" aria-hidden="true" tabindex="-1"></a>,</span>
<span id="cb389-5"><a href="#cb389-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(<span class="fu">st_downsample</span>(summer_median_temp_ref_long, <span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb389-6"><a href="#cb389-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="st">&quot;sd&quot;</span>,</span>
<span id="cb389-7"><a href="#cb389-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">palette =</span> <span class="st">&quot;-viridis&quot;</span>)</span>
<span id="cb389-8"><a href="#cb389-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure">
<img src="climate_indicators_explained_files/figure-html/unnamed-chunk-69-1.png" alt="Showing the upper reference levels and the standard deviation from actual data of median summer temperatures." width="672" />
<p class="caption">
(#fig:unnamed-chunk-69)Showing the upper reference levels and the standard deviation from actual data of median summer temperatures.
</p>
</div>
</div>
<div id="combine" class="section level4" number="9.8.6.2">
<h4><span class="header-section-number">9.8.6.2</span> Combine</h4>
<p>I need to combine the variables and the ref values in one data cube</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="#cb390-1" aria-hidden="true" tabindex="-1"></a>y_var <span class="ot">&lt;-</span> summer_median_temp <span class="sc">%&gt;%</span></span>
<span id="cb390-2"><a href="#cb390-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(<span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb390-3"><a href="#cb390-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(summer_median_temp_ref_long)</span></code></pre></div>
</div>
</div>
<div id="normalise-variable" class="section level3" number="9.8.7">
<h3><span class="header-section-number">9.8.7</span> Normalise variable</h3>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="#cb391-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select the columns to normalise</span></span>
<span id="cb391-2"><a href="#cb391-2" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">names</span>(y_var)[<span class="sc">!</span><span class="fu">names</span>(y_var) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;reference_upper&quot;</span>, <span class="st">&quot;sd&quot;</span>) ]</span>
<span id="cb391-3"><a href="#cb391-3" aria-hidden="true" tabindex="-1"></a>cols_new <span class="ot">&lt;-</span> cols</span>
<span id="cb391-4"><a href="#cb391-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cols_new) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;v_&quot;</span>, <span class="st">&quot;i_&quot;</span>, cols)</span></code></pre></div>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="#cb392-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mutate</span></span>
<span id="cb392-2"><a href="#cb392-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb392-3"><a href="#cb392-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The break point scaling is actually not needed here, since </span></span>
<span id="cb392-4"><a href="#cb392-4" aria-hidden="true" tabindex="-1"></a><span class="co"># having the lower ref value to be 5 sd implies that the threshold is</span></span>
<span id="cb392-5"><a href="#cb392-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 sd in a linear scaling.</span></span>
<span id="cb392-6"><a href="#cb392-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb392-7"><a href="#cb392-7" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(</span>
<span id="cb392-8"><a href="#cb392-8" aria-hidden="true" tabindex="-1"></a>y_var_norm <span class="ot">&lt;-</span> y_var <span class="sc">%&gt;%</span></span>
<span id="cb392-9"><a href="#cb392-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">reference_low =</span> reference_upper <span class="sc">-</span> <span class="dv">5</span><span class="sc">*</span>sd ) <span class="sc">%&gt;%</span></span>
<span id="cb392-10"><a href="#cb392-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">reference_low2 =</span> reference_upper <span class="sc">+</span> <span class="dv">5</span><span class="sc">*</span>sd ) <span class="sc">%&gt;%</span></span>
<span id="cb392-11"><a href="#cb392-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">threshold_low =</span> reference_upper <span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>sd ) <span class="sc">%&gt;%</span></span>
<span id="cb392-12"><a href="#cb392-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">threshold_high =</span> reference_upper <span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>sd ) <span class="sc">%&gt;%</span></span>
<span id="cb392-13"><a href="#cb392-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(cols), <span class="sc">~</span> </span>
<span id="cb392-14"><a href="#cb392-14" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">if_else</span>(.x <span class="sc">&lt;</span> reference_upper,</span>
<span id="cb392-15"><a href="#cb392-15" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">if_else</span>(.x <span class="sc">&lt;</span> threshold_low, </span>
<span id="cb392-16"><a href="#cb392-16" aria-hidden="true" tabindex="-1"></a>                                        (.x <span class="sc">-</span> reference_low) <span class="sc">/</span> (threshold_low <span class="sc">-</span> reference_low),</span>
<span id="cb392-17"><a href="#cb392-17" aria-hidden="true" tabindex="-1"></a>                                        (.x <span class="sc">-</span> threshold_low) <span class="sc">/</span> (reference_upper <span class="sc">-</span> threshold_low),</span>
<span id="cb392-18"><a href="#cb392-18" aria-hidden="true" tabindex="-1"></a>                                        ),</span>
<span id="cb392-19"><a href="#cb392-19" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">if_else</span>(.x <span class="sc">&gt;</span> threshold_high, </span>
<span id="cb392-20"><a href="#cb392-20" aria-hidden="true" tabindex="-1"></a>                                        (reference_low2 <span class="sc">-</span> .x) <span class="sc">/</span> (reference_low2 <span class="sc">-</span> threshold_high),</span>
<span id="cb392-21"><a href="#cb392-21" aria-hidden="true" tabindex="-1"></a>                                        (threshold_high <span class="sc">-</span> .x) <span class="sc">/</span> (threshold_high <span class="sc">-</span> reference_upper),</span>
<span id="cb392-22"><a href="#cb392-22" aria-hidden="true" tabindex="-1"></a>                                        )</span>
<span id="cb392-23"><a href="#cb392-23" aria-hidden="true" tabindex="-1"></a>                ))) <span class="sc">%&gt;%</span></span>
<span id="cb392-24"><a href="#cb392-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(cols), <span class="sc">~</span> <span class="fu">if_else</span>(.x <span class="sc">&gt;</span> <span class="dv">1</span>, <span class="dv">1</span>, .x))) <span class="sc">%&gt;%</span></span>
<span id="cb392-25"><a href="#cb392-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(cols), <span class="sc">~</span> <span class="fu">if_else</span>(.x <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, .x))) <span class="sc">%&gt;%</span></span>
<span id="cb392-26"><a href="#cb392-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="fu">all_of</span>(cols_new)) <span class="sc">%&gt;%</span></span>
<span id="cb392-27"><a href="#cb392-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fu">select</span>(y_var, <span class="fu">all_of</span>(cols)))</span>
<span id="cb392-28"><a href="#cb392-28" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th>user</th>
<th>system</th>
<th>elapsed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>14.803</td>
<td>2.717</td>
<td>17.512</td>
</tr>
</tbody>
</table>
<p>Writing to file, this time as RData (could use rds) because tiff don’t allow multiple attributes, and because we don’t need to use <code>c.stars()</code> in this object.</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()</span>
<span id="cb393-2"><a href="#cb393-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(y_var_norm, <span class="st">&quot;/data/P-Prosjekter2/41201785_okologisk_tilstand_2022_2023/data/climate_indicators/aggregated_climate_time_series/summer_median_temp_normalised.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="#cb394-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb394-2"><a href="#cb394-2" aria-hidden="true" tabindex="-1"></a>lims <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">22</span>)</span>
<span id="cb394-3"><a href="#cb394-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb394-4"><a href="#cb394-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(</span>
<span id="cb394-5"><a href="#cb394-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb394-6"><a href="#cb394-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> <span class="fu">st_downsample</span>(y_var_norm[<span class="st">&quot;v_1970&quot;</span>],<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb394-7"><a href="#cb394-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb394-8"><a href="#cb394-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb394-9"><a href="#cb394-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;D&quot;</span>,</span>
<span id="cb394-10"><a href="#cb394-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> lims) <span class="sc">+</span>  </span>
<span id="cb394-11"><a href="#cb394-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb394-12"><a href="#cb394-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb394-13"><a href="#cb394-13" aria-hidden="true" tabindex="-1"></a>,</span>
<span id="cb394-14"><a href="#cb394-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb394-15"><a href="#cb394-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> <span class="fu">st_downsample</span>(y_var_norm[<span class="st">&quot;reference_upper&quot;</span>], <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb394-16"><a href="#cb394-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb394-17"><a href="#cb394-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb394-18"><a href="#cb394-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;D&quot;</span>,</span>
<span id="cb394-19"><a href="#cb394-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> lims) <span class="sc">+</span>  </span>
<span id="cb394-20"><a href="#cb394-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb394-21"><a href="#cb394-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb394-22"><a href="#cb394-22" aria-hidden="true" tabindex="-1"></a>,</span>
<span id="cb394-23"><a href="#cb394-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb394-24"><a href="#cb394-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> <span class="fu">st_downsample</span>(y_var_norm[<span class="st">&quot;reference_low&quot;</span>], <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb394-25"><a href="#cb394-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb394-26"><a href="#cb394-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb394-27"><a href="#cb394-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;D&quot;</span>,</span>
<span id="cb394-28"><a href="#cb394-28" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> lims) <span class="sc">+</span>  </span>
<span id="cb394-29"><a href="#cb394-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb394-30"><a href="#cb394-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb394-31"><a href="#cb394-31" aria-hidden="true" tabindex="-1"></a>,</span>
<span id="cb394-32"><a href="#cb394-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb394-33"><a href="#cb394-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb394-34"><a href="#cb394-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> <span class="fu">st_downsample</span>(y_var_norm[<span class="st">&quot;reference_low2&quot;</span>], <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb394-35"><a href="#cb394-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb394-36"><a href="#cb394-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb394-37"><a href="#cb394-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;D&quot;</span>,</span>
<span id="cb394-38"><a href="#cb394-38" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> lims) <span class="sc">+</span>  </span>
<span id="cb394-39"><a href="#cb394-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb394-40"><a href="#cb394-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb394-41"><a href="#cb394-41" aria-hidden="true" tabindex="-1"></a>,</span>
<span id="cb394-42"><a href="#cb394-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb394-43"><a href="#cb394-43" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb394-44"><a href="#cb394-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>(<span class="at">data =</span> <span class="fu">st_downsample</span>(y_var_norm[<span class="st">&quot;i_1970&quot;</span>],<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb394-45"><a href="#cb394-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb394-46"><a href="#cb394-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb394-47"><a href="#cb394-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;A&quot;</span>,</span>
<span id="cb394-48"><a href="#cb394-48" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span>  </span>
<span id="cb394-49"><a href="#cb394-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb394-50"><a href="#cb394-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb394-51"><a href="#cb394-51" aria-hidden="true" tabindex="-1"></a>, <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">nrow=</span><span class="dv">3</span>, <span class="at">align =</span> <span class="st">&quot;hv&quot;</span></span>
<span id="cb394-52"><a href="#cb394-52" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure">
<img src="climate_indicators_explained_files/figure-html/unnamed-chunk-75-1.png" alt="Example showing median summer tempretur in 1970, the upper and lwoer reference temperture, i.e. median and 5 SD units of the temperature between  1961-1990, and finally, the scaled indicator values." width="672" />
<p class="caption">
(#fig:unnamed-chunk-75)Example showing median summer tempretur in 1970, the upper and lwoer reference temperture, i.e. median and 5 SD units of the temperature between 1961-1990, and finally, the scaled indicator values.
</p>
</div>
<p>The <em>real</em> indicator values should be means over 5 year periods. Calculating a running mean for all time steps is too time consuming. Therefore, the scaled, regional indicator values will be calculated for distinct time steps. The time series can perhaps best be presented with yearly resolution.</p>
</div>
<div id="plot-time-series-as-line-graphs" class="section level3" number="9.8.8">
<h3><span class="header-section-number">9.8.8</span> Plot time series as line graphs</h3>
<p>We could also plot a time series as a series of maps, but then we need to average over these 5 year time periods first. We can get to that later.</p>
<p>To plot time series I first need to do a spatial aggregation. One option is to spatially aggregate the stars object directly, using the <code>reg</code> data set:</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="#cb395-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> y_var_norm[<span class="dv">1</span>,,] <span class="sc">%&gt;%</span></span>
<span id="cb395-2"><a href="#cb395-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aggregate</span>(reg, mean, <span class="at">na.rm=</span>T)</span>
<span id="cb395-3"><a href="#cb395-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(temp)</span>
<span id="cb395-4"><a href="#cb395-4" aria-hidden="true" tabindex="-1"></a>temp2 <span class="ot">&lt;-</span> temp <span class="sc">%&gt;%</span></span>
<span id="cb395-5"><a href="#cb395-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="co"># too slow</span></span></code></pre></div>
<p>However, this does no preserve the region name, and a subsequent <code>st_intersection</code> taks a little while and gives some boundary problems.</p>
<p>I can also convert pixels to points and then do the intersection.</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="#cb396-1" aria-hidden="true" tabindex="-1"></a>temp_points <span class="ot">&lt;-</span> y_var_norm[<span class="dv">1</span>,,] <span class="sc">%&gt;%</span></span>
<span id="cb396-2"><a href="#cb396-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">as_points =</span> <span class="cn">TRUE</span>, <span class="at">merge =</span> <span class="cn">FALSE</span>)</span>
<span id="cb396-3"><a href="#cb396-3" aria-hidden="true" tabindex="-1"></a>temp_points2 <span class="ot">&lt;-</span> temp_points <span class="sc">%&gt;%</span></span>
<span id="cb396-4"><a href="#cb396-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersection</span>(reg) <span class="st">&quot; too slow&quot;</span></span></code></pre></div>
<p>But this also took too long.</p>
<p>I can perhaps aggregate, and then turn to points and intersect, but that did not work perfect either.</p>
<p>I can rasterize the regions data set, turn it into a coded dimension and use st_apply, but that is tedious.</p>
<p>Let me try using <code>exact_extract</code>, as an alternative to <code>aggregate</code>. This requires us to turn to the <code>terra</code> package for a bit.</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="#cb397-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(</span>
<span id="cb397-2"><a href="#cb397-2" aria-hidden="true" tabindex="-1"></a>regional_means <span class="ot">&lt;-</span> <span class="fu">rast</span>(y_var_norm) <span class="sc">%&gt;%</span></span>
<span id="cb397-3"><a href="#cb397-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exact_extract</span>(reg, <span class="at">fun =</span> <span class="st">&#39;mean&#39;</span>, <span class="at">append_cols =</span> <span class="st">&quot;region&quot;</span>, <span class="at">progress=</span>T) <span class="sc">%&gt;%</span></span>
<span id="cb397-4"><a href="#cb397-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">&quot;region&quot;</span>, <span class="fu">names</span>(y_var_norm)))</span>
<span id="cb397-5"><a href="#cb397-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>user; system; elapsed: 7.603; 3.071; 10.697</p>
<p>That was fast!</p>
<p>I should also get the sd:</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="#cb398-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(</span>
<span id="cb398-2"><a href="#cb398-2" aria-hidden="true" tabindex="-1"></a>regional_sd <span class="ot">&lt;-</span> <span class="fu">rast</span>(y_var_norm) <span class="sc">%&gt;%</span></span>
<span id="cb398-3"><a href="#cb398-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exact_extract</span>(reg, <span class="at">fun =</span> <span class="st">&#39;stdev&#39;</span>, <span class="at">append_cols =</span> <span class="st">&quot;region&quot;</span>, <span class="at">progress=</span>T) <span class="sc">%&gt;%</span></span>
<span id="cb398-4"><a href="#cb398-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">&quot;region&quot;</span>, <span class="fu">names</span>(y_var_norm)))</span>
<span id="cb398-5"><a href="#cb398-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>user; system; elapsed: 7.420; 2.921; 10.355</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="#cb399-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(regional_means, <span class="st">&quot;temp/regional_means.rds&quot;</span>)</span>
<span id="cb399-2"><a href="#cb399-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(regional_sd, <span class="st">&quot;temp/regional_sd.rds&quot;</span>)</span></code></pre></div>
<p>Reshape and plot</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="#cb400-1" aria-hidden="true" tabindex="-1"></a>div <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;reference_upper&quot;</span>,</span>
<span id="cb400-2"><a href="#cb400-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;reference_low&quot;</span>,</span>
<span id="cb400-3"><a href="#cb400-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;reference_low2&quot;</span>,</span>
<span id="cb400-4"><a href="#cb400-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;threshold_low&quot;</span>,</span>
<span id="cb400-5"><a href="#cb400-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;threshold_high&quot;</span>,</span>
<span id="cb400-6"><a href="#cb400-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;sd&quot;</span>)</span>
<span id="cb400-7"><a href="#cb400-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb400-8"><a href="#cb400-8" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> regional_means <span class="sc">%&gt;%</span></span>
<span id="cb400-9"><a href="#cb400-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb400-10"><a href="#cb400-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(region, div)</span>
<span id="cb400-11"><a href="#cb400-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb400-12"><a href="#cb400-12" aria-hidden="true" tabindex="-1"></a>regional_means_long <span class="ot">&lt;-</span> regional_means <span class="sc">%&gt;%</span></span>
<span id="cb400-13"><a href="#cb400-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb400-14"><a href="#cb400-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">all_of</span>(div)) <span class="sc">%&gt;%</span></span>
<span id="cb400-15"><a href="#cb400-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span>region) <span class="sc">%&gt;%</span></span>
<span id="cb400-16"><a href="#cb400-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="at">into=</span><span class="fu">c</span>(<span class="st">&quot;type&quot;</span>, <span class="st">&quot;year&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb400-17"><a href="#cb400-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="co">#id_cols = region,</span></span>
<span id="cb400-18"><a href="#cb400-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_from =</span> type)  <span class="sc">%&gt;%</span></span>
<span id="cb400-19"><a href="#cb400-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(temp, <span class="at">by=</span><span class="fu">join_by</span>(region)) <span class="sc">%&gt;%</span> </span>
<span id="cb400-20"><a href="#cb400-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> v<span class="sc">-</span>reference_upper) <span class="sc">%&gt;%</span></span>
<span id="cb400-21"><a href="#cb400-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">threshold_low_centered =</span> threshold_low<span class="sc">-</span>reference_upper) <span class="sc">%&gt;%</span></span>
<span id="cb400-22"><a href="#cb400-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">threshold_high_centered =</span> threshold_high<span class="sc">-</span>reference_upper)</span>
<span id="cb400-23"><a href="#cb400-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb400-24"><a href="#cb400-24" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding the spatial sd</span></span>
<span id="cb400-25"><a href="#cb400-25" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb400-26"><a href="#cb400-26" aria-hidden="true" tabindex="-1"></a>regional_means_long <span class="ot">&lt;-</span> regional_sd <span class="sc">%&gt;%</span></span>
<span id="cb400-27"><a href="#cb400-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">all_of</span>(div)) <span class="sc">%&gt;%</span></span>
<span id="cb400-28"><a href="#cb400-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span>region) <span class="sc">%&gt;%</span></span>
<span id="cb400-29"><a href="#cb400-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="at">into=</span><span class="fu">c</span>(<span class="st">&quot;type&quot;</span>, <span class="st">&quot;year&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb400-30"><a href="#cb400-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> type) <span class="sc">%&gt;%</span></span>
<span id="cb400-31"><a href="#cb400-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">i_sd =</span> i,</span>
<span id="cb400-32"><a href="#cb400-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">v_sd =</span> v) <span class="sc">%&gt;%</span></span>
<span id="cb400-33"><a href="#cb400-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(regional_means_long, <span class="at">by=</span><span class="fu">join_by</span>(region, year))</span>
<span id="cb400-34"><a href="#cb400-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb400-35"><a href="#cb400-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 330 × 15</span></span>
<span id="cb400-36"><a href="#cb400-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    region     year   i_sd  v_sd     i     v reference_upper</span></span>
<span id="cb400-37"><a href="#cb400-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt;</span></span>
<span id="cb400-38"><a href="#cb400-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Nord-Norge 2022  0.246  1.90 0.523  11.5            10.2</span></span>
<span id="cb400-39"><a href="#cb400-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Nord-Norge 2021  0.255  1.65 0.672  10.8            10.2</span></span>
<span id="cb400-40"><a href="#cb400-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Nord-Norge 2020  0.143  1.82 0.784  10.3            10.2</span></span>
<span id="cb400-41"><a href="#cb400-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Nord-Norge 2019  0.290  1.77 0.623  10.8            10.2</span></span>
<span id="cb400-42"><a href="#cb400-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Nord-Norge 2018  0.344  1.64 0.523  12.5            10.2</span></span>
<span id="cb400-43"><a href="#cb400-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Nord-Norge 2017  0.145  1.79 0.794  10.1            10.2</span></span>
<span id="cb400-44"><a href="#cb400-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Nord-Norge 2016  0.175  1.74 0.705  10.8            10.2</span></span>
<span id="cb400-45"><a href="#cb400-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Nord-Norge 2015  0.198  1.61 0.682  10.6            10.2</span></span>
<span id="cb400-46"><a href="#cb400-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Nord-Norge 2014  0.297  1.65 0.545  13.1            10.2</span></span>
<span id="cb400-47"><a href="#cb400-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Nord-Norge 2013  0.202  1.65 0.479  11.4            10.2</span></span>
<span id="cb400-48"><a href="#cb400-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 320 more rows</span></span>
<span id="cb400-49"><a href="#cb400-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 8 more variables: reference_low &lt;dbl&gt;,</span></span>
<span id="cb400-50"><a href="#cb400-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   reference_low2 &lt;dbl&gt;, threshold_low &lt;dbl&gt;,</span></span>
<span id="cb400-51"><a href="#cb400-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   threshold_high &lt;dbl&gt;, sd &lt;dbl&gt;, diff &lt;dbl&gt;,</span></span>
<span id="cb400-52"><a href="#cb400-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   threshold_low_centered &lt;dbl&gt;,</span></span>
<span id="cb400-53"><a href="#cb400-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   threshold_high_centered &lt;dbl&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="#cb401-1" aria-hidden="true" tabindex="-1"></a>regOrder <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Østlandet&quot;</span>,<span class="st">&quot;Sørlandet&quot;</span>,<span class="st">&quot;Vestlandet&quot;</span>,<span class="st">&quot;Midt-Norge&quot;</span>,<span class="st">&quot;Nord-Norge&quot;</span>)</span>
<span id="cb401-2"><a href="#cb401-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-3"><a href="#cb401-3" aria-hidden="true" tabindex="-1"></a>regional_means_long <span class="sc">%&gt;%</span></span>
<span id="cb401-4"><a href="#cb401-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">col =</span> <span class="fu">if_else</span>(diff<span class="sc">&gt;</span><span class="dv">0</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb401-5"><a href="#cb401-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(year), </span>
<span id="cb401-6"><a href="#cb401-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> diff, <span class="at">fill =</span> col))<span class="sc">+</span></span>
<span id="cb401-7"><a href="#cb401-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb401-8"><a href="#cb401-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> threshold_low_centered),</span>
<span id="cb401-9"><a href="#cb401-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">linetype=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb401-10"><a href="#cb401-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> threshold_high_centered),</span>
<span id="cb401-11"><a href="#cb401-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">linetype=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb401-12"><a href="#cb401-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> <span class="dv">1961</span>, <span class="at">xend=</span><span class="dv">1990</span>,</span>
<span id="cb401-13"><a href="#cb401-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">0</span>,</span>
<span id="cb401-14"><a href="#cb401-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb401-15"><a href="#cb401-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_hue</span>(<span class="at">l=</span><span class="dv">70</span>, <span class="at">c=</span><span class="dv">60</span>)<span class="sc">+</span></span>
<span id="cb401-16"><a href="#cb401-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb401-17"><a href="#cb401-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Sommertempratur</span><span class="sc">\n</span><span class="st">avvik fra 1961-1990&quot;</span>)<span class="sc">+</span></span>
<span id="cb401-18"><a href="#cb401-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>)<span class="sc">+</span></span>
<span id="cb401-19"><a href="#cb401-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill=</span><span class="st">&quot;none&quot;</span>)<span class="sc">+</span></span>
<span id="cb401-20"><a href="#cb401-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( .<span class="sc">~</span> <span class="fu">factor</span>(region, <span class="at">levels =</span> regOrder),</span>
<span id="cb401-21"><a href="#cb401-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">ncol=</span><span class="dv">3</span>,</span>
<span id="cb401-22"><a href="#cb401-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="climate_indicators_explained_files/figure-html/unnamed-chunk-83-1.png" alt="Times series for median summer temperature centered on the median value during the reference period. The reference period is indicated with a thick horizontal line. Dottet horisontal lines are 2 sd units for the reference period." width="672" />
<p class="caption">
(#fig:unnamed-chunk-83)Times series for median summer temperature centered on the median value during the reference period. The reference period is indicated with a thick horizontal line. Dottet horisontal lines are 2 sd units for the reference period.
</p>
</div>
<p>Then we can take the mean over the last 5 years and add to a spatial representation.</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="#cb402-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb402-2"><a href="#cb402-2" aria-hidden="true" tabindex="-1"></a>i_aggregatedToPeriods <span class="ot">&lt;-</span> regional_means_long <span class="sc">%&gt;%</span></span>
<span id="cb402-3"><a href="#cb402-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year)) <span class="sc">%&gt;%</span></span>
<span id="cb402-4"><a href="#cb402-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">period =</span> <span class="fu">case_when</span>(</span>
<span id="cb402-5"><a href="#cb402-5" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">%between%</span> <span class="fu">c</span>(<span class="dv">2018</span>, <span class="dv">2022</span>) <span class="sc">~</span> <span class="st">&quot;2018-2022&quot;</span>,</span>
<span id="cb402-6"><a href="#cb402-6" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">%between%</span> <span class="fu">c</span>(<span class="dv">2013</span>, <span class="dv">2017</span>) <span class="sc">~</span> <span class="st">&quot;2013-2017&quot;</span>,</span>
<span id="cb402-7"><a href="#cb402-7" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">%between%</span> <span class="fu">c</span>(<span class="dv">2008</span>, <span class="dv">2012</span>) <span class="sc">~</span> <span class="st">&quot;2008-2012&quot;</span>,</span>
<span id="cb402-8"><a href="#cb402-8" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">%between%</span> <span class="fu">c</span>(<span class="dv">2003</span>, <span class="dv">2007</span>) <span class="sc">~</span> <span class="st">&quot;2003-2007&quot;</span>,</span>
<span id="cb402-9"><a href="#cb402-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="st">&quot;pre 2003&quot;</span></span>
<span id="cb402-10"><a href="#cb402-10" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb402-11"><a href="#cb402-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">period_rank =</span> <span class="fu">case_when</span>(</span>
<span id="cb402-12"><a href="#cb402-12" aria-hidden="true" tabindex="-1"></a>   period <span class="sc">==</span> <span class="st">&quot;2018-2022&quot;</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb402-13"><a href="#cb402-13" aria-hidden="true" tabindex="-1"></a>   period <span class="sc">==</span> <span class="st">&quot;2013-2017&quot;</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb402-14"><a href="#cb402-14" aria-hidden="true" tabindex="-1"></a>   period <span class="sc">==</span> <span class="st">&quot;2008-2012&quot;</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb402-15"><a href="#cb402-15" aria-hidden="true" tabindex="-1"></a>   period <span class="sc">==</span> <span class="st">&quot;2003-2007&quot;</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb402-16"><a href="#cb402-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="dv">1</span></span>
<span id="cb402-17"><a href="#cb402-17" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb402-18"><a href="#cb402-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, period, period_rank) <span class="sc">%&gt;%</span></span>
<span id="cb402-19"><a href="#cb402-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">indicator =</span> <span class="fu">mean</span>(i),</span>
<span id="cb402-20"><a href="#cb402-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">spatial_sd =</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(i_sd<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="fu">length</span>(i_sd)</span>
<span id="cb402-21"><a href="#cb402-21" aria-hidden="true" tabindex="-1"></a>            <span class="co">#,</span></span>
<span id="cb402-22"><a href="#cb402-22" aria-hidden="true" tabindex="-1"></a>            <span class="co">#spatial_sd_mean = mean(i_sd),</span></span>
<span id="cb402-23"><a href="#cb402-23" aria-hidden="true" tabindex="-1"></a>            <span class="co">#spatial_sd2_max = max(i_sd),</span></span>
<span id="cb402-24"><a href="#cb402-24" aria-hidden="true" tabindex="-1"></a>            <span class="co">#spatial_sd2_length = length(i_sd)</span></span>
<span id="cb402-25"><a href="#cb402-25" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb402-26"><a href="#cb402-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb402-27"><a href="#cb402-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `summarise()` has grouped output by &#39;region&#39;, &#39;period&#39;. You</span></span>
<span id="cb402-28"><a href="#cb402-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; can override using the `.groups` argument.</span></span>
<span id="cb402-29"><a href="#cb402-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 25 × 5</span></span>
<span id="cb402-30"><a href="#cb402-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   region, period [25]</span></span>
<span id="cb402-31"><a href="#cb402-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    region     period    period_rank indicator spatial_sd</span></span>
<span id="cb402-32"><a href="#cb402-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb402-33"><a href="#cb402-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Midt-Norge 2003-2007           2     0.427     0.101 </span></span>
<span id="cb402-34"><a href="#cb402-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Midt-Norge 2008-2012           3     0.573     0.143 </span></span>
<span id="cb402-35"><a href="#cb402-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Midt-Norge 2013-2017           4     0.536     0.0986</span></span>
<span id="cb402-36"><a href="#cb402-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Midt-Norge 2018-2022           5     0.607     0.130 </span></span>
<span id="cb402-37"><a href="#cb402-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Midt-Norge pre 2003            1     0.642     0.0277</span></span>
<span id="cb402-38"><a href="#cb402-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Nord-Norge 2003-2007           2     0.460     0.122 </span></span>
<span id="cb402-39"><a href="#cb402-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Nord-Norge 2008-2012           3     0.675     0.109 </span></span>
<span id="cb402-40"><a href="#cb402-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Nord-Norge 2013-2017           4     0.641     0.0937</span></span>
<span id="cb402-41"><a href="#cb402-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Nord-Norge 2018-2022           5     0.625     0.118 </span></span>
<span id="cb402-42"><a href="#cb402-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Nord-Norge pre 2003            1     0.625     0.0266</span></span>
<span id="cb402-43"><a href="#cb402-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 15 more rows</span></span></code></pre></div>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="#cb403-1" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">&lt;-</span> <span class="fu">unique</span>(i_aggregatedToPeriods<span class="sc">$</span>period[<span class="fu">order</span>(i_aggregatedToPeriods<span class="sc">$</span>period_rank)])</span>
<span id="cb403-2"><a href="#cb403-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb403-3"><a href="#cb403-3" aria-hidden="true" tabindex="-1"></a>i_aggregatedToPeriods <span class="sc">%&gt;%</span></span>
<span id="cb403-4"><a href="#cb403-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> period_rank, </span>
<span id="cb403-5"><a href="#cb403-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> indicator,</span>
<span id="cb403-6"><a href="#cb403-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour=</span>region))<span class="sc">+</span></span>
<span id="cb403-7"><a href="#cb403-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb403-8"><a href="#cb403-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb403-9"><a href="#cb403-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>indicator<span class="sc">-</span>spatial_sd, </span>
<span id="cb403-10"><a href="#cb403-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax=</span>indicator<span class="sc">+</span>spatial_sd), </span>
<span id="cb403-11"><a href="#cb403-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">width=</span>.<span class="dv">2</span>,</span>
<span id="cb403-12"><a href="#cb403-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb403-13"><a href="#cb403-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb403-14"><a href="#cb403-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb403-15"><a href="#cb403-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb403-16"><a href="#cb403-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;indikatorverdi&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="climate_indicators_explained_files/figure-html/unnamed-chunk-85-1.png" alt="Scaled indicator values, aggregated over 5 year intervals. Errors represent spatial variation within regions and across years." width="672" />
<p class="caption">
(#fig:unnamed-chunk-85)Scaled indicator values, aggregated over 5 year intervals. Errors represent spatial variation within regions and across years.
</p>
</div>
<p>Finally, I can add these values to the sp object.</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true" tabindex="-1"></a>reg2 <span class="ot">&lt;-</span> reg <span class="sc">%&gt;%</span></span>
<span id="cb404-2"><a href="#cb404-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(i_aggregatedToPeriods[i_aggregatedToPeriods<span class="sc">$</span>period_rank<span class="sc">==</span><span class="dv">5</span>,], <span class="at">by=</span><span class="fu">join_by</span>(region))</span>
<span id="cb404-3"><a href="#cb404-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(reg2)</span>
<span id="cb404-4"><a href="#cb404-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;id&quot;          &quot;region&quot;      &quot;GID_0&quot;       &quot;NAME_0&quot;     </span></span>
<span id="cb404-5"><a href="#cb404-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5] &quot;period&quot;      &quot;period_rank&quot; &quot;indicator&quot;   &quot;spatial_sd&quot; </span></span>
<span id="cb404-6"><a href="#cb404-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [9] &quot;geometry&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="#cb405-1" aria-hidden="true" tabindex="-1"></a>myCol <span class="ot">&lt;-</span> <span class="st">&quot;RdYlGn&quot;</span></span>
<span id="cb405-2"><a href="#cb405-2" aria-hidden="true" tabindex="-1"></a>myCol2 <span class="ot">&lt;-</span> <span class="st">&quot;-RdYlGn&quot;</span></span>
<span id="cb405-3"><a href="#cb405-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-4"><a href="#cb405-4" aria-hidden="true" tabindex="-1"></a>tm_main <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(reg2)<span class="sc">+</span></span>
<span id="cb405-5"><a href="#cb405-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col=</span><span class="st">&quot;indicator&quot;</span>,</span>
<span id="cb405-6"><a href="#cb405-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">title=</span><span class="st">&quot;Indikator:</span><span class="sc">\n</span><span class="st">sommertemperatur&quot;</span>,</span>
<span id="cb405-7"><a href="#cb405-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> myCol,</span>
<span id="cb405-8"><a href="#cb405-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">style=</span><span class="st">&quot;fixed&quot;</span>,</span>
<span id="cb405-9"><a href="#cb405-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,.<span class="dv">2</span>)) </span>
<span id="cb405-10"><a href="#cb405-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb405-11"><a href="#cb405-11" aria-hidden="true" tabindex="-1"></a>tm_inset <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(reg2)<span class="sc">+</span></span>
<span id="cb405-12"><a href="#cb405-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col=</span><span class="st">&quot;spatial_sd&quot;</span>,</span>
<span id="cb405-13"><a href="#cb405-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">title=</span><span class="st">&quot;SD&quot;</span>,</span>
<span id="cb405-14"><a href="#cb405-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> myCol2,</span>
<span id="cb405-15"><a href="#cb405-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">style=</span><span class="st">&quot;cont&quot;</span>)<span class="sc">+</span></span>
<span id="cb405-16"><a href="#cb405-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.format =</span> <span class="fu">list</span>(<span class="at">digits=</span><span class="dv">2</span>))</span>
<span id="cb405-17"><a href="#cb405-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-18"><a href="#cb405-18" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(tm_main, </span>
<span id="cb405-19"><a href="#cb405-19" aria-hidden="true" tabindex="-1"></a>             tm_inset)</span></code></pre></div>
<div class="figure">
<img src="climate_indicators_explained_files/figure-html/unnamed-chunk-87-1.png" alt="Summer tempreature indicator values for five accounting areas in Norway. SD is the spatial variation." width="672" />
<p class="caption">
(#fig:unnamed-chunk-87)Summer tempreature indicator values for five accounting areas in Norway. SD is the spatial variation.
</p>
</div>
<!--chapter:end:climate_indicators_explained.Rmd-->
</div>
</div>
</div>
<!--bookdown:body:end-->
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Indicators for Ecosystem Condition in Norway</strong>" was written by Anders L. Kolstad. It was last built on 2023-03-24.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
